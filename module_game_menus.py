from header_common import *
from header_game_menus import *
from header_operations import *
from header_parties import *
from header_skills import *
from header_troops import *
from header_items import *
from header_item_modifiers import *
from header_mission_templates import *
from header_music import mtf_sit_town_infiltrate, mtf_sit_travel
from header_terrain_types import *
from ID_factions import *

from module_constants import *

####################################################################################################################
#  (menu-id, menu-flags, menu_text, mesh-name, [<operations>], [<options>]),
#
#   Each game menu is a tuple that contains the following fields:
#
#  1) Game-menu id (string): used for referencing game-menus in other files.
#     The prefix menu_ is automatically added before each game-menu-id
#
#  2) Game-menu flags (int). See header_game_menus.py for a list of available flags.
#     You can also specify menu text color here, with the menu_text_color macro
#  3) Game-menu text (string).
#  4) mesh-name (string). Not currently used. Must be the string "none"
#  5) Operations block (list). A list of operations. See header_operations.py for reference.
#     The operations block is executed when the game menu is activated.
#  6) List of Menu options (List).
#     Each menu-option record is a tuple containing the following fields:
#   6.1) Menu-option-id (string) used for referencing game-menus in other files.
#        The prefix mno_ is automatically added before each menu-option.
#   6.2) Conditions block (list). This must be a valid operation block. See header_operations.py for reference.
#        The conditions are executed for each menu option to decide whether the option will be shown to the player or not.
#   6.3) Menu-option text (string).
#   6.4) Consequences block (list). This must be a valid operation block. See header_operations.py for reference.
#        The consequences are executed for the menu option that has been selected by the player.
#
#
# Note: The first Menu is the initial character creation menu.
####################################################################################################################

game_menus = [
#chief cambiados textos de creacion de pj empieza dunde
  ("start_game_0",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "It rains. It is cold, too cold and for a moment you are afraid... but then you start to remember who you are.",
    "none",
    [],
    [
     ("introduccion",[],"Prelude",
       [
         #(start_presentation, "prsnt_brytenwalda_story"),
           #(jump_to_menu, "mnu_introduccion_1"),
           (jump_to_menu, "mnu_introduccion_2"),
        ]
       ),
     ("continue",[],"Character Creation",
       [(jump_to_menu, "mnu_start_game_1"),
        ]
       ),
      ("go_back",[],"Go back",
       [
         (change_screen_quit),
       ]),
    ]
  ),

  ("start_phase_2",mnf_disable_all_keys,
    "...Anno Domini 636...\
^The world is at war and respects only the law of the sword and spear. Realms are born and die every single day. Kings die on the battlefield.\
^In the north and east, the Angles consolidate domains and claim more land. Oswald, the new lord of the north, now rules Bernacia, Deira and Elmet.\
^In the south, the Saxons, led by Cynegils, have teamed up with Oswald and cornered Penda, King of the Angles of Mierce, The March. Will Mierce resist being surrounded by enemies? King Penda is bloody and violent -- many kings have been killed by his sword, and it seems his sword will kill many more.\
^Meanwhile, Christianity is extending out from Centware, land of the Jutes, converting the barbarians.\
^Pushed against the coast, the Welsh are fighting for every inch of land, but they are too divided. Dreaming of a king to unify them all and lead them to final victory, they wish for the return of King Arthur. But Arthur is dead, and all eyes look to Cynddylan, the king of Pengwern.\
^ And Gwynedd, the kingdom fertile with great warriors, is silent, unable to hear the sound of the armies advancing to threaten their land. Gwynedd mourns great king Cadwallon, scourge of the Angles and Saxons, who has left a son, a king three year old.\
^In the snowy lands of the far north fight the Irish, Dal Riata, and the Picts. Their kings share blood, but the Irish are invading the land of Cait, the Kingdom of the Picts. The Picts, with their faces painted and their female warriors, are now united under one king and are stronger than ever.\
^Across the sea, in Ireland, Domnaill mac Aedo of Ui Neill clan has emerged as High King in Temair after defeating his enemies, but it is nothing more than a prestigious title. Although he is called the most powerful of the island, around him clans are fighting for land, women and cattle in fratricidal wars. War in Ireland is endemic.\
^Who can bring light to this world of war and misery? The world was chaos, and chaos was war.\
^This is... BRYTENWALDA.",
    "none",
    [ (set_background_mesh, "mesh_pic_extra_barco"),],
    [
      ("town_1",[(eq, "$current_startup_quest_phase", 0), (is_between, "$character_nationality", 13, 19),    #Pict      or Briton
                 ],"I need go to Alt Clut, in the Briton Kingdom of Alt Clut.",
       [
         (assign, "$current_town", "p_town_6"),
         (assign, "$g_starting_town", "$current_town"),
         (assign, "$g_journey_string", "str_journey_to_praven"),
		 (jump_to_menu, "mnu_start_phase_2_5"),
#         (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
#         (change_screen_return),
       ]),

      ("town_2",[(eq, "$current_startup_quest_phase", 0), (neg|is_between, "$character_nationality", 13, 22),         #NOT Pict or Briton or Irish
                 ],"I need go to Grantebrycge, in the Angle Kingdom of the East Englas",
       [
         (assign, "$current_town", "p_town_8"),
         (assign, "$g_starting_town", "$current_town"),
         (assign, "$g_journey_string", "str_journey_to_reyvadin"),
		 (jump_to_menu, "mnu_start_phase_2_5"),
#         (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
#         (change_screen_return),
       ]),

      ("town_3",[(eq, "$current_startup_quest_phase", 0),(is_between, "$character_nationality", 16, 19),    #Briton
                 ],"I need go to Din Gonwy, in the Briton kingdom of Gwynedd.",
       [
         (assign, "$current_town", "p_town_13"),
         (assign, "$g_starting_town", "$current_town"),
         (assign, "$g_journey_string", "str_journey_to_tulga"),
		 (jump_to_menu, "mnu_start_phase_2_5"),
#         (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
#         (change_screen_return),
       ]),

      ("town_4",[(eq, "$current_startup_quest_phase", 0), (neg|is_between, "$character_nationality", 13, 22),         #NOT Pict or Briton or Irish
                 ],"I need go to Cantwaraburh, in the Christian Kingdom of Centware.",
       [
         (assign, "$current_town", "p_town_1"),
         (assign, "$g_starting_town", "$current_town"),
         (assign, "$g_journey_string", "str_journey_to_sargoth"),
		 (jump_to_menu, "mnu_start_phase_2_5"),
#         (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
#         (change_screen_return),
       ]),

      ("town_5",[(eq, "$current_startup_quest_phase", 0),
                 (is_between, "$character_nationality", 19, 22),    #Irish
                 ],"I need go to Clochair, in the Irish Kingdom of Airgialla.",
       [
         (assign, "$current_town", "p_town_40"),
         (assign, "$g_starting_town", "$current_town"),
         (assign, "$g_journey_string", "str_journey_to_jelkala"),
		 (jump_to_menu, "mnu_start_phase_2_5"),
#         (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
#         (change_screen_return),
       ]),

      ("town_6",[(eq, "$current_startup_quest_phase", 0),(is_between, "$character_nationality", 19, 22),    #Irish
                 ],"I need go to Dun Iasgach, in the Irish kingdom of Mumain.",
       [
         (assign, "$current_town", "p_town_35"),
         (assign, "$g_starting_town", "$current_town"),
         (assign, "$g_journey_string", "str_journey_to_shariz"),
		 (jump_to_menu, "mnu_start_phase_2_5"),
#         (party_relocate_near_party, "p_main_party", "$g_starting_town", 2),
#         (change_screen_return),
       ]),
#chief cambiados textos de presentacion de pj acaba


      ("tutorial_cheat",[(eq,1,0)],"{!}CHEAT!",
       [
         (change_screen_return),
         (assign, "$cheat_mode", 1),
         (set_show_messages, 0),
		 (add_xp_to_troop, 15000, "trp_player"),
         (troop_raise_skill, "trp_player", skl_leadership, 7),
         (troop_raise_skill, "trp_player", skl_prisoner_management, 5),
         (troop_raise_skill, "trp_player", skl_inventory_management, 10),
         (party_add_members, "p_main_party", "trp_swadian_knight", 10),
         (party_add_members, "p_main_party", "trp_vaegir_knight", 10),
         (party_add_members, "p_main_party", "trp_vaegir_archer", 10),
         (party_add_members, "p_main_party", "trp_swadian_sharpshooter", 10),
         (troop_add_item, "trp_player","itm_scale_armor",0),
         (troop_add_item, "trp_player","itm_full_helm",0),

         (troop_add_item, "trp_player","itm_hafted_blade_b",0),
         (troop_add_item, "trp_player","itm_hafted_blade_a",0),
         (troop_add_item, "trp_player","itm_morningstar",0),
         (troop_add_item, "trp_player","itm_tutorial_spear",0),
         (troop_add_item, "trp_player","itm_tutorial_staff",0),
         (troop_add_item, "trp_player","itm_tutorial_staff_no_attack",0),
         (troop_add_item, "trp_player","itm_arena_lance",0),
         (troop_add_item, "trp_player","itm_practice_staff",0),
         (troop_add_item, "trp_player","itm_practice_lance",0),
         (troop_add_item, "trp_player","itm_practice_javelin",0),
         (troop_add_item, "trp_player","itm_scythe",0),
         (troop_add_item, "trp_player","itm_pitch_fork",0),
         (troop_add_item, "trp_player","itm_military_fork",0),
         (troop_add_item, "trp_player","itm_battle_fork",0),
         (troop_add_item, "trp_player","itm_boar_spear",0),
         (troop_add_item, "trp_player","itm_spear_1",0),
         (troop_add_item, "trp_player","itm_hasta",0),
         (troop_add_item, "trp_player","itm_spear_1",0),
         (troop_add_item, "trp_player","itm_spear_2",0),
         (troop_add_item, "trp_player","itm_spear_3",0),
         (troop_add_item, "trp_player","itm_staff",0),
         (troop_add_item, "trp_player","itm_quarter_staff",0),
         (troop_add_item, "trp_player","itm_shepherds_crook",0),
         (troop_add_item, "trp_player","itm_shortened_spear",0),
         (troop_add_item, "trp_player","itm_spear",0),
         (troop_add_item, "trp_player","itm_war_spear",0),
         (troop_add_item, "trp_player","itm_spear_4",0),
         (troop_add_item, "trp_player","itm_war_spear",0),
         (troop_add_item, "trp_player","itm_hasta",0),
         (troop_add_item, "trp_player","itm_shepherds_crook",0),
         (troop_add_item, "trp_player","itm_hasta",0),
         (troop_add_item, "trp_player","itm_spear_6",0),
         (troop_add_item, "trp_player","itm_war_spear",0),
         (troop_add_item, "trp_player","itm_spear_7",0),
         (troop_add_item, "trp_player","itm_throwing_spears",0),
         (troop_add_item, "trp_player","itm_javelin",0),
         (troop_add_item, "trp_player","itm_throwing_spears",0),

         (troop_add_item, "trp_player","itm_long_axe_b",0),

         (set_show_messages, 1),

         (try_for_range, ":cur_place", scenes_begin, scenes_end),
           (scene_set_slot, ":cur_place", slot_scene_visited, 1),
         (try_end),

         (call_script, "script_get_player_party_morale_values"),
         (party_set_morale, "p_main_party", reg0),
       ]
	   ),
    ]
  ),




  (
    "start_game_3",mnf_disable_all_keys,
    "Choose your scenario:",
    "none",
    [
      (assign, "$g_custom_battle_scenario", 0),
      (assign, "$g_custom_battle_scenario", "$g_custom_battle_scenario"),
##      #Default banners
##      (troop_set_slot, "trp_banner_background_color_array", 126, 0xFF212221),
##      (troop_set_slot, "trp_banner_background_color_array", 127, 0xFF212221),
##      (troop_set_slot, "trp_banner_background_color_array", 128, 0xFF2E3B10),
##      (troop_set_slot, "trp_banner_background_color_array", 129, 0xFF425D7B),
##      (troop_set_slot, "trp_banner_background_color_array", 130, 0xFF394608),
      ],
    [
##      ("custom_battle_scenario_1",[], "Skirmish 1",
##       [
##           (assign, "$g_custom_battle_scenario", 0),
##           (jump_to_menu, "mnu_custom_battle_2"),
##
##        ]
##       ),
####      ("custom_battle_scenario_2",[],"Siege Attack 1",
####       [
####           (assign, "$g_custom_battle_scenario", 1),
####           (jump_to_menu, "mnu_custom_battle_2"),
####
####        ]
####       ),
##      ("custom_battle_scenario_3",[],"Skirmish 2",
##       [
##           (assign, "$g_custom_battle_scenario", 1),
##           (jump_to_menu, "mnu_custom_battle_2"),
##
##        ]
##       ),
##       ("custom_battle_scenario_4",[],"Siege Defense",
##       [
##           (assign, "$g_custom_battle_scenario", 2),
##           (jump_to_menu, "mnu_custom_battle_2"),
##        ]
##       ),
##       ("custom_battle_scenario_5",[],"Skirmish 3",
##       [
##           (assign, "$g_custom_battle_scenario", 3),
##           (jump_to_menu, "mnu_custom_battle_2"),
##        ]
##       ),
##      ("custom_battle_scenario_6",[],"Siege Attack",
##       [
##           (assign, "$g_custom_battle_scenario", 4),
##           (jump_to_menu, "mnu_custom_battle_2"),
##
##        ]
##       ),
      ("go_back",[],"Go back",
       [(change_screen_quit),
        ]
		),
    ]
  ),

##  ("start_game_3",mnf_disable_all_keys,
##    "Choose your scenario:",
##    "none",
##    [
##      (assign, "$g_custom_battle_scenario", 0),
##      (assign, "$g_custom_battle_scenario", "$g_custom_battle_scenario"),
####      #Default banners
####      (troop_set_slot, "trp_banner_background_color_array", 126, 0xFF212221),
####      (troop_set_slot, "trp_banner_background_color_array", 127, 0xFF212221),
####      (troop_set_slot, "trp_banner_background_color_array", 128, 0xFF2E3B10),
####      (troop_set_slot, "trp_banner_background_color_array", 129, 0xFF425D7B),
####      (troop_set_slot, "trp_banner_background_color_array", 130, 0xFF394608),
##      ],
##    [
####      ("custom_battle_scenario_1",[], "Skirmish 1",
####       [
####           (assign, "$g_custom_battle_scenario", 0),
####           (jump_to_menu, "mnu_custom_battle_2"),
####
####        ]
####       ),
######      ("custom_battle_scenario_2",[],"Siege Attack 1",
######       [
######           (assign, "$g_custom_battle_scenario", 1),
######           (jump_to_menu, "mnu_custom_battle_2"),
######
######        ]
######       ),
####      ("custom_battle_scenario_3",[],"Skirmish 2",
####       [
####           (assign, "$g_custom_battle_scenario", 1),
####           (jump_to_menu, "mnu_custom_battle_2"),
####
####        ]
####       ),
####       ("custom_battle_scenario_4",[],"Siege Defense",
####       [
####           (assign, "$g_custom_battle_scenario", 2),
####           (jump_to_menu, "mnu_custom_battle_2"),
####        ]
####       ),
####       ("custom_battle_scenario_5",[],"Skirmish 3",
####       [
####           (assign, "$g_custom_battle_scenario", 3),
####           (jump_to_menu, "mnu_custom_battle_2"),
####        ]
####       ),
####      ("custom_battle_scenario_6",[],"Siege Attack",
####       [
####           (assign, "$g_custom_battle_scenario", 4),
####           (jump_to_menu, "mnu_custom_battle_2"),
####
####        ]
####       ),
##      ("go_back",[],"Go back",
##       [(change_screen_quit),
##        ]
##       ),
##    ]
##  ),

  (
    "tutorial",mnf_disable_all_keys,
    "You approach a field where the locals are training with weapons. You can practice here to improve your combat skills.",
    "none",
    [
      (try_begin),
        (eq, "$g_tutorial_entered", 1),
        (change_screen_quit),
      (else_try),
        (set_passage_menu, "mnu_tutorial"),
##        (try_begin),
##          (eq, "$tutorial_1_finished", 1),
##          (str_store_string, s1, "str_finished"),
##        (else_try),
##          (str_store_string, s1, "str_empty_string"),
##        (try_end),
##        (try_begin),
##          (eq, "$tutorial_2_finished", 1),
##          (str_store_string, s2, "str_finished"),
##        (else_try),
##          (str_store_string, s2, "str_empty_string"),
##        (try_end),
##        (try_begin),
##          (eq, "$tutorial_3_finished", 1),
##          (str_store_string, s3, "str_finished"),
##        (else_try),
##          (str_store_string, s3, "str_empty_string"),
##        (try_end),
##        (try_begin),
##          (eq, "$tutorial_4_finished", 1),
##          (str_store_string, s4, "str_finished"),
##        (else_try),
##          (str_store_string, s4, "str_empty_string"),
##        (try_end),
##        (try_begin),
##          (eq, "$tutorial_5_finished", 1),
##          (str_store_string, s5, "str_finished"),
##        (else_try),
##          (str_store_string, s5, "str_empty_string"),
##        (try_end),
        (assign, "$g_tutorial_entered", 1),
      (try_end),
    ],
    [
##      ("tutorial_1",
##      [(eq,1,0),],
##      "Tutorial #1: Basic movement and weapon selection. {s1}",
##      [
##        #(modify_visitors_at_site,"scn_tutorial_1"),(reset_visitors,0),
####           (set_jump_mission,"mt_tutorial_1"),
####           (jump_to_scene,"scn_tutorial_1"),(change_screen_mission)]),
##      ]),
##
##      ("tutorial_2",[(eq,1,0),],"Tutorial #2: Fighting with a shield. {s2}",[
####           (modify_visitors_at_site,"scn_tutorial_2"),(reset_visitors,0),
####           (set_visitor,1,"trp_tutorial_maceman"),
####           (set_visitor,2,"trp_tutorial_archer"),
####           (set_jump_mission,"mt_tutorial_2"),
####           (jump_to_scene,"scn_tutorial_2"),(change_screen_mission)]),
##           (modify_visitors_at_site,"scn_tutorial_training_ground"),
##           (reset_visitors, 0),
##           (set_player_troop, "trp_player"),
##           (set_visitor,0,"trp_player"),
##           (set_jump_mission,"mt_ai_training"),
##           (jump_to_scene,"scn_tutorial_training_ground"),
##           (change_screen_mission)]),
##
##      ("tutorial_3",[(eq,1,0),],"Tutorial #3: Fighting without a shield. {s3}",[
##           (modify_visitors_at_site,"scn_tutorial_3"),(reset_visitors,0),
##           (set_visitor,1,"trp_tutorial_maceman"),
##           (set_visitor,2,"trp_tutorial_swordsman"),
##           (set_jump_mission,"mt_tutorial_3"),
##           (jump_to_scene,"scn_tutorial_3"),(change_screen_mission)]),
##      ("tutorial_3b",[(eq,0,1)],"Tutorial 3 b",[(try_begin),
##                                                  (ge, "$tutorial_3_state", 12),
##                                                  (modify_visitors_at_site,"scn_tutorial_3"),(reset_visitors,0),
##                                                  (set_visitor,1,"trp_tutorial_maceman"),
##                                                  (set_visitor,2,"trp_tutorial_swordsman"),
##                                                  (set_jump_mission,"mt_tutorial_3_2"),
##                                                  (jump_to_scene,"scn_tutorial_3"),
##                                                  (change_screen_mission),
##                                                (else_try),
##                                                  (display_message,"str_door_locked",0xFFFFAAAA),
##                                                (try_end)], "Next level"),
##      ("tutorial_4",[(eq,1,0),],"Tutorial #4: Riding a horse. {s4}",[
##           (modify_visitors_at_site,"scn_tutorial_training_ground"),
##           (reset_visitors, 0),
##           (set_player_troop, "trp_player"),
##           (assign, "$g_player_troop", "trp_player"),
##           (troop_raise_attribute, "$g_player_troop", ca_strength, 12),
##           (troop_raise_attribute, "$g_player_troop", ca_agility, 9),
##           (troop_raise_attribute, "$g_player_troop", ca_charisma, 5),
##           (troop_raise_skill, "$g_player_troop", skl_shield, 3),
##           (troop_raise_skill, "$g_player_troop", skl_athletics, 2),
##           (troop_raise_skill, "$g_player_troop", skl_riding, 3),
##           (troop_raise_skill, "$g_player_troop", skl_power_strike, 1),
##           (troop_raise_skill, "$g_player_troop", skl_power_draw, 5),
##           (troop_raise_skill, "$g_player_troop", skl_weapon_master, 4),
##           (troop_raise_skill, "$g_player_troop", skl_ironflesh, 1),
##           (troop_raise_skill, "$g_player_troop", skl_horse_archery, 6),
##           (troop_raise_proficiency_linear, "$g_player_troop", wpt_one_handed_weapon, 70),
##           (troop_raise_proficiency_linear, "$g_player_troop", wpt_two_handed_weapon, 70),
##           (troop_raise_proficiency_linear, "$g_player_troop", wpt_polearm, 70),
##           (troop_raise_proficiency_linear, "$g_player_troop", wpt_crossbow, 70),
##           (troop_raise_proficiency_linear, "$g_player_troop", wpt_throwing, 70),
##
##        (troop_clear_inventory, "$g_player_troop"),
##        (troop_add_item, "$g_player_troop","itm_leather_jerkin",0),
##        (troop_add_item, "$g_player_troop","itm_leather_boots",0),
##        (troop_add_item, "$g_player_troop","itm_practice_sword",0),
##        (troop_add_item, "$g_player_troop","itm_quarter_staff",0),
##        (troop_equip_items, "$g_player_troop"),
##        (set_visitor,0,"trp_player"),
##        (set_visitor,32,"trp_tutorial_fighter_1"),
##        (set_visitor,33,"trp_tutorial_fighter_2"),
##        (set_visitor,34,"trp_tutorial_fighter_3"),
##        (set_visitor,35,"trp_tutorial_fighter_4"),
##        (set_visitor,40,"trp_tutorial_master_archer"),
##        (set_visitor,41,"trp_tutorial_archer_1"),
##        (set_visitor,42,"trp_tutorial_archer_1"),
##        (set_visitor,60,"trp_tutorial_master_horseman"),
##        (set_visitor,61,"trp_tutorial_rider_1"),
##        (set_visitor,62,"trp_tutorial_rider_1"),
##        (set_visitor,63,"trp_tutorial_rider_2"),
##        (set_visitor,64,"trp_tutorial_rider_2"),
##        (set_jump_mission,"mt_tutorial_training_ground"),
##        (jump_to_scene,"scn_tutorial_training_ground"),
##        (change_screen_mission),
##      ]),
##
##      ("tutorial_5",
##      [
##        (eq,1,0),
##      ],
##      "Tutorial #5: Commanding a band of soldiers. {s5}",
##      [
##        (modify_visitors_at_site,"scn_tutorial_5"),(reset_visitors,0),
##        (set_visitor,0,"trp_player"),
##        (set_visitor,1,"trp_vaegir_infantry"),
##        (set_visitor,2,"trp_vaegir_infantry"),
##        (set_visitor,3,"trp_vaegir_infantry"),
##        (set_visitor,4,"trp_vaegir_infantry"),
##        (set_jump_mission,"mt_tutorial_5"),
##        (jump_to_scene,"scn_tutorial_5"),
##        (change_screen_mission),
##      ]),
##
##      ("tutorial_edit_custom_battle_scenes",
##      [(eq,1,0),],
##      "(NO TRANSLATE) tutorial_edit_custom_battle_scenes",
##      [
##        (jump_to_menu,"mnu_custom_battle_scene"),
##      ]),

      ("continue",[],"Continue...",
      [
        (modify_visitors_at_site,"scn_tutorial_training_ground"),
        (reset_visitors, 0),
        (set_player_troop, "trp_player"),
        (assign, "$g_player_troop", "trp_player"),
        (troop_raise_attribute, "$g_player_troop", ca_strength, 12),
        (troop_raise_attribute, "$g_player_troop", ca_agility, 9),
        (troop_raise_attribute, "$g_player_troop", ca_charisma, 5),
        (troop_raise_skill, "$g_player_troop", skl_shield, 3),
        (troop_raise_skill, "$g_player_troop", skl_athletics, 2),
        (troop_raise_skill, "$g_player_troop", skl_riding, 3),
        (troop_raise_skill, "$g_player_troop", skl_power_strike, 1),
        (troop_raise_skill, "$g_player_troop", skl_power_draw, 5),
        (troop_raise_skill, "$g_player_troop", skl_weapon_master, 4),
        (troop_raise_skill, "$g_player_troop", skl_ironflesh, 1),
        (troop_raise_skill, "$g_player_troop", skl_horse_archery, 6),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_one_handed_weapon, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_two_handed_weapon, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_polearm, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_crossbow, 70),
        (troop_raise_proficiency_linear, "$g_player_troop", wpt_throwing, 70),

        (troop_clear_inventory, "$g_player_troop"),
        (troop_add_item, "$g_player_troop","itm_leather_jerkin",0),
        (troop_add_item, "$g_player_troop","itm_leather_boots",0),
        (troop_add_item, "$g_player_troop","itm_practice_sword",0),
        (troop_add_item, "$g_player_troop","itm_quarter_staff",0),
        (troop_equip_items, "$g_player_troop"),
        (set_visitor,0,"trp_player"),
        (set_visitor,32,"trp_tutorial_fighter_1"),
        (set_visitor,33,"trp_tutorial_fighter_2"),
        (set_visitor,34,"trp_tutorial_fighter_3"),
        (set_visitor,35,"trp_tutorial_fighter_4"),
        (set_visitor,40,"trp_tutorial_master_archer"),
        (set_visitor,41,"trp_tutorial_archer_1"),
        (set_visitor,42,"trp_tutorial_archer_1"),
        (set_visitor,60,"trp_tutorial_master_horseman"),
        (set_visitor,61,"trp_tutorial_rider_1"),
        (set_visitor,62,"trp_tutorial_rider_1"),
        (set_visitor,63,"trp_tutorial_rider_2"),
        (set_visitor,64,"trp_tutorial_rider_2"),
        (set_jump_mission,"mt_tutorial_training_ground"),
        (jump_to_scene,"scn_tutorial_training_ground"),
        (change_screen_mission),
        ]),

      ("go_back_dot",
      [],
      "Go back.",
       [
         (change_screen_quit),
       ]),
    ]
  ),

  ("reports",0,
   "Character Renown: {reg5}^Reputation Rating: {reg6}^Party Morale: {reg8}^Party Size Limit: {reg7}^", #diplomacy chief cambia
   "none",
   [(call_script, "script_game_get_party_companion_limit"),
    (assign, ":party_size_limit", reg0),
    (troop_get_slot, ":renown", "trp_player", slot_troop_renown),
    (assign, reg5, ":renown"),
    (assign, reg6, "$player_honor"),
    (assign, reg7, ":party_size_limit"),
    #(call_script, "script_get_player_party_morale_values"),
    #(party_set_morale, "p_main_party", reg0),
    (party_get_morale, reg8, "p_main_party"),
#TEMPERED chief  CHANGES BEGIN DISPLAY POISONED LORDS AND COMMONER RELATIONS
	(call_script,"script_peasant_approval"),
	(assign,":num_poisoned",0),
	(str_clear,s1),
	(str_clear,s18),
	(try_for_range,":cur_lord",kingdom_heroes_begin,kingdom_heroes_end),
		(troop_slot_ge,":cur_lord",slot_troop_poisoned,1),
		(str_store_troop_name_link,s1,":cur_lord"),
		(str_store_string,s18,"@ {s18} {s1},"),
		(val_add,":num_poisoned",1),
	(try_end),
	(try_begin),
		(lt,":num_poisoned",1),
		(str_store_string,s18,"@ None"),
	(try_end),
#TEMPERED chief CHANGES END
    ##diplomacy chief begin
    (str_clear, s1),
    (try_begin),
	    (gt, "$g_next_pay_time", 0),
      (str_store_date, s1, "$g_next_pay_time"),
      (str_store_string, s1, "@ Next pay day: {s1}"),
    (try_end),

    (try_begin),
      (is_between, "$g_player_affiliated_troop", lords_begin, kingdom_ladies_end),
      (str_store_troop_name, s5, "$g_player_affiliated_troop"),
      (str_store_string, s1, "@{s1}^^Affiliated to {s5}"),
    (try_end),
    ##diplomacy end
   ],
    [
      ("cheat_faction_orders",[(ge,"$cheat_mode",1)],"{!}Cheat: Faction orders.",
       [(jump_to_menu, "mnu_faction_orders"),
        ]
       ),

      ("view_character_report",[],"View character report.",
       [(jump_to_menu, "mnu_character_report"),
        ]
       ),
      ("view_party_size_report",[],"View party size report.",
       [(jump_to_menu, "mnu_party_size_report"),
        ]
       ),

      ## CC chief arbol tropas
##      ("action_view_upgrade_trees",[],"View upgrade trees.",
##       [(start_presentation, "prsnt_upgrade_tree_1"),
##        ]
##       ),
#chief arbol de tropas acaba
      ("view_npc_mission_report",[],"View companion mission report.",
       [(jump_to_menu, "mnu_companion_report"),
        ]
       ),

      ("view_weekly_budget_report",[
          ],"View weekly budget report.",
       [
#				(display_message, "@Next pay day: {s1}"),

         (assign, "$g_apply_budget_report_to_gold", 0),
         (start_presentation, "prsnt_budget_report"),
        ]
       ),
      ("view_morale_report",[],"View party morale report.",
       [(jump_to_menu, "mnu_morale_report"),
        ]
       ),


		# chief para submenus de economia
		("economia_rp",[],"Troops Tree, Prosperity and Spy Reports",
			[(jump_to_menu, "mnu_economia_report"),]),

		# Moneylending duh chief
		("view_bank_report",[],"View Financial Report",
			[(start_presentation, "prsnt_bank_quickview"),]),


#NPC companion changes begin
      ("lord_relations",[],"View list of known lords by relation.",
       [
         # Jrider chief +
     #(jump_to_menu, "mnu_lord_relations"),
         (assign, "$g_jrider_pres_called_from_menu", 1),
         (assign, "$g_character_presentation_type", 1),
         (start_presentation, "prsnt_jrider_character_relation_report"),
         # Jrider chief -
        ]
       ),

      ("courtship_relations",[],"View courtship relations.",
       [
         # Jrider chief +
      #(jump_to_menu, "mnu_courtship_relations"),
         (assign, "$g_jrider_pres_called_from_menu", 1),
         (assign, "$g_character_presentation_type", 0),
         (start_presentation, "prsnt_jrider_character_relation_report"),
         # Jrider chief -
        ]
       ),

      ("status_check",[(eq,"$cheat_mode",1)],"{!}NPC status check.",
       [
        (try_for_range, ":npc", companions_begin, companions_end),
            (main_party_has_troop, ":npc"),
            (str_store_troop_name, 4, ":npc"),
            (troop_get_slot, reg3, ":npc", slot_troop_morality_state),
            (troop_get_slot, reg4, ":npc", slot_troop_2ary_morality_state),
            (troop_get_slot, reg5, ":npc", slot_troop_personalityclash_state),
            (troop_get_slot, reg6, ":npc", slot_troop_personalityclash2_state),
            (troop_get_slot, reg7, ":npc", slot_troop_personalitymatch_state),
            (display_message, "@{!}{s4}: M{reg3}, 2M{reg4}, PC{reg5}, 2PC{reg6}, PM{reg7}"),
        (try_end),
        ]
       ),

#NPC companion changes end
#########JEDEDIAH Q chief START ######################################################
     ("Companions_overview",[],"Companions overview.",
      [
	(assign, "$jq_in_market_menu", 0), # player is not in market menu
	#Exit if no companions
	(assign, ":heroes_in_party", 0),
	(try_for_range, reg3, companions_begin, companions_end),
   	(main_party_has_troop, reg3),
	(val_add, ":heroes_in_party", 1),
	 (try_end),
	    (try_begin),
	 	(eq, ":heroes_in_party", 0),
		(display_message,"@No companions in party!",0xFFFF0000),
	(else_try),
	(gt, "$jq_startpage", 1),
	(start_presentation, "prsnt_jq_extended_info"),
	(else_try),
	(start_presentation, "prsnt_jq_companions_quickview"),
     	(try_end),
       ]
     ),
#########JEDEDIAH chief Q END #######################################################

      ("view_faction_relations_report",[],"View faction relations report.",
       [
           # Jrider + REPORTS PRESENTATIONS 1.0, comment to hook faction report presentation
           ##(jump_to_menu, "mnu_faction_relations_report"),
           (start_presentation, "prsnt_jrider_faction_relations_report"),
           # Jrider -
        ]
       ),
#diplomacy chief
##           ("dplmc_show_economic_report",[],"View prosperity report.",
##       [
##           (jump_to_menu, "mnu_dplmc_economic_report"),
##        ]
##       ),

#chief presetation companeros relation
      # Jrider +
      ("view_player_companion_report",[],"View player and companions report.",
       [
         # init variables before starting
         (assign, "$g_jrider_pres_called_from_menu", 1),
         (assign, "$g_character_presentation_type", 2),
         (start_presentation, "prsnt_jrider_character_relation_report"),
        ]
       ),
      # Jrider -
#chief acaba
#TEMPERED  chief ######################   SPY REPORT ######################################

##      ("spy_report",[],"View Spy reports.",
##		[
##			(start_presentation, "prsnt_spy_reports"),
##        ]),


      ("resume_travelling",[],"Resume travelling.",
       [	(str_clear,s1),
			(str_clear,s2),
			(str_clear,s3),
			(str_clear,s4),
			(str_clear,s5),
			(str_clear,s6),
			(str_clear,s7),
			(str_clear,s8),
			(str_clear,s9),
			(str_clear,s18),
			(change_screen_return),
#tempered chief acaba spy report
##      ("resume_travelling",[],"Resume travelling.", #off comment tempered chief
##       [(change_screen_return), #off comment tempered chief
        ]
       ),
      ]
  ),

  (
    "custom_battle_scene",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "(NO_TRANS)",

    "none",
    [],
    [

      ("quick_battle_scene_1",[],"{!}quick_battle_scene_1",
       [
           (set_jump_mission,"mt_ai_training"),
           (jump_to_scene,"scn_quick_battle_scene_1"),(change_screen_mission)
		]
       ),
      ("quick_battle_scene_2",[],"{!}quick_battle_scene_2",
       [
           (set_jump_mission,"mt_ai_training"),
           (jump_to_scene,"scn_quick_battle_scene_2"),(change_screen_mission)
		]
       ),
      ("quick_battle_scene_3",[],"{!}quick_battle_scene_3",
       [
           (set_jump_mission,"mt_ai_training"),
           (jump_to_scene,"scn_quick_battle_scene_3"),(change_screen_mission)
		]
       ),
      ("quick_battle_scene_4",[],"{!}quick_battle_scene_4",
       [
           (set_jump_mission,"mt_ai_training"),
           (jump_to_scene,"scn_quick_battle_scene_4"),(change_screen_mission)
		]
       ),
      ("quick_battle_scene_5",[],"{!}quick_battle_scene_5",
       [
           (set_jump_mission,"mt_ai_training"),
           (jump_to_scene,"scn_quick_battle_scene_5"),(change_screen_mission)
		]
       ),

      ("go_back",[],"{!}Go back",
       [(change_screen_quit),
        ]
       ),
      ]
  ),

  #depreciated
##  (
##    "custom_battle_2",mnf_disable_all_keys,
##    "{s16}",
##    "none",
##    [
##     (assign, "$g_battle_result", 0),
##     (set_show_messages, 0),
##
##     (troop_clear_inventory, "trp_player"),
##     (troop_raise_attribute, "trp_player", ca_strength, -1000),
##     (troop_raise_attribute, "trp_player", ca_agility, -1000),
##     (troop_raise_attribute, "trp_player", ca_charisma, -1000),
##     (troop_raise_attribute, "trp_player", ca_intelligence, -1000),
##     (troop_raise_skill, "trp_player", skl_shield, -1000),
##     (troop_raise_skill, "trp_player", skl_athletics, -1000),
##     (troop_raise_skill, "trp_player", skl_riding, -1000),
##     (troop_raise_skill, "trp_player", skl_power_strike, -1000),
##     (troop_raise_skill, "trp_player", skl_power_throw, -1000),
##     (troop_raise_skill, "trp_player", skl_weapon_master, -1000),
##     (troop_raise_skill, "trp_player", skl_horse_archery, -1000),
##     (troop_raise_skill, "trp_player", skl_ironflesh, -1000),
##     (troop_raise_proficiency_linear, "trp_player", wpt_one_handed_weapon, -10000),
##     (troop_raise_proficiency_linear, "trp_player", wpt_two_handed_weapon, -10000),
##     (troop_raise_proficiency_linear, "trp_player", wpt_polearm, -10000),
##     (troop_raise_proficiency_linear, "trp_player", wpt_archery, -10000),
##     (troop_raise_proficiency_linear, "trp_player", wpt_crossbow, -10000),
##     (troop_raise_proficiency_linear, "trp_player", wpt_throwing, -10000),
##
##     (reset_visitors),
####   Scene 1 Start "Shalow Lake War"
##     (try_begin),
##       (eq, "$g_custom_battle_scenario", 0),
##       (assign, "$g_player_troop", "trp_knight_1_15"),
##       (set_player_troop, "$g_player_troop"),
##
##       (assign, "$g_custom_battle_scene", "scn_quick_battle_1"),
##       (modify_visitors_at_site, "$g_custom_battle_scene"),
##       (set_visitor, 0, "$g_player_troop"),
##
###       (troop_add_item, "trp_player","itm_bascinet",0),
###       (troop_add_item, "trp_player","itm_mail_with_surcoat",0),
###       (troop_add_item, "trp_player","itm_bastard_sword_a",0),
###       (troop_add_item, "trp_player","itm_war_bow",0),
###       (troop_add_item, "trp_player","itm_khergit_arrows",0),
###       (troop_add_item, "trp_player","itm_kite_shield",0),
###       (troop_add_item, "trp_player","itm_hunter",0),
###       (troop_add_item, "trp_player","itm_mail_chausses",0),
###       (troop_equip_items, "trp_player"),
##
##       (set_visitors, 1, "trp_farmer", 13),
##       (set_visitors, 2, "trp_swadian_sergeant", 5),
##       (set_visitors, 3, "trp_swadian_sharpshooter", 4),
##       (set_visitors, 4, "trp_swadian_man_at_arms", 8),
##       (set_visitors, 5, "trp_swadian_knight", 3),
##       (set_visitors, 6, "trp_peasant_woman", 7),
##
####     Enemy
##       (set_visitors, 16, "trp_vaegir_infantry", 6),
##       (set_visitors, 17, "trp_vaegir_archer", 6),
##       (set_visitors, 18, "trp_vaegir_horseman", 4),
##       (set_visitors, 19, "trp_vaegir_knight", 10),
##       (set_visitors, 20, "trp_vaegir_guard", 6),
##       (str_store_string, s16, "str_custom_battle_1"),
##
####   SCENE 3 Start "Mountain Bandit Hunt"
##     (else_try),
##       (eq, "$g_custom_battle_scenario", 1),
##       (assign, "$g_player_troop", "trp_knight_2_5"),
##       (set_player_troop, "$g_player_troop"),
##
##       (assign, "$g_custom_battle_scene", "scn_quick_battle_3"),
##       (modify_visitors_at_site, "$g_custom_battle_scene"),
##       (set_visitor, 0, "$g_player_troop"),
##
##       (set_visitors, 1, "trp_vaegir_archer", 4),
##       (set_visitors, 2, "trp_vaegir_archer", 5),
##       (set_visitors, 3, "trp_vaegir_veteran", 4),
##       (set_visitors, 4, "trp_vaegir_horseman", 4),
##       (set_visitors, 5, "trp_vaegir_footman", 2),
##       (set_visitors, 6, "trp_vaegir_knight", 4),
#### ENEMY
##
##       (set_visitors, 16, "trp_mountain_bandit", 4),
##       (set_visitors, 17, "trp_bandit", 8),
##       (set_visitors, 18, "trp_mountain_bandit", 8),
##       (set_visitors, 19, "trp_mountain_bandit", 6),
##       (set_visitors, 20, "trp_sea_raider", 5),
##       (set_visitors, 21, "trp_mountain_bandit", 4),
##       (set_visitors, 22, "trp_brigand", 6),
##       (set_visitors, 23, "trp_sea_raider", 8),
##       (set_visitors, 25, "trp_brigand", 10),
##       (str_store_string, s16, "str_custom_battle_2"),
##
####   SCENE 4 Start "Grand Stand"
##     (else_try),
##       (eq, "$g_custom_battle_scenario", 2),
##       (assign, "$g_player_troop", "trp_kingdom_5_lady_1"),
##       (set_player_troop, "$g_player_troop"),
##
##       (troop_raise_attribute, "$g_player_troop", ca_strength, 12),
##       (troop_raise_attribute, "$g_player_troop", ca_agility, 9),
##       (troop_raise_attribute, "$g_player_troop", ca_charisma, 5),
##       (troop_raise_attribute, "$g_player_troop", ca_intelligence, 5),
##       (troop_raise_skill, "$g_player_troop", skl_shield, 3),
##       (troop_raise_skill, "$g_player_troop", skl_athletics, 2),
##       (troop_raise_skill, "$g_player_troop", skl_riding, 3),
##       (troop_raise_skill, "$g_player_troop", skl_power_strike, 4),
##       (troop_raise_skill, "$g_player_troop", skl_power_draw, 5),
##       (troop_raise_skill, "$g_player_troop", skl_weapon_master, 4),
##       (troop_raise_skill, "$g_player_troop", skl_ironflesh, 6),
##       (troop_raise_proficiency_linear, "$g_player_troop", wpt_one_handed_weapon, 100),
##       (troop_raise_proficiency_linear, "$g_player_troop", wpt_two_handed_weapon, 30),
##       (troop_raise_proficiency_linear, "$g_player_troop", wpt_polearm, 20),
##       (troop_raise_proficiency_linear, "$g_player_troop", wpt_crossbow, 110),
##       (troop_raise_proficiency_linear, "$g_player_troop", wpt_throwing, 10),
##
##       (assign, "$g_custom_battle_scene", "scn_quick_battle_4"),
##       (modify_visitors_at_site, "$g_custom_battle_scene"),
##       (set_visitor, 0, "$g_player_troop"),
##
##       (troop_clear_inventory, "$g_player_troop"),
##       (troop_add_item, "$g_player_troop","itm_helmet_with_neckguard",0),
##       (troop_add_item, "$g_player_troop","itm_plate_armor",0),
##       (troop_add_item, "$g_player_troop","itm_iron_greaves",0),
##       (troop_add_item, "$g_player_troop","itm_mail_chausses",0),
##       (troop_add_item, "$g_player_troop","itm_tab_shield_small_round_c",0),
##       (troop_add_item, "$g_player_troop","itm_heavy_crossbow",0),
##       (troop_add_item, "$g_player_troop","itm_bolts",0),
##       (troop_add_item, "$g_player_troop","itm_sword_medieval_b_small",0),
##       (troop_equip_items, "$g_player_troop"),
#### US
##       (set_visitors, 1, "trp_vaegir_infantry", 4),
##       (set_visitors, 2, "trp_vaegir_archer", 3),
##       (set_visitors, 3, "trp_vaegir_infantry", 4),
##       (set_visitors, 4, "trp_vaegir_archer", 3),
##       (set_visitors, 5, "trp_vaegir_infantry", 3),
##       (set_visitors, 6, "trp_vaegir_footman", 5),
##       (set_visitors, 7, "trp_vaegir_footman", 4),
##       (set_visitors, 8, "trp_vaegir_archer", 3),
##
#### ENEMY
##       (set_visitors, 16, "trp_swadian_footman", 8),
##       (set_visitors, 17, "trp_swadian_crossbowman", 9),
##       (set_visitors, 18, "trp_swadian_sergeant", 7),
##       (set_visitors, 19, "trp_swadian_sharpshooter", 8),
##       (set_visitors, 20, "trp_swadian_militia", 13),
##       (str_store_string, s16, "str_custom_battle_3"),
##
####   Scene 5 START
##     (else_try),
##       (eq, "$g_custom_battle_scenario", 3),
##       (assign, "$g_player_troop", "trp_knight_1_10"),
##       (set_player_troop, "$g_player_troop"),
##
##       (assign, "$g_custom_battle_scene", "scn_quick_battle_5"),
##       (modify_visitors_at_site, "$g_custom_battle_scene"),
##       (set_visitor, 0, "$g_player_troop"),
##
#### US
##       (set_visitors, 1, "trp_swadian_knight", 3),
##       (set_visitors, 2, "trp_swadian_sergeant", 4),
##       (set_visitors, 3, "trp_swadian_sharpshooter", 8),
##       (set_visitors, 4, "trp_swadian_man_at_arms", 8),
##       (set_visitors, 5, "trp_swadian_knight", 2),
##
####     enemy
##       (set_visitors, 16, "trp_vaegir_infantry", 8),
##       (set_visitors, 17, "trp_vaegir_archer", 10),
##       (set_visitors, 18, "trp_vaegir_horseman", 4),
##       (set_visitors, 19, "trp_vaegir_knight", 10),
##       (set_visitors, 20, "trp_vaegir_guard", 7),
##       (str_store_string, s16, "str_custom_battle_4"),
##
##     (else_try),
##       (eq, "$g_custom_battle_scenario", 4),
##
####       (assign, "$g_custom_battle_scene", "scn_quick_battle_6"),
##       (assign, "$g_custom_battle_scene", "scn_quick_battle_7"),
##
###   Player Wear
##       (assign, "$g_player_troop", "trp_knight_4_9"),
##       (set_player_troop, "$g_player_troop"),
##
##       (modify_visitors_at_site, "$g_custom_battle_scene"),
##       (set_visitor, 0, "$g_player_troop"),
##
##       (set_visitors, 1, "trp_nord_archer", 4),
##       (set_visitors, 2, "trp_nord_archer", 4),
##       (set_visitors, 3, "trp_nord_champion", 4),
##       (set_visitors, 4, "trp_nord_veteran", 5),
##       (set_visitors, 5, "trp_nord_warrior", 5),
##       (set_visitors, 6, "trp_nord_trained_footman", 8),
##
#### ENEMY
##       (set_visitors, 11, "trp_vaegir_knight", 2),
##       (set_visitors, 12, "trp_vaegir_guard", 6),
##       (set_visitors, 13, "trp_vaegir_infantry", 8),
##       (set_visitors, 14, "trp_vaegir_veteran", 10),
##       (set_visitors, 16, "trp_vaegir_skirmisher", 5),
##       (set_visitors, 17, "trp_vaegir_archer", 4),
##       (set_visitors, 18, "trp_vaegir_marksman", 2),
##       (set_visitors, 19, "trp_vaegir_skirmisher", 4),
##       (set_visitors, 20, "trp_vaegir_skirmisher", 3),
##       (set_visitors, 21, "trp_vaegir_skirmisher", 3),
##       (set_visitors, 22, "trp_vaegir_skirmisher", 3),
##       (set_visitors, 23, "trp_vaegir_archer", 2),
##       (str_store_string, s16, "str_custom_battle_5"),
##     (try_end),
##     (set_show_messages, 1),
##     ],
##
##    [
##      ("custom_battle_go",[],"Start.",
##       [(try_begin),
##          (eq, "$g_custom_battle_scenario", 2),
####          (set_jump_mission,"mt_custom_battle_siege"),
##        (else_try),
##          (eq, "$g_custom_battle_scenario", 4),
####          (set_jump_mission,"mt_custom_battle_5"),
##        (else_try),
####          (set_jump_mission,"mt_custom_battle"),
##        (try_end),
##        (jump_to_menu, "mnu_custom_battle_end"),
##        (jump_to_scene,"$g_custom_battle_scene"),
##        (change_screen_mission),
##        ]
##       ),
##      ("leave_custom_battle_2",[],"Cancel.",
##       [(jump_to_menu, "mnu_start_game_3"),
##        ]
##       ),
##    ]
##  ),

####dunde cambia custom battles chief. Dunde eres un crack.
  (
    "custom_battle_end",mnf_disable_all_keys,
    "The battle is over. {s1} Your side killed {reg5} enemies and lost {reg6} troops over the battle. You personally slew {reg7} men in the fighting.",
    "none",
    [(music_set_situation, 0),
     (assign, reg5, "$g_custom_battle_team2_death_count"),
     (assign, reg6, "$g_custom_battle_team1_death_count"),
     (get_player_agent_kill_count, ":kill_count"),
     (get_player_agent_kill_count, ":wound_count", 1),
     ## Dunde's Restart Custom Battle BEGIN
     ##(store_add, reg7, ":kill_count", ":wound_count"),
     # Reseting Player Kill on Report
     (store_add, reg9, ":kill_count", ":wound_count"),
     (store_sub, reg7, reg9, reg8),
     (assign, reg8, reg9),
     ## Dunde's Restart Custom Battle END
     (try_begin),
       (eq, "$g_battle_result", 1),
       (str_store_string, s1, "str_battle_won"),
     (else_try),
       (str_store_string, s1, "str_battle_lost"),
     (try_end),

     (try_begin),
       (ge, "$g_custom_battle_team2_death_count", 100),
       (unlock_achievement, ACHIEVEMENT_LOOK_AT_THE_BONES),
     (try_end),
     ],
    [
      ("continue",[],"Continue.",
       [(change_screen_quit),
        ]
       ),
       ## Dunde's Restart Custom Battle BEGIN
       ("restart",[],"Restart.",
       [
         #Restoring Custom Battle Design
         (assign, "$g_is_quick_battle", 1),
         (assign, ":cur_scene", "$g_quick_battle_map"),
         (try_begin),
           (eq, "$g_quick_battle_game_type", 0), #battle
           (assign, ":cur_mission_template", "mt_quick_battle_battle"),
			#### edited-1 KLABAUTERMANN begin chief	 Phaiak
			(assign, ":cur_scene", "scn_sea"),
			(assign, "$coastal_assault", 0),
			#### edited-1 KLABAUTERMANN ends
           (modify_visitors_at_site, ":cur_scene"),
           (call_script, "script_spawn_quick_battle_army", 0, "$g_quick_battle_team_1_faction", "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value", 0, 1),
           (call_script, "script_spawn_quick_battle_army", 16, "$g_quick_battle_team_2_faction", "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value", 0, 0),
         (else_try),
           (eq, "$g_quick_battle_game_type", 1), #siege offense
           (assign, ":cur_mission_template", "mt_quick_battle_siege"),
 			#### edited-2 KLABAUTERMANN begin chief	  Phaiak
			(assign, ":cur_mission_template", "mt_quick_battle_battle"),
			(assign, ":cur_scene", "scn_sea"),
			(assign, "$coastal_assault", 0),
			#### edited-2 KLABAUTERMANN ends
          (modify_visitors_at_site, ":cur_scene"),
           (call_script, "script_spawn_quick_battle_army", 16, "$g_quick_battle_team_1_faction", "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value", 0, 1),
           (call_script, "script_spawn_quick_battle_army", 0, "$g_quick_battle_team_2_faction", "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value", 1, 0),
         (else_try),
           #siege defense
           (assign, ":cur_mission_template", "mt_quick_battle_siege"),
			#### edited-3 KLABAUTERMANN begin chief	  Phaiak
			(assign, ":cur_mission_template", "mt_quick_battle_battle"),
			(assign, ":cur_scene", "scn_sea_2"),
			(assign, "$coastal_assault", 0),
			#### edited-3 KLABAUTERMANN ends
           (modify_visitors_at_site, ":cur_scene"),
           (call_script, "script_spawn_quick_battle_army", 0, "$g_quick_battle_team_1_faction", "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value", 1, 1),
           (call_script, "script_spawn_quick_battle_army", 16, "$g_quick_battle_team_2_faction", "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value", 0, 0),
         (try_end),
        # Reset Battle Result
        (assign, "$g_battle_result", 0),
        (assign, "$g_battle_won", 0),
         (set_jump_mission,":cur_mission_template"),
         (jump_to_menu, "mnu_custom_battle_end"),
         (jump_to_scene, ":cur_scene"),
         (change_screen_mission),
        ]
       ),
      ## Dunde's Restart Custom Battle END
    ]
  ),


##  (
##    "custom_battle_end",mnf_disable_all_keys,
##    "The battle is over. {s1} Your side killed {reg5} enemies and lost {reg6} troops over the battle. You personally slew {reg7} men in the fighting.",
##    "none",
##    [(music_set_situation, 0),
##     (assign, reg5, "$g_custom_battle_team2_death_count"),
##     (assign, reg6, "$g_custom_battle_team1_death_count"),
##     (get_player_agent_kill_count, ":kill_count"),
##     (get_player_agent_kill_count, ":wound_count", 1),
##     (store_add, reg7, ":kill_count", ":wound_count"),
##     (try_begin),
##       (eq, "$g_battle_result", 1),
##       (str_store_string, s1, "str_battle_won"),
##     (else_try),
##       (str_store_string, s1, "str_battle_lost"),
##     (try_end),
##     (try_begin),
##       (ge, "$g_custom_battle_team2_death_count", 100),
##       (unlock_achievement, ACHIEVEMENT_LOOK_AT_THE_BONES),
##     (try_end),
##     ],
##    [
##      ("continue",[],"Continue.",
##       [(change_screen_quit),
##        ]
##       ),
##    ]
##  ),
#dunde chief cambia acaba.

#chief nueva creacion pj
#This needs to be the first window!!! dunde
  (
    "start_game_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Welcome, adventurer, to Brytenwalda. Before you can start playing the game you must create a character.",
    "none",
    [(try_begin),
        (neq, "$creation_canceled", 999),
        (call_script, "script_randomize_background", 0),
        (start_presentation, "prsnt_player_background"),
     (try_end),],
    [("start",[],"Create Character",[(start_presentation, "prsnt_player_background"),]),
     ("quit",[],"Cancel",[(change_screen_quit),]),]),
#chief nueva creacion pj acaba

  ("start_game_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Select your character's gender.",
    "none",
    [],
    [
      ("start_male",[],"Male",
       [
         (troop_set_type,"trp_player",0),
         (assign,"$character_gender",tf_male),
           (assign,"$wound_type",0), # 0-8 (0=not wounded, 1-8=type of wound) chief
           (assign,"$heal_day",0),   # day that wound heals chief
         (jump_to_menu,"mnu_start_character_1"),
        ]
       ),
      ("start_female",[],"Female",
       [
         (troop_set_type, "trp_player", 1),
         (assign, "$character_gender", tf_female),
           (assign,"$wound_type",0), # 0-8 (0=not wounded, 1-8=type of wound) chief
           (assign,"$heal_day",0),   # day that wound heals chief
         (jump_to_menu, "mnu_start_character_1"),
       ]
       ),
	  ("go_back",[],"Go back",
       [
	     (jump_to_menu,"mnu_start_game_0"),
       ]),
    ]
  ),

  (
    "start_character_1",mnf_disable_all_keys,
    "You were born years ago, in a land far away. Your father was...",
    "none",
    [
    (str_clear,s10),
    (str_clear,s11),
    (str_clear,s12),
    (str_clear,s13),
    (str_clear,s14),
    (str_clear,s15),
    ],
    [
    ("start_noble",[],"An impoverished noble.",[
      (assign,"$background_type",cb_noble),
      (assign, reg3, "$character_gender"),
      (str_store_string,s10,"@You came into the world a {reg3?daughter:son} of declining nobility,\
 owning only the house in which they lived. However, despite your family's hardships,\
 they afforded you a good education and trained you from childhood for the rigors of aristocracy and life at court."),
	(jump_to_menu,"mnu_start_character_2"),
    ]),
    ("start_merchant",[],"A travelling merchant.",[
      (assign,"$background_type",cb_merchant),
      (assign, reg3, "$character_gender"),
      (str_store_string,s10,"@You were born the {reg3?daughter:son} of travelling merchants,\
 always moving from place to place in search of a profit. Although your parents were wealthier than most\
 and educated you as well as they could, you found little opportunity to make friends on the road,\
 living mostly for the moments when you could sell something to somebody."),
	(jump_to_menu,"mnu_start_character_2"),
    ]),
    ("start_guard",[],"A veteran warrior.",[
      (assign,"$background_type",cb_guard),
      (assign, reg3, "$character_gender"),
      (str_store_string,s10,"@As a child, your family scrabbled out a meagre living from your father's wages\
 as a guardsman to the local lord. It was not an easy existence, and you were too poor to get much of an\
 education. You learned mainly how to defend yourself on the streets, with or without a weapon in hand."),
	(jump_to_menu,"mnu_start_character_2"),
    ]),
    ("start_forester",[],"A hunter.",[
      (assign,"$background_type",cb_forester),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@{reg3?daughter:son}"),
      (str_store_string,s10,"@You were the {reg3?daughter:son} of a family who lived off the woods,\
 doing whatever they needed to make ends meet. Hunting, woodcutting, making arrows,\
 even a spot of poaching whenever things got tight. Winter was never a good time for your family\
 as the cold took animals and people alike, but you always lived to see another dawn,\
 though your brothers and sisters might not be so fortunate."),
	(jump_to_menu,"mnu_start_character_2"),
    ]),
    ("start_nomad",[],"A steppe nomad.",[
      (assign,"$background_type",cb_nomad),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@{reg3?daughter:son}"),
      (str_store_string,s10,"@You were a child of the steppe, born to a tribe of wandering nomads who lived\
 in great camps throughout the arid grasslands.\
 Like the other tribesmen, your family revered horses above almost everything else, and they taught you\
 how to ride almost before you learned how to walk. "),
	(jump_to_menu,"mnu_start_character_2"),
    ]),
    ("start_thief",[],"A thief.",[
      (assign,"$background_type",cb_thief),
      (assign, reg3, "$character_gender"),
      (str_store_string,s10,"@As the {reg3?daughter:son} of a thief, you had very little 'formal' education.\
 Instead you were out on the street, begging until you learned how to cut purses, cutting purses\
 until you learned how to pick locks, all the way through your childhood.\
 Still, these long years made you streetwise and sharp to the secrets of cities and shadowy backways."),
	(jump_to_menu,"mnu_start_character_2"),
    ]),
##    ("start_priest",[],"Priests.",[
##      (assign,"$background_type",cb_priest),
##      (assign, reg3, "$character_gender"),
##      (str_store_string,s10,"@A {reg3?daughter:son} that nobody wanted, you were left to the church as a baby,\
## a foundling raised by the priests and nuns to their own traditions.\
## You were only one of many other foundlings and orphans, but you nonetheless received a lot of attention\
## as well as many years of study in the church library and before the altar. They taught you many things.\
## Gradually, faith became such a part of your life that it was no different from the blood coursing through your veins."),
##	(jump_to_menu,"mnu_start_character_2"),
##    ]),
    ("go_back",[],"Go back",
     [(jump_to_menu,"mnu_start_game_1"),
    ]),
    ]
  ),
  (
    "start_character_2",0,
    "{s10}^^ You started to learn about the world almost as soon as you could walk and talk. You spent your early life as...",
    "none",
    [],
    [
      ("page",[
          ],"A page at a nobleman's court.",[
      (assign,"$background_answer_2", cb2_page),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@As a {reg3?girl:boy} growing out of childhood,\
 you were sent to live in the court of one of the nobles of the land.\
 There, your first lessons were in humility, as you waited upon the lords and ladies of the household.\
 But from their chess games, their gossip, even the poetry of great deeds and courtly love, you quickly began to learn about the adult world of conflict\
 and competition. You also learned from the rough games of the other children, who battered at each other with sticks in imitation of their elders' swords."),
	(jump_to_menu,"mnu_start_character_3"),
    ]),
      ("apprentice",[
          ],"A craftsman's apprentice.",[
      (assign,"$background_answer_2", cb2_apprentice),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@As a {reg3?girl:boy} growing out of childhood,\
 you apprenticed with a local craftsman to learn a trade. After years of hard work and study under your\
 new master, he promoted you to journeyman and employed you as a fully paid craftsman for as long as\
 you wished to stay."),
	(jump_to_menu,"mnu_start_character_3"),
    ]),
      ("stockboy",[
          ],"A shop assistant.",[
      (assign,"$background_answer_2",cb2_merchants_helper),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@As a {reg3?girl:boy} growing out of childhood,\
 you apprenticed to a wealthy merchant, picking up the trade over years of working shops and driving caravans.\
 You soon became adept at the art of buying low, selling high, and leaving the customer thinking they'd\
 got the better deal."),
	(jump_to_menu,"mnu_start_character_3"),
    ]),
      ("urchin",[
          ],"A street urchin.",[
      (assign,"$background_answer_2",cb2_urchin),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@As a {reg3?girl:boy} growing out of childhood,\
 you took to the streets, doing whatever you must to survive.\
 Begging, thieving and working for gangs to earn your bread, you lived from day to day in this violent world,\
 always one step ahead of the law and those who wished you ill."),
	(jump_to_menu,"mnu_start_character_3"),
    ]),
      ("nomad",[
          ],"A steppe child.",[
      (assign,"$background_answer_2",cb2_steppe_child),
      (assign, reg3, "$character_gender"),
      (str_store_string,s11,"@As a {reg3?girl:boy} growing out of childhood,\
 you rode the great steppes on a horse of your own, learning the ways of the grass and the desert.\
 Although you sometimes went hungry, you became a skillful hunter and pathfinder in this trackless country.\
 Your body too started to harden with muscle as you grew into the life of a nomad {reg3?woman:man}."),
	(jump_to_menu,"mnu_start_character_3"),
    ]),

##      ("mummer",[],"Mummer.",[
##      (assign,"$background_answer_2",5),
##      (assign, reg3, "$character_gender"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@{reg3?girl:boy}"),
##      (str_store_string,s11,"@As a {s12} growing out of childhood,\
## you attached yourself to a troupe of wandering entertainers, going from town to town setting up mummer's\
## shows. It was a life of hard work, selling, begging and stealing your living from the punters who flocked\
## to watch your antics. Over time you became a performer well capable of attracting a crowd."),
##	(jump_to_menu,"mnu_start_character_3"),
##    ]),
##      ("courtier",[],"Courtier.",[
##      (assign,"$background_answer_2",6),
##      (assign, reg3, "$character_gender"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@{reg3?girl:boy}"),
##      (str_store_string,s11,"@As a {s12} growing out of childhood,\
## you spent much of your life at court, inserting yourself into the tightly-knit circles of nobility.\
## With the years you became more and more involved with the politics and intrigue demanded of a high-born {s13}.\
## You could not afford to remain a stranger to backstabbing and political violence, even if you wanted to."),
##	(jump_to_menu,"mnu_start_character_3"),
##    ]),
##      ("noble",[],"Noble in training.",[
##      (assign,"$background_answer_2",7),
##      (assign, reg3, "$character_gender"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@{reg3?girl:boy}"),
##      (try_begin),
##      (eq,"$character_gender",tf_male),
##      (str_store_string,s11,"@As a {s12} growing out of childhood,\
## you were trained and educated to perform the duties and wield the rights of a noble landowner.\
## The managing of taxes and rents were equally important in your education as diplomacy and even\
## personal defence. You learned everything you needed to become a lord of your own hall."),
##      (else_try),
##      (str_store_string,s11,"@As a {s12} growing out of childhood,\
## you were trained and educated to the duties of a noble {s13}. You learned much about the household arts,\
## but even more about diplomacy and decorum, and all the things that a future husband might choose to speak of.\
## Truly, you became every inch as shrewd as any lord, though it would be rude to admit it aloud."),
##      (try_end),
##	(jump_to_menu,"mnu_start_character_3"),
##    ]),
##      ("acolyte",[],"Cleric acolyte.",[
##    (assign,"$background_answer_2",8),
##      (assign, reg3, "$character_gender"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@{reg3?girl:boy}"),
##      (str_store_string,s11,"@As a {s12} growing out of childhood,\
## you became an acolyte in the church, the lowest rank on the way to priesthood.\
## Years of rigorous learning and hard work followed. You were one of several acolytes,\
## performing most of the menial labour in the church in addition to being trained for more holy tasks.\
## On the night of your adulthood you were allowed to conduct your first service.\
## After that you were no longer an acolyte {s12}, but a {s13} waiting to take your vows into the service of God."),
##	(jump_to_menu,"mnu_start_character_3"),
##    ]),
      ("go_back",[],"Go back.",
     [(jump_to_menu,"mnu_start_character_1"),
    ]),
    ]
  ),
  (
    "start_character_3",mnf_disable_all_keys,
    "{s11}^^ Then, as a young adult, life changed as it always does. You became...",
    "none",
    [(assign, reg3, "$character_gender"),],
    [
##      ("bravo",[],"A travelling bravo.",[
##        (assign,"$background_answer_3",1),
##      (str_store_string,s14,"@{reg3?daughter:man}"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@Though the distinction felt sudden to you,\
## somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
## You left your old life behind to travel the roads as a mercenary, a bravo, guarding caravans for coppers\
## or bashing in heads for silvers. You became a {s14} of the open road, working with bandits as often as against.\
## Going from fight to fight, you grew experienced at battle, and you learned what it was to kill."),
##	(jump_to_menu,"mnu_start_character_4"),
##        ]),
##      ("merc",[],"A sellsword in foreign lands.",[
##        (assign,"$background_answer_3",2),
##      (str_store_string,s14,"@{reg3?daughter:man}"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@Though the distinction felt sudden to you,\
## somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
## You signed on with a mercenary company and travelled far from your home. The life you found was rough and\
## ready, marching to the beat of strange drums and learning unusual ways of fighting.\
## There were men who taught you how to wield any weapon you desired, and plenty of battles to hone your skills.\
## You were one of the charmed few who survived through every campaign in which you marched."),
##	(jump_to_menu,"mnu_start_character_4"),
##        ]),

      ("squire",[(eq,"$character_gender",tf_male)],"A squire.",[
        (assign,"$background_answer_3",cb3_squire),
      (str_store_string,s14,"@{reg3?daughter:man}"),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {reg3?woman:man}, and the whole world seemed to change around you.\
 When you were named squire to a noble at court, you practiced long hours with weapons,\
 learning how to deal out hard knocks and how to take them, too.\
 You were instructed in your obligations to your lord, and of your duties to those who might one day be your vassals.\
 But in addition to learning the chivalric ideal, you also learned about the less uplifting side\
 -- old warriors' stories of ruthless power politics, of betrayals and usurpations,\
 of men who used guile as well as valor to achieve their aims."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
      ("lady",[(eq,"$character_gender",tf_female)],"A lady-in-waiting.",[
        (assign,"$background_answer_3",cb3_lady_in_waiting),
      (str_store_string,s14,"@{reg3?daughter:man}"),
      (str_store_string,s13,"@{reg3?woman:man}"),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
 You joined the tightly-knit circle of women at court, ladies who all did proper ladylike things,\
 the wives and mistresses of noble men as well as maidens who had yet to find a husband.\
 However, even here you found politics at work as the ladies schemed for prominence and fought each other\
 bitterly to catch the eye of whatever unmarried man was in fashion at court.\
 You soon learned ways of turning these situations and goings-on to your advantage. With it came the\
 realisation that you yourself could wield great influence in the world, if only you applied yourself\
 with a little bit of subtlety."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
      ("troubadour",[],"A troubadour.",[
        (assign,"$background_answer_3",cb3_troubadour),
      (str_store_string,s14,"@{reg3?daughter:man}"),
      (str_store_string,s13,"@{reg3?woman:man}"),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
 You set out on your own with nothing except the instrument slung over your back and your own voice.\
 It was a poor existence, with many a hungry night when people failed to appreciate your play,\
 but you managed to survive on your music alone. As the years went by you became adept at playing the\
 drunken crowds in your taverns, and even better at talking anyone out of anything you wanted."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
      ("student",[],"A university student.",[
        (assign,"$background_answer_3",cb3_student),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {reg3?woman:man}, and the whole world seemed to change around you.\
 You found yourself as a student in the university of one of the great cities,\
 where you studied theology, philosophy, and medicine.\
 But not all your lessons were learned in the lecture halls.\
 You may or may not have joined in with your fellows as they roamed the alleys in search of wine, women, and a good fight.\
 However, you certainly were able to observe how a broken jaw is set,\
 or how an angry townsman can be persuaded to set down his club and accept cash compensation for the destruction of his shop."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
      ("peddler",[],"A goods peddler.",[
        (assign,"$background_answer_3",cb3_peddler),
      (str_store_string,s14,"@{reg3?daughter:man}"),
      (str_store_string,s13,"@{reg3?woman:man}"),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
 Heeding the call of the open road, you travelled from village to village buying and selling what you could.\
 It was not a rich existence, but you became a master at haggling even the most miserly elders into\
 giving you a good price. Soon, you knew, you would be well-placed to start your own trading empire..."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
      ("craftsman",[],"A smith.",[
        (assign,"$background_answer_3", cb3_craftsman),
      (str_store_string,s14,"@{reg3?daughter:man}"),
      (str_store_string,s13,"@{reg3?woman:man}"),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
 You pursued a career as a smith, crafting items of function and beauty out of simple metal.\
 As time wore on you became a master of your trade, and fine work started to fetch fine prices.\
 With food in your belly and logs on your fire, you could take pride in your work and your growing reputation."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
      ("poacher",[],"A game poacher.",[
        (assign,"$background_answer_3", cb3_poacher),
      (str_store_string,s14,"@{reg3?daughter:man}"),
      (str_store_string,s13,"@{reg3?woman:man}"),
      (str_store_string,s12,"@Though the distinction felt sudden to you,\
 somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
 Dissatisfied with common men's desperate scrabble for coin, you took to your local lord's own forests\
 and decided to help yourself to its bounty, laws be damned. You hunted stags, boars and geese and sold\
 the precious meat under the table. You cut down trees right under the watchmen's noses and turned them into\
 firewood that warmed many freezing homes during winter. All for a few silvers, of course."),
	(jump_to_menu,"mnu_start_character_4"),
        ]),
##      ("preacher",[],"Itinerant preacher.",[
##        (assign,"$background_answer_3",6),
##      (str_store_string,s14,"@{reg3?daughter:man}"),
##      (str_store_string,s13,"@{reg3?woman:man}"),
##      (str_store_string,s12,"@Though the distinction felt sudden to you,\
## somewhere along the way you had become a {s13}, and the whole world seemed to change around you.\
## You packed your few belongings and went out into the world to spread the word of God. You preached to\
## anyone who would listen, and impressed many with the passion of your sermons. Though you had taken a vow\
## to remain in poverty through your itinerant years, you never lacked for food, drink or shelter; the\
## hospitality of the peasantry was always generous to a rising {s13} of God."),
##	(jump_to_menu,"mnu_start_character_4"),
##        ]),
      ("go_back",[],"Go back.",
       [(jump_to_menu,"mnu_start_character_2"),
        ]
       ),
    ]
  ),

  (
    "start_character_4",mnf_disable_all_keys,
    "{s12}^^But soon everything changed and you decided to strike out on your own as an adventurer. What made you take this decision was...",
    #Finally, what made you decide to strike out on your own as an adventurer?",
    "none",
    [],
    [
      ("revenge",[],"Personal revenge.",[
        (assign,"$background_answer_4", cb4_revenge),
      (str_store_string,s13,"@Only you know exactly what caused you to give up your old life and become an adventurer.\
 Still, it was not a difficult choice to leave, with the rage burning brightly in your heart.\
 You want vengeance. You want justice. What was done to you cannot be undone,\
 and these debts can only be paid in blood..."),
        (jump_to_menu,"mnu_choose_skill"),
        ]),
      ("death",[],"The loss of a loved one.",[
        (assign,"$background_answer_4",cb4_loss),
      (str_store_string,s13,"@Only you know exactly what caused you to give up your old life and become an adventurer.\
 All you can say is that you couldn't bear to stay, not with the memories of those you loved so close and so\
 painful. Perhaps your new life will let you forget,\
 or honour the name that you can no longer bear to speak..."),
        (jump_to_menu,"mnu_choose_skill"),
        ]),
      ("wanderlust",[],"Wanderlust.",[
        (assign,"$background_answer_4",cb4_wanderlust),
      (str_store_string,s13,"@Only you know exactly what caused you to give up your old life and become an adventurer.\
 You're not even sure when your home became a prison, when the familiar became mundane, but your dreams of\
 wandering have taken over your life. Whether you yearn for some faraway place or merely for the open road and the\
 freedom to travel, you could no longer bear to stay in the same place. You simply went and never looked back..."),
        (jump_to_menu,"mnu_choose_skill"),
        ]),
##      ("fervor",[],"Religious fervor.",[
##        (assign,"$background_answer_4",4),
##      (str_store_string,s13,"@Only you know exactly what caused you to give up your old life and become an adventurer.\
## Regardless, the intense faith burning in your soul would not let you find peace in any single place.\
## There were others in the world, souls to be washed in the light of God. Now you preach wherever you go,\
## seeking to bring salvation and revelation to the masses, be they faithful or pagan. They will all know the\
## glory of God by the time you're done..."),
##        (jump_to_menu,"mnu_choose_skill"),
##        ]),
      ("disown",[],"Being forced out of your home.",[
        (assign,"$background_answer_4",cb4_disown),
      (str_store_string,s13,"@Only you know exactly what caused you to give up your old life and become an adventurer.\
 However, you know you cannot go back. There's nothing to go back to. Whatever home you may have had is gone\
 now, and you must face the fact that you're out in the wide wide world. Alone to sink or swim..."),
        (jump_to_menu,"mnu_choose_skill"),
        ]),
     ("greed",[],"Lust for money and power.",[
        (assign,"$background_answer_4",cb4_greed),
      (str_store_string,s13,"@Only you know exactly what caused you to give up your old life and become an adventurer.\
 To everyone else, it's clear that you're now motivated solely by personal gain.\
 You want to be rich, powerful, respected, feared.\
 You want to be the one whom others hurry to obey.\
 You want people to know your name, and tremble whenever it is spoken.\
 You want everything, and you won't let anyone stop you from having it..."),
        (jump_to_menu,"mnu_choose_skill"),
        ]),
      ("go_back",[],"Go back.",
       [(jump_to_menu,"mnu_start_character_3"),
        ]
       ),
    ]
  ),


  (
    "choose_skill",mnf_disable_all_keys,
    "{s13}",
    "none",
    [(assign,"$current_string_reg",10),
	 (assign, ":difficulty", 0),

	 (try_begin),
		(eq, "$character_gender", tf_female),
		(str_store_string, s14, "str_woman"),
		(val_add, ":difficulty", 1),
	 (else_try),
		(str_store_string, s14, "str_man"),
	 (try_end),

	 (try_begin),
        (eq,"$background_type",cb_noble),
		(str_store_string, s15, "str_noble"),
		(val_sub, ":difficulty", 1),
	 (else_try),
		(str_store_string, s15, "str_common"),
	 (try_end),

	 (try_begin),
		(eq, ":difficulty", -1),
		(str_store_string, s16, "str_may_find_that_you_are_able_to_take_your_place_among_calradias_great_lords_relatively_quickly"),
	 (else_try),
		(eq, ":difficulty", 0),
		(str_store_string, s16, "str_may_face_some_difficulties_establishing_yourself_as_an_equal_among_calradias_great_lords"),
	 (else_try),
		(eq, ":difficulty", 1),
		(str_store_string, s16, "str_may_face_great_difficulties_establishing_yourself_as_an_equal_among_calradias_great_lords"),
	 (try_end),
	],
    [
##      ("start_swordsman",[],"Swordsmanship.",[
##        (assign, "$starting_skill", 1),
##        (str_store_string, s14, "@You are particularly talented at swordsmanship."),
##        (jump_to_menu,"mnu_past_life_explanation"),
##        ]),
##      ("start_archer",[],"Archery.",[
##        (assign, "$starting_skill", 2),
##        (str_store_string, s14, "@You are particularly talented at archery."),
##        (jump_to_menu,"mnu_past_life_explanation"),
##        ]),
##      ("start_medicine",[],"Medicine.",[
##        (assign, "$starting_skill", 3),
##        (str_store_string, s14, "@You are particularly talented at medicine."),
##        (jump_to_menu,"mnu_past_life_explanation"),
##        ]),
      ("begin_adventuring",[],"Become an adventurer and ride to your destiny.",[
           (set_show_messages, 0),
           (try_begin),
             (eq,"$character_gender",0),
             (troop_raise_attribute, "trp_player",ca_strength,1),
             (troop_raise_attribute, "trp_player",ca_charisma,1),
           (else_try),
             (troop_raise_attribute, "trp_player",ca_agility,1),
             (troop_raise_attribute, "trp_player",ca_intelligence,1),
           (try_end),

           (troop_raise_attribute, "trp_player",ca_strength,1),
           (troop_raise_attribute, "trp_player",ca_agility,1),
           (troop_raise_attribute, "trp_player",ca_charisma,1),

           (troop_raise_skill, "trp_player","skl_leadership",1),
           (troop_raise_skill, "trp_player","skl_riding",1),
##           (try_begin),
##             (eq, "$starting_skill", 1),
##             (troop_raise_attribute, "trp_player",ca_agility,1),
##             (troop_raise_attribute, "trp_player",ca_strength,1),
##             (troop_raise_skill, "trp_player",skl_power_strike,2),
##             (troop_raise_proficiency, "trp_player",0,30),
##             (troop_raise_proficiency, "trp_player",1,20),
##           (else_try),
##             (eq, "$starting_skill", 2),
##             (troop_raise_attribute, "trp_player",ca_strength,2),
##             (troop_raise_skill, "trp_player",skl_power_draw,2),
##             (troop_raise_proficiency, "trp_player",3,50),
##           (else_try),
##             (troop_raise_attribute, "trp_player",ca_intelligence,1),
##             (troop_raise_attribute, "trp_player",ca_charisma,1),
##             (troop_raise_skill, "trp_player",skl_first_aid,1),
##             (troop_raise_skill, "trp_player",skl_wound_treatment,1),
##             (troop_add_item, "trp_player","itm_winged_mace",0),
##             (troop_raise_proficiency, "trp_player",0,15),
##             (troop_raise_proficiency, "trp_player",1,15),
##             (troop_raise_proficiency, "trp_player",2,15),
##           (try_end),


      (try_begin),
        (eq,"$background_type",cb_noble),
        (eq,"$character_gender",tf_male),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_attribute, "trp_player",ca_charisma,2),
        (troop_raise_skill, "trp_player",skl_weapon_master,1),
        (troop_raise_skill, "trp_player",skl_power_strike,1),
        (troop_raise_skill, "trp_player",skl_riding,1),
        (troop_raise_skill, "trp_player",skl_tactics,1),
        (troop_raise_skill, "trp_player",skl_leadership,1),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,10),
        (troop_raise_proficiency, "trp_player",wpt_two_handed_weapon,10),
        (troop_raise_proficiency, "trp_player",wpt_polearm,10),

        (troop_add_item, "trp_player","itm_tab_shield_round_a",imod_battered),
        (troop_set_slot, "trp_player", slot_troop_renown, 100),
        (call_script, "script_change_player_honor", 3),


##        (troop_add_item, "trp_player","itm_red_gambeson",imod_plain),
##        (troop_add_item, "trp_player","itm_sword",imod_plain),
##        (troop_add_item, "trp_player","itm_dagger",imod_balanced),
##        (troop_add_item, "trp_player","itm_woolen_hose",0),
##        (troop_add_item, "trp_player","itm_dried_meat",0),
##        (troop_add_item, "trp_player","itm_saddle_horse",imod_plain),
        (troop_add_gold, "trp_player", 100),
      (else_try),
        (eq,"$background_type",cb_noble),
        (eq,"$character_gender",tf_female),
        (troop_raise_attribute, "trp_player",ca_intelligence,2),
        (troop_raise_attribute, "trp_player",ca_charisma,1),
        (troop_raise_skill, "trp_player",skl_wound_treatment,1),
        (troop_raise_skill, "trp_player",skl_riding,2),
        (troop_raise_skill, "trp_player",skl_first_aid,1),
        (troop_raise_skill, "trp_player",skl_leadership,1),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,20),

        (troop_set_slot, "trp_player", slot_troop_renown, 50),
        (troop_add_item, "trp_player","itm_tab_shield_round_a",imod_battered),

##        (troop_add_item, "trp_player","itm_dress",imod_sturdy),
##        (troop_add_item, "trp_player","itm_dagger",imod_watered_steel),
##        (troop_add_item, "trp_player","itm_woolen_hose",0),
##        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
##        (troop_add_item, "trp_player","itm_bolts",0),
##        (troop_add_item, "trp_player","itm_smoked_fish",0),
##        (troop_add_item, "trp_player","itm_courser",imod_spirited),
        (troop_add_gold, "trp_player", 100),
      (else_try),
        (eq,"$background_type",cb_merchant),
        (troop_raise_attribute, "trp_player",ca_intelligence,2),
        (troop_raise_attribute, "trp_player",ca_charisma,1),
        (troop_raise_skill, "trp_player",skl_riding,1),
        (troop_raise_skill, "trp_player",skl_leadership,1),
        (troop_raise_skill, "trp_player",skl_trade,2),
        (troop_raise_skill, "trp_player",skl_inventory_management,1),
        (troop_raise_proficiency, "trp_player",wpt_two_handed_weapon,10),

##        (troop_add_item, "trp_player","itm_leather_jacket",0),
##        (troop_add_item, "trp_player","itm_leather_boots",0),
##        (troop_add_item, "trp_player","itm_fur_hat",0),
##        (troop_add_item, "trp_player","itm_dagger",0),
##        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
##        (troop_add_item, "trp_player","itm_bolts",0),
##        (troop_add_item, "trp_player","itm_smoked_fish",0),
##        (troop_add_item, "trp_player","itm_saddle_horse",0),
##        (troop_add_item, "trp_player","itm_sumpter_horse",0),
##        (troop_add_item, "trp_player","itm_salt",0),
##        (troop_add_item, "trp_player","itm_salt",0),
##        (troop_add_item, "trp_player","itm_salt",0),
##        (troop_add_item, "trp_player","itm_pottery",0),
##        (troop_add_item, "trp_player","itm_pottery",0),

        (troop_add_gold, "trp_player", 250),
        (troop_set_slot, "trp_player", slot_troop_renown, 20),
      (else_try),
        (eq,"$background_type",cb_guard),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_attribute, "trp_player",ca_charisma,1),
        (troop_raise_skill, "trp_player","skl_ironflesh",1),
        (troop_raise_skill, "trp_player","skl_power_strike",1),
        (troop_raise_skill, "trp_player","skl_weapon_master",1),
        (troop_raise_skill, "trp_player","skl_leadership",1),
        (troop_raise_skill, "trp_player","skl_trainer",1),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,10),
        (troop_raise_proficiency, "trp_player",wpt_two_handed_weapon,15),
        (troop_raise_proficiency, "trp_player",wpt_polearm,20),
        (troop_raise_proficiency, "trp_player",wpt_throwing,10),
        (troop_add_item, "trp_player","itm_tab_shield_kite_b",imod_battered),

##        (troop_add_item, "trp_player","itm_leather_jerkin",imod_ragged),
##        (troop_add_item, "trp_player","itm_skullcap",imod_rusty),
##        (troop_add_item, "trp_player","itm_spear",0),
##        (troop_add_item, "trp_player","itm_arming_sword",imod_chipped),
##        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
##        (troop_add_item, "trp_player","itm_hunter_boots",0),
##        (troop_add_item, "trp_player","itm_leather_gloves",imod_ragged),
##        (troop_add_item, "trp_player","itm_bolts",0),
##        (troop_add_item, "trp_player","itm_smoked_fish",0),

##        (troop_add_item, "trp_player","itm_saddle_horse",imod_swaybacked),
        (troop_add_gold, "trp_player", 50),
        (troop_set_slot, "trp_player", slot_troop_renown, 10),
      (else_try),
        (eq,"$background_type",cb_forester),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,2),
        (troop_raise_skill, "trp_player","skl_power_draw",1),
        (troop_raise_skill, "trp_player","skl_tracking",1),
        (troop_raise_skill, "trp_player","skl_pathfinding",1),
        (troop_raise_skill, "trp_player","skl_spotting",1),
        (troop_raise_skill, "trp_player","skl_athletics",1),
        (troop_raise_proficiency, "trp_player",wpt_two_handed_weapon,10),
        (troop_raise_proficiency, "trp_player",wpt_archery,30),
##        (troop_add_item, "trp_player","itm_short_bow",imod_bent),
##        (troop_add_item, "trp_player","itm_arrows",0),
##        (troop_add_item, "trp_player","itm_axe",imod_chipped),
##        (troop_add_item, "trp_player","itm_leather_vest_green",0),
##        (troop_add_item, "trp_player","itm_hide_boots",0),
##        (troop_add_item, "trp_player","itm_dried_meat",0),
##        (troop_add_item, "trp_player","itm_sumpter_horse",imod_heavy),
##        (troop_add_item, "trp_player","itm_furs",0),
        (troop_add_gold, "trp_player", 30),
      (else_try),
        (eq,"$background_type",cb_nomad),
        (eq,"$character_gender",tf_male),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_skill, "trp_player","skl_power_draw",1),
        (troop_raise_skill, "trp_player","skl_horse_archery",1),
        (troop_raise_skill, "trp_player","skl_pathfinding",1),
        (troop_raise_skill, "trp_player","skl_riding",2),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,10),
        (troop_raise_proficiency, "trp_player",wpt_archery,30),
        (troop_raise_proficiency, "trp_player",wpt_throwing,10),
        (troop_add_item, "trp_player","itm_tab_shield_small_round_a",imod_battered),
##        (troop_add_item, "trp_player","itm_javelin",imod_bent),
##        (troop_add_item, "trp_player","itm_sword_khergit_1",imod_rusty),
##        (troop_add_item, "trp_player","itm_nomad_armor",0),
##        (troop_add_item, "trp_player","itm_hide_boots",0),
##        (troop_add_item, "trp_player","itm_horse_meat",0),
##        (troop_add_item, "trp_player","itm_steppe_horse",0),
        (troop_add_gold, "trp_player", 15),
        (troop_set_slot, "trp_player", slot_troop_renown, 10),
      (else_try),
        (eq,"$background_type",cb_nomad),
        (eq,"$character_gender",tf_female),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_skill, "trp_player","skl_wound_treatment",1),
        (troop_raise_skill, "trp_player","skl_first_aid",1),
        (troop_raise_skill, "trp_player","skl_pathfinding",1),
        (troop_raise_skill, "trp_player","skl_riding",2),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,5),
        (troop_raise_proficiency, "trp_player",wpt_archery,20),
        (troop_raise_proficiency, "trp_player",wpt_throwing,5),
        (troop_add_item, "trp_player","itm_tab_shield_small_round_a",imod_battered),
##        (troop_add_item, "trp_player","itm_javelin",imod_bent),
##        (troop_add_item, "trp_player","itm_sickle",imod_plain),
##        (troop_add_item, "trp_player","itm_nomad_armor",0),
##        (troop_add_item, "trp_player","itm_hide_boots",0),
##        (troop_add_item, "trp_player","itm_steppe_horse",0),
##        (troop_add_item, "trp_player","itm_grain",0),
        (troop_add_gold, "trp_player", 20),
      (else_try),
        (eq,"$background_type",cb_thief),
        (troop_raise_attribute, "trp_player",ca_agility,3),
        (troop_raise_skill, "trp_player","skl_athletics",2),
        (troop_raise_skill, "trp_player","skl_power_throw",1),
        (troop_raise_skill, "trp_player","skl_inventory_management",1),
        (troop_raise_skill, "trp_player","skl_looting",1),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,20),
        (troop_raise_proficiency, "trp_player",wpt_throwing,20),
        (troop_add_item, "trp_player","itm_throwing_knives",0),
##        (troop_add_item, "trp_player","itm_stones",0),
##        (troop_add_item, "trp_player","itm_cudgel",imod_plain),
##        (troop_add_item, "trp_player","itm_dagger",imod_rusty),
##        (troop_add_item, "trp_player","itm_shirt",imod_tattered),
##        (troop_add_item, "trp_player","itm_black_hood",imod_tattered),
##        (troop_add_item, "trp_player","itm_wrapping_boots",imod_ragged),
        (troop_add_gold, "trp_player", 25),
##      (else_try),
##        (eq,"$background_type",cb_priest),
##        (troop_raise_attribute, "trp_player",ca_strength,1),
##        (troop_raise_attribute, "trp_player",ca_intelligence,2),
##        (troop_raise_attribute, "trp_player",ca_charisma,1),
##        (troop_raise_skill, "trp_player",skl_wound_treatment,1),
##        (troop_raise_skill, "trp_player",skl_leadership,1),
##        (troop_raise_skill, "trp_player",skl_prisoner_management,1),
##        (troop_raise_proficiency, "trp_player",0,10),
##        (troop_add_item, "trp_player","itm_robe",0),
##        (troop_add_item, "trp_player","itm_wrapping_boots",0),
##        (troop_add_item, "trp_player","itm_club",0),
##        (troop_add_item, "trp_player","itm_smoked_fish",0),
##        (troop_add_item, "trp_player","itm_sumpter_horse",0),
##        (troop_add_gold, "trp_player", 10),
##        (troop_set_slot, "trp_player", slot_troop_renown, 10),
      (try_end),

    (try_begin),
        (eq,"$background_answer_2",cb2_page),
        (troop_raise_attribute, "trp_player",ca_charisma,1),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_skill, "trp_player","skl_power_strike",1),
        (troop_raise_skill, "trp_player","skl_persuasion",1),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,15),
        (troop_raise_proficiency, "trp_player",wpt_polearm,5),
    (else_try),
        (eq,"$background_answer_2",cb2_apprentice),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_skill, "trp_player","skl_engineer",1),
        (troop_raise_skill, "trp_player","skl_trade",1),
    (else_try),
        (eq,"$background_answer_2",cb2_urchin),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_skill, "trp_player","skl_spotting",1),
        (troop_raise_skill, "trp_player","skl_looting",1),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,15),
        (troop_raise_proficiency, "trp_player",wpt_throwing,5),
    (else_try),
        (eq,"$background_answer_2",cb2_steppe_child),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_skill, "trp_player","skl_horse_archery",1),
        (troop_raise_skill, "trp_player","skl_power_throw",1),
        (troop_raise_proficiency, "trp_player",wpt_archery,15),
        (call_script,"script_change_troop_renown", "trp_player", 5),
    (else_try),
        (eq,"$background_answer_2",cb2_merchants_helper),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_attribute, "trp_player",ca_charisma,1),
        (troop_raise_skill, "trp_player","skl_inventory_management",1),
        (troop_raise_skill, "trp_player","skl_trade",1),
##	(else_try),
##        (eq,"$background_answer_2",5),
##        (troop_raise_attribute, "trp_player",ca_intelligence,1),
##        (troop_raise_attribute, "trp_player",ca_charisma,1),
##        (troop_raise_skill, "trp_player",skl_leadership,1),
##        (troop_raise_skill, "trp_player",skl_athletics,1),
##        (troop_raise_skill, "trp_player",skl_riding,1),
##        (troop_raise_proficiency, "trp_player",1,5),
##        (troop_raise_proficiency, "trp_player",2,5),
##        (call_script,"script_change_troop_renown", "trp_player", 15),
##	(else_try),
##        (eq,"$background_answer_2",6),
##        (troop_raise_attribute, "trp_player",ca_charisma,3),
##        (troop_raise_attribute, "trp_player",ca_agility,1),
##        (troop_raise_skill, "trp_player",skl_weapon_master,1),
##        (troop_raise_proficiency, "trp_player",0,15),
##        (troop_raise_proficiency, "trp_player",2,10),
##        (troop_raise_proficiency, "trp_player",4,10),
##        (call_script,"script_change_troop_renown", "trp_player", 20),
##	(else_try),
##        (eq,"$background_answer_2",7),
##        (troop_raise_attribute, "trp_player",ca_intelligence,1),
##        (troop_raise_attribute, "trp_player",ca_charisma,2),
##        (troop_raise_skill, "trp_player",skl_leadership,1),
##        (troop_raise_skill, "trp_player",skl_tactics,1),
##        (troop_raise_proficiency, "trp_player",0,10),
##        (troop_raise_proficiency, "trp_player",1,10),
##        (call_script,"script_change_troop_renown", "trp_player", 15),
##	(else_try),
##        (eq,"$background_answer_2",8),
##        (troop_raise_attribute, "trp_player",ca_agility,1),
##        (troop_raise_attribute, "trp_player",ca_intelligence,1),
##        (troop_raise_attribute, "trp_player",ca_charisma,1),
##        (troop_raise_skill, "trp_player",skl_leadership,1),
##        (troop_raise_skill, "trp_player",skl_surgery,1),
##        (troop_raise_skill, "trp_player",skl_first_aid,1),
##        (troop_raise_proficiency, "trp_player",2,10),
##        (call_script,"script_change_troop_renown", "trp_player", 5),
	(try_end),

	(try_begin),
##        (eq,"$background_answer_3",1),
##        (troop_raise_attribute, "trp_player",ca_strength,1),
##        (troop_raise_skill, "trp_player",skl_power_strike,1),
##        (troop_raise_skill, "trp_player",skl_shield,1),
##        (troop_add_gold, "trp_player", 10),
##        (try_begin),
##        (this_or_next|player_has_item,"itm_sword"),
##        (troop_has_item_equipped,"trp_player","itm_sword"),
##        (troop_remove_item, "trp_player","itm_sword"),
##        (try_end),
##        (try_begin),
##        (this_or_next|player_has_item,"itm_arming_sword"),
##        (troop_has_item_equipped,"trp_player","itm_arming_sword"),
##        (troop_remove_item, "trp_player","itm_arming_sword"),
##        (try_end),
##        (troop_add_item, "trp_player","itm_short_sword",0),
##        (troop_add_item, "trp_player","itm_wooden_shield",imod_battered),
##        (troop_raise_proficiency, "trp_player",0,10),
##        (troop_raise_proficiency, "trp_player",4,10),
##    (else_try),
##        (eq,"$background_answer_3",2),
##        (troop_raise_attribute, "trp_player",ca_agility,1),
##        (troop_raise_skill, "trp_player",skl_weapon_master,1),
##        (troop_raise_skill, "trp_player",skl_shield,1),
##        (try_begin),
##        (this_or_next|player_has_item,"itm_hide_boots"),
##        (troop_has_item_equipped,"trp_player","itm_hide_boots"),
##        (troop_remove_item, "trp_player","itm_hide_boots"),
##        (try_end),
##        (troop_add_item, "trp_player","itm_khergit_guard_helmet",imod_crude),
##        (troop_add_item, "trp_player","itm_mail_chausses",imod_crude),
##        (troop_add_item, "trp_player","itm_sword_khergit_1",imod_plain),
##        (troop_add_gold, "trp_player", 20),
##        (troop_raise_proficiency, "trp_player",2,20),
##    (else_try),
        (eq,"$background_answer_3",cb3_poacher),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_skill, "trp_player","skl_power_draw",1),
        (troop_raise_skill, "trp_player","skl_tracking",1),
        (troop_raise_skill, "trp_player","skl_spotting",1),
        (troop_raise_skill, "trp_player","skl_athletics",1),
        (troop_add_gold, "trp_player", 10),
        (troop_raise_proficiency, "trp_player",wpt_polearm,10),
        (troop_raise_proficiency, "trp_player",wpt_archery,35),

        (troop_add_item, "trp_player","itm_axe",imod_chipped),
        (troop_add_item, "trp_player","itm_leather_vest_green",0),
        (troop_add_item, "trp_player","itm_carbatinae_1_blue",0),
        (troop_add_item, "trp_player","itm_hunting_bow",0),
        (troop_add_item, "trp_player","itm_fire_arrows",0),
        (troop_add_item, "trp_player","itm_sumpter_horse",imod_heavy),
        (troop_add_item, "trp_player","itm_dried_meat",0),
        (troop_add_item, "trp_player","itm_dried_meat",0),
        (troop_add_item, "trp_player","itm_furs",0),
        (troop_add_item, "trp_player","itm_furs",0),
    (else_try),
        (eq,"$background_answer_3",cb3_craftsman),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),

        (troop_raise_skill, "trp_player","skl_weapon_master",1),
        (troop_raise_skill, "trp_player","skl_engineer",1),
        (troop_raise_skill, "trp_player","skl_tactics",1),
        (troop_raise_skill, "trp_player","skl_trade",1),

        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,15),
        (troop_add_gold, "trp_player", 100),


        (troop_add_item, "trp_player","itm_leather_boots",imod_ragged),
        (troop_add_item, "trp_player","itm_coarse_tunic",0),

        (troop_add_item, "trp_player","itm_sword_medieval_b", imod_balanced),
        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
        (troop_add_item, "trp_player","itm_bolts",0),

        (troop_add_item, "trp_player","itm_tools",0),
        (troop_add_item, "trp_player","itm_saddle_horse",0),
        (troop_add_item, "trp_player","itm_smoked_fish",0),
    (else_try),
        (eq,"$background_answer_3",cb3_peddler),
        (troop_raise_attribute, "trp_player",ca_charisma,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_skill, "trp_player","skl_riding",1),
        (troop_raise_skill, "trp_player","skl_trade",1),
        (troop_raise_skill, "trp_player","skl_pathfinding",1),
        (troop_raise_skill, "trp_player","skl_inventory_management",1),

        (troop_add_item, "trp_player","itm_leather_gloves",imod_plain),
        (troop_add_gold, "trp_player", 90),
        (troop_raise_proficiency, "trp_player",wpt_polearm,15),

        (troop_add_item, "trp_player","itm_leather_jacket",0),
        (troop_add_item, "trp_player","itm_leather_boots",imod_ragged),
        (troop_add_item, "trp_player","itm_fur_hat",0),
        (troop_add_item, "trp_player","itm_staff",0),
        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
        (troop_add_item, "trp_player","itm_bolts",0),
        (troop_add_item, "trp_player","itm_saddle_horse",0),
        (troop_add_item, "trp_player","itm_sumpter_horse",0),

        (troop_add_item, "trp_player","itm_linen",0),
        (troop_add_item, "trp_player","itm_pottery",0),
        (troop_add_item, "trp_player","itm_wool",0),
        (troop_add_item, "trp_player","itm_wool",0),
        (troop_add_item, "trp_player","itm_smoked_fish",0),
##    (else_try),
##        (eq,"$background_answer_3",6),
##        (troop_raise_attribute, "trp_player",ca_strength,1),
##        (troop_raise_attribute, "trp_player",ca_charisma,1),
##        (troop_raise_skill, "trp_player",skl_shield,1),
##        (troop_raise_skill, "trp_player",skl_wound_treatment,1),
##        (troop_raise_skill, "trp_player",skl_first_aid,1),
##        (troop_raise_skill, "trp_player",skl_surgery,1),
##        (troop_add_item, "trp_player","itm_leather_gloves",imod_ragged),
##        (troop_add_item, "trp_player","itm_quarter_staff",imod_heavy),
##        (troop_add_item, "trp_player","itm_black_hood",0),
##        (troop_add_gold, "trp_player", 10),
##        (troop_raise_proficiency, "trp_player",2,20),
    (else_try),
        (eq,"$background_answer_3",cb3_troubadour),
        (troop_raise_attribute, "trp_player",ca_charisma,2),

        (troop_raise_skill, "trp_player","skl_weapon_master",1),
        (troop_raise_skill, "trp_player","skl_persuasion",1),
        (troop_raise_skill, "trp_player","skl_leadership",1),
        (troop_raise_skill, "trp_player","skl_pathfinding",1),

        (troop_add_gold, "trp_player", 80),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,25),
        (troop_raise_proficiency, "trp_player",wpt_crossbow,10),

        (troop_add_item, "trp_player","itm_tabard",imod_sturdy),
        (troop_add_item, "trp_player","itm_leather_boots",imod_ragged),
        (troop_add_item, "trp_player","itm_sword_medieval_a", imod_rusty),
        (troop_add_item, "trp_player","itm_hunting_crossbow", 0),
        (troop_add_item, "trp_player","itm_bolts", 0),
        (troop_add_item, "trp_player","itm_saddle_horse",imod_swaybacked),
        (troop_add_item, "trp_player","itm_smoked_fish",0),
    (else_try),
        (eq,"$background_answer_3",cb3_squire),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_skill, "trp_player","skl_riding",1),
        (troop_raise_skill, "trp_player","skl_weapon_master",1),
        (troop_raise_skill, "trp_player","skl_power_strike",1),
        (troop_raise_skill, "trp_player","skl_leadership",1),

        (troop_add_gold, "trp_player", 20),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,30),
        (troop_raise_proficiency, "trp_player",wpt_two_handed_weapon,30),
        (troop_raise_proficiency, "trp_player",wpt_polearm,30),
        (troop_raise_proficiency, "trp_player",wpt_archery,10),
        (troop_raise_proficiency, "trp_player",wpt_crossbow,10),
        (troop_raise_proficiency, "trp_player",wpt_throwing,10),

        (troop_add_item, "trp_player","itm_leather_jerkin",imod_ragged),
        (troop_add_item, "trp_player","itm_leather_boots",imod_tattered),

        (troop_add_item, "trp_player","itm_sword_medieval_a", imod_rusty),
        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
        (troop_add_item, "trp_player","itm_bolts",0),
        (troop_add_item, "trp_player","itm_saddle_horse",imod_swaybacked),
        (troop_add_item, "trp_player","itm_smoked_fish",0),
    (else_try),
        (eq,"$background_answer_3",cb3_lady_in_waiting),
        (eq,"$character_gender",tf_female),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_attribute, "trp_player",ca_charisma,1),

        (troop_raise_skill, "trp_player","skl_persuasion",2),
        (troop_raise_skill, "trp_player","skl_riding",1),
        (troop_raise_skill, "trp_player","skl_wound_treatment",1),

        (troop_add_item, "trp_player","itm_dagger", 0),
        (troop_add_item, "trp_player","itm_hunting_crossbow",0),
        (troop_add_item, "trp_player","itm_bolts",0),
        (troop_add_item, "trp_player","itm_courser", imod_spirited),
        (troop_add_item, "trp_player","itm_woolen_hood",imod_sturdy),
        (troop_add_item, "trp_player","itm_woolen_dress",imod_sturdy),
        (troop_add_gold, "trp_player", 100),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,10),
        (troop_raise_proficiency, "trp_player",wpt_crossbow,15),
        (troop_add_item, "trp_player","itm_smoked_fish",0),
    (else_try),
        (eq,"$background_answer_3",cb3_student),
        (troop_raise_attribute, "trp_player",ca_intelligence,2),

        (troop_raise_skill, "trp_player","skl_weapon_master",1),
        (troop_raise_skill, "trp_player","skl_surgery",1),
        (troop_raise_skill, "trp_player","skl_wound_treatment",1),
        (troop_raise_skill, "trp_player","skl_persuasion",1),

        (troop_add_gold, "trp_player", 80),
        (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,20),
        (troop_raise_proficiency, "trp_player",wpt_crossbow,20),

        (troop_add_item, "trp_player","itm_linen_tunic",imod_sturdy),
        (troop_add_item, "trp_player","itm_woolen_hose",0),
        (troop_add_item, "trp_player","itm_sword_medieval_a", imod_rusty),
        (troop_add_item, "trp_player","itm_hunting_crossbow", 0),
        (troop_add_item, "trp_player","itm_bolts", 0),
        (troop_add_item, "trp_player","itm_saddle_horse",imod_swaybacked),
        (troop_add_item, "trp_player","itm_smoked_fish",0),
        (store_random_in_range, ":book_no", books_begin, books_end),
        (troop_add_item, "trp_player",":book_no",0),
    (try_end),

      (try_begin),
        (eq,"$background_answer_4",cb4_revenge),
        (troop_raise_attribute, "trp_player",ca_strength,2),
        (troop_raise_skill, "trp_player","skl_power_strike",1),
      (else_try),
        (eq,"$background_answer_4",cb4_loss),
        (troop_raise_attribute, "trp_player",ca_charisma,2),
        (troop_raise_skill, "trp_player","skl_ironflesh",1),
      (else_try),
        (eq,"$background_answer_4",cb4_wanderlust),
        (troop_raise_attribute, "trp_player",ca_agility,2),
        (troop_raise_skill, "trp_player","skl_pathfinding",1),
##        (else_try),
##        (eq,"$background_answer_4",4),
##        (troop_raise_attribute, "trp_player",ca_charisma,1),
##        (troop_raise_skill, "trp_player",skl_wound_treatment,1),
##        (troop_raise_proficiency, "trp_player",5,10),
      (else_try),
        (eq,"$background_answer_4",cb4_disown),
        (troop_raise_attribute, "trp_player",ca_strength,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_skill, "trp_player","skl_weapon_master",1),
      (else_try),
        (eq,"$background_answer_4",cb4_greed),
        (troop_raise_attribute, "trp_player",ca_agility,1),
        (troop_raise_attribute, "trp_player",ca_intelligence,1),
        (troop_raise_skill, "trp_player","skl_looting",1),
      (try_end),


           (try_begin),
             (eq, "$background_type", cb_noble),
             (jump_to_menu, "mnu_auto_return"),
#normal_banner_begin
             (start_presentation, "prsnt_banner_selection"),
#custom_banner_begin
#             (start_presentation, "prsnt_custom_banner"),
           (else_try),
             (change_screen_return, 0),
           (try_end),
           (set_show_messages, 1),
        ]),
      ("go_back_dot",[],"Go back.",[
        (jump_to_menu,"mnu_start_character_4"),
        ]),
    ]
  ),

  (
    "past_life_explanation",mnf_disable_all_keys,
    "{s3}",
    "none",
    [
     (try_begin),
       (gt,"$current_string_reg",14),
       (assign,"$current_string_reg",10),
     (try_end),
     (str_store_string_reg,s3,"$current_string_reg"),
     (try_begin),
       (ge,"$current_string_reg",14),
       (str_store_string,s5,"@Back to the beginning..."),
     (else_try),
       (str_store_string,s5,"@View next segment..."),
     (try_end),
     ],
    [
      ("view_next",[],"{s5}",[
        (val_add,"$current_string_reg",1),
        (jump_to_menu, "mnu_past_life_explanation"),
        ]),
      ("continue",[],"Continue...",
       [
        ]),
      ("go_back_dot",[],"Go back.",[
        (jump_to_menu, "mnu_choose_skill"),
        ]),
    ]
  ),

  (
    "auto_return",0,
    "{!}This menu automatically returns to caller.",
    "none",
    [(change_screen_return, 0)],
    [
    ]
  ),
#native morale report chief puesto off para anadir debajo el de motomataru
##  ("morale_report",0,
##   "{s1}",
##   "none",
##   [
##     (call_script, "script_get_player_party_morale_values"),
##
##     (assign, ":target_morale", reg0),
##     (assign, reg1, "$g_player_party_morale_modifier_party_size"),
##     (try_begin),
##       (gt, reg1, 0),
##       (str_store_string, s2, "@{!} -"),
##     (else_try),
##       (str_store_string, s2, "str_space"),
##     (try_end),
##
##     (assign, reg2, "$g_player_party_morale_modifier_leadership"),
##     (try_begin),
##       (gt, reg2, 0),
##       (str_store_string, s3, "@{!} +"),
##     (else_try),
##       (str_store_string, s3, "str_space"),
##     (try_end),
##
##     (try_begin),
##       (gt, "$g_player_party_morale_modifier_no_food", 0),
##       (assign, reg7, "$g_player_party_morale_modifier_no_food"),
##       (str_store_string, s5, "@^No food:  -{reg7}"),
##     (else_try),
##       (str_store_string, s5, "str_space"),
##     (try_end),
##     (assign, reg3, "$g_player_party_morale_modifier_food"),
##     (try_begin),
##       (gt, reg3, 0),
##       (str_store_string, s4, "@{!} +"),
##     (else_try),
##       (str_store_string, s4, "str_space"),
##     (try_end),
##
##     (try_begin),
##       (gt, "$g_player_party_morale_modifier_debt", 0),
##       (assign, reg6, "$g_player_party_morale_modifier_debt"),
##       (str_store_string, s6, "@^Wage debt:  -{reg6}"),
##     (else_try),
##       (str_store_string, s6, "str_space"),
##     (try_end),
##
##     (party_get_morale, reg5, "p_main_party"),
##     (store_sub, reg4, reg5, ":target_morale"),
##     (try_begin),
##       (gt, reg4, 0),
##       (str_store_string, s7, "@{!} +"),
##     (else_try),
##       (str_store_string, s7, "str_space"),
##     (try_end),
##
##     (assign, reg6, 50),
##
##     (str_store_string, s1, "str_current_party_morale_is_reg5_current_party_morale_modifiers_are__base_morale__50_party_size_s2reg1_leadership_s3reg2_food_variety_s4reg3s5s6_recent_events_s7reg4_total__reg5___"),
##
##     (try_for_range, ":kingdom_no", npc_kingdoms_begin, npc_kingdoms_end),
##       (faction_get_slot, ":faction_morale", ":kingdom_no",  slot_faction_morale_of_player_troops),
##       (val_div, ":faction_morale", 100),
##       (neq, ":faction_morale", 0),
##       (assign, reg6, ":faction_morale"),
##       (str_store_faction_name, s9, ":kingdom_no"),
##       (str_store_string, s1, "str_s1extra_morale_for_s9_troops__reg6_"),
##     (try_end),
##    ],
##    [
##      ("continue",[],"Continue...",
##      [
##        (jump_to_menu, "mnu_reports"),
##      ]),
##    ]
##  ),

 ("morale_report",0,    #modified motomataru chief
  "{s1}",
  "none",
  [
    (call_script, "script_get_player_party_morale_values"),
    #(party_set_morale, "p_main_party", reg0),
    (assign, reg6, 50),
    (assign, ":sum_modifiers", reg6),

    (assign, reg1, "$g_player_party_morale_modifier_party_size"),
    (try_begin),
      (gt, reg1, 0),
      (str_store_string, s2, "@{!} -"),
    (else_try),
      (str_store_string, s2, "str_space"),
    (try_end),
    (val_sub, ":sum_modifiers", reg1),

    # (assign, reg2, "$g_player_party_morale_modifier_leadership"),    included in party size modifier now
    # (try_begin),
      # (gt, reg2, 0),
      # (str_store_string, s3, "@{!} +"),
    # (else_try),
      # (str_store_string, s3, "str_space"),
    # (try_end),

    (assign, reg2, "$g_player_party_morale_modifier_weariness"),
    (try_begin),
      (gt, reg2, 0),
      (str_store_string, s3, "@{!} -"),
    (else_try),
      (str_store_string, s3, "str_space"),
    (try_end),
    (val_sub, ":sum_modifiers", reg2),

    (try_begin),
      (gt, "$g_player_party_morale_modifier_no_food", 0),
      (assign, reg7, "$g_player_party_morale_modifier_no_food"),
      (str_store_string, s5, "@^No food:  -{reg7}"),
      (val_sub, ":sum_modifiers", reg7),
    (else_try),
      (str_store_string, s5, "str_space"),
    (try_end),

    (assign, reg3, "$g_player_party_morale_modifier_food"),
    (try_begin),
      (gt, reg3, 0),
      (str_store_string, s4, "@{!} +"),
    (else_try),
      (str_store_string, s4, "str_space"),
    (try_end),
    (val_add, ":sum_modifiers", reg3),

    (try_begin),
      (gt, "$g_player_party_morale_modifier_debt", 0),
      (assign, reg7, "$g_player_party_morale_modifier_debt"),
      (str_store_string, s6, "@^Wage debt:  -{reg7}"),
      (val_sub, ":sum_modifiers", reg7),
    (else_try),
      (str_store_string, s6, "str_space"),
    (try_end),

    (party_get_morale, reg5, "p_main_party"),
    (store_sub, reg4, reg5, ":sum_modifiers"),
    (try_begin),
      (gt, reg4, 0),
      (str_store_string, s7, "@{!} +"),
    (else_try),
      (str_store_string, s7, "str_space"),
    (try_end),

    (str_store_string, s1, "@Current party morale is {reg5}.^Current party morale modifiers are:^^Base morale:  +{reg6}^Party size unmanageable: {s2}{reg1}^Lack of rest: {s3}{reg2}^Food variety: {s4}{reg3}{s5}{s6}^Recent events: {s7}{reg4}^TOTAL:  {reg5}^^^"),

    (try_for_range, ":kingdom_no", npc_kingdoms_begin, npc_kingdoms_end),
      (faction_get_slot, ":faction_morale", ":kingdom_no",  slot_faction_morale_of_player_troops),
      (val_div, ":faction_morale", 100),
      (neq, ":faction_morale", 0),
      (assign, reg6, ":faction_morale"),
      (str_store_faction_name, s9, ":kingdom_no"),
      (str_store_string, s1, "str_s1extra_morale_for_s9_troops__reg6_"),
    (try_end),
   ],
   [
     ("continue",[],"Continue...",
     [
       (jump_to_menu, "mnu_reports"),
     ]),
   ]
 ),
  #menu moral motomataru chief acaba

  ("courtship_relations",0,
   "{s1}",
   "none",
   [(str_store_string, s1, "str_courtships_in_progress_"),
    (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
		(troop_slot_eq, ":lady", slot_troop_met, 2),
		(call_script, "script_troop_get_relation_with_troop", "trp_player", ":lady"),
		(gt, reg0, 0),
		(assign, reg3, reg0),

		(str_store_troop_name, s2, ":lady"),

		(store_current_hours, ":hours_since_last_visit"),
		(troop_get_slot, ":last_visit_hour", ":lady", slot_troop_last_talk_time),
		(val_sub, ":hours_since_last_visit", ":last_visit_hour"),
		(store_div, ":days_since_last_visit", ":hours_since_last_visit", 24),
		(assign, reg4, ":days_since_last_visit"),

		(str_store_string, s1, "str_s1_s2_relation_reg3_last_visit_reg4_days_ago"),
	(try_end),

	(str_store_string, s1, "str_s1__poems_known"),
	(try_begin),
		 (gt, "$allegoric_poem_recitations", 0),
		 (str_store_string, s1, "str_s1_storming_the_castle_of_love_allegoric"),
	(try_end),
	(try_begin),
		 (gt, "$tragic_poem_recitations", 0),
		 (str_store_string, s1, "str_s1_kais_and_layali_tragic"),
	(try_end),
	(try_begin),
		 (gt, "$comic_poem_recitations", 0),
		 (str_store_string, s1, "str_s1_a_conversation_in_the_garden_comic"),
	(try_end),
	(try_begin),
		 (gt, "$heroic_poem_recitations", 0),
		 (str_store_string, s1, "str_s1_helgered_and_kara_epic"),
	(try_end),
	(try_begin),
		 (gt, "$mystic_poem_recitations", 0),
		 (str_store_string, s1, "str_s1_a_hearts_desire_mystic"),
	(try_end),

    ],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_reports"),
        ]
       ),
      ]
  ),


  ("lord_relations",0,
   "{s1}",
   "none",
   [
    (try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),
		(troop_set_slot, ":active_npc", slot_troop_temp_slot, 0),
	(try_end),

	(str_clear, s1),
    (try_for_range, ":unused", active_npcs_begin, active_npcs_end),
		(assign, ":score_to_beat", -100),
		(assign, ":best_relation_remaining_npc", -1),
		(try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),
			(troop_slot_eq, ":active_npc", slot_troop_temp_slot, 0),
			(troop_slot_eq, ":active_npc", slot_troop_occupation, slto_kingdom_hero),
			(troop_slot_ge, ":active_npc", slot_troop_met, 1),

			(call_script, "script_troop_get_player_relation", ":active_npc"),
			(assign, ":relation_with_player", reg0),
			(ge, ":relation_with_player", ":score_to_beat"),

			(assign, ":score_to_beat", ":relation_with_player"),
			(assign, ":best_relation_remaining_npc", ":active_npc"),
		(try_end),
		(gt, ":best_relation_remaining_npc", -1),

		(str_store_troop_name_link, s4, ":best_relation_remaining_npc"),
		(assign, reg4, ":score_to_beat"),
		(str_store_string, s1, "@{!}{s1}^{s4}: {reg4}"),
		(troop_set_slot, ":best_relation_remaining_npc", slot_troop_temp_slot, 1),
	(try_end),


    ],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_reports"),
        ]
       ),
      ]
  ),



  ("companion_report",0,
   "{s7}{s1}",
   "none",
   [
   (str_clear, s1),
   (str_store_string, s7, "str_no_companions_in_service"),

   (try_begin),
	(troop_get_slot, ":spouse_or_betrothed", "trp_player", slot_troop_spouse),
	(try_begin),
		(troop_get_type, ":is_female", "trp_player"),
   		(val_mod, ":is_female", 2),	#gender fix chief moto
		(eq, ":is_female", 1),
		(str_store_string, s8, "str_husband"),
	(else_try),
		(str_store_string, s8, "str_wife"),
	(try_end),

	(try_begin),
		(le, ":spouse_or_betrothed", 0),
		(troop_get_slot, ":spouse_or_betrothed", "trp_player", slot_troop_betrothed),
		(str_store_string, s8, "str_betrothed"),
	(try_end),
	(gt, ":spouse_or_betrothed", 0),

	(str_store_troop_name, s4, ":spouse_or_betrothed"),
	(troop_get_slot, ":cur_center", ":spouse_or_betrothed", slot_troop_cur_center),
	(try_begin),
		(is_between, ":cur_center", centers_begin, centers_end),
		(str_store_party_name, s5, ":cur_center"),
	(else_try),
		(troop_slot_eq, ":spouse_or_betrothed", slot_troop_occupation, slto_kingdom_hero),
		(str_store_string, s5, "str_leading_party"),
	(else_try),
		(str_store_string, s5, "str_whereabouts_unknown"),
    (try_end),
	(str_store_string, s3, "str_s4_s8_s5"),
	(str_store_string, s2, s1),
	(str_store_string, s1, "str_s2_s3"),

   (try_end),


   (try_begin),
    (ge, "$cheat_mode", 1),
	(ge, "$npc_to_rejoin_party", 0),
    (str_store_troop_name, s5, "$npc_to_rejoin_party"),
	(str_store_string, s1, "@{!}DEBUG -- {s1}^NPC in rejoin queue: {s5}^"),
   (try_end),


   (try_for_range, ":companion", companions_begin, companions_end),
		(str_clear, s2),
		(str_clear, s3),

		(try_begin),
			(troop_get_slot, ":days_left", ":companion", slot_troop_days_on_mission),

			(troop_slot_eq, ":companion", slot_troop_occupation, slto_player_companion),


			(str_store_troop_name, s4, ":companion"),

			(try_begin),
				(troop_slot_eq, ":companion", slot_troop_current_mission, npc_mission_kingsupport),
				(str_store_string, s8, "str_gathering_support"),
				(try_begin),
					(eq, ":days_left", 1),
					(str_store_string, s5, "str_expected_back_imminently"),
				(else_try),
					(assign, reg3, ":days_left"),
					(str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
				(try_end),
			(else_try),
				(troop_slot_eq, ":companion", slot_troop_current_mission, npc_mission_gather_intel),
				(troop_get_slot, ":town_with_contacts", ":companion", slot_troop_town_with_contacts),
				(str_store_party_name, s11, ":town_with_contacts"),

				(str_store_string, s8, "str_gathering_intelligence"),
				(try_begin),
					(eq, ":days_left", 1),
					(str_store_string, s5, "str_expected_back_imminently"),
				(else_try),
					(assign, reg3, ":days_left"),
					(str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
				(try_end),
			(else_try),	#This covers most diplomatic missions

				(troop_slot_ge, ":companion", slot_troop_current_mission, npc_mission_peace_request),
				##diplomacy chief begin
				(neg|troop_slot_eq, ":companion", slot_troop_current_mission, 8),
        		##diplomacy end

				(troop_get_slot, ":faction", ":companion", slot_troop_mission_object),
				(str_store_faction_name, s9, ":faction"),
				(str_store_string, s8, "str_diplomatic_embassy_to_s9"),
				(try_begin),
					(eq, ":days_left", 1),
					(str_store_string, s5, "str_expected_back_imminently"),
				(else_try),
					(assign, reg3, ":days_left"),
					(str_store_string, s5, "str_expected_back_in_approximately_reg3_days"),
				(try_end),
			(else_try),
				(eq, ":companion", "$g_player_minister"),
				(str_store_string, s8, "str_serving_as_minister"),
				(try_begin),
					(is_between, "$g_player_court", centers_begin, centers_end),
					(str_store_party_name, s9, "$g_player_court"),
					(str_store_string, s5, "str_in_your_court_at_s9"),
				(else_try),
					(str_store_string, s5, "str_whereabouts_unknown"),
				(try_end),
			(else_try),
				(main_party_has_troop, ":companion"),
				(str_store_string, s8, "str_under_arms"),
				(str_store_string, s5, "str_in_your_party"),
			(else_try),
				(troop_slot_eq, ":companion", slot_troop_current_mission, npc_mission_rejoin_when_possible),
				(str_store_string, s8, "str_attempting_to_rejoin_party"),
				(str_store_string, s5, "str_whereabouts_unknown"),
			(else_try),	#Companions who are in a center
				(troop_slot_ge, ":companion", slot_troop_cur_center, 1),

				(str_store_string, s8, "str_separated_from_party"),
				(str_store_string, s5, "str_whereabouts_unknown"),
			(else_try), #Excludes companions who have occupation = retirement
                (try_begin),
                  (check_quest_active, "qst_lend_companion"),
                  (quest_slot_eq, "qst_lend_companion", slot_quest_target_troop, ":companion"),
                  (str_store_string, s8, "@On loan,"),
                (else_try),
                  (check_quest_active, "qst_lend_surgeon"),
                  (quest_slot_eq, "qst_lend_surgeon", slot_quest_target_troop, ":companion"),
                  (str_store_string, s8, "@On loan,"),
                (else_try),
				  (troop_set_slot, ":companion", slot_troop_current_mission, npc_mission_rejoin_when_possible),
                  (str_store_string, s8, "str_attempting_to_rejoin_party"),
                (try_end),

	        	(str_store_string, s5, "str_whereabouts_unknown"),
				(try_begin),

					(ge, "$cheat_mode", 1),
					(troop_get_slot, reg2, ":companion", slot_troop_current_mission),
					(troop_get_slot, reg3, ":companion", slot_troop_days_on_mission),
					(troop_get_slot, reg4, ":companion", slot_troop_prisoner_of_party),
					(troop_get_slot, reg4, ":companion", slot_troop_playerparty_history),

					(display_message, "@{!}DEBUG: {s4} current mission: {reg2}, days on mission: {reg3}, prisoner: {reg4}, pphistory: {reg5}"),
				(try_end),
			(try_end),

			(str_store_string, s3, "str_s4_s8_s5"),

			(str_store_string, s2, s1),
			(str_store_string, s1, "str_s2_s3"),

			(str_clear, s7), #"no companions in service"
		(else_try),
			(neg|troop_slot_eq, ":companion", slot_troop_occupation, slto_kingdom_hero),
			(troop_slot_ge, ":companion", slot_troop_prisoner_of_party, centers_begin),

			(str_store_troop_name, s4, ":companion"),
			(str_store_string, s8, "str_missing_after_battle"),
			(str_store_string, s5, "str_whereabouts_unknown"),

			(str_store_string, s3, "str_s4_s8_s5"),
			(str_store_string, s2, s1),
			(str_store_string, s1, "str_s2_s3"),
			(str_clear, s7), #"no companions in service"

		(try_end),

   (try_end),


    ],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_reports"),
        ]
       ),
      ]
  ),





  ("faction_orders",0,
   "{!}{s9}",
   "none",
   [
    (str_clear, s9),
    (store_current_hours, ":cur_hours"),
    (try_for_range, ":faction_no", kingdoms_begin, kingdoms_end),
        (faction_slot_eq, ":faction_no", slot_faction_state, sfs_active),
        (neq, ":faction_no", "fac_player_supporters_faction"),

        (faction_get_slot, ":old_faction_ai_state", ":faction_no", slot_faction_ai_state),

	    (try_begin),
			(faction_get_slot, ":faction_marshal", ":faction_no", slot_faction_marshall),
			(gt, ":faction_marshal", -1),
			(assign, ":faction_ai_decider", ":faction_marshal"),
	    (else_try),
			(faction_get_slot, ":faction_ai_decider", ":faction_no", slot_faction_leader),
	    (try_end),


        #(*1) these two lines moved to here from (*2)
        (call_script, "script_npc_decision_checklist_faction_ai_alt", ":faction_ai_decider"),
	    (assign, ":new_strategy", reg0),
	    (str_store_string, s26, s14),

        #(3*) these three lines moved to here from (*4)
        (faction_get_slot, ":faction_ai_state", ":faction_no", slot_faction_ai_state),
        (faction_get_slot, ":faction_ai_object", ":faction_no", slot_faction_ai_object),
        (faction_get_slot, ":faction_marshall", ":faction_no", slot_faction_marshall),

        (faction_get_slot, ":faction_ai_offensive_max_followers", ":faction_no", slot_faction_ai_offensive_max_followers),
        (str_store_faction_name, s10, ":faction_no"),

	   (try_begin),
			(faction_get_slot, ":faction_issue", ":faction_no", slot_faction_political_issue),

			(try_begin),
				(eq, ":faction_issue", 1),
				(str_store_string, s11, "@Appoint next marshal"),
			(else_try),
				(is_between, ":faction_issue", centers_begin, centers_end),
				(str_store_party_name, s12, ":faction_issue"),
				(str_store_string, s11, "@Award {s12} as fief"),
			(else_try),
				(eq, ":faction_issue", 0),
				(str_store_string, s11, "@None"),
			(else_try),
				(assign, reg3, ":faction_issue"),
				(str_store_string, s11, "@{!}Error ({reg3})"),
			(try_end),

			(store_current_hours, reg4),
			(faction_get_slot, ":faction_issue_put_on_agenda", ":faction_no", slot_faction_political_issue_time),
			(val_sub, reg4, ":faction_issue_put_on_agenda"),

	        (str_store_string, s10, "@{!}{s10}^Faction political issue: {s11}"),
			(try_begin),
				(faction_slot_ge, ":faction_no", slot_faction_political_issue, 1),
				(str_store_string, s10, "@{!}{s10} (on agenda {reg4} hours)"),
			(try_end),
	   (try_end),


       (assign, reg2, ":faction_ai_offensive_max_followers"),
       (try_begin),
         (eq, ":faction_ai_state", sfai_default),
         (str_store_string, s11, "@{!}Defending"),
       (else_try),
         (eq, ":faction_ai_state", sfai_gathering_army),
         (str_store_string, s11, "@{!}Gathering army"),
       (else_try),
         (eq, ":faction_ai_state", sfai_attacking_center),
         (str_store_party_name, s11, ":faction_ai_object"),
         (str_store_string, s11, "@{!}Besieging {s11}"),
       (else_try),
         (eq, ":faction_ai_state", sfai_raiding_village),
         (str_store_party_name, s11, ":faction_ai_object"),
         (str_store_string, s11, "@{!}Raiding {s11}"),
       (else_try),
         (eq, ":faction_ai_state", sfai_attacking_enemy_army),
         (str_store_party_name, s11, ":faction_ai_object"),
         (str_store_string, s11, "str_attacking_enemy_army_near_s11"),
       (else_try),
         (eq, ":faction_ai_state", sfai_feast),
         (str_store_party_name, s11, ":faction_ai_object"),
         (str_store_string, s11, "str_holding_feast_at_s11"),
	   (else_try),
         (eq, ":faction_ai_state", sfai_attacking_enemies_around_center),
         (str_store_party_name, s11, ":faction_ai_object"),
         (str_store_string, s11, "@{!}Attacking enemies around {s11}"),
       (else_try),
	     (assign, reg4, ":faction_ai_state"),
		 (str_store_string, s11, "str_sfai_reg4"),
	   (try_end),

       (try_begin),
         (lt, ":faction_marshall", 0),
         (str_store_string, s12, "@No one"),
       (else_try),
         (str_store_troop_name, s12, ":faction_marshall"),
		 (troop_get_slot, reg21, ":faction_marshall", slot_troop_controversy),
		 (str_store_string, s12, "@{!}{s12} (controversy: {reg21})"),
       (try_end),

	   (try_for_parties, ":screen_party"),
            #MOTO chief use substate to represent screening properly
                  # (party_slot_eq, ":screen_party",      slot_party_ai_state, spai_screening_army),
                  (party_slot_eq, ":screen_party", slot_party_ai_state,      spai_accompanying_army),
                  (party_slot_eq, ":screen_party",      slot_party_ai_substate, 1),
                  #MOTO end use substate to represent screening properly
			(store_faction_of_party, ":screen_party_faction", ":screen_party"),
			(eq, ":screen_party_faction", ":faction_no"),

			(str_store_party_name, s38, ":screen_party"),
			(str_store_string, s12, "@{!}{s12}^Screening party: {s38}"),
	   (try_end),

       #(*2) these two lines moved to up (look *1)
	   #(call_script, "script_npc_decision_checklist_faction_ai", ":faction_no"),
	   #(assign, ":new_strategy", reg0),

       #(try_begin),
       #  (this_or_next|eq, ":new_strategy", sfai_default),
       #  (eq, ":new_strategy", sfai_feast),
	   #
	   #  (store_current_hours, ":hours"),
	   #  (faction_set_slot, ":faction_no", slot_faction_ai_last_rest_time, ":hours"),
	   #(try_end),
      (try_begin),
         #new condition to rest, (a faction's new strategy should be feast or default) and (":hours_at_current_state" > 20)
         (this_or_next|eq, ":new_strategy", sfai_default),
         (eq, ":new_strategy", sfai_feast),

         (store_current_hours, ":hours_at_current_state"),
         (faction_get_slot, ":current_state_started", ":faction_no", slot_faction_ai_current_state_started),
         (val_sub, ":hours_at_current_state", ":current_state_started"),
         (ge, ":hours_at_current_state", 18),

         (store_current_hours, ":hours"),
         (faction_set_slot, ":faction_no", slot_faction_ai_last_rest_time, ":hours"),
       (try_end),

        #Change of strategy
        (try_begin),
          (neq, ":new_strategy", ":old_faction_ai_state"),

          (store_current_hours, ":hours"),
          (faction_set_slot, ":faction_no", slot_faction_ai_current_state_started, ":hours"),
        (try_end),

	   (call_script, "script_evaluate_realm_stability", ":faction_no"),
	   (assign, ":disgruntled_lords", reg0),
	   (assign, ":restless_lords", reg1),

	   (faction_get_slot, ":last_feast_ended", ":faction_no", slot_faction_last_feast_start_time),
	   (store_sub, ":hours_since_last_feast", ":cur_hours", ":last_feast_ended"),
           (val_sub, ":last_feast_ended", 72),
	   (faction_get_slot, ":current_state_started", ":faction_no", slot_faction_ai_current_state_started),
	   (store_sub, ":hours_at_current_state", ":cur_hours", ":current_state_started"),

       (faction_get_slot, ":faction_ai_last_offensive_time", ":faction_no", slot_faction_last_offensive_concluded),
       (store_sub, ":hours_since_last_offensive", ":cur_hours", ":faction_ai_last_offensive_time"),

       (faction_get_slot, ":faction_ai_last_rest", ":faction_no", slot_faction_ai_last_rest_time),
       (store_sub, ":hours_since_last_rest", ":cur_hours", ":faction_ai_last_rest"),

       (faction_get_slot, ":faction_ai_last_decisive_event", ":faction_no", slot_faction_ai_last_decisive_event),
       (store_sub, ":hours_since_last_decisive_event", ":cur_hours", ":faction_ai_last_decisive_event"),

	   (assign, reg3, ":hours_at_current_state"),
	   (assign, reg4, ":hours_since_last_offensive"),
	   (assign, reg5, ":hours_since_last_feast"),

	   (assign, reg7, ":disgruntled_lords"),
	   (assign, reg8, ":restless_lords"),
	   (assign, reg9, ":hours_since_last_rest"),
	   (assign, reg10, ":hours_since_last_decisive_event"),
	   (str_store_string, s14, s26),

       (str_store_string, s9, "str_s9s10_current_state_s11_hours_at_current_state_reg3_current_strategic_thinking_s14_marshall_s12_since_the_last_offensive_ended_reg4_hours_since_the_decisive_event_reg10_hours_since_the_last_rest_reg9_hours_since_the_last_feast_ended_reg5_hours_percent_disgruntled_lords_reg7_percent_restless_lords_reg8__"),
     (try_end),

     (try_begin),
       (neg|is_between, "$g_cheat_selected_faction", kingdoms_begin, kingdoms_end),
       (call_script, "script_get_next_active_kingdom", kingdoms_end),
       (assign, "$g_cheat_selected_faction", reg0),
     (try_end),
     (str_store_faction_name, s10, "$g_cheat_selected_faction"),
     (str_store_string, s9, "@Selected faction is: {s10}^^{s9}"),
    ],
    [
      ("faction_orders_next_faction", [],"{!}Select next faction.",
       [
         (call_script, "script_get_next_active_kingdom", "$g_cheat_selected_faction"),
         (assign, "$g_cheat_selected_faction", reg0),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),

      ("faction_orders_political_collapse", [],"{!}CHEAT - Cause all lords in faction to fall out with their liege.",
       [
	   (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
			(troop_slot_eq, ":lord", slot_troop_occupation, slto_kingdom_hero),
			(store_faction_of_troop, ":troop_faction", ":lord"),
			(eq, ":troop_faction", "$g_cheat_selected_faction"),
			(faction_get_slot, ":faction_liege", ":troop_faction", slot_faction_leader),
			(call_script, "script_troop_change_relation_with_troop", ":lord", ":faction_liege", -200),
	   (try_end),

	   ]
       ),

      ("faction_orders_defend", [],"{!}Force defend.",
       [
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_state, sfai_default),
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_object, -1),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),
      ("faction_orders_feast", [],"{!}Force feast.",
       [

		 (assign, ":location_high_score", 0),
		 (try_for_range, ":location", walled_centers_begin, walled_centers_end),
			(neg|party_slot_ge, ":location", slot_center_is_besieged_by, 1),
			(store_faction_of_party, ":location_faction", ":location"),
			(eq, ":location_faction", "$g_cheat_selected_faction"),
			(party_get_slot, ":location_lord", ":location", slot_town_lord),
			(troop_get_slot, ":location_score", ":location_lord", slot_troop_renown),
			(store_random_in_range, ":random", 0, 1000), #will probably be king or senior lord
			(val_add, ":location_score", ":random"),
			(gt, ":location_score", ":location_high_score"),
			(assign, ":location_high_score", ":location_score"),
			(assign, ":location_feast", ":location"),
		 (try_end),

		 (try_begin),
			(gt, ":location_feast", centers_begin),
			(faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_state, sfai_feast),
			(faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_object, ":location_feast"),
			(try_begin),
			  (eq, "$g_player_eligible_feast_center_no", ":location_feast"),
			  (assign, "$g_player_eligible_feast_center_no", -1),
			(try_end),

			(store_current_hours, ":hours"),
			(faction_set_slot, "$g_cheat_selected_faction", slot_faction_last_feast_start_time, ":hours"),
		 (try_end),

	     (jump_to_menu, "mnu_faction_orders"),
        ]
       ),


      ("faction_orders_gather", [],"{!}Force gather army.",
       [
         (store_current_hours, ":cur_hours"),
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_state, sfai_gathering_army),
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_last_offensive_concluded, ":cur_hours"),
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_offensive_max_followers, 1),
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_ai_object, -1),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),
      ("faction_orders_increase_time", [],"{!}Increase last offensive time by 24 hours.",
       [
         (faction_get_slot, ":faction_ai_last_offensive_time", "$g_cheat_selected_faction", slot_faction_last_offensive_concluded),
         (val_sub, ":faction_ai_last_offensive_time", 24),
         (faction_set_slot, "$g_cheat_selected_faction", slot_faction_last_offensive_concluded, ":faction_ai_last_offensive_time"),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),
      ("faction_orders_rethink", [],"{!}Force rethink.",
       [
         (call_script, "script_init_ai_calculation"),
         (call_script, "script_decide_faction_ai", "$g_cheat_selected_faction"),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),
      ("faction_orders_rethink_all", [],"{!}Force rethink for all factions.",
       [
         (call_script, "script_recalculate_ais"),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),

	   ("enable_alt_ai",[(eq, "$g_use_alternative_ai", 2),],"{!}CHEAT! - enable alternative ai",
       [
	   (assign, "$g_use_alternative_ai", 1),
	   (jump_to_menu, "mnu_faction_orders"),
       ]
       ),

	   ("disable_alt_ai",[(eq, "$g_use_alternative_ai", 2)],"{!}CHEAT! - disable alternative ai",
       [
	   (assign, "$g_use_alternative_ai", 0),
	   (jump_to_menu, "mnu_faction_orders"),
       ]
       ),

      ("faction_orders_init_econ", [],"{!}Initialize economic stats.",
       [
         (call_script, "script_initialize_economic_information"),
         (jump_to_menu, "mnu_faction_orders"),
        ]
       ),



      ("go_back_dot",[],"{!}Go back.",
       [(jump_to_menu, "mnu_reports"),
        ]
       ),
      ]
  ),


  ("character_report",0,
   "{s9}",
   "none",
   [(try_begin),
      (gt, "$g_player_reading_book", 0),
      (player_has_item, "$g_player_reading_book"),
      (str_store_item_name, s8, "$g_player_reading_book"),
      (str_store_string, s9, "@You are currently reading {s8}."),
    (else_try),
      (assign, "$g_player_reading_book", 0),
      (str_store_string, s9, "@You are not reading any books."),
    (try_end),
    (assign, ":num_friends", 0),
    (assign, ":num_enemies", 0),
    (str_store_string, s6, "@none"),
    (str_store_string, s8, "@none"),
    (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
	  (this_or_next|troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
		(troop_slot_eq, ":troop_no", slot_troop_occupation, slto_inactive_pretender),
	  (call_script, "script_troop_get_player_relation", ":troop_no"),
      (assign, ":player_relation", reg0),
      #(troop_get_slot, ":player_relation", ":troop_no", slot_troop_player_relation),
      (try_begin),
        (gt, ":player_relation", 20),
        (try_begin),
          (eq, ":num_friends", 0),
          (str_store_troop_name, s8, ":troop_no"),
        (else_try),
          (eq, ":num_friends", 1),
          (str_store_troop_name, s7, ":troop_no"),
          (str_store_string, s8, "@{s7} and {s8}"),
        (else_try),
          (str_store_troop_name, s7, ":troop_no"),
          (str_store_string, s8, "@{!}{s7}, {s8}"),
        (try_end),
        (val_add, ":num_friends", 1),
      (else_try),
        (lt, ":player_relation", -20),
        (try_begin),
          (eq, ":num_enemies", 0),
          (str_store_troop_name, s6, ":troop_no"),
        (else_try),
          (eq, ":num_enemies", 1),
          (str_store_troop_name, s5, ":troop_no"),
          (str_store_string, s6, "@{s5} and {s6}"),
        (else_try),
          (str_store_troop_name, s5, ":troop_no"),
          (str_store_string, s6, "@{!}{s5}, {s6}"),
        (try_end),
        (val_add, ":num_enemies", 1),
      (try_end),
    (try_end),

	#lord recruitment changes begin
	(str_clear, s12),
	(try_begin),
		(gt, "$player_right_to_rule", 0),
		(assign, reg12, "$player_right_to_rule"),
		(str_store_string, s12, "str__right_to_rule_reg12"),
	(try_end),

	(str_clear, s15),
	(try_begin),
		(this_or_next|gt, "$claim_arguments_made", 0),
		(this_or_next|gt, "$ruler_arguments_made", 0),
		(this_or_next|gt, "$victory_arguments_made", 0),
		(this_or_next|gt, "$lords_arguments_made", 0),
		(eq, 1, 0),

		(assign, reg3, "$claim_arguments_made"),
		(assign, reg4, "$ruler_arguments_made"),
		(assign, reg5, "$victory_arguments_made"),
		(assign, reg6, "$lords_arguments_made"),
		(assign, reg7, "$benefit_arguments_made"),

		(str_store_string, s15, "str_political_arguments_made_legality_reg3_rights_of_lords_reg4_unificationpeace_reg5_rights_of_commons_reg6_fief_pledges_reg7"),
	(try_end),

	#lord recruitment changes begin

    (assign, reg3, "$player_honor"),
    (troop_get_slot, reg2, "trp_player", slot_troop_renown),

#chief entretenimiento skill bardo moto
    (assign, reg1, "$bardic_reputation"),

    # (str_store_string, s9, "str_renown_reg2_honour_rating_reg3s12_friends_s8_enemies_s6_s9"),
    (str_store_string, s9, "@Renown: {reg2}.^Bardic Reputation: {reg1}.^Honour rating: {reg3}.{s12}^Friends: {s8}.^Enemies: {s6}.^{s9}"),
#chief entretenimiento skill bardo acaba

    (call_script, "script_get_number_of_hero_centers", "trp_player"),
    (assign, ":no_centers", reg0),
    (try_begin),
      (gt, ":no_centers", 0),
      (try_for_range, ":i_center", 0, ":no_centers"),
        (call_script, "script_troop_get_leaded_center_with_index", "trp_player", ":i_center"),
        (assign, ":cur_center", reg0),
        (try_begin),
          (eq, ":i_center", 0),
          (str_store_party_name, s8, ":cur_center"),
        (else_try),
          (eq, ":i_center", 1),
          (str_store_party_name, s7, ":cur_center"),
          (str_store_string, s8, "@{s7} and {s8}"),

        (else_try),
          (str_store_party_name, s7, ":cur_center"),
          (str_store_string, s8, "@{!}{s7}, {s8}"),
        (try_end),
      (try_end),
      (str_store_string, s9, "@Your estates are: {s8}.^{s9}"),
    (try_end),
    (try_begin),
      (gt, "$players_kingdom", 0),

      (str_store_faction_name, s8, "$players_kingdom"),
      (try_begin),
        (this_or_next|is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
        (neg|faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
        #(str_store_string, s9, "@You are a lord of {s8}.^{s9}"),
        (str_store_string, s9, "str_you_are_a_lord_lady_of_s8_s9"),
      (else_try),
        (str_store_string, s9, "str_you_are_king_queen_of_s8_s9"),
      (try_end),

    (try_end),
    ],
    [

	#lord recruitment changes begin

	("continue",[(eq,"$cheat_mode",1)],"{!}CHEAT! - increase Right to Rule",
       [
	   (val_add, "$player_right_to_rule", 10),
	   (jump_to_menu, "mnu_character_report"),
       ]
       ),


	("continue",[(eq,"$cheat_mode",1),
		(str_store_troop_name, s14, "$g_talk_troop"),
	],"{!}CHEAT! - increase your relation with {s14}",
       [
	   (call_script, "script_change_player_relation_with_troop", "$g_talk_troop", 10),
	   (jump_to_menu, "mnu_character_report"),
       ]
       ),


	("continue",[(eq,"$cheat_mode",1)],"{!}CHEAT! - increase Reputation",
       [
	   (val_add, "$player_honor", 10),
	   (jump_to_menu, "mnu_character_report"),
       ]
       ),

	("continue",[(eq,"$cheat_mode",1)],"{!}CHEAT! - increase renown",
       [
	   (troop_get_slot, ":renown", "trp_player", slot_troop_renown),
	   (val_add, ":renown", 50),
	   (troop_set_slot, "trp_player", slot_troop_renown, ":renown"),

	   (jump_to_menu, "mnu_character_report"),
       ]
       ),

	("continue",[(eq,"$cheat_mode",1)],"{!}CHEAT! - increase persuasion",
       [
	   (troop_raise_skill, "trp_player", "skl_persuasion", 1),

	   (jump_to_menu, "mnu_character_report"),
       ]
       ),



	("continue",[],"Continue...",
       [(jump_to_menu, "mnu_reports"),
        ]
       ),

	#lord recruitment changes end

	   ]
  ),
#native party size chief
##  ("party_size_report",0,
##   "{s1}",
##   "none",
##   [(call_script, "script_game_get_party_companion_limit"),
##    (assign, ":party_size_limit", reg0),
##
##    (store_skill_level, ":leadership", "skl_leadership", "trp_player"),
##    (val_mul, ":leadership", 5),
##    (store_attribute_level, ":charisma", "trp_player", ca_charisma),
##
##    (troop_get_slot, ":renown", "trp_player", slot_troop_renown),
##    (val_div, ":renown", 25),
##    (try_begin),
##      (gt, ":leadership", 0),
##      (str_store_string, s2, "@{!} +"),
##    (else_try),
##      (str_store_string, s2, "str_space"),
##    (try_end),
##    (try_begin),
##      (gt, ":charisma", 0),
##      (str_store_string, s3, "@{!} +"),
##    (else_try),
##      (str_store_string, s3, "str_space"),
##    (try_end),
##    (try_begin),
##      (gt, ":renown", 0),
##      (str_store_string, s4, "@{!} +"),
##    (else_try),
##      (str_store_string, s4, "str_space"),
##    (try_end),
##    (assign, reg5, ":party_size_limit"),
##    (assign, reg1, ":leadership"),
##    (assign, reg2, ":charisma"),
##    (assign, reg3, ":renown"),
##    (str_store_string, s1, "@Current party size limit is {reg5}.^Current party size modifiers are:^^Base size:  +30^Leadership: {s2}{reg1}^Charisma: {s3}{reg2}^Renown: {s4}{reg3}^TOTAL:  {reg5}"),
##    ],
##    [
##      ("continue",[],"Continue...",
##       [(jump_to_menu, "mnu_reports"),
##        ]
##       ),
##      ]
##  ),

#modificacion party size por motomataru
   ("party_size_report", 0, "{s1}", "none", [    #motomataru update 9/29/10 to use same numbers as the function that generates it
   (call_script, "script_game_get_party_companion_limit"),
   (try_begin),    #base
     (gt, reg31, 0),
     (str_store_string, s5, "@{!} +"),
   (else_try),
     (str_store_string, s5, "str_space"),
   (try_end),
   (try_begin),    #leadership
     (gt, reg32, 0),
     (str_store_string, s2, "@{!} +"),
   (else_try),
     (str_store_string, s2, "str_space"),
   (try_end),
   (try_begin),    #charisma
     (gt, reg33, 0),
     (str_store_string, s3, "@{!} +"),
   (else_try),
     (str_store_string, s3, "str_space"),
   (try_end),
   (try_begin),    #renown
     (gt, reg34, 0),
     (str_store_string, s4, "@{!} +"),
   (else_try),
     (str_store_string, s4, "str_space"),
   (try_end),
   (str_store_string, s1, "@Current party size limit is {reg0}.^Current party size modifiers are:^^Base size: {s5}{reg31}^Combined leadership: {s2}{reg32}^Charisma: {s3}{reg33}^Renown: {s4}{reg34}^TOTAL:  {reg0}"),
   ],
   [
     ("continue",[],"Continue...",
      [(jump_to_menu, "mnu_reports"),
       ]
      ),
     ]
 ),
 #motomataru chief acaba

  ("faction_relations_report",0,
   "{s1}",
   "none",
   [(str_clear, s2),
    (try_for_range, ":cur_kingdom", kingdoms_begin, kingdoms_end),
      (faction_slot_eq, ":cur_kingdom", slot_faction_state, sfs_active),
      (neq, ":cur_kingdom", "fac_player_supporters_faction"),
      (store_relation, ":cur_relation", "fac_player_supporters_faction", ":cur_kingdom"),
      (try_begin),
        (ge, ":cur_relation", 90),
        (str_store_string, s3, "@Loyal"),
      (else_try),
        (ge, ":cur_relation", 80),
        (str_store_string, s3, "@Devoted"),
      (else_try),
        (ge, ":cur_relation", 70),
        (str_store_string, s3, "@Fond"),
      (else_try),
        (ge, ":cur_relation", 60),
        (str_store_string, s3, "@Gracious"),
      (else_try),
        (ge, ":cur_relation", 50),
        (str_store_string, s3, "@Friendly"),
      (else_try),
        (ge, ":cur_relation", 40),
        (str_store_string, s3, "@Supportive"),
      (else_try),
        (ge, ":cur_relation", 30),
        (str_store_string, s3, "@Favorable"),
      (else_try),
        (ge, ":cur_relation", 20),
        (str_store_string, s3, "@Cooperative"),
      (else_try),
        (ge, ":cur_relation", 10),
        (str_store_string, s3, "@Accepting"),
      (else_try),
        (ge, ":cur_relation", 0),
        (str_store_string, s3, "@Indifferent"),
      (else_try),
        (ge, ":cur_relation", -10),
        (str_store_string, s3, "@Suspicious"),
      (else_try),
        (ge, ":cur_relation", -20),
        (str_store_string, s3, "@Grumbling"),
      (else_try),
        (ge, ":cur_relation", -30),
        (str_store_string, s3, "@Hostile"),
      (else_try),
        (ge, ":cur_relation", -40),
        (str_store_string, s3, "@Resentful"),
      (else_try),
        (ge, ":cur_relation", -50),
        (str_store_string, s3, "@Angry"),
      (else_try),
        (ge, ":cur_relation", -60),
        (str_store_string, s3, "@Hateful"),
      (else_try),
        (ge, ":cur_relation", -70),
        (str_store_string, s3, "@Revengeful"),
      (else_try),
        (str_store_string, s3, "@Vengeful"),
      (try_end),
      (str_store_faction_name, s4, ":cur_kingdom"),
      (assign, reg1, ":cur_relation"),
      (str_store_string, s2, "@{!}{s2}^{s4}: {reg1} ({s3})"),
    (try_end),
    (str_store_string, s1, "@Your relation with the factions are:^{s2}"),



    ],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_reports"),
        ]
       ),
      ]
  ),

#Tempered  chief changed camp menu for entrenchment
  ("camp",mnf_scale_picture,
   "You find a suitable place to camp.^{s15}",
   "none",
   [
#     (assign, "$g_player_icon_state", pis_normal),
     (set_background_mesh, "mesh_pic_camp"),
#tempered chief
		(str_clear,s15),
		(str_store_string,s15,"@_"),
		(try_begin),
			(party_get_slot,":party_entrenched","p_main_party",slot_party_entrenched),
			(this_or_next|ge,":party_entrenched",1),
			(party_slot_eq,"p_main_party",slot_party_siege_camp,1),
			(str_store_string,s15,"str_entrench"),
		(try_end),
#tempered chief
     ],
    [
##      ("camp_action_1",[(eq,"$cheat_mode",1)],"{!}Cheat: Walk around.",
##       [(set_jump_mission,"mt_ai_training"),
##        (call_script, "script_setup_random_scene"),
##        (change_screen_mission),
##        ]
##       ),
#diplomacy chief
	("dplmc_camp_preferences",
		[
		],
		"Mod options.",
		[
			(jump_to_menu, "mnu_dplmc_preferences")
		]
	),
#diplomacy chief acaba
#religion chief Sod
	("religion_preferences",
		[
		],
		"What religion am I?.",
		[
           (try_begin),
							 (eq, "$g_sod_faith", 4),
				(display_message, "@You are Christian."),
				(else_try),
							 (eq, "$g_sod_faith", 2),
				(display_message, "@You are Pagan and worship the Old Celtics Gods."),
				(else_try),
							 (eq, "$g_sod_faith", 3),
				(display_message, "@You are Pagan and worship Germanic Gods."),
				(else_try),
				(display_message, "@You haven no religion yet. If you desire conversion, seek out a bishop or pagan priest."),
           (try_end),
		]
	),
#religion chief acaba
#heridas

	("heridas_actuales",
		[
		],
		"Am I injured?.",
		[
           (try_begin),
                      (eq, "$wound_type", 1),
                     (display_message,"@Yes. You have a deep cut on your arm. (-1 strength)",0xFFFFAAAA),
            (else_try),
                      (eq, "$wound_type", 2),
                     (display_message,"@Yes. You have a nasty cut on your torso. (-1 strength, -1 agility)",0xFFFFAAAA),
            (else_try),
                      (eq, "$wound_type", 3),
                     (display_message,"@Yes. You have suffered a blow to the head. (-1 intelligence)",0xFFFFAAAA),
            (else_try),
                      (eq, "$wound_type", 4),
                     (display_message,"@Yes. You have suffered a severe blow to your leg. (-1 agility)",0xFFFFAAAA),
            (else_try),
                      (eq, "$wound_type", 5),
                     (display_message,"@Yes. You have a broken arm. (-3 strength, -1 power strike, -1 power draw)",0xFFFFAAAA),
            (else_try),
                      (eq, "$wound_type", 6),
                     (display_message,"@Yes. You have a broken rib. (-2 strength, -2 agility, -1 ironflesh)",0xFFFFAAAA),
            (else_try),
                      (eq, "$wound_type", 7),
                     (display_message,"@Yes. You have suffered a heavy blow to the head. (-2 intelligence, -1 leadership, -1 tactics)",0xFFFFAAAA),
            (else_try),
           (eq, "$wound_type", 8),
                     (display_message,"@Yes. You have a broken leg. (-3 agility, -1 athletics, -1 riding)",0xFFFFAAAA),
            (else_try),
            (display_message, "@No. You are fine."),
           (try_end),
		]
	),
#heridas acaba
##        ###navegar solo chief
##              ("navegar_solo",[(eq, "$g_player_icon_state", pis_ship),],"Explore the ocean.",
##             [   				(assign, ":scene_to_use", "scn_sea_2"),
##
##		(modify_visitors_at_site, ":scene_to_use"),
##        (reset_visitors),
###        (assign, "$talk_context", tc_camp),
##		(assign,":count",30),
##		(try_for_range,":current_npc",companions_begin,companions_end),
##			(try_begin),
##				(main_party_has_troop,":current_npc"),
##				(set_visitor,":count",":current_npc"),
##			(try_end),
##			(val_add,":count",1),
##		(try_end),
##        (set_jump_mission,"mt_navegar_solo"),
##        (set_jump_entry, 0),
##        (jump_to_scene, ":scene_to_use"),
##        (change_screen_mission),
##    ],
##  ),
###navegar solo acaba

      ("camp_action",[],"Take an action.",
       [(jump_to_menu, "mnu_camp_action"),
        ]
       ),
      ("camp_wait_here",[],"Wait here for some time.",
       [
 	  (val_max, "$entertainement_on", 1), #chief entretenimiento bardo MOTO avoid overwriting higher value
          (assign,"$g_camp_mode", 1),
           (assign, "$g_infinite_camping", 0),
           (assign, "$g_player_icon_state", pis_camping),
		   (party_set_slot,"p_main_party",slot_party_entrenched,0), #TEMPERED chief ADDED LINE FOR NO ENTRENCHMENT
	   (assign,"$current_camp_party",-1), #TEMPERED chief ADDED LINE FOR NO ENTRENCHMENT

           (try_begin),
             (party_is_active, "p_main_party"),
             (party_get_current_terrain, ":cur_terrain", "p_main_party"),
             (try_begin),
               (eq, ":cur_terrain", rt_desert),
               (unlock_achievement, ACHIEVEMENT_SARRANIDIAN_NIGHTS),
			 (else_try), #seafare chief duh
         (this_or_next|eq,":cur_terrain",0),
         (this_or_next|eq,":cur_terrain",7),
          (eq,":cur_terrain",8),
				(assign, "$g_player_icon_state", pis_ship),
				(party_set_flags, "p_main_party", pf_is_ship, 1), #seafare acaba
             (try_end),
           (try_end),

           (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable

           (change_screen_return),
        ]
       ),

	   ("camp_fishing", #Floris Fishing seafare chief duh
	   [	(party_get_current_terrain, ":terrain", "p_main_party"),
         (this_or_next|eq,":terrain",0),
         (this_or_next|eq,":terrain",7),
          (eq,":terrain",8),
	   ],
	   "Try to catch some fish (use foraging skill).",
	   [
			(store_current_hours, ":time"),
			(val_add, ":time", 24),
			(party_set_slot, "p_main_party", slot_ship_time, ":time"),
			(assign,"$g_camp_mode", 1),
			(assign, "$g_infinite_camping", 0),
			(rest_for_hours_interactive, 24 * 365, 5, 1),
			(assign, "$g_player_icon_state", pis_ship),
			(change_screen_map),
		]),

   #caba'drin custom name player party chief
         ("action_change_party_name",
       [(troop_slot_ge, "trp_player", slot_troop_renown, 300)], #My opinion is that it should be renown-dependent...
       "Thanks to your renown, you can change your party's name.",
       [(start_presentation, "prsnt_set_party_name")]
       ),
#custom name acaba chief caba'drin
	#-## Outposts begin chief
	   ("action_manage_outposts",[
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          (troop_slot_ge, "trp_player", slot_troop_renown, 80), #chief anadido
                                          ],"Your Lair.",
       [(jump_to_menu, "mnu_encontrar_guarida")]),
	#-## Outposts end

#Tempered inspect camp
      ("camp_inspect",[
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
],"Inspect your camp.",
       [
			(call_script,"script_visit_camp"),
        ]
       ),
#TEMPERED chief CHANGES BEGIN  ADDED ENTRENCHMENT MENU OPTION
      ("camp_entrench",[
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),

(party_slot_eq,"p_main_party",slot_party_entrenched,0),
							(assign,":continue",0),
							(try_for_parties,":camp_site"),
								(eq,":continue",0),
								(party_slot_eq,":camp_site",slot_party_type,spt_entrenchment),
								(store_distance_to_party_from_party, ":distance", ":camp_site", "p_main_party"),
								(try_begin),
									(le,":distance",1),
									(str_store_string,s1,"@Return to your fortifications."),
									(assign,":continue",1),
									(assign,"$current_camp_party",":camp_site"),
								(try_end),
							(try_end),
							(try_begin),
								(eq,":continue",0),
								(call_script,"script_party_entrench_time"),
								(str_store_string,s1,"@Spend {reg5} hours entrenching your camp site."),
								(assign,"$current_camp_party",-1),
							(try_end),
						],"{s1}",
       [
			(assign,":continue",0),
			(store_current_hours,":cur_hour"),
			(try_begin),
				(player_has_item,"itm_tools"),
				(assign,":continue",1),
			(try_end),
			(try_begin),
				(eq,":continue",1),
				(try_begin),
					(lt,"$current_camp_party",0),
					(call_script,"script_party_entrench_time"),
					(store_add,"$entrench_time",":cur_hour",reg5),
					(call_script,"script_change_player_party_morale",-10),
					(party_set_slot,"p_main_party",slot_party_entrenched,-1),
					(assign,"$g_camp_mode", 1),
					(assign, "$g_infinite_camping", 0),
					(assign, "$g_player_icon_state", pis_camping),
					(rest_for_hours_interactive, 24 * 7, 5, 1), #rest while attackable
					(change_screen_return),
				(else_try),
					(gt,"$current_camp_party",0),
					(party_set_slot,"p_main_party",slot_party_entrenched,1),
					(display_message,"@_You have returned to a fortified position."),
					(party_set_slot,"$current_camp_party",slot_village_state,1),
					(party_clear_particle_systems, "$current_camp_party"),
					(assign,"$entrench_time",0),
					(assign,"$g_camp_mode", 1),
					(assign, "$g_infinite_camping", 0),
					(assign, "$g_player_icon_state", pis_camping),
					(jump_to_menu,"mnu_camp"),
				(try_end),
			(else_try),
				(eq,":continue",0),
				(display_message,"@_You must have tools in inventory to entrench your camp site."),
				(jump_to_menu,"mnu_camp"),
			(try_end),
        ]
       ),
###Wathtower chief SoT
##      ("wathtower_action",
##		[
##		],"Manage Watchtower.",
##       [
##			(jump_to_menu,"mnu_camp_watchtower"),
##        ]
##       ),
###wathtower acaba
###rigale chief

      ("camp_set_ambush",
		   [
          (neg|troop_is_wounded, "trp_player"),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
		(ge, ":tactics", 5),
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
		   (eq, "$ambush_set_by_player", 0),
			],
		"Gather my party, and warn that we will set up an ambush",
		   [
		   (assign, "$ambush_set_by_player", 1),
		   (assign, "$sneaking_set_by_player", 0),
		   (call_script,"script_rigale_check_ambushing_success"),
		   (change_screen_return),
		   (rest_for_hours_interactive, 2, 1, 1),

			],
		),
      ("camp_set_sneaking",
		   [
          (neg|troop_is_wounded, "trp_player"),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
		(ge, ":tactics", 2),
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
		   (eq, "$sneaking_set_by_player", 0),

			],
		"Gather my party, and warn that we will sneak around",
		   [
#		(assign,":keep_checking",0),
		# (try_for_parties, ":party_no"),
		#(try_begin),
#		(neq,":keep_checking",1),
			# (party_is_active, ":party_no"),
			# (store_distance_to_party_from_party, ":dist", "p_main_party", ":party_no"),
				# (try_begin),
					# (lt, ":dist", 3),
					# (display_message,"@You are too close to another party",0xCC3333),
#					(assign,":keep_checking",1),
				# (else_try),
				   # (ge, ":dist", 3),
				   (assign, "$sneaking_set_by_player", 1),
				   (assign, "$ambush_set_by_player", 0),
				   (call_script,"script_rigale_check_sneaking_success"),
				   (call_script,"script_game_get_party_speed_multiplier","p_main_party"),
					(display_message,"@You start sneaking",0x00FF00),
#					(assign,":keep_checking",1),
				   (change_screen_return),
				# (try_end),
			#(try_end),
	#	(try_end),

			],
		),
            ("camp_stop_sneaking",
		   [
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
		   (eq, "$sneaking_set_by_player", 1),
			],
		"Gather my party, and stop the sneaking action.",
		   [
		   (assign, "$sneaking_set_by_player", 0),
		   (change_screen_return),
		],
	  ),
#rigales chief acaba
###rigale chief acaba

#TEMPERED chief LOOT WAGON OPTIONS
      ("loot_wagon_options",
		[
                    (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),

                    (gt,"$wagon_attached",0),
		],"Manage your supply wagon.",
       [
			(assign,"$auto_menu","mnu_loot_wagon"),
			(change_screen_map),
        ]
       ),
#TEMPERED BUILD LOOT WAGON
      ("loot_wagon_build",
		[
                              (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),

                    (eq,"$owns_wagon",0),
		],"Build a new supply wagon.",
       [
			(jump_to_menu,"mnu_build_wagon"),
        ]
       ),
#destruir wagon chief
      ("loot_wagon_eliminar",
		[
                              (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),

                    (eq,"$owns_wagon",1),
                    (le,"$wagon_attached",0),
		],"Disband wagon.",
       [
			(call_script,"script_restore_wagon_troops"),
			(troop_clear_inventory,"trp_loot_wagon_storage_1"),
			(assign,"$wagon_attached",-1),
			(assign,"$owns_wagon",0),
        ]
       ),
#TEMPERED   DEBUG position info
  ("get_position",[(eq, "$cheat_mode", 1)],"_Cheat: get last camp position.",
   [
		(position_get_x,reg1,"$last_position"),
		(position_get_y,reg2,"$last_position"),
		(position_get_z,reg3,"$last_position"),
		(display_message,"@  Last camp x: {reg1}  y: {reg2} z: {reg3}"),
    ]
	),
#TEMPERED chief CHANGES END
      ("camp_cheat",
       [(ge, "$cheat_mode", 1)
        ], "CHEAT MENU!",
       [(jump_to_menu, "mnu_camp_cheat"),
        ],
       ),
      ("resume_travelling",[],"Resume travelling.",
       [
#motomataru fix camping on water chief
         # (assign, "$g_player_icon_state", pis_normal),
         (party_get_current_terrain,":terrain","p_main_party"),
         (try_begin),
           (neq, ":terrain", 0),    #not rt_water
           (neq, ":terrain", 7),    #not rt_river used as water terrain
           (neq, ":terrain", 8),    #not rt_bridge used as water terrain
           (assign, "$g_player_icon_state", pis_normal),
         (else_try),
           (assign, "$g_player_icon_state", pis_ship),
          (try_end),
#end motomataru fix camping on water
         (assign,"$g_camp_mode", 0),
			(change_screen_map),
        ]
       ),
      ]
  ),
  ("camp_cheat",0,
   "Select a cheat:",
   "none",
   [
     ],
    [
      ("camp_cheat_find_item",[], "Find an item...",
       [
         (jump_to_menu, "mnu_cheat_find_item"),
	   ]
       ),

      ("camp_cheat_find_item",[], "Change weather..",
       [
         (jump_to_menu, "mnu_cheat_change_weather"),
	   ]
       ),

      ("camp_cheat_1",[],"{!}Increase player renown.",
       [
         (str_store_string, s1, "@Player renown is increased by 100. "),
         (call_script, "script_change_troop_renown", "trp_player", 100),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),

      ("camp_cheat_2",[],"{!}Increase player Reputation.",
       [
         (assign, reg7, "$player_honor"),
         (val_add, reg7, 1),
         (display_message, "@Player reputation is increased by 1 and it is now {reg7}."),
         (val_add, "$player_honor", 1),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),

      ("camp_cheat_3",[],"{!}Update political notes.",
       [
         (try_for_range, ":hero", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":hero", slot_troop_occupation, slto_kingdom_hero),
           (call_script, "script_update_troop_political_notes", ":hero"),
         (try_end),

         (try_for_range, ":kingdom", kingdoms_begin, kingdoms_end),
           (call_script, "script_update_faction_political_notes", ":kingdom"),
         (try_end),
        ]
       ),

      ("camp_cheat_4",[],"{!}Update troop notes.",
       [
         (try_for_range, ":hero", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":hero", slot_troop_occupation, slto_kingdom_hero),
           (call_script, "script_update_troop_notes", ":hero"),
         (try_end),

         (try_for_range, ":lady", kingdom_ladies_begin, kingdom_ladies_end),
           (call_script, "script_update_troop_notes", ":lady"),
           (call_script, "script_update_troop_political_notes", ":lady"),
           (call_script, "script_update_troop_location_notes", ":lady", 0),
         (try_end),
        ]
       ),

      ("camp_cheat_5",[],"{!}Scramble minstrels.",
       [
         (call_script, "script_update_tavern_minstrels"),
        ]
       ),

      ("camp_cheat_6",[],"{!}Infinite camp",
       [
         (assign,"$g_camp_mode", 1),
         (assign, "$g_infinite_camping", 1),
         (assign, "$g_player_icon_state", pis_camping),
         (rest_for_hours_interactive, 10 * 24 * 365, 20), #10 year rest while not attackable with 20x speed
         (change_screen_return),
        ]
       ),

      ("cheat_faction_orders",[(ge,"$cheat_mode",1)],
	  "{!}Cheat: Set Debug messages to All.",
       [(assign,"$cheat_mode",1),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),
      ("cheat_faction_orders",[
	  (ge, "$cheat_mode", 1),
	  (neq,"$cheat_mode",3)],"{!}Cheat: Set Debug messages to Econ Only.",
       [(assign,"$cheat_mode",3),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),
      ("cheat_faction_orders",[
	  (ge, "$cheat_mode", 1),
	  (neq,"$cheat_mode",4)],"{!}Cheat: Set Debug messages to Political Only.",
       [(assign,"$cheat_mode",4),
         (jump_to_menu, "mnu_camp_cheat"),
        ]
       ),


      ("back_to_camp_menu",[],"{!}Back to camp menu.",
       [
         (jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("cheat_find_item",0,
   "{!}Current item range: {reg5} to {reg6}",
   "none",
   [
     (assign, reg5, "$cheat_find_item_range_begin"),
     (store_add, reg6, "$cheat_find_item_range_begin", max_inventory_items),
	 (val_min, reg6, "itm_items_end"),
	 (val_sub, reg6, 1),
     ],
    [
      ("cheat_find_item_next_range",[], "{!}Move to next item range.",
       [
	    (val_add, "$cheat_find_item_range_begin", max_inventory_items),
	    (try_begin),
	      (ge, "$cheat_find_item_range_begin", "itm_items_end"),
		  (assign, "$cheat_find_item_range_begin", 0),
	    (try_end),
	    (jump_to_menu, "mnu_cheat_find_item"),
	   ]
       ),

	   ("cheat_find_item_choose_this",[], "{!}Choose from this range.",
       [
        (troop_clear_inventory, "trp_find_item_cheat"),
        (store_add, ":max_item", "$cheat_find_item_range_begin", max_inventory_items),
	    (val_min, ":max_item", "itm_items_end"),
		(store_sub, ":num_items_to_add", ":max_item", "$cheat_find_item_range_begin"),
		(try_for_range, ":i_slot", 0, ":num_items_to_add"),
		  (store_add, ":item_id", "$cheat_find_item_range_begin", ":i_slot"),
          (troop_add_items, "trp_find_item_cheat", ":item_id", 1),
        (try_end),
        (change_screen_trade, "trp_find_item_cheat"),
	   ]
       ),

      ("camp_action_4",[],"{!}Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

   ("cheat_change_weather",0,
   "{!}Current cloud amount: {reg5}^Current Fog Strength: {reg6}",
   "none",
   [
     (get_global_cloud_amount, reg5),
     (get_global_haze_amount, reg6),
     ],
    [
      ("cheat_increase_cloud",[], "{!}Increase Cloud Amount.",
       [
	    (get_global_cloud_amount, ":cur_cloud_amount"),
		(val_add, ":cur_cloud_amount", 5),
		(val_min, ":cur_cloud_amount", 100),
	    (set_global_cloud_amount, ":cur_cloud_amount"),
	   ]
       ),
      ("cheat_decrease_cloud",[], "{!}Decrease Cloud Amount.",
       [
	    (get_global_cloud_amount, ":cur_cloud_amount"),
		(val_sub, ":cur_cloud_amount", 5),
		(val_max, ":cur_cloud_amount", 0),
	    (set_global_cloud_amount, ":cur_cloud_amount"),
	   ]
       ),
      ("cheat_increase_fog",[], "{!}Increase Fog Amount.",
       [
	    (get_global_haze_amount, ":cur_fog_amount"),
		(val_add, ":cur_fog_amount", 5),
		(val_min, ":cur_fog_amount", 100),
	    (set_global_haze_amount, ":cur_fog_amount"),
	   ]
       ),
      ("cheat_decrease_fog",[], "{!}Decrease Fog Amount.",
       [
	    (get_global_haze_amount, ":cur_fog_amount"),
		(val_sub, ":cur_fog_amount", 5),
		(val_max, ":cur_fog_amount", 0),
	    (set_global_haze_amount, ":cur_fog_amount"),
	   ]
       ),

      ("camp_action_4",[],"{!}Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("camp_action",0,
   "Choose an action:",
   "none",
   [
     ],
    [
      ## CC chief arbol tropas
      ("action_view_upgrade_trees",[],"View upgrade trees.",
       [(start_presentation, "prsnt_upgrade_tree_1"),
        ]
       ),
#chief arbol de tropas acaba
      ("camp_recruit_prisoners",
       [(troops_can_join, 1),
        (store_current_hours, ":cur_time"),
        (val_sub, ":cur_time", 24),
        (gt, ":cur_time", "$g_prisoner_recruit_last_time"),
        (try_begin),
          (gt, "$g_prisoner_recruit_last_time", 0),
          (assign, "$g_prisoner_recruit_troop_id", 0),
          (assign, "$g_prisoner_recruit_size", 0),
          (assign, "$g_prisoner_recruit_last_time", 0),
        (try_end),
        ], "Recruit some of your prisoners to your party.",
       [(jump_to_menu, "mnu_camp_recruit_prisoners"),
        ],
       ),

      ("action_read_book",[],"Select a book to read.",
       [  (try_begin), #chief anadido
             (eq, "$sabe_leer", 1),
             (jump_to_menu, "mnu_camp_action_read_book"),
		   (else_try), #chief anadido
             (display_message,"@You can not read. You should learn it at a monastery.",0xFFFFAAAA), #chief anadido
           (try_end), #chief anadido
        ]
       ),

      #### export/import NPCs begin chief ####
      ("action_export_import",[],"Export/import NPCs.",
        [
          (jump_to_menu, "mnu_export_import_npcs"),
          ]
      ),
#### export/import NPCs end ####

      ("action_rename_kingdom",
       [
         (eq, "$players_kingdom_name_set", 1),
         (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_active),
         (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
         ],"Rename your kingdom.",
       [(start_presentation, "prsnt_name_kingdom"),
        ]
       ),

#Tempered chief Changes Begin added cheat menu items  DEBUG
      ("jump_to_scene",[(eq,"$cheat_mode",1)],"debug: test scene menu",
       [
			(jump_to_menu,"mnu_test_scene"),
        ]
       ),
      ("toggle_cheat_on",[(eq, "$cheat_mode", 0)],"_Toggle cheat menu on.",
       [
			(assign,"$cheat_mode",1),
        ]
       ),

      ("toggle_cheat_off",[(eq, "$cheat_mode",1)],"_Toggle cheat menu off.",
       [
			(assign,"$cheat_mode",0),
        ]
       ),

#Tempered chief changes end

        #rigale chief empieza
      ("camp_smoke_food",
       [
		(try_begin),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_cattle_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_pork", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_chicken", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_deer_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_boar_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_wolf_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_coat_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_coat_2_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(else_try),
		(call_script, "script_cf_player_has_item_without_modifier", "itm_wilddonkey_meat", imod_rotten),
        (assign, ":player_has_smokable_food", 1),
		(try_end),

		(eq, ":player_has_smokable_food", 1),

 	    ],

	"Smoke some of the raw food in your inventory.",
	   [
       (jump_to_menu, "mnu_camp_smoking_food"),
        ],
	  ),

#rigale chief acaba

      ("action_modify_banner",[(eq, "$cheat_mode", 1)],"{!}Cheat: Modify your banner.",
       [
           (start_presentation, "prsnt_banner_selection"),
           #(start_presentation, "prsnt_custom_banner"),
        ]
       ),
      ("action_retire",[],"Retire from adventuring.",
       [(jump_to_menu, "mnu_retirement_verify"),
        ]
       ),
      ("camp_action_4",[],"Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("camp_recruit_prisoners",0,
   "You offer your prisoners freedom if they agree to join you as soldiers. {s18}",
   "none",
   [(assign, ":num_regular_prisoner_slots", 0),
    (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
    (try_for_range, ":cur_stack", 0, ":num_stacks"),
      (party_prisoner_stack_get_troop_id, ":cur_troop_id", "p_main_party", ":cur_stack"),
      (neg|troop_is_hero, ":cur_troop_id"),
      (val_add, ":num_regular_prisoner_slots", 1),
    (try_end),
    (try_begin),
      (eq, ":num_regular_prisoner_slots", 0),
      (jump_to_menu, "mnu_camp_no_prisoners"),
    (else_try),
      (eq, "$g_prisoner_recruit_troop_id", 0),
      (store_current_hours, "$g_prisoner_recruit_last_time"),
      (store_random_in_range, ":rand", 0, 100),
      (store_skill_level, ":persuasion_level", "skl_persuasion", "trp_player"),
      (store_sub, ":reject_chance", 15, ":persuasion_level"),
      (val_mul, ":reject_chance", 4),
      (try_begin),
        (lt, ":rand", ":reject_chance"),
        (assign, "$g_prisoner_recruit_troop_id", -7),
      (else_try),
        (assign, ":num_regular_prisoner_slots", 0),
        (party_get_num_prisoner_stacks, ":num_stacks", "p_main_party"),
        (try_for_range, ":cur_stack", 0, ":num_stacks"),
          (party_prisoner_stack_get_troop_id, ":cur_troop_id", "p_main_party", ":cur_stack"),
          (neg|troop_is_hero, ":cur_troop_id"),
          (val_add, ":num_regular_prisoner_slots", 1),
        (try_end),
        (store_random_in_range, ":random_prisoner_slot", 0, ":num_regular_prisoner_slots"),
        (try_for_range, ":cur_stack", 0, ":num_stacks"),
          (party_prisoner_stack_get_troop_id, ":cur_troop_id", "p_main_party", ":cur_stack"),
          (neg|troop_is_hero, ":cur_troop_id"),
          (val_sub, ":random_prisoner_slot", 1),
          (lt, ":random_prisoner_slot", 0),
          (assign, ":num_stacks", 0),
          (assign, "$g_prisoner_recruit_troop_id", ":cur_troop_id"),
          (party_prisoner_stack_get_size, "$g_prisoner_recruit_size", "p_main_party", ":cur_stack"),
        (try_end),
      (try_end),

      (try_begin),
        (gt, "$g_prisoner_recruit_troop_id", 0),
        (party_get_free_companions_capacity, ":capacity", "p_main_party"),
        (val_min, "$g_prisoner_recruit_size", ":capacity"),
        (assign, reg1, "$g_prisoner_recruit_size"),
        (gt, "$g_prisoner_recruit_size", 0),
        (try_begin),
          (gt, "$g_prisoner_recruit_size", 1),
          (assign, reg2, 1),
        (else_try),
          (assign, reg2, 0),
        (try_end),
        (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (str_store_string, s18, "@{reg1} {s1} {reg2?accept:accepts} the offer."),
      (else_try),
        (str_store_string, s18, "@No one accepts the offer."),
      (try_end),
    (try_end),
    ],
    [
      ("camp_recruit_prisoners_accept",[(gt, "$g_prisoner_recruit_troop_id", 0)],"Take them.",
       [(remove_troops_from_prisoners, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (party_add_members, "p_main_party", "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (store_mul, ":morale_change", -3, "$g_prisoner_recruit_size"),
        (call_script, "script_change_player_party_morale", ":morale_change"),
        (jump_to_menu, "mnu_camp"),
        ]
       ),
      ("camp_recruit_prisoners_reject",[(gt, "$g_prisoner_recruit_troop_id", 0)],"Reject them.",
       [(jump_to_menu, "mnu_camp"),
        (assign, "$g_prisoner_recruit_troop_id", 0),
        (assign, "$g_prisoner_recruit_size", 0),
        ]
       ),
      ("continue",[(le, "$g_prisoner_recruit_troop_id", 0)],"Go back.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("camp_no_prisoners",0,
   "You have no prisoners to recruit from.",
   "none",
   [],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("camp_action_read_book",0,
   "Choose a book to read:",
   "none",
   [],
    [
      ("action_read_book_1",[(player_has_item, "itm_book_tactics"),
                             (item_slot_eq, "itm_book_tactics", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_tactics"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_tactics"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_2",[(player_has_item, "itm_book_persuasion"),
                             (item_slot_eq, "itm_book_persuasion", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_persuasion"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_persuasion"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_3",[(player_has_item, "itm_book_leadership"),
                             (item_slot_eq, "itm_book_leadership", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_leadership"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_leadership"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_4",[(player_has_item, "itm_book_intelligence"),
                             (item_slot_eq, "itm_book_intelligence", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_intelligence"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_intelligence"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_5",[(player_has_item, "itm_book_trade"),
                             (item_slot_eq, "itm_book_trade", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_trade"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_trade"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_6",[(player_has_item, "itm_book_weapon_mastery"),
                             (item_slot_eq, "itm_book_weapon_mastery", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_weapon_mastery"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_weapon_mastery"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("action_read_book_7",[(player_has_item, "itm_book_engineering"),
                             (item_slot_eq, "itm_book_engineering", slot_item_book_read, 0),
                             (str_store_item_name, s1, "itm_book_engineering"),
                             ],"{s1}.",
       [(assign, "$temp", "itm_book_engineering"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
        ]
       ),
      ("camp_action_4",[],"Back to camp menu.",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("camp_action_read_book_start",0,
   "{s1}",
   "none",
   [(assign, ":new_book", "$temp"),
    (str_store_item_name, s2, ":new_book"),
    (try_begin),
      (store_attribute_level, ":int", "trp_player", ca_intelligence),
      (item_get_slot, ":int_req", ":new_book", slot_item_intelligence_requirement),
      (le, ":int_req", ":int"),
      (str_store_string, s1, "@You start reading {s2}. After a few pages,\
 you feel you could learn a lot from this book. You decide to keep it close by and read whenever you have the time."),
      (assign, "$g_player_reading_book", ":new_book"),
    (else_try),
      (str_store_string, s1, "@You flip through the pages of {s2}, but you find the text confusing and difficult to follow.\
 Try as you might, it soon gives you a headache, and you're forced to give up the attempt."),
    (try_end),],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

    #### export/import NPCs begin chief ####
      ("export_import_npcs", mnf_enable_hot_keys,
       "Please choose an NPC, then press key C to view and export/import this character.^^You choose {reg0?{s0}:none}.",
       "none",
        [
          (assign, reg0, "$g_player_troop"),
          (str_store_troop_name, s0, "$g_player_troop"),
        ],
        [
          ("export_import_back",[],"Go back",
            [
              (assign, "$g_player_troop", "trp_player"),
              (set_player_troop, "$g_player_troop"),
              (jump_to_menu, "mnu_camp_action"),
            ]
          ),
        ]+[("export_import_npc"+str(x+1),
            [
              (store_add, ":dest_npc", "trp_npc1", x),
              (str_store_troop_name, s0, ":dest_npc"),
            ], "{s0}",
            [
              (store_add, ":dest_npc", "trp_npc1", x),
              (assign, "$g_player_troop", ":dest_npc"),
              (set_player_troop, "$g_player_troop"),
            ]) for x in range(0, 13)]+[
          ("export_import_next",[],"Next page", [(jump_to_menu, "mnu_export_import_npcs_2")]),
        ]
      ),

      ("export_import_npcs_2", mnf_enable_hot_keys,
        "Please choose an NPC, then press key C to view and export/import this character.^^You choose {reg0?{s0}:none}.",
        "none",
         [
           (assign, reg0, "$g_player_troop"),
           (str_store_troop_name, s0, "$g_player_troop"),
         ],
        [
          ("export_import_prev",[],"Previous page", [(jump_to_menu, "mnu_export_import_npcs")]),
        ]+[("export_import_npc"+str(x+1),
          [
            (store_add, ":dest_npc", "trp_npc1", x),
            (str_store_troop_name, s0, ":dest_npc"),
          ], "{s0}",
          [
            (store_add, ":dest_npc", "trp_npc1", x),
            (assign, "$g_player_troop", ":dest_npc"),
            (set_player_troop, "$g_player_troop"),
          ]) for x in range(13, 26)]
      ),
    #### export/import NPCs end ####

  ("retirement_verify",0,
   "You are at day {reg0}. Your current luck is {reg1}. Are you sure you want to retire?",
   "none",
   [
     (store_current_day, reg0),
     (assign, reg1, "$g_player_luck"),
     ],
    [
      ("retire_yes",[],"Yes.",
       [
         (start_presentation, "prsnt_retirement"),
        ]
       ),
      ("retire_no",[],"No.",
       [
         (jump_to_menu, "mnu_camp"),
        ]
       ),
      ]
  ),

  ("end_game",0,
   "The decision is made, and you resolve to give up your adventurer's\
 life and settle down. You sell off your weapons and armour, gather up\
 all your money, and ride off into the sunset....",
   "none",
   [],
    [
      ("end_game_bye",[],"Farewell.",
       [
         (change_screen_quit),
        ]
       ),
      ]
  ),

  ("cattle_herd",mnf_scale_picture,
   "You encounter a herd of cattle.",
   "none",
   [(play_sound, "snd_cow_moo"),
    (set_background_mesh, "mesh_pic_cattle"),
   ],
    [
      ("cattle_drive_away",[],"Drive the cattle onward.",
       [
        (party_set_slot, "$g_encountered_party", slot_cattle_driven_by_player, 1),
        #AJM chief SET CATTLE TO FOLLOW INSTEAD OF FLEEING MADLY, WHICH WAS EXTREMELY ANNOYING
        #AJM chief ai_bhvr_escort_party CONSTANT IS FROM AI_PARTIES
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_escort_party),
        (party_set_ai_object,"$g_encountered_party", "p_main_party"),
        (change_screen_return),
        ]
       ),
      ("cattle_stop",[],"Bring the herd to a stop.",
       [
        (party_set_slot, "$g_encountered_party", slot_cattle_driven_by_player, 0),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_hold),
        (change_screen_return),
        ]
       ),
      ("cattle_kill",[(assign, ":continue", 1),
                      (try_begin),
                        (check_quest_active, "qst_move_cattle_herd"),
                        (quest_slot_eq, "qst_move_cattle_herd", slot_quest_target_party, "$g_encountered_party"),
                        (assign, ":continue", 0),
                      (try_end),
                      (eq, ":continue", 1)],"Slaughter some of the animals.",
       [(jump_to_menu, "mnu_cattle_herd_kill"),
        ]
       ),

##      ("cattle_skin",[(eq, "$encountered_party_friendly", 1),],"Skin some animals and make some hides.",
##       [(jump_to_menu, "mnu_cattle_herd_kill"),
##      #  (assign, "$temp", "itm_raw_leather"),
##        ]
##       ),

      ("leave",[],"Leave.",
       [(change_screen_return),
        ]
       ),
      ]
  ),

  ("cattle_herd_kill",0,
   "How many animals do you want to slaughter?",
   "none",
   [(party_get_num_companions, reg5, "$g_encountered_party")],
    [
      ("cattle_kill_1",[(ge, reg5, 1),],"One.",
       [(call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 1),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
        ]
       ),
      ("cattle_kill_2",[(ge, reg5, 2),],"Two.",
       [(call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 2),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
        ]
       ),
      ("cattle_kill_3",[(ge, reg5, 3),],"Three.",
       [(call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 3),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
        ]
       ),
      ("cattle_kill_4",[(ge, reg5, 4),],"Four.",
       [(call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 4),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
        ]
       ),
      ("cattle_kill_5",[(ge, reg5, 5),],"Five.",
       [(call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 5),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
        ]
       ),
      ("cattle_kill_20",[(ge, reg5, 20),],"Twenty.",
       [(call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 20),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
        ]
       ),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_cattle_herd"),
        ]
       ),
      ]
  ),

  ("cattle_herd_kill_end",0,
   "{!}You shouldn't be reading this.",
   "none",
   [(change_screen_return)],
    [
      ]
  ),


  ("arena_duel_fight",0,
   "You and your opponent prepare to duel.",
   "none",
   [],
   [
     ("continue",[],"Continue...",
      [
        (assign, "$g_leave_encounter", 0),

        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (party_get_slot, ":duel_scene", "$g_encountered_party", slot_town_arena),
        (else_try),
          (eq, "$g_start_arena_fight_at_nearest_town", 1),
          (assign, ":closest_town", -1),
          (assign, ":minimum_dist", 10000),
          (try_for_range, ":cur_town", towns_begin, towns_end),
            (store_distance_to_party_from_party, ":dist", ":cur_town", "$g_encountered_party"),
            (lt, ":dist", ":minimum_dist"),
            (assign, ":minimum_dist", ":dist"),
            (assign, ":closest_town", ":cur_town"),
          (try_end),
          (try_begin),
            (ge, ":closest_town", 0),
            (party_get_slot, ":duel_scene", ":closest_town", slot_town_arena),
          (try_end),
          (assign, "$g_start_arena_fight_at_nearest_town", 0),
        (else_try),
          (party_get_current_terrain, ":terrain", "p_main_party"),
          (eq, ":terrain", 4),
          (assign, ":duel_scene", "scn_training_ground_ranged_melee_3"),
        (else_try),
          (eq, ":terrain", 5),
          (assign, ":duel_scene", "scn_training_ground_ranged_melee_4"),
        (else_try),
          (assign, ":duel_scene", "scn_training_ground_ranged_melee_1"),
        (try_end),

        (modify_visitors_at_site, ":duel_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 1, "$g_duel_troop"),
        (set_jump_mission, "mt_duel_with_lord"),
        (jump_to_scene, ":duel_scene"),
        (jump_to_menu, "mnu_arena_duel_conclusion"),
        (change_screen_mission),
      ]),
    ]
  ),


  ("arena_duel_conclusion",0,
   "{!}{s11}",
   "none",
   [

    (try_begin),
		(eq, "$g_leave_encounter", 1),
		(change_screen_return),
	(try_end),


    (str_store_troop_name, s10, "$g_duel_troop"),
    (try_begin),
		(quest_slot_eq, "qst_duel_for_lady", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_failed, "qst_duel_for_lady"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
    (else_try),
		(quest_slot_eq, "qst_duel_for_lady", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_succeeded, "qst_duel_for_lady"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
	(else_try),
		(quest_slot_eq, "qst_duel_courtship_rival", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_failed, "qst_duel_courtship_rival"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
    (else_try),
		(quest_slot_eq, "qst_duel_courtship_rival", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_succeeded, "qst_duel_courtship_rival"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
	(else_try),
		(quest_slot_eq, "qst_duel_avenge_insult", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_succeeded, "qst_duel_avenge_insult"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
	(else_try),
		(quest_slot_eq, "qst_duel_avenge_insult", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_failed, "qst_duel_avenge_insult"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
	(else_try),
		(quest_slot_eq, "qst_denounce_lord", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_succeeded, "qst_denounce_lord"),
        (str_store_string, s11, "str_s10_lies_in_the_arenas_dust_for_several_minutes_then_staggers_to_his_feet_you_have_won_the_duel"),
	(else_try),
		(quest_slot_eq, "qst_denounce_lord", slot_quest_target_troop, "$g_duel_troop"),
		(check_quest_failed, "qst_denounce_lord"),
        (str_store_string, s11, "str_you_lie_stunned_for_several_minutes_then_stagger_to_your_feet_to_find_your_s10_standing_over_you_you_have_lost_the_duel"),
	(else_try),
		(str_store_troop_name, s10, "$g_duel_troop"),
	(try_end),
   ],
   [
     ("continue",[],"Continue...",
      [
        (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
        (modify_visitors_at_site,":meeting_scene"),
		(reset_visitors),
        (set_visitor,0,"trp_player"),
        (set_visitor,17,"$g_duel_troop"),
        (set_jump_mission,"mt_conversation_encounter"),
        (jump_to_scene,":meeting_scene"),
        (assign, "$talk_context", tc_after_duel),
        (change_screen_map_conversation, "$g_duel_troop"),
        ]),
      ]
  ),
 ############################### Duel chief Mod Start  ##############################

("duel_menu",0,
   "{s1}{s2}",
   "none",
   [
 (str_clear, s2),  (str_clear, s3), (str_clear, s5), (str_clear, s6), (str_clear, s7),
   (troop_get_slot, ":duel_wins", "$g_talk_troop", slot_troop_duel_won),
   (assign, reg(6), ":duel_wins"),
   (troop_get_slot, ":duel_losses", "$g_talk_troop", slot_troop_duel_lost),
   (assign, reg(7), ":duel_losses"),
   (store_add, ":duel_total", ":duel_wins", ":duel_losses"),
   (assign, reg(5), ":duel_total"),
   (str_store_troop_name, s3, "$g_talk_troop"),
   (try_begin),
      (eq, "$g_duel_result", -1),
      (str_store_string, s1, "@You lost your duel against ^^{s3}"),
   (else_try),
      (eq, "$g_duel_result", 1),
      (str_store_string, s1, "@You won your duel against ^^{s3}"),
   (else_try),
      (str_store_string, s1, "@You prepare to duel ^^{s3}"),
   (try_end),
    (try_begin),
      (troop_is_hero, "$g_talk_troop"),
      (str_store_string, s2, "@^^^^You have fought {s3} {reg5} times. ^^You've won {reg6} times. ^^You've lost {reg7} times"),
   (else_try),
      (str_store_string, s2, "@^^^^Dueling with your own troops will not count towards your dueling statistics."),
   (try_end),

    ],

   [
      ("start_fight",[(eq, "$g_duel_result", 0)],"Start the duel.",
       [(try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
            (party_get_slot, ":arena_scene", "$g_encountered_party", slot_town_arena),
        (else_try),
            (assign, ":closest_dist", 100000),
            (assign, ":closest_town", -1),
            (try_for_range, ":cur_town", towns_begin, towns_end),
                (store_distance_to_party_from_party, ":dist", ":cur_town", "p_main_party"),
                (lt, ":dist", ":closest_dist"),
                (assign, ":closest_dist", ":dist"),
                (assign, ":closest_town", ":cur_town"),
            (try_end),
            (party_get_slot, ":arena_scene", ":closest_town", slot_town_arena),
        (try_end),
        (modify_visitors_at_site, ":arena_scene"),
        (reset_visitors),
    (set_visitor, "$g_duel_vis_point_opp", "$g_talk_troop"),
    (set_visitor, "$g_duel_vis_point_plyr", "trp_player"),

         (set_jump_mission, "mt_arena_duel_thing_std"),
         (jump_to_scene, ":arena_scene"),
         (change_screen_mission),
        ]
       ),
##      ("duel_again",[(neq, "$g_duel_result", 0)],"Duel again.",
##       [
##           (assign, "$g_duel_result", 0),
##           (jump_to_menu, "mnu_duel_menu"),
##   ]
##       ),
      ("leave",[],"Leave.",
       [(change_screen_map),
        ]
       ),
      ]
 ),

############################### Duel chief Mod End  ##############################


  (
    "simple_encounter",mnf_enable_hot_keys,
    "{s2}^^ You have {reg10} troops fit for battle against their {reg11}.^{s15}", #cambiado tempered chief
    "none",
    [
#TEMPERED chief CHANGES BEGIN
		(str_clear,s15),
		(str_store_string,s15,"@_"),
		(try_begin),
			(party_get_slot,":party_entrenched","p_main_party",slot_party_entrenched),
			(this_or_next|ge,":party_entrenched",1),
			(party_slot_eq,"p_main_party",slot_party_siege_camp,1),
			(neq, "$duel_encounter",1),#TEMPERED ADDED FOR WILDERNESS DUEL
			(str_store_string,s15,"str_entrench"),
			(assign, "$cant_leave_encounter", 1),
		(try_end),
#TEMPERED CHANGES END
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", -1),
        (call_script, "script_encounter_calculate_fit"),
        (try_begin),
          (eq, "$new_encounter", 1),
                   # (assign, "$new_encounter", 0),	MOTO move to end so it can be used!
          (assign, "$g_encounter_is_in_village", 0),
          (assign, "$g_encounter_type", 0),
          (try_begin),
            (party_slot_eq, "$g_enemy_party", slot_party_ai_state, spai_raiding_around_center),
            (party_get_slot, ":village_no", "$g_enemy_party", slot_party_ai_object),

            (store_distance_to_party_from_party, ":dist", ":village_no", "$g_enemy_party"),

            (try_begin),
              (lt, ":dist", raid_distance),
              (assign, "$g_encounter_is_in_village", ":village_no"),
              (assign, "$g_encounter_type", enctype_fighting_against_village_raid),
            (try_end),
          (try_end),
          (try_begin),
            (gt, "$g_player_raiding_village", 0),
            (assign, "$g_encounter_is_in_village", "$g_player_raiding_village"),
            (assign, "$g_encounter_type", enctype_catched_during_village_raid),
            (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 1), #attach as enemy
            (str_store_string, s1, "@Villagers"),
            (display_message, "str_s1_joined_battle_enemy",color_bad_news),
          (else_try),
            (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
            (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 0), #attach as friend
            (str_store_string, s1, "@Villagers"),
            (display_message, "str_s1_joined_battle_friend",color_good_news),
            # Let village party join battle at your side
          (try_end),

                   ## CC chief commander
          (try_begin),
            (party_get_template_id, ":template_id", "$g_enemy_party"),
            (neq, ":template_id", "pt_routed_warriors"),
            (call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
          (try_end),
          ## CC

          (call_script, "script_encounter_init_variables"),
          (assign, "$encountered_party_hostile", 0),
          (assign, "$encountered_party_friendly", 0),
          (try_begin),
            (gt, "$g_encountered_party_relation", 0),
			(neg|is_between, ":template_id", "pt_looters", "pt_merchant_caravan"), #Floris - Prevent bandits from being friends due to join any side script. Chief
            (assign, "$encountered_party_friendly", 1),
          (try_end),
          ## CC chief commander
          (try_begin),
            (party_get_template_id, ":template_id", "$g_enemy_party"),
            (eq, ":template_id", "pt_routed_warriors"),
            (assign, "$encountered_party_friendly", 0),
          (try_end),
          ## CC
          (try_begin),
            (lt, "$g_encountered_party_relation", 0),
            (assign, "$encountered_party_hostile", 1),
            (try_begin),
              (encountered_party_is_attacker),
              (assign, "$cant_leave_encounter", 1),
            (try_end),
          (try_end),

#rigale emboscada chief MOTO move this part to avoid dialog and add necessary rewrite
		  (assign, ":ambush_probability", 0),

		  (try_begin),
            (eq, "$g_encounter_type", 0),
			(neq, "$ambush_set_by_player", 1),
			(neq, "$sneaking_set_by_player", 1),
            (neg|encountered_party_is_attacker),
            (eq, "$encountered_party_hostile", 1),

			(party_get_current_terrain, ":terrain_type", "p_main_party"),
			(neq,":terrain_type",0),	#no ambushes at sea
			(neq,":terrain_type",7),
			(neq,":terrain_type",8),
			(neq, "$emboscada_time", 1), #1 cada 90 h
            #MOTO chief limit parties that ambush
                  (this_or_next|eq, "$g_encountered_party_template",      "pt_manhunters"),
                  (this_or_next|eq, "$g_encountered_party_template",      "pt_deserters"),
                  (this_or_next|eq, "$g_encountered_party_template",      "pt_kingdom_hero_party"),
                  (is_between, "$g_encountered_party_template",      bandit_party_template_begin, bandit_party_template_end),

                  (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_besieging_center),
                  (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_raiding_around_center),
                  (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_accompanying_army),
                  (neg|party_slot_eq, "$g_encountered_party",      slot_party_ai_state, spai_visiting_village),
                  #MOTO end limit parties that ambush
##                (party_get_template_id, ":template_id", "$g_enemy_party"),
##            (neq, ":template_id", "pt_kingdom_caravan_party"),

			(try_begin),
			  (eq, ":terrain_type", rt_steppe),
			  (assign, ":ambush_probability", 10),
			(else_try),
			  (eq, ":terrain_type", rt_plain),
			  (assign, ":ambush_probability", 15),
			(else_try),
			  (eq, ":terrain_type", rt_snow),
			  (assign, ":ambush_probability", 20),
			(else_try),
			  (eq, ":terrain_type", rt_desert),
			  (assign, ":ambush_probability", 10),
			(else_try),
			  (eq, ":terrain_type", rt_steppe_forest),
			  (assign, ":ambush_probability", 25),
			(else_try),
			  (eq, ":terrain_type", rt_forest),
			  (assign, ":ambush_probability", 40),
			(else_try),
			  (eq, ":terrain_type", rt_snow_forest),
			  (assign, ":ambush_probability", 30),
			(try_end),

##			(try_begin),
##			  (eq,"$g_encountered_party","pt_ambushers"),
##			  (val_add,":ambush_probability",20),
##			(try_end),

                            #MOTO chief tone it down
                  (val_div, reg0, "$g_friend_fit_for_battle", 10),
                  (val_add, ":ambush_probability", reg0),    #more      likely a group will ambush a larger one
                  (val_div, reg0, "$g_enemy_fit_for_battle", 10),
                  (val_sub, ":ambush_probability", reg0),
                  #MOTO end tone it down
		  (try_end),

		  (store_random_in_range,":ambush_chance",0,101),

		  (try_begin),
			(lt,":ambush_chance",":ambush_probability"),
			(assign,"$player_fall_in_ambush",1),
            (assign, "$cant_leave_encounter", 1),
		  (else_try),
			(assign,"$player_fall_in_ambush",0),
			(assign, "$talk_context", tc_party_encounter),
			(call_script, "script_setup_party_meeting", "$g_encountered_party"),
		  (try_end),
#rigale emboscada chief acaba

        (else_try), #second or more turn
#          (try_begin),
#            (call_script, "script_encounter_calculate_morale_change"),
#          (try_end),
          (try_begin),
            # We can leave battle only after some troops have been killed.
            (eq, "$cant_leave_encounter", 1),
            (call_script, "script_party_count_members_with_full_health", "p_main_party_backup"),
            (assign, ":org_total_party_counts", reg0),
            (call_script, "script_party_count_members_with_full_health", "p_encountered_party_backup"),
            (val_add, ":org_total_party_counts", reg0),

            (call_script, "script_party_count_members_with_full_health", "p_main_party"),
            (assign, ":cur_total_party_counts", reg0),
            (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
            (val_add, ":cur_total_party_counts", reg0),

            (store_sub, ":leave_encounter_limit", ":org_total_party_counts", 10),
            (lt, ":cur_total_party_counts", ":leave_encounter_limit"),
            (assign, "$cant_leave_encounter", 0),
				(assign,"$force_presentation_shown",1), #Tempered chief do not show presentation if battle has started
          (try_end),
          (eq, "$g_leave_encounter",1),
          (change_screen_return),
        (try_end),

        #setup s2
        (try_begin),
          (party_is_active, "$g_encountered_party"),
          (str_store_party_name, s1,"$g_encountered_party"),
          (try_begin),
#chief cambiado
				(eq, "$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
				(str_store_string,s2,"@The time for talk is over. {s1} is waiting to begin the duel."), #tempered chief
#rigale quita chief
##			(else_try),
##            (eq, "$g_encounter_type", 0),
##				(neq, "$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
##				(str_store_string, s2,"@You have encountered {s1}. You have {reg10} troops fit for battle."), #tempered chief puesto
#rigale quita chief acaba
#chief cambiado acaba
          (else_try),
            (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
            (str_store_party_name, s3, "$g_encounter_is_in_village"),
            (str_store_string, s2,"@You have engaged {s1} while they were raiding {s3}."),
          (else_try),
            (eq, "$g_encounter_type", enctype_catched_during_village_raid),
            (str_store_party_name, s3, "$g_encounter_is_in_village"),
            (str_store_string, s2,"@You were caught by {s1} while your forces were raiding {s3}."),
#rigale emboscada chief MOTO rewrite to limit sensibly
		  (else_try),
			(try_begin),
			  (eq, "$cant_leave_encounter", 0),	#a fight occurred?
			  (assign, "$player_fall_in_ambush", 0),
			(try_end),
			(eq,"$player_fall_in_ambush",1),	#an ambush happens. will the player see it. add party spotting and player ambushing skill, checekd on random 30
			(str_store_string, s2,"@YOU FALL INTO AN AMBUSH !!!"),
			(try_begin),
			  (eq, "$new_encounter", 1),	#don't allow player to leave and get a second attempt to spot!
			  (call_script, "script_get_max_skill_of_player_party", "skl_spotting"),
			  (assign, ":spotting_skill", reg0),

			  (store_random_in_range,":ambush_factor2",1,2),#chief anade
			  (assign,":ambush_final2",":ambush_factor2"),#chief anade
			  (party_get_skill_level, ":skill_ambush12", "p_main_party", skl_tactics), #chief anade
			  (party_get_skill_level, ":skill_ambush22", "p_main_party", skl_tracking), #chief anade
			  (val_add,":ambush_final2",":skill_ambush12"),#chief anade
			  (val_add,":ambush_final2",":skill_ambush22"),#chief anade
			  (val_sub,":ambush_final2",2),#chief anade

			  (assign,":ambushing_player_skill",":ambush_final2"), #chief cambia
			  (val_add,":spotting_skill",":ambushing_player_skill"),
			  (store_random_in_range,":ambush_preventing_check",1,31),
			  (try_begin),
			    (lt,":ambush_preventing_check",":spotting_skill"),
			    (str_store_string, s2,"@YOU SUCCESSFULLY THWARTED AN AMBUSH !!! You have encountered {s1}. "),
			    (assign, "$player_fall_in_ambush", 0),
				(assign, "$cant_leave_encounter", 0),
			  (else_try),
			    (ge,":ambush_preventing_check",":spotting_skill"),
			    (call_script,"script_rigale_learn_from_failure",10,30),
			  (try_end),
			(try_end),

		  (else_try),
			(str_store_string, s2,"@You have encountered {s1}. You have {reg10} troops fit for battle."), #tempered chief puesto
		  (try_end),
		(try_end),
###rigale chief emboscada acaba


        (try_begin),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (assign, ":num_enemy_regulars_remaining", reg0),
          (assign, ":enemy_finished", 0),
          (try_begin),
            (eq, "$g_battle_result", 1), #battle won

            (this_or_next|le, ":num_enemy_regulars_remaining", 0), #battle won
            (le, ":num_enemy_regulars_remaining",  "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (assign, ":enemy_finished",1),
          (else_try),
            (eq, "$g_engaged_enemy", 1),

            (this_or_next|le, ":num_enemy_regulars_remaining", 0),
            (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (ge, "$g_friend_fit_for_battle",1),
            (assign, ":enemy_finished",1),
          (try_end),

          (this_or_next|eq, ":enemy_finished",1),
          (eq,"$g_enemy_surrenders",1),
          (assign, "$g_next_menu", -1),

          (jump_to_menu, "mnu_total_victory"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
          (assign, ":num_our_regulars_remaining", reg0),
          (assign, ":friends_finished",0),
          (try_begin),
            (eq, "$g_battle_result", -1),

            #(eq, ":num_our_regulars_remaining", 0), #battle lost
            (le, ":num_our_regulars_remaining",  "$num_routed_us"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (assign,  ":friends_finished", 1),
          (else_try),
            (eq, "$g_engaged_enemy", 1),
            (ge, "$g_enemy_fit_for_battle",1),
            (le, "$g_friend_fit_for_battle",0),
            (assign,  ":friends_finished",1),
          (try_end),

          (this_or_next|eq,  ":friends_finished",1),
          (eq,"$g_player_surrenders",1),
          (assign, "$g_next_menu", "mnu_captivity_start_wilderness"),
# only destroy supply wagon if he is attached to party tempered chief
   (try_begin),
         (eq, "$wagon_attached", 1),
         (troop_clear_inventory,"trp_loot_wagon_storage_1"),  ## supply wagon inventory cleaned after total defeat
         (assign,"$wagon_attached",0),   # supply wagon destroyed
                   (assign,"$owns_wagon",0),       # supply wagon destoyed
         (display_message, "@_Your supply wagon is getting looted and destroyed.", 0xFF0000),  # message for destroyed supply wagon
   (try_end),
                #tempered chief acaba
          (jump_to_menu, "mnu_total_defeat"),
        (try_end),


#chief anadidos
        (try_begin),
          (eq, "$g_encountered_party_template", "pt_looters"),
          (set_background_mesh, "mesh_pic_bandits1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_mountain_bandits"),
          (set_background_mesh, "mesh_pic_mountain_bandits1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_steppe_bandits"),
          (set_background_mesh, "mesh_pic_steppe_bandits1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_taiga_bandits"),
          (set_background_mesh, "mesh_pic_steppe_bandits1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_sea_raiders"),
          (set_background_mesh, "mesh_pic_sea_raiders1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_sea_raiders2"),
          (set_background_mesh, "mesh_pic_sea_raiders1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_forest_bandits"),
          (set_background_mesh, "mesh_pic_forest_bandits1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_deserters"),
          (set_background_mesh, "mesh_pic_deserters1"),
        (else_try),
          (eq, "$g_encountered_party_template", "pt_kingdom_hero_party"),
		  (party_stack_get_troop_id, ":leader_troop", "$g_encountered_party", 0),
		  (ge, ":leader_troop", 1),
		  (troop_get_slot, ":leader_troop_faction", ":leader_troop", slot_troop_original_faction),
		  (try_begin),
			(eq, ":leader_troop_faction", fac_kingdom_1),
            (set_background_mesh, "mesh_pic_sarranid_encounter1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_2),
            (set_background_mesh, "mesh_pic_vaegir1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_3),
            (set_background_mesh, "mesh_pic_vaegir1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_4),
            (set_background_mesh, "mesh_pic_nord1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_5),
            (set_background_mesh, "mesh_pic_vaegir1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_6), ##puestos chief de aqui hasta 32
            (set_background_mesh, "mesh_pic_swad1"),
                  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_7),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_8),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_9),
            (set_background_mesh, "mesh_pic_nord1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_10),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_11),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_12),
            (set_background_mesh, "mesh_pic_swad1"),
                  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_13),
            (set_background_mesh, "mesh_pic_nord1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_14),
            (set_background_mesh, "mesh_pic_nord1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_15),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_16),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_17),
            (set_background_mesh, "mesh_pic_rhodock1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_18),
            (set_background_mesh, "mesh_pic_swad1"),
                  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_19),
            (set_background_mesh, "mesh_pic_rhodock1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_20),
            (set_background_mesh, "mesh_pic_khergit1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_21),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_22),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_23),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_24),
            (set_background_mesh, "mesh_pic_swad1"),
                  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_25),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_26),
            (set_background_mesh, "mesh_pic_swad1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_27),
            (set_background_mesh, "mesh_pic_rhodock1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_28),
            (set_background_mesh, "mesh_pic_rhodock1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_29),
            (set_background_mesh, "mesh_pic_rhodock1"),
		  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_30),
            (set_background_mesh, "mesh_pic_rhodock1"),
                  (else_try),
			(eq, ":leader_troop_faction", fac_kingdom_31), ##con este reino acaba puestos chief
            (set_background_mesh, "mesh_pic_rhodock1"),
		  (try_end),
        (try_end),
	  (assign, "$new_encounter", 0),	#MOTO move to end so it can be used!
    ],
    [

####rigale chief emboscada
      ("ambush_attack",  #rigale ambush script
      [
        (eq, "$encountered_party_friendly", 0),
		(eq,"$ambush_set_by_player", 1),
		  (eq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL TREACHERY
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
	    (set_background_mesh, "mesh_pic_forest_bandits1"),
      ],
     "Launch the ambush.",
     [
       (assign, "$g_battle_result", 0),
       (assign, "$g_engaged_enemy", 1),
#        (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
       (call_script, "script_calculate_renown_value"),
       (call_script, "script_calculate_battle_advantage"),
       (set_battle_advantage, reg0),
        (assign,"$ambush_set_by_player", 0), #rigale
       (set_party_battle_mode),
       (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),  #besiege mode, hopefully garrisonned troops join

		(try_begin),
			(eq, "$type_of_ambushing_success", 1), #crit success
			#ajout battle avantage ajouter directement dans le script

			(call_script,"script_change_player_honor",-1),
			(call_script,"script_rigale_random_troop_death_or_wounded",15,40,"$g_encountered_party"),
			(display_message,"@Your ambush is a critical success.{s17}",0x669933),
		(else_try),
 			(eq, "$type_of_ambushing_success", 2), #success

			(call_script,"script_rigale_random_troop_death_or_wounded",10,25,"$g_encountered_party"),
			#ajout battle avantage ajouter directement dans le script
			(display_message,"@Your ambush is a success.{s17}",0x669933),
		(else_try),
 			(eq, "$type_of_ambushing_success", 3), #failure

			#ajout battle avantage ajouter directement dans le script
			(display_message,"@Your ambush is a failure. You will fight at a disadvantage.{s17}",0xCC3333),
		(else_try),
 			(eq, "$type_of_ambushing_success", 4), #crit failure
			(display_message,"@Your ambush is a critical failure. You will fight at a big disadvantage.{s17}",0xCC3333),
			#ajout battle avantage ajouter directement dans le script
        (try_end),

         (party_get_current_terrain, ":terrain_type", "p_main_party"),
		(try_begin),
		  (this_or_next|eq, ":terrain_type", rt_steppe),
		  (this_or_next|eq, ":terrain_type", rt_plain),
		 (this_or_next|eq, ":terrain_type", rt_steppe_forest),
		 (eq, ":terrain_type", rt_forest),
				(store_random_in_range, ":scene_a_usar", 1,5),
				(try_begin),
					(eq, ":scene_a_usar", 1),
		  (assign, ":scene_to_use", "scn_ambush_steppe"),
				(else_try),
					(eq, ":scene_a_usar", 2),
		  (assign, ":scene_to_use", "scn_ambush_plains"),
				(else_try),
					(eq, ":scene_a_usar", 3),
		 (assign, ":scene_to_use", "scn_ambush_steppe_forest"),
				(else_try),
					(eq, ":scene_a_usar", 4),
		 (assign, ":scene_to_use", "scn_ambush_plains_forest"),
				(else_try),
		 (assign, ":scene_to_use", "scn_ambush_plains_forest"),
				(try_end),
		(else_try),
		  (this_or_next|eq, ":terrain_type", rt_snow),
			 (eq, ":terrain_type", rt_snow_forest),
				(store_random_in_range, ":scene_a_usar", 1,3),
				(try_begin),
					(eq, ":scene_a_usar", 1),
		  (assign, ":scene_to_use", "scn_ambush_snow"),
				(else_try),
					(eq, ":scene_a_usar", 2),
		 (assign, ":scene_to_use", "scn_ambush_snow_forest"),
				(else_try),
		 (assign, ":scene_to_use", "scn_ambush_snow_forest"),
				(try_end),
		(else_try),
		 (eq, ":terrain_type", rt_desert),
		 (assign, ":scene_to_use", "scn_ambush_desert"),
		(try_end),

          (set_jump_mission,"mt_lead_charge_ambush"),
          (jump_to_scene, ":scene_to_use"),

		  #(jump_to_scene, "scn_ambusher_plains_player"),
          #(call_script, "script_setup_random_scene"),

		(assign, "$type_of_ambushing_success", 0),#rigale
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]),




      ("sneaking_attack",  #rigale sneaking script
      [
        (eq, "$encountered_party_friendly", 0),
		(eq,"$sneaking_set_by_player", 1),
		  (eq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL TREACHERY
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
	  (str_store_string,s1,"@ "),
		(try_begin),(eq,is_currently_night), (str_store_string, s1, "@ Nocturnal "),(try_end),

      ],
     "Launch the{s1}sneak attack.",
     [

       (assign, "$g_battle_result", 0),
       (assign, "$g_engaged_enemy", 1),
#        (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
       (call_script, "script_calculate_renown_value"),
       (call_script, "script_calculate_battle_advantage"),
       (set_battle_advantage, reg0),
        (assign,"$sneaking_set_by_player", 0), #rigale
       (set_party_battle_mode),
       (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),  #besiege mode, hopefully garrisonned troops join



		(try_begin),
			(eq, "$type_of_sneaking_success", 1), #crit success
			#ajout battle avantage ajouter directement dans le script

			(call_script,"script_change_player_honor",-1),
			(call_script,"script_rigale_random_troop_death_or_wounded",10,20,"$g_encountered_party"),
			(display_message,"@Your {s2} sneak attack is a critical success. {s17}",0x669933),
		(else_try),
 			(eq, "$type_of_sneaking_success", 2), #success

			(call_script,"script_rigale_random_troop_death_or_wounded",5,10,"$g_encountered_party"),
			#ajout battle avantage ajouter directement dans le script
			(display_message,"@Your sneak attack is a success. {s17}",0x669933),
		(else_try),
 			(eq, "$type_of_sneaking_success", 3), #failure

			#ajout battle avantage ajouter directement dans le script
			(display_message,"@Your sneak attack is a failure. You will fight at a disadvantage. {s17}",0xCC3333),
		(else_try),
 			(eq, "$type_of_sneaking_success", 4), #crit failure

			#ajout battle avantage ajouter directement dans le script
			(display_message,"@Your sneak attack is a critical failure. You will fight at a big disadvantage. {s17}",0xCC3333),


        (try_end),
          (set_jump_mission,"mt_lead_charge"),
          (call_script, "script_setup_random_scene"),
		(assign, "$type_of_sneaking_success", 0),#rigale
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
	  ),
      ###rigale chief emboscada acaba



      ("encounter_attack",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
          (this_or_next|eq, "$encountered_party_friendly", 0),#TEMPERED chief CHANGED TO ALLOW ATTACKING FOR DUEL TREACHERY
		  (eq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL TREACHERY
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          #Wulf
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          #Wulf end
          ],
                            "Charge the enemy.",[
                                (assign, "$g_battle_result", 0),
                                (assign, "$g_engaged_enemy", 1),

								(assign,"$duel_encounter",-1),#TEMPERED chief ADDED FOR WILDERNESS DUEL

        (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
        (try_begin),
		  (eq, ":encountered_party_template", "pt_village_farmers"),
		  (unlock_achievement, ACHIEVEMENT_HELP_HELP_IM_BEING_REPRESSED),
		(try_end),
                                (call_script, "script_calculate_renown_value"),
   		##diplomacy start+ chief
		(try_begin),
			#Call this to properly set cached values for strength
			(eq, "$g_dplmc_terrain_advantage", DPLMC_TERRAIN_ADVANTAGE_ENABLE),
			(assign, ":terrain_code", dplmc_terrain_code_none),#defined in header_terrain_types.py
			(try_begin),
				(this_or_next|eq, "$g_encounter_type", enctype_fighting_against_village_raid),
					(eq, "$g_encounter_type", enctype_catched_during_village_raid),
				(assign, ":terrain_code", dplmc_terrain_code_village),#defined in header_terrain_types.py
			(else_try),
				(encountered_party_is_attacker),
				(call_script, "script_dplmc_get_terrain_code_for_battle", "$g_encountered_party", "p_main_party"),
				(assign, ":terrain_code", reg0),
			(else_try),
				(call_script, "script_dplmc_get_terrain_code_for_battle", "p_main_party", "$g_encountered_party"),
				(assign, ":terrain_code", reg0),
			(try_end),
			(neq, ":terrain_code", dplmc_terrain_code_none),
			(call_script, "script_dplmc_party_calculate_strength_in_terrain", "p_main_party", ":terrain_code", 0, 1),
			(call_script, "script_dplmc_party_calculate_strength_in_terrain", "$g_encountered_party", ":terrain_code", 0, 1),
		(try_end),
		##diplomacy end+
                             (call_script, "script_calculate_battle_advantage"),
                                (set_battle_advantage, reg0),
##						#Fixes absurd battle advantage problems vs. giant armies bos chief
##								(try_begin),
##									(ge, get_battle_advantage, 4),
##										(set_battle_advantage, 4),
##								(try_end),
##								(try_begin),
##									(le, get_battle_advantage, -4),
##										(set_battle_advantage, -4),
##								(try_end),
##       ###chief bos acaba
                                (set_party_battle_mode),
                                (try_begin),
                                  (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
                                  (assign, "$g_village_raid_evil", 0),
                                  (set_jump_mission,"mt_village_raid"),
                                  (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
                                  (jump_to_scene, ":scene_to_use"),
                                (else_try),
                                  (eq, "$g_encounter_type", enctype_catched_during_village_raid),
                                  (assign, "$g_village_raid_evil", 0),
                                  (set_jump_mission,"mt_village_raid"),
                                  (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
                                  (jump_to_scene, ":scene_to_use"),
#caravan chief anadido
                                (else_try),
		  (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),
		(try_begin),
                                (store_random_in_range, ":scene_a_usar", 1,4),
				(try_begin),
					(eq, ":scene_a_usar", 1),
		  (assign, ":scene_to_use", "scn_caravanatacada"),
				(else_try),
					(eq, ":scene_a_usar", 2),
		  (assign, ":scene_to_use", "scn_of_multi_caravan_ambush2"),
				(else_try),
					(eq, ":scene_a_usar", 3),
		  (assign, ":scene_to_use", "scn_of_multi_caravan_ambush2"),
				(else_try),
		 (assign, ":scene_to_use", "scn_caravanatacada"),
				(try_end),
		(try_end),

			(set_jump_mission,"mt_lead_charge"),
			(jump_to_scene, ":scene_to_use"),
                                #chief puentes empieza
                                (else_try), #Arch3r#
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_1"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_1"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_2"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_2"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_3"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_3"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_4"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_4"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_5"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_5"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_6"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_6"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_7"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_7"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_8"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_8"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_9"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_9"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_10"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_10"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_11"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_11"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_12"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_12"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_13"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_13"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
##                                 (else_try),
##                                  (party_get_position,pos1,"p_main_party"),
##                                    (party_get_position,pos2,"p_bridge_14"),
##                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
##                                    (lt,":cur_distance",100),
##                                    (assign, ":scene_to_use", "scn_bridge_14"),
##                                  (set_jump_mission,"mt_lead_charge"),
##                                  (jump_to_scene, ":scene_to_use"),
##                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_bridge_15"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",100),
                                    (assign, ":scene_to_use", "scn_bridge_15"),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 #chief puentes acaba
                                #chief escenas unicas empieza
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_river_delta"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                                    (assign, ":scene_to_use", "scn_river_delta"),
##                                (display_message, "@ Scout report: Sir, be careful, the enemy is on the other side of the estuary.",color_good_news),
##				(display_message, "@ One of your men sigh: This site is beautiful, a shame that soon the water will run stained with blood.",color_good_news),
                                  (assign,"$battle_type",1),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_quarry"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_quarry"),
                                  (assign,"$battle_type",2),
##                 		(display_message, "@ Scout report: Lord, I do not see the enemy, we lost their track.",color_good_news),
##				(display_message, "@ One of your men screams: By the Gods! there!, AMBUSH!!!.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_tilting_at_windmills"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_tilting_at_windmills"),
                                  (assign,"$battle_type",3),
##                 		(display_message, "@ Scout report: Sir, there, across the River. Can you see them?",color_good_news),
##				(display_message, "@ One of your men smile: Hey, look at those chickens, I have to catch a few for the pot tonight.",color_good_news),
##                 		(display_message, "@ Other man reply: These people are hungry because of the war, don't ever steal anything, OK?",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_multi_indigo_cradle"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_multi_indigo_cradle"),
                                  (assign,"$battle_type",4),
##                 		(display_message, "@ Scout report: Sir, I found a monastery there before, it seems to have been looted and the place is now in enemy hands.",color_good_news),
##				(display_message, "@ One of your men reads: In the name of Christ, in this land nobody respects the sacred. Kill them all!",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_multi_indigo_frontier"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_multi_indigo_frontier"),
                                  (assign,"$battle_type",5),
##                 		(display_message, "@ Scout report: Sir, this village is empty, villagers have fled.",color_good_news),
##				(display_message, "@ One of your men points to the horizon: someone is coming!",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_caravan_ambush"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_caravan_ambush"),
                                  (assign,"$battle_type",6),
##                 		(display_message, "@ Scout report: Sir, this is a perfect spot for an ambush. Our supply train is very exposed.",color_good_news),
##				(display_message, "@ One of your men tells you: The horses rGive me timeefused to move, we're making a defensive circle with the carts.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_crezy"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_crezy"),
                                  (assign,"$battle_type",7),
##                 		(display_message, "@ Scout report: Sir, the hill is ours, the enemy is displayed below.",color_good_news),
##				(display_message, "@ A man whispers to his companion: Many battles are not what you expect, in the end we all die.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_fjord"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_fjord"),
                                  (assign,"$battle_type",8),
##                 		(display_message, "@ Scout report: Sir, the enemy has occupied an abandoned city.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_hastings"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_hastings"),
                                  (assign,"$battle_type",9),
##                 		(display_message, "@ Scout report: My Lord, we are in haestingas territory, that hill would be a good area.",color_good_news),
##				(display_message, "@ A man whispers to his companion: It seems the enemy had the same thought.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_hot_gates"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                                    (assign, ":scene_to_use", "scn_of_multi_hot_gates"),
                                  (assign,"$battle_type",10),
##                 		(display_message, "@ Scout report: Sir, this place gives me chills, we could be ambushed at any time.",color_good_news),
##				(display_message, "@ A man whispers to you: Sir, this site is cursed.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_mini_circles"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_mini_circles"),
                                  (assign,"$battle_type",11),
##                 		(display_message, "@ Scout report: Sir, the enemy is down, they are already ours.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_rock_valley"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                                    (assign, ":scene_to_use", "scn_of_multi_rock_valley"),
                                  (assign,"$battle_type",12),
##                 		(display_message, "@ Scout report: Sir, look at that hill, there they are.",color_good_news),
##				(display_message, "@ A man screams: By the gods, victory or death!.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_small_ruins"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_small_ruins"),
                                  (assign,"$battle_type",13),
##                 		(display_message, "@ Scout report: Sir, we have cornered the enemy.",color_good_news),
##				(display_message, "@ A man screams: Everyone ready, they're coming!",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_stone_circles"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_stone_circles"),
                                  (assign,"$battle_type",14),
##                 		(display_message, "@ Scout report: The enemy has been deployed near the stone circles. Our men are afraid of the magic of the old religion.",color_good_news),
##				(display_message, "@ A man says to you: My dear Lord, raise our morale (key u), please!",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_battle_stones"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_battle_stones"),
                                  (assign,"$battle_type",15),
##                  		(display_message, "@ Scout report: We've reached an ancient monument, rows of stones. But the real obstacle is the enemy lining up on the other side of the brook.",color_good_news),
##				(display_message, "@ You reply: Rows of stones you say... Let us make them tomb stones for the enemy then.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_of_multi_thingvellir"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_of_multi_thingvellir"),
                                  (assign,"$battle_type",16),
##                  		(display_message, "@ Scout report: we have taken up positions in an abandoned fort on the hill.",color_good_news),
##				(display_message, "@ A man says: this place smells of death.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_circle_mystic"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_circle_mystic"),
                                  (assign,"$battle_type",17),
##                  		(display_message, "@ Scout report: A bog lies before us so we must be wary - stay on the path.",color_good_news),
##				(display_message, "@ A man tugs your sleeve: What is that in the trees up ahead? Evil lurks here.",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_roman_fort"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_roman_fort"),
                                  (assign,"$battle_type",18),
##                  		(display_message, "@ While searching for useful remains in a recently ransacked and abandoned Roman fort the scout informs you:",color_good_news),
##				(display_message, "@ Commander, we can not linger here much longer. The enemy is spotted behind the hill. What are your orders?",color_good_news),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_hadrian_wall"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_hadrian_wall"),
                                  (assign,"$battle_type",19),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_farmland"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_farmland"),
                                  (assign,"$battle_type",20),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_stonemonumento"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_stonemonumento"),
                                  (assign,"$battle_type",21),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_forestbattle"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_forestbattle"),
                                  (assign,"$battle_type",22),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 (else_try),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"p_multi_scene_dam_10"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",300),
                                    (assign, ":scene_to_use", "scn_multi_scene_dam_10"),
                                  (assign,"$battle_type",23),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (jump_to_scene, ":scene_to_use"),
                                 #chief escenas unicas acaba
                                (else_try),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (call_script, "script_setup_random_scene"),
                                (try_end),
                                (assign, "$g_next_menu", "mnu_simple_encounter"),
                                (jump_to_menu, "mnu_battle_debrief"),
                                (change_screen_mission),
                                ]),

####player recibe rigale emboscada chief empieza
      ("encounter_attack",[
			(eq,"$player_fall_in_ambush",1),
          (this_or_next|eq, "$encountered_party_friendly", 0),#TEMPERED chief CHANGED TO ALLOW ATTACKING FOR DUEL TREACHERY
		  (eq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL TREACHERY
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          #Wulf
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          #Wulf end
          ],
                            "Ambush!",[
           (assign,"$emboscada_time", 1), #antes de 48 horas no puede haber otra emboscada ambush chief
                                (assign, "$g_battle_result", 0),
                                (assign, "$g_engaged_enemy", 1),

								(assign,"$duel_encounter",-1),#TEMPERED chief ADDED FOR WILDERNESS DUEL

        (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
        (try_begin),
		  (eq, ":encountered_party_template", "pt_village_farmers"),
		  (unlock_achievement, ACHIEVEMENT_HELP_HELP_IM_BEING_REPRESSED),
		(try_end),
                                (call_script, "script_calculate_renown_value"),
                                (call_script, "script_calculate_battle_advantage"),
                                (set_battle_advantage, reg0),
						#Fixes absurd battle advantage problems vs. giant armies bos chief
								(try_begin),
									(ge, get_battle_advantage, 4),
										(set_battle_advantage, 4),
								(try_end),
								(try_begin),
									(le, get_battle_advantage, -4),
										(set_battle_advantage, -4),
								(try_end),
       ###chief bos acaba
                                (set_party_battle_mode),
                                (try_begin),
                                  (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
                                  (assign, "$g_village_raid_evil", 0),
                                  (set_jump_mission,"mt_village_raid"),
                                  (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
                                  (jump_to_scene, ":scene_to_use"),
                                (else_try),
                                  (eq, "$g_encounter_type", enctype_catched_during_village_raid),
                                  (assign, "$g_village_raid_evil", 0),
                                  (set_jump_mission,"mt_village_raid"),
                                  (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
                                  (jump_to_scene, ":scene_to_use"),
		(else_try),
			(eq,"$player_fall_in_ambush",1),

         (party_get_current_terrain, ":terrain_type", "p_main_party"),
		(try_begin),
		  (this_or_next|eq, ":terrain_type", rt_steppe),
		  (this_or_next|eq, ":terrain_type", rt_plain),
		 (this_or_next|eq, ":terrain_type", rt_steppe_forest),
		 (eq, ":terrain_type", rt_forest),
				(store_random_in_range, ":scene_a_usar", 1,5),
				(try_begin),
					(eq, ":scene_a_usar", 1),
		  (assign, ":scene_to_use", "scn_ambush_steppe"),
				(else_try),
					(eq, ":scene_a_usar", 2),
		  (assign, ":scene_to_use", "scn_ambush_plains"),
				(else_try),
					(eq, ":scene_a_usar", 3),
		 (assign, ":scene_to_use", "scn_ambush_steppe_forest"),
				(else_try),
					(eq, ":scene_a_usar", 4),
		 (assign, ":scene_to_use", "scn_ambush_plains_forest"),
				(else_try),
		 (assign, ":scene_to_use", "scn_ambush_plains_forest"),
				(try_end),
		(else_try),
		  (this_or_next|eq, ":terrain_type", rt_snow),
			 (eq, ":terrain_type", rt_snow_forest),
				(store_random_in_range, ":scene_a_usar", 1,3),
				(try_begin),
					(eq, ":scene_a_usar", 1),
		  (assign, ":scene_to_use", "scn_ambush_snow"),
				(else_try),
					(eq, ":scene_a_usar", 2),
		 (assign, ":scene_to_use", "scn_ambush_snow_forest"),
				(else_try),
		 (assign, ":scene_to_use", "scn_ambush_snow_forest"),
				(try_end),
		(else_try),
		 (eq, ":terrain_type", rt_desert),
		 (assign, ":scene_to_use", "scn_ambush_desert"),
		(try_end),


			(set_jump_mission,"mt_lead_charge_ambushed"),
			(jump_to_scene, ":scene_to_use"),

						# (assign, "$player_fall_in_ambush", 0),	MOTO now done in mnu_simple_encounter
			(assign, "$g_next_menu", "mnu_simple_encounter"),
			(jump_to_menu, "mnu_battle_debrief"),
			(change_screen_mission),
####rigale emboscada acaba chief
                                (else_try),
                                  (set_jump_mission,"mt_lead_charge"),
                                  (call_script, "script_setup_random_scene"),
                                (try_end),
                                (assign, "$g_next_menu", "mnu_simple_encounter"),
                                (jump_to_menu, "mnu_battle_debrief"),
                                (change_screen_mission),
                                ]),
###rigale emboscada acaba
#seafare chief duh
##      	 	 ("access_crew", 			#Seafaring reassign crew before battle	#Floris
##		[	(party_get_current_terrain, ":terrain", "p_main_party"),
##         (this_or_next|eq,":terrain",0), #chief
##         (this_or_next|eq,":terrain",7),
##          (eq,":terrain",8),
##		],
##      "Reassign your crew for battle.",
##      [
##		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
##		(party_get_num_companions, reg1, ":ship_no"),
##		(try_begin),
##			(gt, reg1, 1),
##			(change_screen_exchange_members, 0, ":ship_no"),
##			(assign, "$g_next_menu", "mnu_simple_encounter"),
##		(else_try),
##			(display_message, "@All your troops are already assigned to fight in the battle."),
##		(try_end),
##     ]),

#seafareduh acaba chief
#chief sea battles empieza
      ("encounter_attack",[
          (eq, "$encountered_party_friendly", 0),
          (neg|troop_is_wounded, "trp_player"),
          #Wulf
          (party_get_current_terrain,":terrain","p_main_party"),
         (this_or_next|eq,":terrain",0),
         (this_or_next|eq,":terrain",7),
          (eq,":terrain",8),
          #Wulf end
          ],
                            "Close in and board the enemy.",[
                                (assign, "$g_battle_result", 0),
                                (assign, "$g_engaged_enemy", 1),
        (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
        (try_begin),
		  (eq, ":encountered_party_template", "pt_village_farmers"),
		  (unlock_achievement, ACHIEVEMENT_HELP_HELP_IM_BEING_REPRESSED),
		(try_end),
                                (call_script, "script_calculate_renown_value"),
                                (call_script, "script_calculate_battle_advantage"),
                                (set_battle_advantage, reg0),
                                (set_party_battle_mode),
                                (try_begin),
                                  (eq, "$g_encounter_type", enctype_fighting_against_village_raid),
                                  (assign, "$g_village_raid_evil", 0),
                                  (set_jump_mission,"mt_village_raid"),
                                  (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
                                  (jump_to_scene, ":scene_to_use"),
                                (else_try),
                                  (eq, "$g_encounter_type", enctype_catched_during_village_raid),
                                  (assign, "$g_village_raid_evil", 0),
                                  (set_jump_mission,"mt_village_raid"),
                                  (party_get_slot, ":scene_to_use", "$g_encounter_is_in_village", slot_castle_exterior),
                                  (jump_to_scene, ":scene_to_use"),
                                (else_try),
                                #Wulf sea battles
                                (store_random_in_range, ":scene_a_sea", 1,3),
                                 (try_begin),
                                #Adorno
					(eq, ":scene_a_sea", 1),
                                  (set_jump_mission,"mt_ship_battle2"),
                                 (try_begin),
                                   (val_add,reg10,reg11),
                                   (gt,reg10,60),
                                   (jump_to_scene, "scn_sea_4"),
                                 (else_try),
#                                   (val_add,reg10,reg11),
                                   (gt,reg10,30),
                                   (jump_to_scene, "scn_sea_3"),
                                 (else_try),
                                   (jump_to_scene, "scn_sea_1"),
                                (try_end),
                                   #Adorno end
                                 (else_try),
                                 #phaiak
                                  (set_jump_mission,"mt_ship_battle"),
                                 (try_begin),
                                   (val_add,reg10,reg11),
                                   (gt,reg10,60),
                                   (jump_to_scene, "scn_sea_2"),
                                 (else_try),
#                                   (val_add,reg10,reg11),
                                   (gt,reg10,30),
                                   (jump_to_scene, "scn_sea"),
                                 (else_try),
                                   (jump_to_scene, "scn_sea_2"),
                                (try_end),
                                 #phaiak acaba
                                (try_end),
                                   #Wulf end

                                (try_end),
                                (assign, "$g_next_menu", "mnu_simple_encounter"),
                                (jump_to_menu, "mnu_battle_debrief"),
                                (change_screen_mission),
                                ]),
      #chief sea battles acaba

      ("encounter_order_attack",[
          (eq, "$encountered_party_friendly", 0),
		  (neq,"$duel_encounter",1),#TEMPERED  chief ADDED FOR WILDERNESS DUEL
		  (neq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),(ge, reg0, 4),
          ],
           "Order your troops to attack without you.",[(jump_to_menu,"mnu_order_attack_begin"),
                                                            #(simulate_battle,3)
                                                            ]),


###chief tacticas, discursos, combate campeones etc...
              ("tactical_nuevo",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
          (eq, "$encountered_party_friendly", 0),
		  (neq,"$duel_encounter",1),#TEMPERED  chief ADDED FOR WILDERNESS DUEL
		  (neq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          (neg|troop_is_wounded, "trp_player"),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
		(ge, ":tactics", 4),
                                                         (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
                  ],"Commander's Options.",
       [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 50), # deja pasar si el player tiene por lo menos 50 hombres
           (assign,"$emboscada_time", 1), #antes de 48 horas no puede haber otra emboscada ambush chief
       (jump_to_menu,"mnu_panel_comandante"),
      (else_try),
        (display_message,"@ You need to have more men for can use panel commander."),
      (try_end),
        ]),
#tactical chief acaba

#COOP chief Battle#############################
          #Wulf end
      ("coop_setup",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          #Wulf
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          #Wulf end
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
      ],"Setup multiplayer battle.",
      [
        #need to attach villagers to battle
        (try_begin),
          (eq, "$g_encounter_type", enctype_catched_during_village_raid), #if player is raiding
          (gt, "$g_player_raiding_village", 0),
          (party_attach_to_party, "$g_encounter_is_in_village", "$g_enemy_party"),
          (assign, "$coop_encountered_party", "$g_enemy_party"),
          (assign, "$coop_battle_type", coop_battle_type_village_player_attack),
        (else_try),
          (eq, "$g_encounter_type", enctype_fighting_against_village_raid),#if enemy lord is raiding
          (assign, "$g_ally_party", "$g_encounter_is_in_village"),
          (assign, "$coop_encountered_party", "$g_enemy_party"),
          (assign, "$coop_battle_type", coop_battle_type_village_player_defend),
        (else_try),
          (assign, "$coop_battle_type", coop_battle_type_field_battle), #normal field battle
          (assign, "$coop_encountered_party", "$g_enemy_party"),
        (try_end),

        (call_script, "script_coop_copy_parties_to_file_sp"), # set coop_battle_state to 1
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit),
        (try_end),
      ]),

      ("quit_juego_sin_salvar",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          #Wulf
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          #Wulf end
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).",
      [
        (change_screen_quit),
      ]),

      ("coop_use_result",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
          (neg|troop_is_wounded, "trp_player"),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          #Wulf
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          #Wulf end
         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.",
      [
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_coop_copy_file_to_parties_sp"),	   # set coop_battle_state to 0
        (assign, "$g_engaged_enemy", 1),
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
      ]),

##      ("encounter_save",[		  (neq,"$player_fall_in_ambush",1), #rigale chief
##          (neg|troop_is_wounded, "trp_player"),
##		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
##          #Wulf
##          (party_get_current_terrain,":terrain","p_main_party"),
##         (neq,":terrain",0),
##          (neq,":terrain",7),
##          (neq,":terrain",8),
##          #Wulf end
##          ],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (leave_encounter),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),
########################################## chief acaba

              ("encounter_leave",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
          (eq,"$cant_leave_encounter", 0),
		  (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
		  (neq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          ],"Leave.",[

###NPC companion changes begin
              (try_begin),
                  (eq, "$encountered_party_friendly", 0),
                  (encountered_party_is_attacker),
                  (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
              (try_end),
###NPC companion changes end
#Troop commentary changes begin
              (try_begin),
                  (eq, "$encountered_party_friendly", 0),
#                  (encountered_party_is_attacker),
                  (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
                  (try_for_range, ":stack_no", 0, ":num_stacks"),
                    (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
                    (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
					(troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
                    (store_troop_faction, ":victorious_faction", ":stack_troop"),
#					(store_relation, ":relation_with_stack_troop", ":victorious_faction", "fac_player_faction"),
#					(lt, ":relation_with_stack_troop", 0),
                    (call_script, "script_add_log_entry", logent_player_retreated_from_lord, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
                  (try_end),
              (try_end),
#Troop commentary changes end
          	(leave_encounter),(change_screen_return)]),
      ("encounter_retreat",[
		  (neq,"$player_fall_in_ambush",1), #rigale chief
#	  	 (this_or_next|eq,"$player_fall_in_ambush",1), #rigale chief
         (eq,"$cant_leave_encounter", 1),
		 (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
		 (neq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL
         (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
         (assign, ":max_skill", reg0),
         (val_add, ":max_skill", 4),

         (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
         (assign, ":enemy_party_strength", reg0),
         (val_div, ":enemy_party_strength", 2),

         (val_div, ":enemy_party_strength", ":max_skill"),
         (val_max, ":enemy_party_strength", 1),

         (call_script, "script_party_count_fit_regulars", "p_main_party"),
         (assign, ":player_count", reg0),
         (ge, ":player_count", ":enemy_party_strength"),
         ],"Pull back, leaving some soldiers behind to cover your retreat.",[(jump_to_menu, "mnu_encounter_retreat_confirm"),]),

      ("encounter_surrender",[
	     (this_or_next|eq,"$player_fall_in_ambush",1), #rigale chief
         (eq,"$cant_leave_encounter", 1),
		 (neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
		 (neq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL
          ],"Surrender.",[(assign,"$g_player_surrenders",1)]),
#TEMPERED chief ADDED MENU ITEM TO START PRESENTATION
      ("force_presentation",[
	(eq, "$encountered_party_friendly", 0),
								(eq,"$force_presentation_shown",0),
								(neq,"$duel_encounter",1),#TEMPERED chief ADDED FOR WILDERNESS DUEL
								(neq,"$duel_encounter",2),#TEMPERED chief ADDED FOR WILDERNESS DUEL
							],"Assess nearby forces.",
							[(start_presentation,"prsnt_force_composition"),]),
#TEMPERED END CHANGES
#TEMPERED chief MENU ITEM ADDED FOR WILDERNESS DUEL
		("begin_duel",
			[	(eq,"$duel_encounter",1),
			],"Begin the duel",
			[
				(call_script, "script_setup_random_scene"),
				(assign, "$g_next_menu",-1),
				(change_screen_mission),
			]),
#TEMPERED chief END CHANGES
    ]
  ),
  (
    "encounter_retreat_confirm",0,
    "As the party member with the highest tactics skill,\
 ({reg2}), {reg3?you devise:{s3} devises} a plan that will allow you and your men to escape with your lives,\
 but you'll have to leave {reg4} soldiers behind to stop the enemy from giving chase.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),
     (val_add, ":max_skill", 4),

     (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
     (assign, ":enemy_party_strength", reg0),
     (val_div, ":enemy_party_strength", 2),

     (store_div, reg4, ":enemy_party_strength", ":max_skill"),
     (val_max, reg4, 1),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
     ],
    [
      ("leave_behind",[],"Go on. The sacrifice of these men will save the rest.",
       [
          (assign, ":num_casualties", reg4),
          (try_for_range, ":unused", 0, ":num_casualties"),
            (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
            (assign, ":lost_troop", reg0),
            (store_random_in_range, ":random_no", 0, 100),
            (ge, ":random_no", 30),
            (party_add_prisoners, "$g_encountered_party", ":lost_troop", 1),
           (try_end),
           (call_script, "script_change_player_party_morale", -20),
           (jump_to_menu, "mnu_encounter_retreat"),
          ]),
      ("dont_leave_behind",[],"No. We leave no one behind.",[(jump_to_menu, "mnu_simple_encounter"),]),
    ]
  ),
  (
    "encounter_retreat",0,
    "You tell {reg4} of your troops to hold the enemy while you retreat with the rest of your party.",
    "none",
    [
     ],
    [
      ("continue",[],"Continue...",
       [
###Troop commentary changes begin
          (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
          (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
          (try_for_range, ":stack_no", 0, ":num_stacks"),
              (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
              (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
              (troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),

              (store_troop_faction, ":victorious_faction", ":stack_troop"),
              (call_script, "script_add_log_entry", logent_player_retreated_from_lord_cowardly, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
          (try_end),
###Troop commentary changes end
          (party_ignore_player, "$g_encountered_party", 1),
          (leave_encounter),
          (change_screen_return)
          ]),
    ]
  ),
  (
    "order_attack_begin",0,
    "Your troops prepare to attack the enemy.",
    "none",
    [],
    [
      ("order_attack_begin",[],"Order the attack to begin.",
      [
        (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
        (try_begin),
		  (eq, ":encountered_party_template", "pt_village_farmers"),
		  (unlock_achievement, ACHIEVEMENT_HELP_HELP_IM_BEING_REPRESSED),
		(try_end),
        (assign, "$g_engaged_enemy", 1),
        (jump_to_menu,"mnu_order_attack_2"),
      ]),
      ("call_back",[],"Call them back.",[(jump_to_menu,"mnu_simple_encounter")]),
    ]
  ),
  (
    "order_attack_2",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Enemy casualties: {s9}",
    "none",
    [
      (set_background_mesh, "mesh_pic_charge1"),

      (call_script, "script_party_calculate_strength", "p_main_party", 1), #exclude player
      (assign, ":player_party_strength", reg0),
                                    (val_div, ":player_party_strength", 5), #chief blood

      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":enemy_party_strength", reg0),
                                    (val_div, ":enemy_party_strength", 5), #chief blood

 #chief blood bajas reales empieza
##      (party_collect_attachments_to_party, "p_main_party", "p_collective_ally"),
##      (call_script, "script_party_calculate_strength", "p_collective_ally", 1), #exclude player
##      (assign, ":total_player_and_followers_strength", reg0),
##
##      (try_begin),
##        (le, ":total_player_and_followers_strength", ":enemy_party_strength"),
##        (assign, ":minimum_power", ":total_player_and_followers_strength"),
##      (else_try),
##        (assign, ":minimum_power", ":enemy_party_strength"),
##      (try_end),
##
##      (try_begin),
##        (le, ":minimum_power", 25),
##        (assign, ":division_constant", 1),
##      (else_try),
##        (le, ":minimum_power", 50),
##        (assign, ":division_constant", 2),
##      (else_try),
##        (le, ":minimum_power", 75),
##        (assign, ":division_constant", 3),
##      (else_try),
##        (le, ":minimum_power", 125),
##        (assign, ":division_constant", 4),
##      (else_try),
##        (le, ":minimum_power", 200),
##        (assign, ":division_constant", 5),
##      (else_try),
##        (le, ":minimum_power", 400),
##        (assign, ":division_constant", 6),
##      (else_try),
##        (le, ":minimum_power", 800),
##        (assign, ":division_constant", 7),
##      (else_try),
##        (le, ":minimum_power", 1600),
##        (assign, ":division_constant", 8),
##      (else_try),
##        (le, ":minimum_power", 3200),
##        (assign, ":division_constant", 9),
##      (else_try),
##        (le, ":minimum_power", 6400),
##        (assign, ":division_constant", 10),
##      (else_try),
##        (le, ":minimum_power", 12800),
##        (assign, ":division_constant", 11),
##      (else_try),
##        (le, ":minimum_power", 25600),
##        (assign, ":division_constant", 12),
##      (else_try),
##        (le, ":minimum_power", 51200),
##        (assign, ":division_constant", 13),
##      (else_try),
##        (le, ":minimum_power", 102400),
##        (assign, ":division_constant", 14),
##      (else_try),
##        (assign, ":division_constant", 15),
##      (try_end),
##
##      (val_div, ":player_party_strength", ":division_constant"), #1.126, ":division_constant" was 5 before
##      (val_max, ":player_party_strength", 1), #1.126
##      (val_div, ":enemy_party_strength", ":division_constant"), #1.126, ":division_constant" was 5 before
##      (val_max, ":enemy_party_strength", 1), #1.126
##      (val_div, ":total_player_and_followers_strength", ":division_constant"), #1.126, ":division_constant" was 5 before
##      (val_max, ":total_player_and_followers_strength", 1), #1.126
##
##      (store_mul, "$g_strength_contribution_of_player", ":player_party_strength", 100),
##      (val_div, "$g_strength_contribution_of_player", ":total_player_and_followers_strength"),
##
##      (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
##      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
##      (str_store_string_reg, s8, s0),
##
##      (try_begin),
##        (ge, "$g_ally_party", 0),
##        (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
##        (str_store_string_reg, s8, s0),
##      (try_end),
##
##      (inflict_casualties_to_party_group, "$g_encountered_party", ":total_player_and_followers_strength", "p_temp_casualties"),

#                                    (call_script,"script_inflict_casualties_to_party", "p_main_party", ":enemy_party_strength"),
                                    (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
                                    (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
                                    (str_store_string_reg, s8, s0),

####                                    (call_script,"script_inflict_casualties_to_party", "$g_encountered_party", ":player_party_strength"),
                                    (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),

#chief bajas reales acaba
      #ozan begin
      (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
      (try_for_range, ":stack_no", 0, ":num_stacks"),
        (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
        (try_begin),
          (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_size", 0),
          (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
          (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_wounded_size", 0),
          (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
        (try_end),
      (try_end),
      #ozan end

      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),

      (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":num_our_regulars_remaining", reg0),
#chief bajas reales blood empieza
                                      #(le, reg0, 0),
                                      (le, ":num_our_regulars_remaining",  "$num_routed_us"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
##        (store_add, ":num_routed_us_plus_one", "$num_routed_us", 1),
##        (le, ":num_our_regulars_remaining", ":num_routed_us_plus_one"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#chief bajas reales blood acaba
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":num_enemy_regulars_remaining", reg0),
        (this_or_next|le, ":num_enemy_regulars_remaining", 0),
        (le, ":num_enemy_regulars_remaining", "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
        (assign, ":continue", 0),
        (party_get_num_companion_stacks, ":party_num_stacks", "p_collective_enemy"),
        (try_begin),
          (eq, ":party_num_stacks", 0),
          (assign, ":continue", 1),
        (else_try),
          (party_stack_get_troop_id, ":party_leader", "p_collective_enemy", 0),
          (try_begin),
            (neg|troop_is_hero, ":party_leader"),
            (assign, ":continue", 1),
          (else_try),
            (troop_is_wounded, ":party_leader"),
            (assign, ":continue", 1),
          (try_end),
        (try_end),
        (eq, ":continue", 1),
        (assign, "$g_battle_result", 1),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_success"),
      (else_try),
      (str_store_string, s4, "str_order_attack_continue"),
    (try_end),
    ],
    [
      ("order_attack_continue",[(eq, "$no_soldiers_left", 0)],"Order your soldiers to continue the attack.",[
          (jump_to_menu,"mnu_order_attack_2"),
          ]),
      ("order_retreat",[(eq, "$no_soldiers_left", 0)],"Call your soldiers back.",[
          (jump_to_menu,"mnu_simple_encounter"),
          ]),
      ("continue",[(eq, "$no_soldiers_left", 1)],"Continue...",[
          (jump_to_menu,"mnu_simple_encounter"),
          ]),
    ]
  ),

  (
    "battle_debrief",mnf_disable_all_keys,
    "{s11}^^Your Casualties:{s8}{s10}^^Enemy Casualties:{s9}^^Kill count:{s12}", ## CC chief commander
    "none",
    [
     (try_begin),
       (eq, "$g_battle_result", 1),
       (call_script, "script_change_troop_renown", "trp_player", "$battle_renown_value"),
       (try_begin),
         (ge, "$g_encountered_party", 0),
         (party_is_active, "$g_encountered_party"),
         (party_get_template_id, ":encountered_party_template", "$g_encountered_party"),
         (eq, ":encountered_party_template", "pt_kingdom_caravan_party"),

         (get_achievement_stat, ":number_of_village_raids", ACHIEVEMENT_THE_BANDIT, 0),
         (get_achievement_stat, ":number_of_caravan_raids", ACHIEVEMENT_THE_BANDIT, 1),
         (val_add, ":number_of_caravan_raids", 1),
         (set_achievement_stat, ACHIEVEMENT_THE_BANDIT, 1, ":number_of_caravan_raids"),

         (try_begin),
           (ge, ":number_of_village_raids", 3),
           (ge, ":number_of_caravan_raids", 3),
           (unlock_achievement, ACHIEVEMENT_THE_BANDIT),
     (try_end),
       (try_end),

       (try_begin),
         (party_get_current_terrain, ":cur_terrain", "p_main_party"),
         (eq, ":cur_terrain", rt_snow),
         (get_achievement_stat, ":number_of_victories_at_snowy_lands", ACHIEVEMENT_BEST_SERVED_COLD, 0),
         (val_add, ":number_of_victories_at_snowy_lands", 1),
         (set_achievement_stat, ACHIEVEMENT_BEST_SERVED_COLD, 0, ":number_of_victories_at_snowy_lands"),

         (try_begin),
           (eq, ":number_of_victories_at_snowy_lands", 10),
           (unlock_achievement, ACHIEVEMENT_BEST_SERVED_COLD),
         (try_end),
       (try_end),

       (try_begin),
         (ge, "$g_enemy_party", 0),
         (party_is_active, "$g_enemy_party"),
         (party_stack_get_troop_id, ":stack_troop", "$g_enemy_party", 0),
         (eq, ":stack_troop", "trp_mountain_bandit"),

         (get_achievement_stat, ":number_of_victories_aganist_mountain_bandits", ACHIEVEMENT_MOUNTAIN_BLADE, 0),
         (val_add, ":number_of_victories_aganist_mountain_bandits", 1),
         (set_achievement_stat, ACHIEVEMENT_MOUNTAIN_BLADE, 0, ":number_of_victories_aganist_mountain_bandits"),

         (try_begin),
           (eq, ":number_of_victories_aganist_mountain_bandits", 10),
           (unlock_achievement, ACHIEVEMENT_MOUNTAIN_BLADE),
         (try_end),
       (try_end),

       (try_begin),
         (is_between, "$g_ally_party", walled_centers_begin, walled_centers_end),
         (unlock_achievement, ACHIEVEMENT_NONE_SHALL_PASS),
       (try_end),

       (try_begin),
         (eq, "$g_joined_battle_to_help", 1),
         (unlock_achievement, ACHIEVEMENT_GOOD_SAMARITAN),
       (try_end),
     (try_end),

     (assign, "$g_joined_battle_to_help", 0),

     (call_script, "script_count_casualties_and_adjust_morale"),#new
     (call_script, "script_encounter_calculate_fit"),

     (call_script, "script_party_count_fit_regulars", "p_main_party"),
     (assign, "$playerparty_postbattle_regulars", reg0),

     (try_begin),
       (eq, "$g_battle_result", 1),
       (eq, "$g_enemy_fit_for_battle", 0),
       (str_store_string, s11, "@You were victorious!"),
#       (play_track, "track_bogus"), #clear current track.
#       (call_script, "script_music_set_situation_with_culture", mtf_sit_victorious),
       (try_begin),
         (gt, "$g_friend_fit_for_battle", 1),
         (set_background_mesh, "mesh_pic_victory1"),
       (try_end),
     (else_try),
       (eq, "$g_battle_result", -1),
       (ge, "$g_enemy_fit_for_battle",1),
       (this_or_next|le, "$g_friend_fit_for_battle",0),
       (le, "$playerparty_postbattle_regulars", 0),
       (str_store_string, s11, "@Battle was lost. Your forces were utterly crushed."),
       (set_background_mesh, "mesh_pic_defeat1"),
     (else_try),
       (eq, "$g_battle_result", -1),
       (str_store_string, s11, "@Your companions carry you away from the fighting."),
       (troop_get_type, ":is_female", "trp_player"),
     	   (val_mod, ":is_female", 2),	#gender fix chief moto
       (try_begin),
         (eq, ":is_female", 1),
         (set_background_mesh, "mesh_pic_wounded_fem1"),
       (else_try),
         (set_background_mesh, "mesh_pic_wounded1"),
       (try_end),
     (else_try),
       (eq, "$g_battle_result", 1),
       (str_store_string, s11, "@You have defeated the enemy."),
       (try_begin),
         (gt, "$g_friend_fit_for_battle", 1),
         (set_background_mesh, "mesh_pic_victory1"),
       (try_end),
     (else_try),
       (eq, "$g_battle_result", 0),
       (str_store_string, s11, "@You have retreated from the fight."),
#chief bajas reales blood
     (else_try),
       (eq, "$g_battle_result", -2),
       (str_store_string, s11, "str_retreat_in_face_of_enemy"),
	   (assign, "$g_battle_result", 0),
     (else_try),
       (eq, "$g_battle_result", -3),
       (str_store_string, s11, "str_retreat_not_dead"),
	   (assign, "$g_battle_result", 0),
     (else_try),
       (eq, "$g_battle_result", -4),
       (str_store_string, s11, "str_retreat_from_fortress"),
	   (assign, "$g_battle_result", 0),
#chief bajas reales blood acaba
     (try_end),
#NPC companion changes begin
##check for excessive casualties, more forgiving if battle result is good
     (try_begin),
        (gt, "$playerparty_prebattle_regulars", 9),
        (store_add, ":divisor", 3, "$g_battle_result"),
        (store_div, ":half_of_prebattle_regulars", "$playerparty_prebattle_regulars", ":divisor"),
        (lt, "$playerparty_postbattle_regulars", ":half_of_prebattle_regulars"),
        (call_script, "script_objectionable_action", tmt_egalitarian, "str_excessive_casualties"),
     (try_end),
#NPC companion changes end

     (call_script, "script_print_casualties_to_s0", "p_player_casualties", 0),
     (str_store_string_reg, s8, s0),
     (call_script, "script_print_casualties_to_s0", "p_enemy_casualties", 0),
     (str_store_string_reg, s9, s0),
     ## CC chief commander
     (call_script, "script_print_kill_count_to_s0"),
     (str_store_string_reg, s12, s0),
     ## CC
     (str_clear, s10),
     (try_begin),
       (eq, "$any_allies_at_the_last_battle", 1),
       (call_script, "script_print_casualties_to_s0", "p_ally_casualties", 0),
       (str_store_string, s10, "@^^Ally Casualties:{s0}"),
     (try_end),
     ],
    [
      ("continue",[],"Continue...",[(jump_to_menu, "$g_next_menu"),]),
    ]
  ),



  (
    "total_victory", 0,
    "You shouldn't be reading this... {s9}",
    "none",
    [
        # We exploit the menu condition system below.
        # The conditions should make sure that always another screen or menu is called.
        (assign, ":break", 0),
        (try_begin),
			(eq, "$routed_party_added", 0), #new
			(assign, "$routed_party_added", 1),

			#add new party to map (routed_warriors)
			(call_script, "script_add_routed_party"),
        (end_try),

		(try_begin),
			(check_quest_active, "qst_track_down_bandits"),
			(neg|check_quest_succeeded, "qst_track_down_bandits"),
			(neg|check_quest_failed, "qst_track_down_bandits"),

			(quest_get_slot, ":quest_party", "qst_track_down_bandits", slot_quest_target_party),
			(party_is_active, ":quest_party"),
			(party_get_attached_to, ":quest_party_attached"),
			(this_or_next|eq, ":quest_party", "$g_enemy_party"),
			(eq, ":quest_party_attached", "$g_enemy_party"),
			(call_script, "script_succeed_quest", "qst_track_down_bandits"),
		(try_end),

		(try_begin),
			(gt, "$g_private_battle_with_troop", 0),
			(troop_slot_eq, "$g_private_battle_with_troop", slot_troop_leaded_party, "$g_encountered_party"),
			(assign, "$g_private_battle_with_troop", 0),
			(assign, "$g_disable_condescending_comments", 1),
		(try_end),

		#new - begin
        (party_get_num_companion_stacks, ":num_stacks", "p_collective_enemy"),
        (try_for_range, ":i_stack", 0, ":num_stacks"),
			(party_stack_get_troop_id, ":stack_troop", "p_collective_enemy", ":i_stack"),
			(is_between, ":stack_troop", lords_begin, lords_end),
			(troop_is_wounded, ":stack_troop"),
			(party_add_members, "p_total_enemy_casualties", ":stack_troop", 1),
        (try_end),
        #new - end

        (try_begin),
          # Talk to ally leader
			(eq, "$thanked_by_ally_leader", 0),
			(assign, "$thanked_by_ally_leader", 1),

			(gt, "$g_ally_party", 0),
			(party_get_template_id,":ally_party_template","$g_ally_party"), #chief tempered puesto
          #	(store_add, ":total_str_without_player", "$g_starting_strength_ally_party", "$g_starting_strength_enemy_party"),

			(store_add, ":total_str_without_player", "$g_starting_strength_friends", "$g_starting_strength_enemy_party"),
			(val_sub, ":total_str_without_player", "$g_starting_strength_main_party"),

			(store_sub, ":ally_strength_without_player", "$g_starting_strength_friends", "$g_starting_strength_main_party"),

			(store_mul, ":ally_advantage", ":ally_strength_without_player", 100),
			(val_add, ":total_str_without_player", 1),
			(val_div, ":ally_advantage", ":total_str_without_player"),
          #Ally advantage=50  means battle was evenly matched

			(store_sub, ":enemy_advantage", 100, ":ally_advantage"),

			(store_mul, ":faction_reln_boost", ":enemy_advantage", "$g_starting_strength_enemy_party"),
			(val_div, ":faction_reln_boost", 3000),
			(val_min, ":faction_reln_boost", 4),

			(store_mul, "$g_relation_boost", ":enemy_advantage", ":enemy_advantage"),
			(val_div, "$g_relation_boost", 700),
			(val_clamp, "$g_relation_boost", 0, 20),

			(party_get_num_companion_stacks, ":num_ally_stacks", "$g_ally_party"),
			(gt, ":num_ally_stacks", 0),
			(store_faction_of_party, ":ally_faction","$g_ally_party"),

#TEMPERED chief CHANGES BEGIN FOR JOINING BATTLE WITH SKIRMISH PARTY
			(try_begin),
				(eq,"$skirmish_party_no","$g_ally_party"),
				(assign,"$g_relation_boost",0),
			(else_try),
				(neq,"$skirmish_party_no","$g_ally_party"),
				(neq,":ally_party_template","pt_village_farmers"),
				(call_script, "script_change_player_relation_with_faction", ":ally_faction", ":faction_reln_boost"),
			(try_end),
			(try_begin), #TEMPERED INCREASE RELATION WITH VILLAGE IF HELPING VILLAGE FARMERS
				(eq,":ally_party_template","pt_village_farmers"),
				(party_get_slot, ":village_no", "$g_ally_party", slot_party_home_center),
				(gt,"$g_relation_boost",0),
				(store_div,":commoner_trust_bonus","$g_relation_boost",2),
				(val_max,":commoner_trust_bonus",2),
				(call_script, "script_change_player_relation_with_center", ":village_no", ":commoner_trust_bonus"),
			(try_end),
#TEMPERED chief CHANGES END
#          	(call_script, "script_change_player_relation_with_faction", ":ally_faction", ":faction_reln_boost"), # sustituido por tempered chief
			(party_stack_get_troop_id, ":ally_leader", "$g_ally_party"),
			(party_stack_get_troop_dna, ":ally_leader_dna", "$g_ally_party", 0),
			(try_begin),
				(troop_is_hero, ":ally_leader"),
				(troop_get_slot, ":hero_relation", ":ally_leader", slot_troop_player_relation),
				(assign, ":rel_boost", "$g_relation_boost"),
				(try_begin),
					(lt, ":hero_relation", -5),
					(val_div, ":rel_boost", 3),
				(try_end),
				(call_script,"script_change_player_relation_with_troop", ":ally_leader", ":rel_boost"),
			(try_end),
         (neq, "$freelancer_state", 1), #+freelancer chief #prevents player in party from being thanked by allies
			(assign, "$talk_context", tc_ally_thanks),
			(call_script, "script_setup_troop_meeting", ":ally_leader", ":ally_leader_dna"),
        (else_try),
          # Talk to enemy leaders
         (neq, "$freelancer_state", 1), #+freelancer chief #prevents player in party from talking to enemy leaders
		(assign, ":break", 0),

			(party_get_num_companion_stacks, ":num_stacks", "p_total_enemy_casualties"), #p_encountered changed to total_enemy_casualties
			(try_for_range, ":stack_no", "$last_defeated_hero", ":num_stacks"), #May 31 bug note -- this now returns some heroes in victorious party as well as in the other party
            (eq, ":break", 0),
            (party_stack_get_troop_id, ":stack_troop", "p_total_enemy_casualties", ":stack_no"),
            (party_stack_get_troop_dna, ":stack_troop_dna", "p_total_enemy_casualties", ":stack_no"),

            (troop_is_hero, ":stack_troop"),

            (store_troop_faction, ":defeated_faction", ":stack_troop"),
            #steve post 0912 changes begin - removed, this is duplicated elsewhere in game menus
            #(call_script, "script_add_log_entry", logent_lord_defeated_by_player, "trp_player",  -1, ":stack_troop", ":defeated_faction"),
            (try_begin),
				(neq,"$duel_encounter",2),#TEMPERED chief ADDED CONDITION ALWAYS CAPTURE LORD AFTER DUEL ENCOUNTER TREACHERY
				(store_relation, ":relation", ":defeated_faction", "fac_player_faction"),
				(ge, ":relation", 0),
				(str_store_troop_name, s4, ":stack_troop"),

				(try_begin),
					(eq, "$cheat_mode", 1),
					(display_message, "@{!}{s4} skipped in p_total_enemy_casualties capture queue because is friendly"),
				(try_end),
			(else_try),
                (try_begin),
					(party_stack_get_troop_id, ":party_leader", "$g_encountered_party", 0),
					(is_between, ":party_leader", active_npcs_begin, active_npcs_end),
					(troop_slot_eq, ":party_leader", slot_troop_occupation, slto_kingdom_hero),
					(store_sub, ":kingdom_hero_id", ":party_leader", active_npcs_begin),
					(get_achievement_stat, ":was_he_defeated_player_before", ACHIEVEMENT_BARON_GOT_BACK, ":kingdom_hero_id"),
					(eq, ":was_he_defeated_player_before", 1),

					(unlock_achievement, ACHIEVEMENT_BARON_GOT_BACK),
				(try_end),

				(store_add, "$last_defeated_hero", ":stack_no", 1),
				(call_script, "script_remove_troop_from_prison", ":stack_troop"),
				(troop_set_slot, ":stack_troop", slot_troop_leaded_party, -1),

				(call_script, "script_cf_check_hero_can_escape_from_player", ":stack_troop"),

				(str_store_troop_name, s1, ":stack_troop"),
				(str_store_faction_name, s3, ":defeated_faction"),
				(str_store_string, s17, "@{s1} of {s3} managed to escape."),
				(display_log_message, "@{!}{s17}"),
				(jump_to_menu, "mnu_enemy_slipped_away"),
				(assign, ":break", 1),
			(else_try),
				(store_add, "$last_defeated_hero", ":stack_no", 1),
				(call_script, "script_remove_troop_from_prison", ":stack_troop"),
				(troop_set_slot, ":stack_troop", slot_troop_leaded_party, -1),

				(assign, "$talk_context", tc_hero_defeated),

				(call_script, "script_setup_troop_meeting", ":stack_troop", ":stack_troop_dna"),
				(assign, ":break", 1),
            (try_end),
            (try_end), #tempered add chief

			(eq, ":break", 1),
        (else_try),
          # Talk to freed heroes
         (neq, "$freelancer_state", 1), #+freelancer chief #prevents player in party from talking to freed heroes after battle
			(assign, ":break", 0),
			(party_get_num_prisoner_stacks, ":num_prisoner_stacks", "p_collective_enemy"),
			(try_for_range, ":stack_no", "$last_freed_hero", ":num_prisoner_stacks"),
				(eq, ":break", 0),
				(party_prisoner_stack_get_troop_id, ":stack_troop", "p_collective_enemy", ":stack_no"),
				(troop_is_hero, ":stack_troop"),
				(party_prisoner_stack_get_troop_dna, ":stack_troop_dna", "p_collective_enemy", ":stack_no"),
				(store_add, "$last_freed_hero", ":stack_no", 1),
				(assign, "$talk_context", tc_hero_freed),
				(call_script, "script_setup_troop_meeting", ":stack_troop", ":stack_troop_dna"),
				(assign, ":break", 1),
			(try_end),
			(eq, ":break", 1),
        (else_try),
			(eq, "$capture_screen_shown", 0),
			(assign, "$capture_screen_shown", 1),
			(party_clear, "p_temp_party"),
			(assign, "$g_move_heroes", 0),
			#(call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_collective_enemy"),

			#p_total_enemy_casualties deki yarali askerler p_temp_party'e prisoner olarak eklenecek.
			(call_script, "script_party_add_wounded_members_as_prisoners", "p_temp_party", "p_total_enemy_casualties"),

			(call_script, "script_party_add_party_prisoners", "p_temp_party", "p_collective_enemy"),
			(try_begin),
				(call_script, "script_party_calculate_strength", "p_collective_friends_backup",0),
				(assign,":total_initial_strength", reg(0)),
				(gt, ":total_initial_strength", 0),
				#(gt, "$g_ally_party", 0),
				(call_script, "script_party_calculate_strength", "p_main_party_backup",0),
				(assign,":player_party_initial_strength", reg(0)),
				# move ally_party_initial_strength/(player_party_initial_strength + ally_party_initial_strength) prisoners to ally party.
				# First we collect the share of prisoners of the ally party and distribute those among the allies.
				(store_sub, ":ally_party_initial_strength", ":total_initial_strength", ":player_party_initial_strength"),

				#(call_script, "script_party_calculate_strength", "p_ally_party_backup"),
				#(assign,":ally_party_initial_strength", reg(0)),
				#(store_add, ":total_initial_strength", ":player_party_initial_strength", ":ally_party_initial_strength"),
				(store_mul, ":ally_share", ":ally_party_initial_strength", 1000),
				(val_div, ":ally_share", ":total_initial_strength"),
				(assign, "$pin_number", ":ally_share"), #we send this as a parameter to the script.
				(party_clear, "p_temp_party_2"),
				(call_script, "script_move_members_with_ratio", "p_temp_party", "p_temp_party_2"),

				#TODO: This doesn't handle prisoners if our allies joined battle after us.
				(try_begin),
					(gt, "$g_ally_party", 0),
					(neq,"$g_ally_party","$skirmish_party_no"), #TEMPERED chief DONT GIVE RESCUED PRISONERS TO SKIRMISHERS
					(distribute_party_among_party_group, "p_temp_party_2", "$g_ally_party"),
				(try_end),
				#next if there's anything left, we'll open up the party exchange screen and offer them to the player.
			(try_end),
			(party_get_num_companions, ":num_rescued_prisoners", "p_temp_party"),
			(party_get_num_prisoners,  ":num_captured_enemies", "p_temp_party"),

			(store_add, ":total_capture_size", ":num_rescued_prisoners", ":num_captured_enemies"),
          (neq, "$freelancer_state", 1), #+freelancer chief #makes it so player can not have prisoners while in commanders party
			(gt, ":total_capture_size", 0),
			(change_screen_exchange_with_party, "p_temp_party"),
#MOTO chief rewrite

#TEMPERED chief LOOT WAGON CHANGES BEGIN to insert      prsnt_loot_choice
              (else_try),
                  #(eq, "$loot_screen_shown", 0),

                  #(assign, "$loot_screen_shown", 1),


                  (eq,"$loot_wagon_shown",0),
                  (assign,"$loot_wagon_shown",1),


                  (try_begin),
                      (gt, "$g_ally_party", 0),
                      (neq,"$g_ally_party","$skirmish_party_no"),      #TEMPERED chief DONT GIVE PRISONERS TO SKIRMISHERS
		    (neq,"$g_ally_party", spt_companion_raider), # chief DONT GIVE RESCUED PRISONERS TO mercenary_leader capitan mercenario
                      (call_script, "script_party_add_party",      "$g_ally_party", "p_temp_party"), #Add remaining prisoners to ally      TODO: FIX it.
                  (else_try),
                      (party_get_num_attached_parties,      ":num_quick_attachments", "p_main_party"),
                      (gt, ":num_quick_attachments", 0),
                      (party_get_attached_party_with_rank,      ":helper_party", "p_main_party", 0),
                      (call_script, "script_party_add_party",      ":helper_party", "p_temp_party"), #Add remaining prisoners to our      reinforcements
                  (try_end),

                           (try_begin),
                            (neq, "$freelancer_state", 1), #+freelancer chief #makes it so player can not get loot freelancer brytenwalda
                            (start_presentation,"prsnt_loot_choice"),
                        (else_try),
                            (eq, "$freelancer_state", 1), #+freelancer chief #makes it so player can not get loot freelancer brytenwalda
                            (start_presentation,"prsnt_loot_choice2"), #lo usamos para darle mas rol a freelancer
                            (try_end),
              (else_try),


                  (eq, "$loot_screen_shown", 0),
                  (assign, "$loot_screen_shown", 1),
      #TEMPERED  chief LOOT WAGON CHANGES END
                  (troop_clear_inventory, "trp_temp_troop"),
                  (call_script, "script_party_calculate_loot",      "p_total_enemy_casualties"), #p_encountered_party_backup changed      to total_enemy_casualties
                  (gt, reg0, 0),


                  (troop_sort_inventory, "trp_temp_troop"),
                  (change_screen_loot, "trp_temp_troop"),


    #MOTO rewrite end
        (else_try),
			#finished all
			(try_begin),
				(le, "$g_ally_party", 0),
				(end_current_battle),
			(try_end),
			(call_script, "script_party_give_xp_and_gold", "p_total_enemy_casualties"), #p_encountered_party_backup changed to total_enemy_casualties
			(try_begin),
				(eq, "$g_enemy_party", 0),
				(display_message,"str_error_string"),
			(try_end),

			(try_begin),
				(party_is_active, "$g_ally_party"),
				(call_script, "script_battle_political_consequences", "$g_enemy_party", "$g_ally_party"),
			(else_try),
				(call_script, "script_battle_political_consequences", "$g_enemy_party", "p_main_party"),
			(try_end),

			(call_script, "script_event_player_defeated_enemy_party", "$g_enemy_party"),
			(call_script, "script_clear_party_group", "$g_enemy_party"),
			(try_begin),
				(eq, "$g_next_menu", -1),

				#NPC companion changes begin
				(call_script, "script_post_battle_personality_clash_check"),
				#NPC companion changes end

				#Post 0907 changes begin
				(party_stack_get_troop_id, ":enemy_leader", "p_encountered_party_backup",0),
				(try_begin),
					(is_between, ":enemy_leader", active_npcs_begin, active_npcs_end),
					(neg|is_between, "$g_encountered_party", centers_begin, centers_end),
					(store_troop_faction, ":enemy_leader_faction", ":enemy_leader"),

					(try_begin),
						(eq, "$g_ally_party", 0),
						(call_script, "script_add_log_entry", logent_lord_defeated_by_player, "trp_player",  -1, ":enemy_leader", ":enemy_leader_faction"),
						(try_begin),
							(eq, "$cheat_mode", 1),
							(display_message, "@{!}Victory comment. Player was alone"),
						(try_end),
					(else_try),
						(ge, "$g_strength_contribution_of_player", 40),
						(call_script, "script_add_log_entry", logent_lord_defeated_by_player, "trp_player",  -1, ":enemy_leader", ":enemy_leader_faction"),
						(try_begin),
							(eq, "$cheat_mode", 1),
							(display_message, "@{!}Ordinary victory comment. The player provided at least 40 percent forces."),
						(try_end),
					(else_try),
						(gt, "$g_starting_strength_enemy_party", 1000),
						(call_script, "script_get_closest_center", "p_main_party"),
						(assign, ":battle_of_where", reg0),
						(call_script, "script_add_log_entry", logent_player_participated_in_major_battle, "trp_player",  ":battle_of_where", -1, ":enemy_leader_faction"),
						(try_begin),
							(eq, "$cheat_mode", 1),
							(display_message, "@{!}Player participation comment. The enemy had at least 1k starting strength."),
						(try_end),
					(else_try),
						(eq, "$cheat_mode", 1),
						(display_message, "@{!}No victory comment. The battle was small, and the player provided less than 40 percent of allied strength"),
					(try_end),
				(try_end),
				#Post 0907 changes end
				(val_add, "$g_total_victories", 1),
				(leave_encounter),
				(change_screen_return),
			(else_try),
                 (eq, "$freelancer_state", 0),  #+freelancer chief #prevents player's actions from having political consequences when freelancing
				(try_begin), #my kingdom
					##diplomacy chief begin
					(eq, "$g_next_menu", "mnu_dplmc_town_riot_removed"),
					(jump_to_menu, "$g_next_menu"),
				(else_try),
					##diplomacy chief end
					#(change_screen_return),
					(eq, "$g_next_menu", "mnu_castle_taken"),

					(call_script, "script_add_log_entry", logent_castle_captured_by_player, "trp_player", "$g_encountered_party", -1, "$g_encountered_party_faction"),
					(store_current_hours, ":hours"),
					(faction_set_slot, "$players_kingdom", slot_faction_ai_last_decisive_event, ":hours"),

				(try_begin), #player took a walled center while he is a vassal of npc kingdom.
					(is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
					(jump_to_menu, "$g_next_menu"),
				(else_try), #player took a walled center while he is a vassal of rebels.
					(eq, "$players_kingdom", "fac_player_supporters_faction"),
					(assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
					(neg|faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
					(faction_get_slot, ":faction_leader", "fac_player_supporters_faction", slot_faction_leader),
					(change_screen_return),
					(start_map_conversation, ":faction_leader", -1),
				(else_try), #player took a walled center for player's kingdom
					(neg|is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
					(assign, "$g_center_taken_by_player_faction", "$g_encountered_party"),
					(assign, "$talk_context", tc_give_center_to_fief),
					(change_screen_return),

					(assign, ":best_troop", "trp_swadian_sharpshooter"),
					(assign, ":maximum_troop_score", 0),

					(party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
					(try_for_range, ":stack_no", 0, ":num_stacks"),
					(party_stack_get_troop_id, ":stack_troop", "p_main_party", ":stack_no"),
					(neq, ":stack_troop", "trp_player"),

					(party_stack_get_size, ":stack_size", "p_main_party", ":stack_no"),
					(party_stack_get_num_wounded, ":num_wounded", "p_main_party", ":stack_no"),
					(troop_get_slot, ":num_routed", "p_main_party", slot_troop_player_routed_agents),

					(assign, ":continue", 0),
					(try_begin),
						(neg|troop_is_hero, ":stack_troop"),
						(store_add, ":agents_which_cannot_speak", ":num_wounded", ":num_routed"),
						(gt, ":stack_size", ":agents_which_cannot_speak"),
						(assign, ":continue", 1),
					(else_try),
						(troop_is_hero, ":stack_troop"),
						(neg|troop_is_wounded, ":stack_troop"),
						(assign, ":continue", 1),
					(try_end),
					(eq, ":continue", 1),

					(try_begin),
						(troop_is_hero, ":stack_troop"),
						(troop_get_slot, ":troop_renown", ":stack_troop", slot_troop_renown),
						(store_mul, ":troop_score", ":troop_renown", 100),
						(val_add, ":troop_score", 1000),
					(else_try),
						(store_character_level, ":troop_level", ":stack_troop"),
						(assign, ":troop_score", ":troop_level"),
					(try_end),

					(try_begin),
						(gt, ":troop_score", ":maximum_troop_score"),
						(assign, ":maximum_troop_score", ":troop_score"),
						(assign, ":best_troop", ":stack_troop"),
						(party_stack_get_troop_dna, ":best_troop_dna", "p_main_party", ":stack_no"),
					(try_end),
                (try_end),

                (start_map_conversation, ":best_troop", ":best_troop_dna"),
            (try_end),
		(try_end),
        (try_end),
        (try_end),
	],
    [
      ("continue",[],"Continue...",[]),
        ]
  ),



  (
    "enemy_slipped_away",0,
    "{s17}",
    "none",
    [],
    [
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_total_victory")]),
    ]
  ),

  (
    "total_defeat",0,
    "{!}You shouldn't be reading this...",
    "none",
    [
        (play_track, "track_captured", 1),
           # Free prisoners
          (party_get_num_prisoner_stacks, ":num_prisoner_stacks","p_main_party"),
          (try_for_range, ":stack_no", 0, ":num_prisoner_stacks"),
            (party_prisoner_stack_get_troop_id, ":stack_troop","p_main_party",":stack_no"),
            (troop_is_hero, ":stack_troop"),
            (call_script, "script_remove_troop_from_prison", ":stack_troop"),
          (try_end),

		  (try_begin),
		    (party_is_active, "$g_ally_party"),
			(call_script, "script_battle_political_consequences", "$g_ally_party", "$g_enemy_party"),
		  (else_try),
			(call_script, "script_battle_political_consequences", "p_main_party", "$g_enemy_party"),
		  (try_end),

          (call_script, "script_loot_player_items", "$g_enemy_party"),

          (assign, "$g_move_heroes", 0),
          (party_clear, "p_temp_party"),
          (call_script, "script_party_add_party_prisoners", "p_temp_party", "p_main_party"),
          (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_main_party"),
          (distribute_party_among_party_group, "p_temp_party", "$g_enemy_party"),

          (assign, "$g_prison_heroes", 1),
          (call_script, "script_party_remove_all_companions", "p_main_party"),
          (assign, "$g_prison_heroes", 0),
          (assign, "$g_move_heroes", 1),
          (call_script, "script_party_remove_all_prisoners", "p_main_party"),

          (val_add, "$g_total_defeats", 1),

          (try_begin),
            (neq, "$g_player_surrenders", 1),
            (store_random_in_range, ":random_no", 0, 100),
            (ge, ":random_no", "$g_player_luck"),
            (jump_to_menu, "mnu_permanent_damage"),
          (else_try),
            (try_begin),
              (eq, "$g_next_menu", -1),
              (leave_encounter),
              (change_screen_return),
            (else_try),
              (jump_to_menu, "$g_next_menu"),
            (try_end),
          (try_end),
          (try_begin),
            (gt, "$g_ally_party", 0),
            (call_script, "script_party_wound_all_members", "$g_ally_party"),
          (try_end),

#Troop commentary changes begin
          (party_get_num_companion_stacks, ":num_stacks", "p_encountered_party_backup"),
          (try_for_range, ":stack_no", 0, ":num_stacks"),
            (party_stack_get_troop_id,   ":stack_troop","p_encountered_party_backup",":stack_no"),
            (is_between, ":stack_troop", active_npcs_begin, active_npcs_end),
			(troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
            (store_troop_faction, ":victorious_faction", ":stack_troop"),
            (call_script, "script_add_log_entry", logent_player_defeated_by_lord, "trp_player",  -1, ":stack_troop", ":victorious_faction"),
          (try_end),
#Troop commentary changes end

      ],
    []
  ),

  (
    "permanent_damage",mnf_disable_all_keys,
    "{s0}",
    "none",
    [
      (assign, ":end_cond", 1),
      (try_for_range, ":unused", 0, ":end_cond"),
        (store_random_in_range, ":random_attribute", 0, 4),
        (store_attribute_level, ":attr_level", "trp_player", ":random_attribute"),
        (try_begin),
          (gt, ":attr_level", 3),
          (neq, ":random_attribute", ca_charisma),
          (try_begin),
            (eq, ":random_attribute", ca_strength),
            (str_store_string, s0, "@Some of your tendons have been damaged in the battle. You lose 1 strength."),
          (else_try),
            (eq, ":random_attribute", ca_agility),
            (str_store_string, s0, "@You took a nasty wound which will cause you to limp slightly even after it heals. You lose 1 agility."),
##          (else_try),
##            (eq, ":random_attribute", ca_charisma),
##            (str_store_string, s0, "@After the battle you are aghast to find that one of the terrible blows you suffered has left a deep, disfiguring scar on your face, horrifying those around you. Your charisma is reduced by 1."),
          (else_try),
##            (eq, ":random_attribute", ca_intelligence),
            (str_store_string, s0, "@You have trouble thinking straight after the battle, perhaps from a particularly hard hit to your head, and frequent headaches now plague your existence. Your intelligence is reduced by 1."),
          (try_end),
        (else_try),
          (lt, ":end_cond", 200),
          (val_add, ":end_cond", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":end_cond", 200),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      (else_try),
        (troop_raise_attribute, "trp_player", ":random_attribute", -1),
      (try_end),
      ],
    [
      ("s0",
       [
         (store_random_in_range, ":random_no", 0, 4),
         (try_begin),
           (eq, ":random_no", 0),
           (str_store_string, s0, "@Perhaps I'm getting unlucky..."),
         (else_try),
           (eq, ":random_no", 1),
           (str_store_string, s0, "@Retirement is starting to sound better and better."),
         (else_try),
           (eq, ":random_no", 2),
           (str_store_string, s0, "@No matter! I will persevere!"),
         (else_try),
           (eq, ":random_no", 3),
           (troop_get_type, ":is_female", "trp_player"),
         		   (val_mod, ":is_female", 2),	#gender fix chief moto
           (try_begin),
             (eq, ":is_female", 1),
             (str_store_string, s0, "@What did I do to deserve this?"),
           (else_try),
             (str_store_string, s0, "@I suppose it'll make for a good story, at least..."),
           (try_end),
         (try_end),
         ],
       "{s0}",
       [
         (try_begin),
           (eq, "$g_next_menu", -1),
           (leave_encounter),
           (change_screen_return),
         (else_try),
           (jump_to_menu, "$g_next_menu"),
         (try_end),
         ]),
      ]
  ),

  (
    "pre_join",0,
    "You come across a battle between {s2} and {s1}. You decide to...",
    "none",
    [
        (str_store_party_name, 1,"$g_encountered_party"),
        (str_store_party_name, 2,"$g_encountered_party_2"),
		#+Freelancer chief
          (eq, "$freelancer_state", 1),
		  (try_begin),
			(party_get_attached_to, ":attached", "$enlisted_party"),
			(this_or_next|eq, "$enlisted_party", "$g_encountered_party_2"), #added in order to automatically skip this menu
			(eq, ":attached", "$g_encountered_party_2"),
			(select_enemy, 0),
			(assign,"$g_enemy_party","$g_encountered_party"),
            (assign,"$g_ally_party","$g_encountered_party_2"),
		  (else_try),
		    (select_enemy, 1),
			(assign,"$g_enemy_party","$g_encountered_party_2"),
			(assign,"$g_ally_party","$g_encountered_party"),
		  (try_end),
          (jump_to_menu,"mnu_join_battle"),
		#+Freelancer
      ],
    [
      ("pre_join_help_attackers",[
          (store_faction_of_party, ":attacker_faction", "$g_encountered_party_2"),
          (store_relation, ":attacker_relation", ":attacker_faction", "fac_player_supporters_faction"),
          (store_faction_of_party, ":defender_faction", "$g_encountered_party"),
          (store_relation, ":defender_relation", ":defender_faction", "fac_player_supporters_faction"),
          (ge, ":attacker_relation", 0),
          (lt, ":defender_relation", 0),
          ],
          "Move in to help the {s2}.",[
              (select_enemy,0),
              (assign,"$g_enemy_party","$g_encountered_party"),
              (assign,"$g_ally_party","$g_encountered_party_2"),
              (jump_to_menu,"mnu_join_battle")]),
      ("pre_join_help_defenders",[
##          (store_faction_of_party, ":attacker_faction", "$g_encountered_party_2"), #chief puesto fuera
##          (store_relation, ":attacker_relation", ":attacker_faction", "fac_player_supporters_faction"),
##          (store_faction_of_party, ":defender_faction", "$g_encountered_party"),
##          (store_relation, ":defender_relation", ":defender_faction", "fac_player_supporters_faction"),
##          (ge, ":defender_relation", 0),
##          (lt, ":attacker_relation", 0), #chief puesto fuera acaba
          ],
          "Rush to the aid of the {s1}.",[
              (select_enemy,1),
              (assign,"$g_enemy_party","$g_encountered_party_2"),
              (assign,"$g_ally_party","$g_encountered_party"),
              (jump_to_menu,"mnu_join_battle")]),
      ("pre_join_leave",[],"Don't get involved.",[(leave_encounter),(change_screen_return)]),
    ]
  ),

  (
    "join_battle",0,
    "You are helping the {s2} against the {s1}. You have {reg10} troops fit for battle against the enemy's {reg11}.",
    "none",
    [
        (str_store_party_name, 1,"$g_enemy_party"),
        (str_store_party_name, 2,"$g_ally_party"),

        (call_script, "script_encounter_calculate_fit"),

        (try_begin),
          (eq, "$new_encounter", 1),
          (assign, "$new_encounter", 0),
		  #freelancer chief
		  (try_begin),
			(eq, "$freelancer_state", 1),
			(call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
		(str_store_party_name, 1,"$g_enemy_party"), #to prevent bug'd text from the above script (which also uses s1)
		  (try_end),
		  #freelancer end

          (call_script, "script_encounter_init_variables"),
        (else_try), #second or more turn
          (eq, "$g_leave_encounter",1),
          (change_screen_return),
        (try_end),

        (try_begin),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (assign, ":num_enemy_regulars_remaining", reg0),
          (assign, ":enemy_finished",0),
          (try_begin),
            (eq, "$g_battle_result", 1),

            (this_or_next|le, ":num_enemy_regulars_remaining", 0), #battle won
            (le, ":num_enemy_regulars_remaining",  "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (assign, ":enemy_finished",1),
          (else_try),
            (eq, "$g_engaged_enemy", 1),
            (le, "$g_enemy_fit_for_battle",0),
            (ge, "$g_friend_fit_for_battle",1),
            (assign, ":enemy_finished",1),
          (try_end),

          (this_or_next|eq, ":enemy_finished",1),
          (eq,"$g_enemy_surrenders",1),
          (assign, "$g_next_menu", -1),
          (jump_to_menu, "mnu_total_victory"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
          (assign, ":num_ally_regulars_remaining", reg0),
          (assign, ":battle_lost", 0),
          (try_begin),
            (eq, "$g_battle_result", -1),

            #(eq, ":num_ally_regulars_remaining", 0), #battle lost
            (le, ":num_ally_regulars_remaining",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

            (assign, ":battle_lost",1),
          (try_end),

          (this_or_next|eq, ":battle_lost",1),
          (eq,"$g_player_surrenders",1),
          (leave_encounter),
          (change_screen_return),
        (try_end),
      ],
    [
      ("join_attack",
      [
(party_get_current_terrain,":terrain","p_main_party"), #chief sea battles puesto
         (neq,":terrain",0), #chief sea battles puesto
          (neq,":terrain",7), #chief sea battles puesto
          (neq,":terrain",8), #chief sea battles puesto
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Charge the enemy.",
      [
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (assign, "$g_battle_result", 0),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (set_jump_mission,"mt_lead_charge"),
        (call_script, "script_setup_random_scene"),
        (assign, "$g_next_menu", "mnu_join_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]),
#chief empieza sea battles
            ("join_attack",[
                (party_get_current_terrain,":terrain","p_main_party"), #chief sea battles puesto
         (this_or_next|eq,":terrain",0), #chief sea battles puesto
         (this_or_next|eq,":terrain",7), #chief sea battles puesto
          (eq,":terrain",8), #chief sea battles puesto
#          (neq, "$encountered_party_hostile", 0),
           (neg|troop_is_wounded, "trp_player"),
##          (store_troop_health,reg(5),"trp_player"),
##          (ge,reg(5),20),
          ],
                            "Board the enemy",[
        (assign, "$g_joined_battle_to_help", 1),
                                (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
                                (assign, "$g_battle_result", 0),
                                (call_script, "script_calculate_renown_value"),
                                (call_script, "script_calculate_battle_advantage"),
                                (set_battle_advantage, reg0),
                                (set_party_battle_mode),
                                #sea battles chief
                                (store_random_in_range, ":scene_a_sea", 1,4),
                                 (try_begin),
                                #Adorno
					(eq, ":scene_a_sea", 1),
                                  (set_jump_mission,"mt_ship_battle2"),
                                 (try_begin),
                                   (val_add,reg10,reg11),
                                   (gt,reg10,60),
                                   (jump_to_scene, "scn_sea_4"),
                                 (else_try),
#                                   (val_add,reg10,reg11),
                                   (gt,reg10,30),
                                   (jump_to_scene, "scn_sea_3"),
                                 (else_try),
                                   (jump_to_scene, "scn_sea_1"),
                                (try_end),
                                   #Adorno end
                                 (else_try),
                                (set_jump_mission,"mt_ship_battle"),
                                (try_begin),
                                   (val_add,reg10,reg11),
                                   (gt,reg10,60),
                                   (jump_to_scene, "scn_sea"),
                                 (else_try),
                                   (val_add,reg10,reg11),
                                   (gt,reg10,30),
                                   (jump_to_scene, "scn_sea"),
                                 (else_try),
                                   (jump_to_scene, "scn_sea_2"),
                                   (end_try),
                                (try_end), #sea battles acaba chief
                                (assign, "$g_next_menu", "mnu_join_battle"),
                                (jump_to_menu, "mnu_battle_debrief"),
                                (change_screen_mission),
                                ]),
      #chief acaba sea battles

      ("join_order_attack",
      [
	    (neq, "$freelancer_state", 1),	#+freelancer chief
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 3),
      ],
      "Order your troops to attack with your allies while you stay back.",
      [
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (jump_to_menu,"mnu_join_order_attack"),
      ]),

#COOP chief Join battle#############################
      ("coop_setup",[
	    (neq, "$freelancer_state", 1),	#+freelancer chief
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
      ],"Setup multiplayer battle.",
      [
        (assign, "$coop_battle_type", coop_battle_type_field_battle),
        (assign, "$coop_encountered_party", "$g_enemy_party"),
        (call_script, "script_coop_copy_parties_to_file_sp"),
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit),
        (try_end),
      ]),

      ("quit_game_will_save",[
 	    (neq, "$freelancer_state", 1),	#+freelancer chief
       (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).",
      [
        (change_screen_quit),
      ]),

      ("coop_use_result",[
	    (neq, "$freelancer_state", 1),	#+freelancer chief
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.",
      [

        (call_script, "script_calculate_renown_value"),
        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),
      #change these for menu
        (assign, "$g_next_menu", "mnu_join_battle"),
        (assign, "$g_joined_battle_to_help", 1),
      ]),
##      ("encounter_save",[],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (leave_encounter),
##        (change_screen_return),
##        # (rest_for_hours, 1, 1, 0),#rest while not attackable
##
##      ]),

########################################## chief acaba

      ("join_leave",[],"Leave.",
      [
 	    (neq, "$freelancer_state", 1),	#+freelancer chief
       (try_begin),
           (neg|troop_is_wounded, "trp_player"),
           (call_script, "script_objectionable_action", tmt_aristocratic, "str_flee_battle"),
           (party_stack_get_troop_id, ":enemy_leader","$g_enemy_party",0),
		   (is_between, ":enemy_leader", active_npcs_begin, active_npcs_end),
           (call_script, "script_add_log_entry", logent_player_retreated_from_lord, "trp_player",  -1, ":enemy_leader", -1),
           (display_message, "@Player retreats from battle."), #chief anadido
        (try_end),

        (leave_encounter),(change_screen_return)]),
	#+freelancer chief
	("join_wounded",[
	  (eq, "$freelancer_state", 1),
	  (troop_is_wounded, "trp_player"),
	  ],
	  "You are too wounded to fight.",[(leave_encounter),(change_screen_map)]),
	#+freelancer end
      ]),

  (
    "join_order_attack",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
      (assign, ":player_party_strength", reg0),
      (val_div, ":player_party_strength", 5),
      (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
      (assign, ":friend_party_strength", reg0),
      (val_div, ":friend_party_strength", 5),

      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":enemy_party_strength", reg0),
      (val_div, ":enemy_party_strength", 5),

      (try_begin),
        (eq, ":friend_party_strength", 0),
        (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
      (else_try),
        (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
        (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
        (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
      (try_end),

      (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
      (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),

      (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),

      #ozan begin
      (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
      (try_for_range, ":stack_no", 0, ":num_stacks"),
        (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
        (try_begin),
          (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_size", 0),
          (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
          (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
          (gt, ":stack_wounded_size", 0),
          (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
        (try_end),
      (try_end),
      #ozan end

      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),

      (call_script, "script_collect_friendly_parties"),
      #(party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),

      (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

       #(assign, "$cant_leave_encounter", 0),
       (assign, "$no_soldiers_left", 0),
       (try_begin),
         (call_script, "script_party_count_members_with_full_health","p_main_party"),
         (assign, ":num_our_regulars_remaining", reg0),

         #(le, ":num_our_regulars_remaining", 0),
         (le, ":num_our_regulars_remaining", "$num_routed_us"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

         (assign, "$no_soldiers_left", 1),
         (str_store_string, s4, "str_join_order_attack_failure"),
       (else_try),
         (call_script, "script_party_count_members_with_full_health","p_collective_enemy"),
         (assign, ":num_enemy_regulars_remaining", reg0),

         (this_or_next|le, ":num_enemy_regulars_remaining", 0),
         (le, ":num_enemy_regulars_remaining", "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.

         (assign, "$g_battle_result", 1),
         (assign, "$no_soldiers_left", 1),
         (str_store_string, s4, "str_join_order_attack_success"),
       (else_try),
         (str_store_string, s4, "str_join_order_attack_continue"),
       (try_end),
    ],
    [
      ("continue",[],"Continue...",
      [
        (jump_to_menu,"mnu_join_battle"),
      ]),
    ]
  ),


# Towns
  (
    "zendar",mnf_auto_enter,
    "You enter the town of Zendar.",
    "none",
    [(reset_price_rates,0),(set_price_rate_for_item,"itm_tools",70),(set_price_rate_for_item,"itm_salt",140)],
    [
      ("zendar_enter",[],"_",[(set_jump_mission,"mt_town_default"),(jump_to_scene,"scn_zendar_center"),(change_screen_mission)],"Door to the town center."),
      ("zendar_tavern",[],"_",[(set_jump_mission,"mt_town_default"),
                                                   (jump_to_scene,"scn_the_happy_boar"),
                                                   (change_screen_mission)],"Door to the tavern."),
      ("zendar_merchant",[],"_",[(set_jump_mission,"mt_town_default"),
                                                   (jump_to_scene,"scn_zendar_merchant"),
                                                   (change_screen_mission)],"Door to the merchant."),
      ("zendar_arena",[],"_",[(set_jump_mission,"mt_town_default"),
                                                   (jump_to_scene,"scn_zendar_arena"),
                                                   (change_screen_mission)],"Door to the arena."),
#      ("zendar_leave",[],"Leave town.",[[leave_encounter],[change_screen_return]]),
      ("town_1_leave",[],"_",[(leave_encounter),(change_screen_return)]),
    ]
  ),
#salt mine cambiado chief
  (
    "salt_mine",mnf_enable_hot_keys,
    "You arrive at a small mining camp.",
    "none",
    [(reset_price_rates,0),(set_price_rate_for_item,"itm_salt",155)],
    [
      ("enter",[],"Wander around the camp.",[(call_script, "script_count_mission_casualties_from_agents"),(set_jump_mission,"mt_town_center"),(jump_to_scene,"scn_salt_mine"),(change_screen_mission)],"Exit to the camp."),
      ("talk_merchant",[]
          ,"Talk to the Mine Merchant.",
          [
              (assign, "$talk_context", 0),
			  (assign, ":override_state", af_override_horse),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 0, ":override_state"),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 2, ":override_state"),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 3, ":override_state"),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 4, ":override_state"),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 5, ":override_state"),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 6, ":override_state"),
              (mission_tpl_entry_set_override_flags, "mt_town_center", 7, ":override_state"),
              (jump_to_scene, "scn_salt_mine"),
              (change_screen_map_conversation, "trp_salt_mine_merchant"),
           ],"Exit to the camp."),
      ("work_mines",
       [
           (store_troop_health, "$g_player_health","trp_player", 1),
		   (str_clear, s1),
           (party_get_num_companions, ":num_men", "p_main_party"),
           (store_mul, reg1, ":num_men", 4),
           (val_add, reg1, 1),
           (str_store_string, s1, "@ ({reg1} scillingas per day)"),
        ],
         "Volunteer to work in the mines{s1}.",
         [
           (try_begin),
		     (neg|gt, "$g_player_health", 50),
			 (display_message, "@You are in no condition to work."),
			 (jump_to_menu,"mnu_salt_mine"),
		   (else_try),
		     (assign, "$g_is_working", 1),
		     (assign, "$g_last_rest_payment_until", -1),
             (rest_for_hours, 8, 5, 1), #rest while attackable
             (change_screen_return),
             (try_begin),
               (eq, "$g_is_working", 1),
               (neg|map_free),
               (store_current_hours, ":cur_hours"),
               (ge, ":cur_hours", "$g_last_rest_payment_until"),
               (store_add, "$g_last_rest_payment_until", ":cur_hours", 8),
               (party_get_num_companions, ":num_men", "p_main_party"),
               (store_mul, ":total_pay", ":num_men", 4),
               (val_add, ":total_pay", 1),
               (display_message, "@You are paid for your labor."),
               (troop_add_gold, "trp_player", ":total_pay"),
	           (call_script, "script_mine_work"),
	           (assign, "$g_is_working", 0),
	         (try_end),
		   (try_end),
          ]),
      ("add_prisoners",
       [
		   (str_clear, s1),
		   (party_get_num_prisoners, "$g_num_prisoners", "p_salt_mine"),
		   (assign, reg1, "$g_num_prisoners"),
           (str_store_string, s1, "@ (Currently {reg1} prisoners working)"),
        ],
         "Put prisoners to work in the mines{s1}.",
         [
     (call_script, "script_change_player_honor", -2),
          (change_screen_exchange_members, 0),
          ]),
      ("add_guards",
       [
		   (str_clear, s1),
		   (party_get_num_companions, "$g_num_guards", "p_salt_mine"),
		   (assign, reg1, "$g_num_guards"),
           (str_store_string, s1, "@ (Currently {reg1} guards on duty)"),
    (call_script, "script_change_player_party_morale", -2),
        ],
         "Station guards to watch over prisoners{s1}.",
         [

           (change_screen_exchange_members, 1),
          ]),
      ("enter",[],"_",[(call_script, "script_count_mission_casualties_from_agents"),(set_jump_mission,"mt_town_center"),(jump_to_scene,"scn_salt_mine"),(change_screen_mission)],"Exit to the Salt Mine camp."),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),


  (
    "slave_labor",mnf_disable_all_keys,
    "{s1}",
    "none",
    [
          (str_clear, s1),
		  (assign, reg1, "$g_earnings"),
          (troop_add_gold, "trp_player", "$g_earnings"),
		  (try_begin),
		    (gt, "$g_num_escapees", 0),
			(str_store_string, s1, "@Some of the prisoners you have working in the salt mine managed to escape.^The remaining prisoners earned you {reg1} scillingas this week."),
		  (else_try),
		    (str_store_string, s1, "@The prisoners you have working in the salt mine earned you {reg1} scillingas this week."),
		  (try_end),
      ],
    [
      ("continue",[], "Continue...",
       [
           (change_screen_return),
        ]),
    ],
  ),
#sal mine cambiado chief
##  #iron mine anadido en ireland chief
##    (
##    "iron_mine",mnf_enable_hot_keys,
##    "You arrive at a small iron mining camp.",
##    "none",
##    [(reset_price_rates,0),(set_price_rate_for_item,"itm_iron",155)],
##    [
##      ("enter",[],"Wander around the camp.",[(call_script, "script_count_mission_casualties_from_agents"),(set_jump_mission,"mt_town_center"),(jump_to_scene,"scn_iron_mine"),(change_screen_mission)],"Exit to the camp."),
##      ("talk_merchant",[]
##          ,"Talk to the Mine Merchant.",
##          [
##              (assign, "$talk_context", 0),
##			  (assign, ":override_state", af_override_horse),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 0, ":override_state"),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 2, ":override_state"),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 3, ":override_state"),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 4, ":override_state"),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 5, ":override_state"),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 6, ":override_state"),
##              (mission_tpl_entry_set_override_flags, "mt_town_center", 7, ":override_state"),
##              (jump_to_scene, "scn_iron_mine"),
##              (change_screen_map_conversation, "trp_iron_mine_merchant"),
##           ],"Exit to the camp."),
##      ("work_mines",
##       [
##           (store_troop_health, "$g_player_health","trp_player", 1),
##		   (str_clear, s1),
##           (party_get_num_companions, ":num_men", "p_main_party"),
##           (store_mul, reg1, ":num_men", 4),
##           (val_add, reg1, 1),
##           (str_store_string, s1, "@ ({reg1} scillingas per day)"),
##        ],
##         "Volunteer to work in the mines{s1}.",
##         [
##           (try_begin),
##		     (neg|gt, "$g_player_health", 50),
##			 (display_message, "@You are in no condition to work."),
##			 (jump_to_menu,"mnu_iron_mine"),
##		   (else_try),
##		     (assign, "$g_is_working", 1),
##		     (assign, "$g_last_rest_payment_until", -1),
##             (rest_for_hours, 8, 5, 1), #rest while attackable
##             (change_screen_return),
##             (try_begin),
##               (eq, "$g_is_working", 1),
##               (neg|map_free),
##               (store_current_hours, ":cur_hours"),
##               (ge, ":cur_hours", "$g_last_rest_payment_until"),
##               (store_add, "$g_last_rest_payment_until", ":cur_hours", 8),
##               (party_get_num_companions, ":num_men", "p_main_party"),
##               (store_mul, ":total_pay", ":num_men", 4),
##               (val_add, ":total_pay", 1),
##               (display_message, "@You are paid for your labor."),
##               (troop_add_gold, "trp_player", ":total_pay"),
##	           (call_script, "script_mine_work"),
##	           (assign, "$g_is_working", 0),
##	         (try_end),
##		   (try_end),
##          ]),
##      ("add_prisoners",
##       [
##		   (str_clear, s1),
##		   (party_get_num_prisoners, "$g_num_prisoners2", "p_iron_mine"),
##		   (assign, reg1, "$g_num_prisoners2"),
##           (str_store_string, s1, "@ (Currently {reg1} prisoners working)"),
##        ],
##         "Put prisoners to work in the mines{s1}.",
##         [
##     (call_script, "script_change_player_honor", -2),
##
##          (change_screen_exchange_members, 0),
##          ]),
##      ("add_guards",
##       [
##		   (str_clear, s1),
##		   (party_get_num_companions, "$g_num_guards2", "p_iron_mine"),
##		   (assign, reg1, "$g_num_guards2"),
##           (str_store_string, s1, "@ (Currently {reg1} guards on duty)"),
##        ],
##         "Station guards to watch over prisoners{s1}.",
##         [
##    (call_script, "script_change_player_party_morale", -2),
##
##           (change_screen_exchange_members, 1),
##          ]),
##      ("enter",[],"_",[(call_script, "script_count_mission_casualties_from_agents"),(set_jump_mission,"mt_town_center"),(jump_to_scene,"scn_iron_mine"),(change_screen_mission)],"Exit to the Iron Mine camp."),
##      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
##    ]
##  ),
##
##  (
##    "slave_labor2",mnf_disable_all_keys,
##    "{s1}",
##    "none",
##    [
##          (str_clear, s1),
##		  (assign, reg1, "$g_earnings"),
##          (troop_add_gold, "trp_player", "$g_earnings"),
##		  (try_begin),
##		    (gt, "$g_num_escapees", 0),
##			(str_store_string, s1, "@Some of the prisoners you have working in the iron mine managed to escape.^The remaining prisoners earned you {reg1} scillingas this week."),
##		  (else_try),
##		    (str_store_string, s1, "@The prisoners you have working in the iron mine earned you {reg1} scillingas this week."),
##		  (try_end),
##      ],
##    [
##      ("continue",[], "Continue...",
##       [
##           (change_screen_return),
##        ]),
##    ],
##  ),
##
###iron miner acaba chief
  (
    "four_ways_inn",mnf_auto_enter,
    "You arrive at the Four Ways Inn.",
    "none",
    [],
    [

#      ("enter",[],"Enter.",[[set_jump_mission,"mt_town_default"],[jump_to_scene,"scn_conversation_scene"],[change_screen_mission]]),
      ("enter",[],"Enter.",[(set_jump_mission,"mt_ai_training"),(jump_to_scene,"scn_four_ways_inn"),(change_screen_mission)]),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),
#chief anade escenas Sot
          (
    "celidon_forest",0,
    "You arrive at Ancient Stone Circle, home of the last Druids.",
    "none",
    [
        ],
    [
#      ("enter",[],"Enter.",[[set_jump_mission,"mt_town_default"],[jump_to_scene,"scn_conversation_scene"],[change_screen_mission]]),
      ("enter",[],"Enter.",[
                  (set_jump_mission,"mt_stone_circle"),
      (modify_visitors_at_site,"scn_celidon_forest"),
                  (reset_visitors),
	  (try_begin),
        (gt,"trp_manhunterdruid", 0),
        (assign,reg(0),"trp_farmerdruid"),
        (assign,reg(1),"trp_manhunterdruid"),
        (assign,reg(2),"trp_peasant_womandruid"),
        (assign,reg(3),"trp_refugeedruid"),
      (else_try),
        (assign,reg(0),"trp_farmerdruid"),
        (assign,reg(1),"trp_manhunterdruid"),
        (assign,reg(2),"trp_peasant_womandruid"),
        (assign,reg(3),"trp_refugeedruid"),
      (try_end),
#      (shuffle_range,0,4),
      (set_visitor,1,reg(3)),
      (set_visitor,2,reg(1)),
      (set_visitor,3,reg(2)),
      (set_visitor,4,reg(3)),
	  (set_visitor,5,reg(0)),
	  (set_visitor,6,"trp_farmerdruid"),
	  (set_visitor,7,"trp_farmerdruid"),
	  (set_visitor,8,reg(3)),
	  (set_visitor,9,reg(0)),
	  (set_visitor,10,reg(1)),
	  (set_visitor,11,reg(2)),
	  (set_visitor,12,reg(3)),
	  (set_visitor,13,"trp_peasant_womandruid"),
	  (set_visitor,14,"trp_farmerdruid"),
	  (set_visitor,15,reg(2)),
	  (set_visitor,16,"trp_taiga_bandit"),
	  (set_visitor,17,"trp_forest_bandit_hero"), #druida chief
	  (set_visitor,18,"trp_prisionerdruid"),
	  (set_visitor,19,reg(0)),
	  (set_visitor,20,reg(1)),
	  (set_visitor,21,reg(2)),
	  (set_visitor,22,reg(3)),
	  (set_visitor,23,"trp_farmerdruid"),
	  (set_visitor,24,reg(0)),
	  (set_visitor,25,"trp_refugeedruid"),
	  (set_visitor,26,"trp_refugeedruid"),
	  (set_visitor,27,"trp_farmerdruid"),
	  (set_visitor,28,"trp_manhunterdruid"),
	  (set_visitor,29,"trp_peasant_womandruid"),
	  (set_visitor,30,"trp_peasant_womandruid"),
	  (set_visitor,31,reg(2)),
	  (set_visitor,32,reg(3)),
	  (set_visitor,33,"trp_manhunterdruid"),
	  (set_visitor,34,reg(2)),
	  (set_visitor,35,reg(2)),
	  (set_visitor,36,"trp_manhunterdruid"),
	  (set_visitor,37,reg(2)),
	  (set_visitor,38,reg(3)),
	  (set_visitor,39,reg(0)),
	  (set_visitor,40,reg(1)),
      (set_jump_entry, 0),
	  (scene_set_slot, "scn_celidon_forest", slot_scene_visited, 1),

                 (jump_to_scene,"scn_celidon_forest"),
               (change_screen_mission),
]),

      ("service_recruit",
       [
         (eq, "$reclutar_puede_refuges", 0),
   ],
       "Ask if refugees wants to join you.",
   [
          (store_random_in_range, ":rand", 0, 8),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_refugee_recruit_troops1"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_refugee_recruit_troops3"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_refugee_recruit_troops1"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_refugee_recruit_troops4"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_refugee_recruit_troops4"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_refugee_recruit_troops2"),
                                          (else_try),
                                            (eq, ":rand", 6),
       (jump_to_menu,"mnu_refugee_recruit_troops2"),
                                          (else_try),
                                            (eq, ":rand", 7),
       (jump_to_menu,"mnu_refugee_recruit_troops3"),
          (try_end),
        ]),

      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),


    (
        "hidden_valley",0,
        "You arrive at a rare place... which seems to be Roman ruins.",
        "none",
        [
            ],
        [
            ("enter",[(eq,"$g_historia2",0),],"Approach.",
             [
                  (set_jump_mission,"mt_dungeon_romanbath"),
      (modify_visitors_at_site,"scn_hidden_valley"),
                  (reset_visitors),
	  (try_begin),
        (gt,"trp_manhunter", 0),
        (assign,reg(0),"trp_slave_hunter"),
        (assign,reg(1),"trp_slave_crusher"),
        (assign,reg(2),"trp_taiga_bandit"),
        (assign,reg(3),"trp_manhunter"),
      (else_try),
        (assign,reg(0),"trp_rhodok_deserter"),
        (assign,reg(1),"trp_slave_hunter"),
        (assign,reg(2),"trp_manhunter"),
        (assign,reg(3),"trp_slave_driver"),
      (try_end),
      (shuffle_range,0,4),
      (set_visitor,1,reg(0)),
      (set_visitor,2,reg(1)),
      (set_visitor,3,reg(2)),
      (set_visitor,4,reg(3)),
	  (set_visitor,5,reg(0)),
	  (set_visitor,6,"trp_slave_crusher"),
	  (set_visitor,7,"trp_slave_crusher"),
	  (set_visitor,8,reg(3)),
	  (set_visitor,9,reg(0)),
	  (set_visitor,10,reg(1)),
	  (set_visitor,11,reg(2)),
	  (set_visitor,12,reg(3)),
	  (set_visitor,13,"trp_slave_crusher"),
	  (set_visitor,14,"trp_sea_raider"),
	  (set_visitor,15,reg(2)),
	  (set_visitor,16,"trp_slaver_chief"),
	  (set_visitor,17,reg(2)),
	  (set_visitor,18,reg(3)),
	  (set_visitor,19,reg(0)),
	  (set_visitor,20,reg(1)),
	  (set_visitor,21,reg(2)),
	  (set_visitor,22,reg(3)),
	  (set_visitor,23,"trp_desert_bandit_hero"),
	  (set_visitor,24,reg(0)),
	  (set_visitor,25,"trp_refugeeromanruins"),
	  (set_visitor,26,"trp_refugeeromanruins"),
	  (set_visitor,27,"trp_refugeeromanruins"),
	  (set_visitor,28,"trp_peasant_womanromanruins"),
	  (set_visitor,29,"trp_peasant_womanromanruins"),
	  (set_visitor,30,"trp_peasant_womanromanruins"),
      (set_jump_entry, 0),
	  (scene_set_slot, "scn_hidden_valley", slot_scene_visited, 1),

#		 (display_message,"@It's cold and smells old, taking you back to another time... a time when Rome ruled the world, and men knew how to construct huge stone buildings with several storeys.",color_good_news),

                 (jump_to_scene,"scn_hidden_valley"),
               (change_screen_mission),
               ]),
                 ("leave",[],"Leave...",
       [(change_screen_map),
        ]),
    ],
  ),
###cueva odin
      (
        "cueva_odin",0,
        "You arrive at a cave...",
        "none",
        [
            ],
        [
            ("enter",[(eq,"$g_historia21",0),],"Approach.",
             [
                  (set_jump_mission,"mt_cueva_odin"),
      (modify_visitors_at_site,"scn_odin_cave"),
                  (reset_visitors),
	  (try_begin),
        (gt,"trp_manhunter", 0),
        (assign,reg(0),"trp_slave_hunter"),
        (assign,reg(1),"trp_slave_crusher"),
        (assign,reg(2),"trp_taiga_bandit"),
        (assign,reg(3),"trp_manhunter"),
      (else_try),
        (assign,reg(0),"trp_rhodok_deserter"),
        (assign,reg(1),"trp_taiga_bandit"),
        (assign,reg(2),"trp_manhunter"),
        (assign,reg(3),"trp_khergit_deserter"),
      (try_end),
      (shuffle_range,0,4),
      (set_visitor,1,reg(0)),
      (set_visitor,2,reg(1)),
      (set_visitor,3,reg(2)),
      (set_visitor,4,reg(3)),
	  (set_visitor,5,reg(0)),
	  (set_visitor,6,"trp_pict_woman"),
	  (set_visitor,7,"trp_khergit_veteran_horse_archer"),
	  (set_visitor,8,reg(3)),
	  (set_visitor,9,reg(0)),
	  (set_visitor,10,reg(1)),
	  (set_visitor,11,reg(2)),
	  (set_visitor,12,reg(3)),
	  (set_visitor,13,"trp_picti_bruide"),
	  (set_visitor,14,"trp_sea_raider"),
	  (set_visitor,15,reg(2)),
	  (set_visitor,16,"trp_sea_raider_leader2"),
	  (set_visitor,17,"trp_desert_bandit_hero"),
	  (set_visitor,18,reg(3)),
	  (set_visitor,19,reg(0)),
	  (set_visitor,20,reg(1)),

	  (set_visitor,21,"trp_refugeeromanruins"),
	  (set_visitor,22,"trp_refugeeromanruins"),
	  (set_visitor,23,"trp_peasant_womanromanruins"),
	  (set_visitor,24,"trp_peasant_womanromanruins"),
      (set_jump_entry, 0),
	  (scene_set_slot, "scn_odin_cave", slot_scene_visited, 1),

#		 (display_message,"@It's cold and smells old, taking you back to another time... a time when Rome ruled the world, and men knew how to construct huge stone buildings with several storeys.",color_good_news),

                 (jump_to_scene,"scn_odin_cave"),
               (change_screen_mission),
               ]),
                 ("leave",[],"Leave...",
       [(change_screen_map),
        ]),
    ],
  ),
##cueva odin acaba chief
        (
        "iniau_hideout",0,
        "You arrive at the deep forest.",
        "none",
        [
            ],
        [
            ("enter",[(eq,"$g_hero_result",0),],"Approach.",
             [    (modify_visitors_at_site,"scn_iniau_hideout"),
                  (reset_visitors,0),
	          (set_visitors,1,"trp_sea_raider_leader",1),
                 (set_jump_mission,"mt_assasination_cummoc"),
                 (jump_to_scene,"scn_iniau_hideout"),
               (change_screen_mission),
               ]),
                 ("leave",[],"Leave...",
       [(change_screen_map),
        ]),
    ],
  ),

  (
    "hadrian_wall1",0,
    "You arrive at the Hadrian Wall Ruins.",
    "none",
    [],
    [

      ("enter",[],"Enter.",[
                  (set_jump_mission,"mt_hadrian_place"),
      (modify_visitors_at_site,"scn_hadrian_wall1"),
                  (reset_visitors),
	  (set_visitor,16,"trp_refugeedruid"), #old roman chief
	  (set_visitor,17,"trp_sea_raider_hero"), #old roman chief
	  (set_visitor,18,"trp_farmerdruid"), #old roman chief
	  (set_visitor,19,"trp_farmerdruid"), #old roman chief
	  (set_visitor,20,"trp_refugeedruid"), #old roman chief
      (set_jump_entry, 0),
	  (scene_set_slot, "scn_hadrian_wall1", slot_scene_visited, 1),

                 (jump_to_scene,"scn_hadrian_wall1"),
               (change_screen_mission),
]),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),

#chief sot escenas acaba
#scene quarry chief
          (
    "quarry1",0,
    "You arrive at quarry, where freemen are working.",
    "none",
    [
        ],
    [
#      ("enter",[],"Enter.",[[set_jump_mission,"mt_town_default"],[jump_to_scene,"scn_conversation_scene"],[change_screen_mission]]),
      ("enter",[],"Enter.",[
                  (set_jump_mission,"mt_quarry_place"),
      (modify_visitors_at_site,"scn_quarry1"),
                  (reset_visitors),
	  (try_begin),
        (gt,"trp_quarry_trabajador", 0),
        (assign,reg(0),"trp_quarry_trabajador"),
        (assign,reg(1),"trp_quarry_trabajador"),
        (assign,reg(2),"trp_quarry_trabajador"),
        (assign,reg(3),"trp_quarry_trabajador"),
      (else_try),
        (assign,reg(0),"trp_quarry_trabajador"),
        (assign,reg(1),"trp_quarry_trabajador"),
        (assign,reg(2),"trp_quarry_trabajador"),
        (assign,reg(3),"trp_quarry_trabajador"),
      (try_end),
      (shuffle_range,0,4),
      (set_visitor,1,reg(3)),
      (set_visitor,2,reg(1)),
      (set_visitor,3,reg(2)),
      (set_visitor,4,reg(3)),
	  (set_visitor,5,reg(0)),
	  (set_visitor,6,"trp_quarry_trabajador"),
	  (set_visitor,7,"trp_quarry_trabajador"),
	  (set_visitor,8,reg(3)),
	  (set_visitor,9,reg(0)),
	  (set_visitor,10,reg(1)),
	  (set_visitor,11,reg(2)),
	  (set_visitor,12,reg(3)),
	  (set_visitor,13,"trp_quarry_trabajador"),
	  (set_visitor,14,"trp_quarry_trabajador"),
	  (set_visitor,15,reg(2)),
	  (set_visitor,16,"trp_quarry_trabajador"),
	  (set_visitor,17,"trp_quarry_capataz"), #druida chief
	  (set_visitor,18,"trp_quarry_trabajador"),
	  (set_visitor,19,reg(0)),
	  (set_visitor,20,reg(1)),
	  (set_visitor,21,reg(2)),
	  (set_visitor,22,reg(3)),
	  (set_visitor,23,"trp_quarry_trabajador"),
	  (set_visitor,24,reg(0)),
	  (set_visitor,25,"trp_quarry_trabajador"),
	  (set_visitor,26,"trp_quarry_trabajador"),
	  (set_visitor,27,"trp_quarry_trabajador"),
	  (set_visitor,28,"trp_quarry_trabajador"),
	  (set_visitor,29,"trp_quarry_trabajador"),
	  (set_visitor,30,"trp_quarry_trabajador"),
	  (set_visitor,31,reg(2)),
	  (set_visitor,32,reg(3)),
	  (set_visitor,33,"trp_quarry_trabajador"),
	  (set_visitor,34,reg(2)),
	  (set_visitor,35,reg(2)),
	  (set_visitor,36,"trp_quarry_trabajador"),
	  (set_visitor,37,reg(2)),
	  (set_visitor,38,reg(3)),
	  (set_visitor,39,reg(0)),
	  (set_visitor,40,reg(1)),
      (set_jump_entry, 0),
	  (scene_set_slot, "scn_quarry1", slot_scene_visited, 1),

#		 (display_message,"@ The rattle of spikes on the stone is deafening. Below, you can see people working hard under the command of a foreman.",color_good_news),

                 (jump_to_scene,"scn_quarry1"),
               (change_screen_mission),
]),

      ("work_quarry",
       [
           (store_troop_health, "$g_player_health","trp_player", 1),
		   (str_clear, s1),
           (party_get_num_companions, ":num_men", "p_main_party"),
           (store_mul, reg1, ":num_men", 4),
           (val_add, reg1, 1),
           (str_store_string, s1, "@ ({reg1} scillingas per day)"),
        ],
         "I wish work in the quarry{s1}.",
         [
           (try_begin),
		     (neg|gt, "$g_player_health", 50),
			 (display_message, "@You are in no condition to work."),
			 (jump_to_menu,"mnu_quarry1"),
		   (else_try),
		     (assign, "$g_is_working", 1),
		     (assign, "$g_last_rest_payment_until", -1),
             (rest_for_hours, 8, 5, 1), #rest while attackable
             (change_screen_return),
             (try_begin),
               (eq, "$g_is_working", 1),
               (neg|map_free),
               (store_current_hours, ":cur_hours"),
               (ge, ":cur_hours", "$g_last_rest_payment_until"),
               (store_add, "$g_last_rest_payment_until", ":cur_hours", 8),
               (party_get_num_companions, ":num_men", "p_main_party"),
               (store_mul, ":total_pay", ":num_men", 4),
               (val_add, ":total_pay", 1),
               (display_message, "@You are paid for your labor."),
               (troop_add_gold, "trp_player", ":total_pay"),
	           (call_script, "script_mine_work2"),
	           (assign, "$g_is_working", 0),
	         (try_end),
		   (try_end),
          ]),

      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),
#quarry finish chief
####monasterios chief empieza
        (
    "monasterio_visit",0,
    "You arrive at a Monastery. The place stretches out wide, with a church, rooms for the monks and their servants, and large gardens with livestock pens. This place certainly treasure wealth.",
    "none",
    [
(try_begin),
        (party_slot_eq, "$g_encountered_party", slot_saqueo_state, 1),
          (jump_to_menu, "mnu_saqueo_loot_continue"),
      (try_end),
        ],
    [
      ("enter",[
           (eq,"$town_nighttime",0),
          (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
],"Visit the monastery.",[
           (try_begin),
             (this_or_next|eq,"$all_doors_locked",1),
             (eq,"$town_nighttime",1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
                  (set_jump_mission,"mt_monasterio"),

		(try_begin),
          (eq, "$g_encountered_party", "p_monasterio1"),
      (modify_visitors_at_site,"scn_monasterio1_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio2"),
      (modify_visitors_at_site,"scn_monasterio2_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio3"),
      (modify_visitors_at_site,"scn_monasterio2_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio4"),
      (modify_visitors_at_site,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio5"),
      (modify_visitors_at_site,"scn_monasterio1_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio6"),
      (modify_visitors_at_site,"scn_monasterio3_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio7"),
      (modify_visitors_at_site,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio8"),
      (modify_visitors_at_site,"scn_monasterio3_costa"),
		(try_end),

                  (reset_visitors),
	  (try_begin),
        (gt,"trp_monjes", 0),
        (assign,reg(0),"trp_monjes"),
        (assign,reg(1),"trp_monjes"),
        (assign,reg(2),"trp_monjes"),
        (assign,reg(3),"trp_monjes"),
      (else_try),
        (assign,reg(0),"trp_monjes"),
        (assign,reg(1),"trp_monjes"),
        (assign,reg(2),"trp_monjes"),
        (assign,reg(3),"trp_monjes"),
      (try_end),
#      (shuffle_range,0,4),
      (set_visitor,1,reg(3)),
      (set_visitor,2,reg(1)),
      (set_visitor,3,reg(2)),
      (set_visitor,4,reg(3)),
	  (set_visitor,5,reg(0)),
	  (set_visitor,6,"trp_monjes"),
	  (set_visitor,7,"trp_monjes"),
	  (set_visitor,8,reg(3)),
	  (set_visitor,9,reg(0)),
	  (set_visitor,10,reg(1)),
	  (set_visitor,11,reg(2)),
	  (set_visitor,12,reg(3)),
	  (set_visitor,13,"trp_monjes"),
	  (set_visitor,14,"trp_monjes"),
	  (set_visitor,15,reg(2)),
	  (set_visitor,16,"trp_monjes"),
	  (set_visitor,17,"trp_monjes"),
	  (set_visitor,18,"trp_monjes"),
	  (set_visitor,19,reg(0)),
	  (set_visitor,20,reg(1)),
	  (set_visitor,21,reg(2)),
	  (set_visitor,22,reg(3)),
	  (set_visitor,23,"trp_monjes"),
	  (set_visitor,24,reg(0)),
	  (set_visitor,25,"trp_monjes"),
	  (set_visitor,26,"trp_monjes"),
	  (set_visitor,27,"trp_monjes"),
	  (set_visitor,28,"trp_monjes"),
	  (set_visitor,29,"trp_monjes"),
	  (set_visitor,30,"trp_monjes"),
	  (set_visitor,31,reg(2)),
	  (set_visitor,32,reg(3)),
	  (set_visitor,33,"trp_monjes"),
	  (set_visitor,34,reg(2)),
	  (set_visitor,35,reg(2)),
	  (set_visitor,36,"trp_monjes"),
	  (set_visitor,37,reg(2)),
	  (set_visitor,38,reg(3)),
	  (set_visitor,39,reg(0)),
	  (set_visitor,40,reg(1)),
      (set_jump_entry, 0),

		(try_begin),
          (eq, "$g_encountered_party", "p_monasterio1"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio2"),
	  (scene_set_slot, "scn_monasterio2_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio2_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio3"),
	  (scene_set_slot, "scn_monasterio2_normal", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio2_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio4"),
	  (scene_set_slot, "scn_monasterio1_normal", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio5"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio6"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio3_costa"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio7"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio8"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio3_costa"),
		(try_end),
               (change_screen_mission),
          (try_end),
]),

##      ("trade_monasterio",
##      [                  (this_or_next|eq, "$g_sod_faith", 1),
##							 (eq, "$g_sod_faith", 4),],
##	  "Trade with the monastery.",
##      [
##        (change_screen_trade,"trp_monje_mercader"),
##      ]),

      ("enter_interior",
       [
                  (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
                  (eq, "$sneaked_into_town", 0),
           ],
       "Visit abbot.",
       [
           (try_begin),
             (this_or_next|eq,"$all_doors_locked",1),
             (eq,"$town_nighttime",1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
             (set_jump_mission, "mt_monasterio_interior"),
		(try_begin),
          (eq, "$g_encountered_party", "p_monasterio1"),
      (modify_visitors_at_site,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio2"),
      (modify_visitors_at_site,"scn_monasterio2_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio3"),
      (modify_visitors_at_site,"scn_monasterio2_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio4"),
      (modify_visitors_at_site,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio5"),
      (modify_visitors_at_site,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio6"),
      (modify_visitors_at_site,"scn_monasterio3_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio7"),
      (modify_visitors_at_site,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio8"),
      (modify_visitors_at_site,"scn_monasterio3_normal_interior"),
		(try_end),
             (reset_visitors),
             (set_visitor, 43, "trp_abad"),
             (set_jump_entry, 0),
		(try_begin),
          (eq, "$g_encountered_party", "p_monasterio1"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio2"),
	  (scene_set_slot, "scn_monasterio2_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio2_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio3"),
	  (scene_set_slot, "scn_monasterio2_normal", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio2_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio4"),
	  (scene_set_slot, "scn_monasterio1_normal", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio5"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio6"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio3_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio7"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio1_normal_interior"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio8"),
	  (scene_set_slot, "scn_monasterio1_costa", slot_scene_visited, 1),
                 (jump_to_scene,"scn_monasterio3_normal_interior"),
		(try_end),
             (change_screen_mission),
           (try_end),
        ],"Door to the arena."),

      ("monasterio_recruit",
       [
                  (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
         (eq, "$reclutar_puede_refuges", 0),
   ],
       "Ask if somebody wants to join you.",
   [
          (store_random_in_range, ":rand", 0, 8),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_refugee_recruit_troops12"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_refugee_recruit_troops32"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_refugee_recruit_troops12"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_refugee_recruit_troops22"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_refugee_recruit_troops22"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_refugee_recruit_troops22"),
                                          (else_try),
                                            (eq, ":rand", 6),
       (jump_to_menu,"mnu_refugee_recruit_troops22"),
                                          (else_try),
                                            (eq, ":rand", 7),
       (jump_to_menu,"mnu_refugee_recruit_troops32"),
          (try_end),
        ]),

      ("pray",[
                  (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
         (eq, "$g_rezar_monasterio", 0),
          ],"Pray and donate a tribute. (50 schillingas).",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 50),
		(troop_remove_gold, "trp_player", 50),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 1),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -2), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
         (assign, "$g_rezar_monasterio", 1),
	   (change_screen_return),
        ]
       ),

      ("aprender_leer",[
         (eq, "$sabe_leer", 0),
          ],"I want to learn how to read. (4000 schillingas).",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 3999),
		(troop_remove_gold, "trp_player", 4000),
                (display_message, "@ You feel good for helping."),
##           (assign,"$g_camp_mode", 1),
##           (assign, "$g_infinite_camping", 0),
##           (assign, "$g_player_icon_state", pis_camping),
##		   (party_set_slot,"p_main_party",slot_party_entrenched,0), #TEMPERED chief ADDED LINE FOR NO ENTRENCHMENT
##	   (assign,"$current_camp_party",-1), #TEMPERED chief ADDED LINE FOR NO ENTRENCHMENT
           (rest_for_hours_interactive, 24 * 3, 5, 1), #rest while attackable
          (assign, "$sabe_leer", 1),
		(display_message, "@On several occasions throughout your life you have seen the strange Latin letters, and therefore quickly learn how to read. Perhaps in time you will also learn how to write!"),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
          (change_screen_map),
        ]
       ),

      ("donate",[
                  (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
         (eq, "$g_rezar_monasterio", 0),
          ],"Make a generous donation to the monastery. (500 schillingas).",
       [
                (display_message, "@ The monks bless you and you continue your way ."),
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@ The monks bless you and you continue your way ."),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -4), #la q designemos
		(call_script, "script_change_troop_renown", "trp_player", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
         (assign, "$g_rezar_monasterio", 1),
	   (change_screen_return),
        ]
       ),

      ("convertir",[
                  (this_or_next|eq, "$g_sod_faith", 2),
							 (eq, "$g_sod_faith", 3),
          ],"Convert to Christianity.",
       [
       (assign, "$g_sod_faith", 4),
       (display_message, "@ You are now a christian."),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -5), #la q designemos
	   (change_screen_return),
        ]
       ),

      ("camp_wait_here",[],"Wait here for some time.",
       [
           (assign,"$g_camp_mode", 1),
           (assign, "$g_infinite_camping", 0),
           (assign, "$g_player_icon_state", pis_camping),
		   (party_set_slot,"p_main_party",slot_party_entrenched,0), #TEMPERED chief ADDED LINE FOR NO ENTRENCHMENT
	   (assign,"$current_camp_party",-1), #TEMPERED chief ADDED LINE FOR NO ENTRENCHMENT

           (try_begin),
             (party_is_active, "p_main_party"),
             (party_get_current_terrain, ":cur_terrain", "p_main_party"),
             (try_begin),
               (eq, ":cur_terrain", rt_desert),
               (unlock_achievement, ACHIEVEMENT_SARRANIDIAN_NIGHTS),
             (try_end),
           (try_end),

           (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable

           (change_screen_return),
        ]
       ),

      ("pillage_monastery",[                  (this_or_next|eq, "$g_sod_faith", 2),
							 (eq, "$g_sod_faith", 3),
],"Pillage the monastery, slaughter all priests and burn the place!",
       [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 20), # se muestra si el player tiene por lo menos 20 hombres
           	(call_script, "script_change_player_honor", -10),
		(call_script, "script_change_troop_renown", "trp_player", 5),
            (call_script, "script_change_player_party_morale", -5),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 1), #la q designemos
                (display_message, "@ With unusual fury, your pagan warriors plundered the monastery and kill all the monks. Blood covers the ground, and greed shining in the eyes of the fiercest men."),
                (display_message, "@ Blood and death everywhere. The monks do not resist and you take possession of their gold. Your Christian followers do not seem very happy."),
       (jump_to_menu,"mnu_saquear_monasterio"),
      (else_try),
        (display_message,"@ You need to have more men for this."),
      (try_end),
        ]
       ),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),

    ]
  ),
  ####monasterios chief acaba



  (
    "test_scene",0, #TEMPERED chief CHANGED FOR ENTRENCHMENT SCENE EDITING
    "You enter the test scene.",
    "none",
    [],
    [

	  ("leave",[],"Leave.",[(assign,"$temp_presentation_shown",0),(leave_encounter),(change_screen_return)]),
	  ("enter",[(eq,"$temp_presentation_shown",0)],"choose a siege camp",[(assign,"$temp_scene_type",1),(start_presentation,"prsnt_scene_picker")]),
	  ("enter",[(eq,"$temp_presentation_shown",0)],"choose a castle or town",[(assign,"$temp_scene_type",2),(start_presentation,"prsnt_scene_picker")]),
	  ("jump",[(eq,"$temp_presentation_shown",1)],"Jump to scene",
			[	(assign,"$temp_presentation_shown",0),
				(set_jump_mission,"mt_ai_training"),
				(try_begin),
					(eq,"$temp_scene_type",1),
					(party_get_slot,":scene","$g_presentation_obj_15_val",slot_center_siege_camp),
				(else_try),
					(eq,"$temp_scene_type",2),
					(party_get_slot,":scene","$g_presentation_obj_15_val",slot_castle_exterior),
				(try_end),
				(jump_to_scene,":scene"),
				(change_screen_mission)
			]),
      ("enter",[(eq,"$temp_presentation_shown",0)],"camp desert",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_desert"],[change_screen_mission]]),
      ("enter",[(eq,"$temp_presentation_shown",0)],"camp desert forest",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_desert_forest"],[change_screen_mission]]),
      ("enter",[(eq,"$temp_presentation_shown",0)],"camp plain",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_plain"],[change_screen_mission]]),
	  ("enter",[(eq,"$temp_presentation_shown",0)],"camp plain forest",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_plain_forest"],[change_screen_mission]]),
      ("enter",[(eq,"$temp_presentation_shown",0)],"camp snow",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_snow"],[change_screen_mission]]),
      ("enter",[(eq,"$temp_presentation_shown",0)],"camp snow forest",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_snow_forest"],[change_screen_mission]]),
      ("enter",[(eq,"$temp_presentation_shown",0)],"camp steppe",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_steppe"],[change_screen_mission]]),
	  ("enter",[(eq,"$temp_presentation_shown",0)],"camp steppe forest",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_camp_steppe_forest"],[change_screen_mission]]),


    ]
  ),
  (
    "battlefields",0,
    "{!}Select a field...",
    "none",
    [],
    [

      ("enter_f1",[],"{!}Field 1",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_1"],[change_screen_mission]]),
      ("enter_f2",[],"{!}Field 2",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_2"],[change_screen_mission]]),
      ("enter_f3",[],"{!}Field 3",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_3"],[change_screen_mission]]),
      ("enter_f4",[],"{!}Field 4",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_4"],[change_screen_mission]]),
      ("enter_f5",[],"{!}Field 5",[[set_jump_mission,"mt_ai_training"],[jump_to_scene,"scn_field_5"],[change_screen_mission]]),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),
  (
    "dhorak_keep",0,
#    "Dhorak Keep, the stronghold of the bandits stands overlooking the barren wilderness.",
    "You enter the Dhorak Keep",
    "none",
    [],
    [
      ("enter",[],"Enter.",[(set_jump_mission,"mt_town_center"),(jump_to_scene,"scn_dhorak_keep"),(change_screen_mission)]),
      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),

##  (
##    "center_under_attack_while_resting",0,
##    "{s1} has been besieged by {s2}, and the enemy seems to be preparing for an assault!\
## What will you do?",
##    "none",
##    [
##        (party_get_battle_opponent, ":besieger_party", "$auto_enter_town"),
##        (str_store_party_name, s1, "$auto_enter_town"),
##        (str_store_party_name, s2, ":besieger_party"),
##    ],
##    [
##      ("defend_against_siege", [],"Help the defenders of {s1}!",
##       [
##           (assign, "$g_last_player_do_nothing_against_siege_next_check", 0),
##           (rest_for_hours, 0, 0, 0),
##           (change_screen_return),
##           (start_encounter, "$auto_enter_town"),
##           ]),
##      ("do_not_defend_against_siege",[],"Find a secure place and wait there.",
##       [
##           (change_screen_return),
##           ]),
##    ]
##  ),

  (
    "join_siege_outside",mnf_scale_picture,
    "{s1} has come under siege by {s2}.",
    "none",
    [
        (str_store_party_name, s1, "$g_encountered_party"),
        (str_store_party_name, s2, "$g_encountered_party_2"),
        (troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
        (try_begin),
       #+freelancer chief
          (eq, "$freelancer_state", 1),
          (try_begin),
            (store_troop_faction, ":commanders_faction", "$enlisted_lord"),
            (store_relation, ":relation", ":commanders_faction", "$g_encountered_party_faction"),
            (this_or_next|eq, ":commanders_faction", "$g_encountered_party_faction"), #encountered party is always the castle/town sieged
            (ge, ":relation", 0),
            (jump_to_menu, "mnu_siege_started_defender"),
          (else_try),
            (jump_to_menu, "mnu_besiegers_camp_with_allies"),
          (try_end),
        (else_try),
        #+freelancer end
        (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_siege_sighted_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_siege_sighted"),
        (try_end),
    ],
    [
      ("approach_besiegers",[(store_faction_of_party, ":faction_no", "$g_encountered_party_2"),
                             (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
                             (ge, ":relation", 0),
                             (store_faction_of_party, ":faction_no", "$g_encountered_party"),
                             (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
                             (lt, ":relation", 0),
                             ],"Approach the siege camp.",[
          (jump_to_menu, "mnu_besiegers_camp_with_allies"),
                                ]),
      ("pass_through_siege",[(store_faction_of_party, ":faction_no", "$g_encountered_party"),
                             (store_relation, ":relation", ":faction_no", "fac_player_supporters_faction"),
                             (ge, ":relation", 0),
                             ],"Pass through the siege lines and enter {s1}.",
       [
            (jump_to_menu,"mnu_cut_siege_without_fight"),
          ]),
      ("leave",[],"Leave.",[(leave_encounter),
                            (change_screen_return)]),
    ]
  ),
  (
    "cut_siege_without_fight",0,
    "The besiegers let you approach the gates without challenge.",
    "none",
    [],
    [
      ("continue",[],"Continue...",[(try_begin),
                                   (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
                                   (eq, "$g_encountered_party_faction", "$players_kingdom"),
                                   (jump_to_menu, "mnu_town"),
                                 (else_try),
                                   (jump_to_menu, "mnu_castle_outside"),
                                 (try_end),]),
      ]
  ),
  (
    "besiegers_camp_with_allies",0,
    "{s1} remains under siege. The banners of {s2} fly above the camp of the besiegers,\
 where you and your men are welcomed.",
    "none",
    [
        (str_store_party_name, s1, "$g_encountered_party"),
        (str_store_party_name, s2, "$g_encountered_party_2"),
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", "$g_encountered_party_2"),
        (select_enemy, 0),
        (call_script, "script_encounter_calculate_fit"),
        (try_begin),
          (eq, "$new_encounter", 1),
          (assign, "$new_encounter", 0),
          (call_script, "script_encounter_init_variables"),
        (try_end),

        (try_begin),
          (eq, "$g_leave_encounter",1),
          (change_screen_return),
        (else_try),
          (assign, ":enemy_finished", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
            (assign, ":enemy_finished", 1),
          (else_try),
#COOP bugfix chief ##############
#              (le, "$g_enemy_fit_for_battle",0),
              (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
        (ge, "$g_friend_fit_for_battle", 1),
            (assign, ":enemy_finished", 1),
          (try_end),
          (this_or_next|eq, ":enemy_finished", 1),
          (eq, "$g_enemy_surrenders", 1),
##          (assign, "$g_next_menu", -1),#"mnu_castle_taken_by_friends"),
##          (jump_to_menu, "mnu_total_victory"),
          (call_script, "script_party_wound_all_members", "$g_enemy_party"),

#fire arrow chief
                  #Center captured
          (try_begin),
            (assign, "$g_recalculate_ais", 1),
            (assign, ":root_winner_party", "$g_ally_party"),
            (assign, ":root_defeated_party", "$g_enemy_party"),
            (store_faction_of_party, ":winner_faction", ":root_winner_party"),
            (try_begin),
              (eq, ":winner_faction", "fac_player_supporters_faction"),
              (assign, ":winner_faction", "$players_kingdom"),
            (try_end),
            (store_faction_of_party, ":defeated_faction", ":root_defeated_party"),

            (str_store_party_name, s1, ":root_defeated_party"),
            (str_store_faction_name, s2, ":winner_faction"),
            (str_store_faction_name, s3, ":defeated_faction"),
            (display_log_message, "str_center_captured"),

            (try_begin),
                 (eq, "$g_encountered_party", ":root_defeated_party"),
                 (call_script, "script_add_log_entry", logent_player_participated_in_siege, "trp_player",  "$g_encountered_party", 0, "$g_encountered_party_faction"),
            (try_end),

            (try_begin),
              (party_get_num_companion_stacks, ":num_stacks", ":root_winner_party"),
              (gt, ":num_stacks", 0),
              (party_stack_get_troop_id, ":leader_troop_no", ":root_winner_party", 0),
              (is_between, ":leader_troop_no", companions_begin, kingdom_heroes_end),
              (party_set_slot, ":root_defeated_party", slot_center_last_taken_by_troop, ":leader_troop_no"),
            (else_try),
              (party_set_slot, ":root_defeated_party", slot_center_last_taken_by_troop, -1),
            (try_end),

            (call_script, "script_lift_siege", ":root_defeated_party", 0),
            (call_script, "script_give_center_to_faction", ":root_defeated_party", ":winner_faction"),
#            (try_begin),
#              (eq, ":defeated_faction", "fac_player_supporters_faction"),
#              (call_script, "script_add_notification_menu", "mnu_notification_center_lost", ":root_defeated_party", ":winner_faction"),
#            (try_end),
            #Reduce prosperity of the center by 5
            (call_script, "script_change_center_prosperity", ":root_defeated_party", -5),
            (call_script, "script_order_best_besieger_party_to_guard_center", ":root_defeated_party", ":winner_faction"),
            (try_begin),
              (eq, ":winner_faction", "fac_player_supporters_faction"),
#                 (eq, "$players_kingdom", "fac_player_supporters_faction"),
              (jump_to_menu, "mnu_castle_taken"),
            (else_try),
              (call_script, "script_cf_reinforce_party", ":root_defeated_party"),
              (call_script, "script_cf_reinforce_party", ":root_defeated_party"),
            (try_end),
          (try_end),
####fire arrow chief acaba

          (leave_encounter),
          (change_screen_return),
        (else_try),
          (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
          (assign, ":ally_num_soldiers", reg0),
          (eq, "$g_battle_result", -1),
#COOP bugfix chief ##############
#          (eq, ":ally_num_soldiers", 0), #battle lost (TODO : also compare this with routed allies too like in other parts)
           (le, ":ally_num_soldiers",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
          (leave_encounter),
          (change_screen_return),
        (try_end),
        ],
    [
      ("talk_to_siege_commander",[]," Request a meeting with the commander.",[
                                (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
                                (modify_visitors_at_site,":meeting_scene"),(reset_visitors),
                                (set_visitor,0,"trp_player"),
                                (party_stack_get_troop_id, ":siege_leader_id","$g_encountered_party_2",0),
                                (party_stack_get_troop_dna,":siege_leader_dna","$g_encountered_party_2",0),
                                (set_visitor,17,":siege_leader_id",":siege_leader_dna"),
                                (set_jump_mission,"mt_conversation_encounter"),
                                (jump_to_scene,":meeting_scene"),
                                (assign, "$talk_context", tc_siege_commander),
                                (change_screen_map_conversation, ":siege_leader_id")]),
      ("join_siege_with_allies",[(neg|troop_is_wounded, "trp_player")], "Join the next assault.",
       [
           (assign, "$g_joined_battle_to_help", 1),
           (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
           (try_begin),
             (check_quest_active, "qst_join_siege_with_army"),
             (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
             (add_xp_as_reward, 250),
             (call_script, "script_end_quest", "qst_join_siege_with_army"),
             #Reactivating follow army quest
             (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
             (str_store_troop_name_link, s9, ":faction_marshall"),
             (setup_quest_text, "qst_follow_army"),
             (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
             (call_script, "script_start_quest", "qst_follow_army", ":faction_marshall"),
             (assign, "$g_player_follow_army_warnings", 0),
           (try_end),
           (try_begin),
             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
           (else_try),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
           (try_end),
           (call_script, "script_calculate_battle_advantage"),
           (val_mul, reg0, 2),
           (val_div, reg0, 3), #scale down the advantage a bit in sieges.
           (set_battle_advantage, reg0),
           (set_party_battle_mode),
           (try_begin),
             (party_slot_eq, "$g_encountered_party", slot_center_siege_with_belfry, 1),
             (set_jump_mission,"mt_castle_attack_walls_belfry"),
#siege warfare ram chief
		   (else_try),
		     (party_slot_eq, "$g_encountered_party", slot_center_siege_with_ram, 1),
			 (set_jump_mission, "mt_castle_attack_walls_ram"),
#siege warfare ram acaba
           (else_try),
             (set_jump_mission,"mt_castle_attack_walls_ladder"),
           (try_end),
           (jump_to_scene,":battle_scene"),
           (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
           (assign, "$g_siege_battle_state", 1),
           (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
           (jump_to_menu, "mnu_battle_debrief"),
           (change_screen_mission),
          ]),
      ("join_siege_stay_back", [
	    (neq, "$freelancer_state", 1),	#+freelancer chief
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
                                (ge, reg0, 3),
                                ],
       "Order your soldiers to join the next assault without you.",
       [
         (assign, "$g_joined_battle_to_help", 1),
         (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
         (try_begin),
           (check_quest_active, "qst_join_siege_with_army"),
           (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
           (add_xp_as_reward, 100),
           (call_script, "script_end_quest", "qst_join_siege_with_army"),
           #Reactivating follow army quest
           (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
           (str_store_troop_name_link, s9, ":faction_marshall"),
           (setup_quest_text, "qst_follow_army"),
           (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
           (call_script, "script_start_quest", "qst_follow_army", ":faction_marshall"),
           (assign, "$g_player_follow_army_warnings", 0),
         (try_end),
         (jump_to_menu,"mnu_castle_attack_walls_with_allies_simulate")]),

#COOP Join siege chief#############################
      ("coop_setup",
       [
	    (neq, "$freelancer_state", 1),	#+freelancer chief
        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
        (this_or_next|ge, "$cheat_mode", 1),
        (eq, "$coop_battle_state", coop_battle_state_none),
       ],
       "Setup multiplayer battle.",
       [
        (assign, "$coop_battle_type", coop_battle_type_siege_player_attack),
        (assign, "$coop_encountered_party", "$g_enemy_party"),
        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
        (try_begin),
          (eq, "$coop_skip_menu", 1),
          (change_screen_quit),
        (try_end),

       ]),

      ("quit_game_will_not",[
	    (neq, "$freelancer_state", 1),	#+freelancer chief
        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
      ],"Quit game (will not save).",
      [
        (change_screen_quit),
      ]),

      ("coop_use_result",[
 	    (neq, "$freelancer_state", 1),	#+freelancer chief
       (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
         (eq, "$coop_battle_state", coop_battle_state_end_mp),
      ],"Use multiplayer battle results.",
      [
        (call_script, "script_calculate_renown_value"),
        (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
        (assign, "$g_siege_battle_state", 1),
        (assign, "$g_next_menu", "mnu_besiegers_camp_with_allies"),
        (assign, "$g_joined_battle_to_help", 1),
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", slot_quest_target_center, "$g_encountered_party"),
          (add_xp_as_reward, 250),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          #Reactivating follow army quest
          (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
          (str_store_troop_name_link, s9, ":faction_marshall"),
          (setup_quest_text, "qst_follow_army"),
          (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
          (call_script, "script_start_quest", "qst_follow_army", ":faction_marshall"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),

        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
        (jump_to_menu, "mnu_battle_debrief"),
      ]),

##      ("encounter_save",[],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (leave_encounter),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),



################################################ chief acaba
	#+freelancer chief
	("join_wounded",[
	  (eq, "$freelancer_state", 1),
	  (troop_is_wounded, "trp_player"),
	  ],
	  "You are too wounded to fight.",[(leave_encounter),(change_screen_map)]),
	#+freelancer end

      ("leave",[],"Leave.",[(leave_encounter),(change_screen_return)]),
    ]
  ),

  (
    "castle_outside",0,
    "You are outside {s2}.{s11} {s3} {s4}",
    "none",
    [

#chief anade saqueo
          (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_saqueo_state, 1),
          (jump_to_menu, "mnu_saqueo_loot_continue"),
        (else_try),
#chief saqueo acaba

        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", -1),
        (str_store_party_name, s2,"$g_encountered_party"),
        (call_script, "script_encounter_calculate_fit"),
        (assign,"$all_doors_locked",1),
        (assign, "$current_town","$g_encountered_party"),

        (try_begin),
          (eq, "$new_encounter", 1),
          (assign, "$new_encounter", 0),
          (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),
          (call_script, "script_encounter_init_variables"),
          (assign, "$entry_to_town_forbidden",0),
          (assign, "$sneaked_into_town",0),
          (assign, "$town_entered", 0),
#          (assign, "$waiting_for_arena_fight_result", 0),
          (assign, "$encountered_party_hostile", 0),
          (assign, "$encountered_party_friendly", 0),
          (try_begin),
            (gt, "$g_player_besiege_town", 0),
            (neq,"$g_player_besiege_town","$g_encountered_party"),
            (party_slot_eq, "$g_player_besiege_town", slot_center_is_besieged_by, "p_main_party"),
            (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
            (assign,"$g_player_besiege_town",-1),
          (try_end),
          (try_begin),
            (lt, "$g_encountered_party_relation", 0),
            (assign, "$encountered_party_hostile", 1),
            (assign,"$entry_to_town_forbidden",1),
          (try_end),
          ##diplomacy chief begin
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
            (assign, "$encountered_party_hostile", 1),
            (assign,"$entry_to_town_forbidden",1),
          (try_end),
          ##diplomacy chief end
#chief anadido blood
		  (party_get_slot, ":lord", "$g_encountered_party", slot_town_lord),
          (try_begin),
			(eq, ":lord", "trp_player"),
			(assign, "$sneaked_into_town",1),
			(assign, "$town_entered", 1),
			(assign, "$encountered_party_hostile", 0),
			(assign,"$entry_to_town_forbidden",0),
			(assign, "$encountered_party_friendly", 1),
          (try_end),
#chief anadido blood acaba

          (assign,"$cant_sneak_into_town",0),
          (try_begin),
            (eq,"$current_town","$last_sneak_attempt_town"),
            (store_current_hours,reg(2)),
            (val_sub,reg(2),"$last_sneak_attempt_time"),
            (lt,reg(2),12),
            (assign,"$cant_sneak_into_town",1),
          (try_end),
        (else_try), #second or more turn
          (eq, "$g_leave_encounter",1),
          (change_screen_return),
        (try_end),

        (str_clear,s4),
        (try_begin),
          (eq,"$entry_to_town_forbidden",1),
          (try_begin),
            (eq,"$cant_sneak_into_town",1),
            (str_store_string,s4,"str_sneaking_to_town_impossible"),
          (else_try),
            (str_store_string,s4,"str_entrance_to_town_forbidden"),
          (try_end),
        (try_end),

        (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
        (store_faction_of_party, ":center_faction", "$current_town"),
        (str_store_faction_name,s9,":center_faction"),
        (try_begin),
          (ge, ":center_lord", 0),
          (str_store_troop_name,s8,":center_lord"),
          (str_store_string,s7,"@{s8} of {s9}"),
        (try_end),

        (try_begin), # same mnu_town
          (party_slot_eq,"$current_town",slot_party_type, spt_castle),
          (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ Your own banner flies over the castle gate."),
          (else_try),
            (ge, ":center_lord", 0),
            (str_store_string,s11,"@ You see the banner of {s7} over the castle gate."),
          (else_try),
		    (is_between, ":center_faction", kingdoms_begin, kingdoms_end),
            (str_store_string,s11,"str__this_castle_is_temporarily_under_royal_control"),
		  (else_try),
            (str_store_string,s11,"str__this_castle_does_not_seem_to_be_under_anyones_control"),
          (try_end),
        (else_try),
          (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ Your own banner flies over the town gates."),
          (else_try),
            (ge, ":center_lord", 0),
            (str_store_string,s11,"@ You see the banner of {s7} over the town gates."),
          (else_try),
		    (is_between, ":center_faction", kingdoms_begin, kingdoms_end),
            (str_store_string,s11,"str__this_town_is_temporarily_under_royal_control"),
		  (else_try),
            (str_store_string,s11,"str__the_townspeople_seem_to_have_declared_their_independence"),
          (try_end),
        (try_end),

        (party_get_num_companions, reg(7),"p_collective_enemy"),
        (assign,"$castle_undefended",0),
        (str_clear, s3),
        (try_begin),
          (eq,reg(7),0),
          (assign,"$castle_undefended",1),
#          (party_set_faction,"$g_encountered_party","fac_neutral"),
#          (party_set_slot, "$g_encountered_party", slot_town_lord, stl_unassigned),
          (str_store_string, s3, "str_castle_is_abondened"),
        ##diplomacy chief begin
        (else_try),
          (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
          (str_store_string, s3, "str_dplmc_place_is_occupied_by_insurgents"),
        ##diplomacy chief end
        (else_try),
          (eq,"$g_encountered_party_faction","fac_player_supporters_faction"),
          (str_store_string, s3, "str_place_is_occupied_by_player"),
        (else_try),
          (lt, "$g_encountered_party_relation", 0),
          (str_store_string, s3, "str_place_is_occupied_by_enemy"),
        (else_try),
#          (str_store_string, s3, "str_place_is_occupied_by_friendly"),
        (try_end),

        (try_begin),
          (eq, "$g_leave_town_outside",1),
          (assign, "$g_leave_town_outside",0),
          (assign, "$g_permitted_to_center", 0),
          (change_screen_return),
        (else_try),
          (check_quest_active, "qst_escort_lady"),
          (quest_slot_eq, "qst_escort_lady", slot_quest_target_center, "$g_encountered_party"),
          (quest_get_slot, ":quest_object_troop", "qst_escort_lady", slot_quest_object_troop),
          (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
          (modify_visitors_at_site,":meeting_scene"),
          (reset_visitors),
          (set_visitor,0, "trp_player"),
          (set_visitor,17, ":quest_object_troop"),
          (set_jump_mission, "mt_conversation_encounter"),
          (jump_to_scene, ":meeting_scene"),
          (assign, "$talk_context", tc_entering_center_quest_talk),
          (change_screen_map_conversation, ":quest_object_troop"),
        (else_try),
          (check_quest_active, "qst_kidnapped_girl"),
          (quest_slot_eq, "qst_kidnapped_girl", slot_quest_giver_center, "$g_encountered_party"),
          (quest_slot_eq, "qst_kidnapped_girl", slot_quest_current_state, 3),
          (call_script, "script_get_meeting_scene"), (assign, ":meeting_scene", reg0),
          (modify_visitors_at_site,":meeting_scene"),
          (reset_visitors),
          (set_visitor,0, "trp_player"),
          (set_visitor,17, "trp_kidnapped_girl"),
          (set_jump_mission, "mt_conversation_encounter"),
          (jump_to_scene, ":meeting_scene"),
          (assign, "$talk_context", tc_entering_center_quest_talk),
          (change_screen_map_conversation, "trp_kidnapped_girl"),
##        (else_try),
##          (gt, "$lord_requested_to_talk_to", 0),
##          (store_current_hours, ":cur_hours"),
##          (neq, ":cur_hours", "$quest_given_time"),
##          (modify_visitors_at_site,"scn_conversation_scene"),
##          (reset_visitors),
##          (assign, ":cur_lord", "$lord_requested_to_talk_to"),
##          (assign, "$lord_requested_to_talk_to", 0),
##          (set_visitor,0,"trp_player"),
##          (set_visitor,17,":cur_lord"),
##          (set_jump_mission,"mt_conversation_encounter"),
##          (jump_to_scene,"scn_conversation_scene"),
##          (assign, "$talk_context", tc_castle_gate_lord),
##          (change_screen_map_conversation, ":cur_lord"),
        (else_try),
          (eq, "$g_town_visit_after_rest", 1),
          (assign, "$g_town_visit_after_rest", 0),
          (jump_to_menu,"mnu_town"),
        ##diplomacy chief begin
        (else_try),
          (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
          (try_begin),
            (eq, "$g_player_besiege_town", "$g_encountered_party"),
            (jump_to_menu, "mnu_castle_besiege"),
          (try_end),
        ##diplomacy chief end
        (else_try),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_castle),
          (this_or_next|party_slot_eq, "$g_encountered_party", slot_town_lord, "trp_player"),
          (faction_slot_eq, "$g_encountered_party_faction", slot_faction_leader, "trp_player"),
          (jump_to_menu, "mnu_enter_your_own_castle"),
        (else_try),
          (party_slot_eq,"$g_encountered_party", slot_party_type,spt_castle),
          (ge, "$g_encountered_party_relation", 0),
          (this_or_next|eq,"$castle_undefended", 1),
          (this_or_next|eq, "$g_permitted_to_center", 1),
          (eq, "$g_encountered_party_faction", "$players_kingdom"),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (party_slot_eq,"$g_encountered_party", slot_party_type,spt_town),
          (ge, "$g_encountered_party_relation", 0),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (eq, "$g_player_besiege_town", "$g_encountered_party"),
          (jump_to_menu, "mnu_castle_besiege"),
        (try_end),

          ##diplomacy chief begin
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
            (set_background_mesh, "mesh_pic_townriot"),
          (else_try),
          ##diplomacy chief end
		(call_script, "script_set_town_picture"),
		      ##diplomacy chief begin
          (try_end),
          ##diplomacy chief end
          (try_end), #chief saqueo
        ],
    [
#        ("talk_to_castle_commander",[
#            (party_get_num_companions, ":no_companions", "$g_encountered_party"),
#            (ge, ":no_companions", 1),
#            (eq,"$ruler_meeting_denied",0), #this variable is removed
#            ],
#         "Request a meeting with the lord of the castle.",[
#             (modify_visitors_at_site,"scn_conversation_scene"),(reset_visitors),
#             (set_visitor,0,"trp_player"),
#             (party_stack_get_troop_id, reg(6),"$g_encountered_party",0),
#             (party_stack_get_troop_dna,reg(7),"$g_encountered_party",0),
#             (set_visitor,17,reg(6),reg(7)),
#             (set_jump_mission,"mt_conversation_encounter"),
#             (jump_to_scene,"scn_conversation_scene"),
#             (assign, "$talk_context", tc_castle_commander),
#             (change_screen_map_conversation, reg(6))
#             ]),
      ("approach_gates",[(this_or_next|eq,"$entry_to_town_forbidden",1),
                          (party_slot_eq,"$g_encountered_party", slot_party_type,spt_castle)],
       "Approach the gates and hail the guard.",[
                                                  (str_clear, s10), #fire arrow chief
                                                  (jump_to_menu, "mnu_castle_guard"),
##                                                   (modify_visitors_at_site,"scn_conversation_scene"),(reset_visitors),
##                                                   (set_visitor,0,"trp_player"),
##                                                   (store_faction_of_party, ":cur_faction", "$g_encountered_party"),
##                                                   (faction_get_slot, ":cur_guard", ":cur_faction", slot_faction_guard_troop),
##                                                   (set_visitor,17,":cur_guard"),
##                                                   (set_jump_mission,"mt_conversation_encounter"),
##                                                   (jump_to_scene,"scn_conversation_scene"),
##                                                   (assign, "$talk_context", tc_castle_gate),
##                                                   (change_screen_map_conversation, ":cur_guard")
                                                   ]),

      ("town_sneak",
        [
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

          (party_slot_eq|neg, "$g_encountered_party", slot_town_lord, "trp_player"), #chief anadido blood
          (eq, "$entry_to_town_forbidden", 1),
          (eq, "$cant_sneak_into_town", 0)
        ],
       "Disguise yourself and try to sneak into the {s7}",
       [
         (faction_get_slot, ":player_alarm", "$g_encountered_party_faction", slot_faction_player_alarm),
         (party_get_num_companions, ":num_men", "p_main_party"),
         (party_get_num_prisoners, ":num_prisoners", "p_main_party"),
         (val_add, ":num_men", ":num_prisoners"),
         (val_mul, ":num_men", 2),
         (val_div, ":num_men", 3),
         (store_add, ":get_caught_chance", ":player_alarm", ":num_men"),
         (store_random_in_range, ":random_chance", 0, 100),
         (try_begin),
           (this_or_next|ge, ":random_chance", ":get_caught_chance"),
           (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
           (assign, "$g_last_defeated_bandits_town", 0),
           (assign, "$sneaked_into_town",1),
           (assign, "$town_entered", 1),
           (jump_to_menu,"mnu_sneak_into_town_suceeded"),
           (assign, "$g_mt_mode", tcm_disguised),
         (else_try),
           (jump_to_menu,"mnu_sneak_into_town_caught"),
         (try_end),
         ]),

      ##diplomacy  chief begin
      ("dplmc_riot_start_siege",
       [
           (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
           (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
           (lt, "$g_encountered_party_2", 1),
           (call_script, "script_party_count_fit_for_battle","p_main_party"),
           (gt, reg(0), 5),
           (try_begin),
             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (assign, reg6, 1),
           (else_try),
             (assign, reg6, 0),
           (try_end),
           ],
       "Besiege the {reg6?town:castle} to counter the insurgency.",
       [
         (assign,"$g_player_besiege_town","$g_encountered_party"),
         (jump_to_menu, "mnu_castle_besiege"),
         ]),
       ("dplmc_riot_negotiate",
       [
           (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
           (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
           (lt, "$g_encountered_party_2", 1),
           (call_script, "script_party_count_fit_for_battle","p_main_party"),
           (gt, reg(0), 5),
           (try_begin),
             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (assign, reg6, 1),
           (else_try),
             (assign, reg6, 0),
           (try_end),
           ],
       "Begin negotiations.",
       [
          (jump_to_menu, "mnu_dplmc_riot_negotiate"),
        ]),

     ##diplomacy chief end

      ("castle_start_siege",
       [
           ##diplomacy chief begin
           (neg|party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
           ##diplomacy chief  end
           (this_or_next|party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
           (             party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, "p_main_party"),

            #MOTO chief add consequences as vassal
                  (try_begin),
                      (gt, "$players_kingdom", 0),
                      (neq, "$players_kingdom", "fac_player_supporters_faction"),
                      (store_relation, ":reln", "$g_encountered_party_faction", "$players_kingdom"),
                  (else_try),
                      (store_relation, ":reln", "$g_encountered_party_faction", "fac_player_supporters_faction"),
                  (try_end),
                  #MOTO end add consequences as vassal

         #  (store_relation, ":reln", "$g_encountered_party_faction", "fac_player_supporters_faction"),
                     (lt, ":reln", 1),#Tempered chief changed from 0 to allow attacking neutral castles
           (lt, "$g_encountered_party_2", 1),
           (call_script, "script_party_count_fit_for_battle","p_main_party"),
           (gt, reg(0), 5),
           (try_begin),
             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (assign, reg6, 1),
           (else_try),
             (assign, reg6, 0),
           (try_end),
           ],
       "Besiege the {reg6?town:castle}.",
       [
         (assign,"$g_player_besiege_town","$g_encountered_party"),

        #MOTO chief add consequences as vassal
              (try_begin),
                  (gt, "$players_kingdom", 0),
                  (faction_slot_eq, "$players_kingdom", slot_faction_state, sfs_active),
                  (store_relation, ":enemy_relation", "$g_encountered_party_faction", "$players_kingdom"),
                  (ge,":enemy_relation",0),    #not yet at war?
                  (call_script, "script_diplomacy_start_war_between_kingdoms", "$players_kingdom", "$g_encountered_party_faction",      logent_player_faction_declares_war),
                  (try_begin),
                      (neq, "$players_kingdom", "fac_player_supporters_faction"),
                     (faction_get_slot,":faction_leader","$players_kingdom",slot_faction_leader),
                      (ge, ":faction_leader", 0),
                     (call_script,"script_change_player_relation_with_troop",":faction_leader",-10),
                  (try_end),
              (else_try),
                  (store_relation, ":relation", "fac_player_supporters_faction", "$g_encountered_party_faction"),
                  (val_min, ":relation", -40),
                  (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":relation"),
              (try_end),
               #MOTO end add consequences as vassal

##         (store_relation, ":relation", "fac_player_supporters_faction", "$g_encountered_party_faction"),
##         (val_min, ":relation", -40),
##         (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":relation"),
         (call_script, "script_update_all_notes"),
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba
         (jump_to_menu, "mnu_castle_besiege"),
         ]),

      ("cheat_castle_start_siege",
       [
         (eq, "$cheat_mode", 1),
         (this_or_next|party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
         (             party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, "p_main_party"),
         (store_relation, ":reln", "$g_encountered_party_faction", "fac_player_supporters_faction"),
         (ge, ":reln", 0),
         (lt, "$g_encountered_party_2", 1),
         (call_script, "script_party_count_fit_for_battle","p_main_party"),
         (gt, reg(0), 1),
         (try_begin),
           (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
           (assign, reg6, 1),
         (else_try),
           (assign, reg6, 0),
         (try_end),
           ],
       "{!}CHEAT: Besiege the {reg6?town:castle}...",
       [
           (assign,"$g_player_besiege_town","$g_encountered_party"),
           (jump_to_menu, "mnu_castle_besiege"),
           ]),

      ("castle_leave",[],"Leave.",[(change_screen_return,0)]),
      ("castle_cheat_interior",[(eq, "$cheat_mode", 1)], "{!}CHEAT! Interior.",[(set_jump_mission,"mt_ai_training"),
                                                       (party_get_slot, ":castle_scene", "$current_town", slot_town_castle),
                                                       (jump_to_scene,":castle_scene"),
                                                       (change_screen_mission)]),
      ("castle_cheat_exterior",[(eq, "$cheat_mode", 1)], "{!}CHEAT! Exterior.",[
#                                                       (set_jump_mission,"mt_town_default"),
                                                       (set_jump_mission,"mt_ai_training"),
                                                       (party_get_slot, ":castle_scene", "$current_town", slot_castle_exterior),
                                                       (jump_to_scene,":castle_scene"),
                                                       (change_screen_mission)]),
      ("castle_cheat_town_walls",[(eq, "$cheat_mode", 1),(party_slot_eq,"$current_town",slot_party_type, spt_town),], "{!}CHEAT! Town Walls.",
       [
         (party_get_slot, ":scene", "$current_town", slot_town_walls),
         (set_jump_mission,"mt_ai_training"),
         (jump_to_scene,":scene"),
         (change_screen_mission)]),

    ]
  ),
   (
    "castle_guard",0,
    "You approach the gate. The men on the walls watch you closely.^^{s10}",
    "none",
    [
##fire arrow chief
      (try_begin),
        (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
        (gt, ":town_lord", 0),
        (is_between, ":town_lord", companions_begin, kingdom_heroes_end),
        (str_store_troop_name, s11, ":town_lord"),
        (str_store_party_name, s12, "$g_encountered_party"),
        (try_begin),
          (call_script, "script_cf_center_lord_is_player_or_companions", "$g_encountered_party", 0),
          (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
          (party_count_companions_of_type, ":party_has_troop", "p_collective_friends", ":town_lord"),
          (gt, ":party_has_troop", 0),
          (str_store_string, s10, "@^He noticed there is his lord, {s11} in our army.^You and {s11} may be able to persuade them to surrender without bloodshed..."),
        (else_try),
          (party_count_prisoners_of_type, ":party_has_prisoner", "p_main_party", ":town_lord"),
          (gt, ":party_has_prisoner", 0),
          (str_store_string, s10, "@^He noticed his lord, {s11} is taken prisoner by our army."),
        (try_end),
      (try_end),
###fire arrow chief acaba
		(call_script, "script_set_town_picture"),
    ],
    [
      ("request_shelter",[(party_slot_eq, "$g_encountered_party",slot_party_type, spt_castle),
                          (ge, "$g_encountered_party_relation", 0)],
       "Request entry to the castle.",
       [(party_get_slot, ":castle_lord", "$g_encountered_party", slot_town_lord),
        (try_begin),
          (lt, ":castle_lord", 0),
          (jump_to_menu, "mnu_castle_entry_granted"),
        (else_try),
          (call_script, "script_troop_get_player_relation", ":castle_lord"),
          (assign, ":castle_lord_relation", reg0),
          #(troop_get_slot, ":castle_lord_relation", ":castle_lord", slot_troop_player_relation),
          (try_begin),
            (gt, ":castle_lord_relation", -15),
            (jump_to_menu, "mnu_castle_entry_granted"),
          (else_try),
            (jump_to_menu, "mnu_castle_entry_denied"),
          (try_end),
        (try_end),
       ]),
###fire arrow chief siege warfare
            ("persuade_center_surrender_with_town_lord",
      [
         (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_active),
         (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),

        (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
        (gt, ":town_lord", 0),
        (is_between, ":town_lord", companions_begin, kingdom_heroes_end),
        (troop_slot_eq, ":town_lord", slot_troop_occupation, slto_player_companion),
        #(call_script, "script_cf_center_lord_is_player_or_companions", "$g_encountered_party", 0),
        (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (party_count_companions_of_type, ":party_has_troop", "p_collective_friends", ":town_lord"),
        (gt, ":party_has_troop", 0),
      ],
      "You and {s11} persuade them to surrender.",
      [
        (jump_to_menu, "mnu_persuade_center_surrender"),
      ]),
      ("take_lord_as_hostage",
      [
         (faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_active),
         (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),

        (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
        (gt, ":town_lord", 0),
        (is_between, ":town_lord", companions_begin, kingdom_heroes_end),
        (party_count_prisoners_of_type, ":party_has_prisoner", "p_main_party", ":town_lord"),
        (gt, ":party_has_prisoner", 0),
      ],
      "You demanded {s12} surrender in exchange for the {s11}'s safe return.",
      [
        (jump_to_menu, "mnu_persuade_center_surrender_2"),
      ]),
###fire arrow chief acaba
      ("request_meeting_commander",[],
       "Request a meeting with someone.",
       [
          (jump_to_menu, "mnu_castle_meeting"),
       ]),
      ("guard_leave",[],
       "Leave.",
       [(change_screen_return,0)]),
    ]
  ),
  (
    "castle_entry_granted",0,
    "After a brief wait, the guards open the gates for you and allow your party inside.",
    "none",
    [
		(call_script, "script_set_town_picture"),
    ],
    [
      ("continue",[],
       "Continue...",
       [(jump_to_menu,"mnu_town")]),
    ]
  ),
  (
    "castle_entry_denied",0,
    "The lord of this castle has forbidden you from coming inside these walls,\
 and the guard sergeant informs you that his men will fire if you attempt to come any closer.",
    "none",
    [
		(call_script, "script_set_town_picture"),
    ],
    [
      ("continue",[],
       "Continue...",
       [(str_clear, s10), #fire arrow chief
        (jump_to_menu,"mnu_castle_guard"),]),
    ]
  ),
  (
    "castle_meeting",0,
    "With whom do you want to meet?",
    "none",
    [
        (assign, "$num_castle_meeting_troops", 0),
        (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          (call_script, "script_get_troop_attached_party", ":troop_no"),
          (eq, "$g_encountered_party", reg0),
          (troop_set_slot, "trp_temp_array_a", "$num_castle_meeting_troops", ":troop_no"),
          (val_add, "$num_castle_meeting_troops", 1),
        (try_end),
		(call_script, "script_set_town_picture"),
    ],
    [
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 0),(troop_get_slot, ":troop_no", "trp_temp_array_a", 0),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 0),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 1),(troop_get_slot, ":troop_no", "trp_temp_array_a", 1),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 1),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 2),(troop_get_slot, ":troop_no", "trp_temp_array_a", 2),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 2),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 3),(troop_get_slot, ":troop_no", "trp_temp_array_a", 3),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 3),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 4),(troop_get_slot, ":troop_no", "trp_temp_array_a", 4),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 4),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 5),(troop_get_slot, ":troop_no", "trp_temp_array_a", 5),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 5),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 6),(troop_get_slot, ":troop_no", "trp_temp_array_a", 6),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 6),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 7),(troop_get_slot, ":troop_no", "trp_temp_array_a", 7),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 7),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 8),(troop_get_slot, ":troop_no", "trp_temp_array_a", 8),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 8),(jump_to_menu,"mnu_castle_meeting_selected")]),
      ("guard_meet_s5",[(gt, "$num_castle_meeting_troops", 9),(troop_get_slot, ":troop_no", "trp_temp_array_a", 9),(str_store_troop_name, s5, ":troop_no")],
       "{s5}.",[(troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 9),(jump_to_menu,"mnu_castle_meeting_selected")]),

      ("forget_it",[],
       "Forget it.",
       [(str_clear, s10), #fire arrow chief
        (jump_to_menu,"mnu_castle_guard")]),
    ]
  ),
  (
    "castle_meeting_selected",0,
    "Your request for a meeting is relayed inside, and finally {s6} appears in the courtyard to speak with you.",
    "none",
    [(str_store_troop_name, s6, "$castle_meeting_selected_troop")],
    [
      ("continue",[],
       "Continue...",
       [(jump_to_menu, "mnu_castle_outside"),
        (modify_visitors_at_site,"scn_conversation_scene"),(reset_visitors),
        (set_visitor,0,"trp_player"),
        (set_visitor,17,"$castle_meeting_selected_troop"),
        (set_jump_mission,"mt_conversation_encounter"),
        (jump_to_scene,"scn_conversation_scene"),
        (assign, "$talk_context", tc_castle_gate),
        (change_screen_map_conversation, "$castle_meeting_selected_troop"),
        ]),
    ]
  ),

####fire arrow persuadir con lord chief
    #1 persuade_center_surrender
  (
    "persuade_center_surrender",0,
    "{reg30?You and {s11} succeeded to presure {s12} to surrender without bloodshed!:\
You tried to presure {s12} to surrender, but {s11} didn't cooperate with you.({reg13})^Your efforts were not crowned with success.}",
    "none",
    [
      (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
      (gt, ":town_lord", 0),
      #(is_between, ":town_lord", companions_begin, kingdom_heroes_end),
      (str_store_troop_name, s11, ":town_lord"),
      (str_store_party_name, s12, "$g_encountered_party"),
      #(call_script, "script_cf_center_lord_is_player_or_companions", "$g_encountered_party", 0),
      #(neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      #(party_count_companions_of_type, ":party_has_troop", "p_collective_friends", ":town_lord"),
      #(gt, ":party_has_troop", 0),
      (call_script, "script_troop_get_player_relation", ":town_lord"),
      (assign, ":castle_lord_relation", reg0),
      (assign, reg13, reg0),
      (try_begin),
        (ge, ":castle_lord_relation", 0),
        #(party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
        (call_script, "script_give_center_to_lord", "$g_encountered_party", ":town_lord", 0),
        (try_for_range, ":other_center", centers_begin, centers_end),
          (party_slot_eq, ":other_center", slot_village_bound_center, "$g_encountered_party"),
          (try_begin),
            (party_slot_eq, ":other_center", slot_town_lord_old, ":town_lord"),
            (call_script, "script_give_center_to_lord", ":other_center", ":town_lord", 0),
          (else_try),
            (call_script, "script_give_center_to_lord", ":other_center", "trp_player", 0),
          (try_end),
        (try_end),
        (call_script, "script_add_log_entry", logent_castle_captured_by_player, "trp_player",  "$g_encountered_party", 0, "$g_encountered_party_faction"),
        (call_script, "script_change_troop_renown", "trp_player", 5),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (assign, "$g_next_menu", "mnu_auto_return_to_map"),
        (assign, reg30, 1),
      (else_try),
        (assign, reg30, 0),
        (assign, "$g_next_menu", "mnu_castle_guard"),
      (try_end),
    ],
    [
      ("continue",[],
       "Continue...",
       [
         (jump_to_menu, "$g_next_menu"),
       ]),
    ],
  ),
  #1 persuade_center_surrender_2
  (
    "persuade_center_surrender_2",0,
    "{s20}^^{reg30?{s12} agreed with you surrender in exchange for the {s11}'s safe return:\
{s12} censured for your base action. Your plot went wrong.}",
    "none",
    [
      (assign, ":continue", 1),
      (assign, reg30, 0),
      (str_clear, s20),
      (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
      (gt, ":town_lord", 0),
      (is_between, ":town_lord", companions_begin, kingdom_heroes_end),
      (str_store_troop_name, s11, ":town_lord"),
      (str_store_party_name, s12, "$g_encountered_party"),
      (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
      (party_count_prisoners_of_type, ":party_has_prisoner", "p_main_party", ":town_lord"),
      (gt, ":party_has_prisoner", 0),
      # center faction has more than two towns or castles.
      (assign, ":num_of_centers", 0),
      (try_for_range, ":cur_center", walled_centers_begin, walled_centers_end),
        (store_faction_of_party, ":center_faction", ":cur_center"),
        (eq, ":center_faction", "$g_encountered_party_faction"),
        (val_add, ":num_of_centers", 1),
      (try_end),
      (try_begin),
        (gt, ":num_of_centers", 1),
      (else_try),
        (str_store_faction_name, s13, "$g_encountered_party_faction"),
        (str_store_string, s20, "@{s12} is a last fort for {s13}. They will have to fight against you."),
        (assign, ":continue", 0),
      (try_end),
      # Player can use persure skill per a day.
      (troop_get_slot, ":last_persuasion_time", ":town_lord", slot_troop_last_persuasion_time),
      (store_current_hours, ":cur_hours"),
      (store_add, ":valid_time", ":last_persuasion_time", 24),
      (try_begin),
        (gt, ":cur_hours", ":valid_time"),
        (troop_set_slot, ":town_lord", slot_troop_last_persuasion_time, ":cur_hours"),
      (else_try),
        (str_store_string, s20, "@You can use persuasion skill only once per a day."),
        (assign, ":continue", 0),
      (try_end),
      # end
      (try_begin),
      (eq, ":continue", 0),
        (assign, "$g_next_menu", "mnu_castle_guard"),
      (try_end),
      (eq, ":continue", 1),
      # calc ally strength
      (call_script, "script_party_calculate_regular_strength", "p_collective_friends"),
      (assign, ":persuasion_difficulty", reg0),(display_message, "@ally strength: {reg0}"),
      # calc enemy strength
      (call_script, "script_party_calculate_regular_strength", "p_collective_enemy"),
      (val_mul, reg0, 2),
      (val_sub, ":persuasion_difficulty", reg0),(display_message, "@enemy strength: {reg0}"),
      (assign, reg0, ":persuasion_difficulty"), (display_message, "@persuasion difficulty: {reg0}"),
      # normalize difficulty
      (convert_to_fixed_point, ":persuasion_difficulty"),
      (store_sqrt, ":persuasion_difficulty", ":persuasion_difficulty"),
      (convert_from_fixed_point, ":persuasion_difficulty"),
      (val_div, ":persuasion_difficulty", 10),
      (val_add, ":persuasion_difficulty", 4),
      (assign, reg0, ":persuasion_difficulty"), (display_message, "@normalize difficulty: {reg0}"),
      # player persuasion skill
      (store_skill_level, ":persuasion_level", "skl_persuasion", "trp_player"),
      (store_add, ":persuasion_potential", ":persuasion_level", 5),
      (store_random_in_range, ":random_1", 0, ":persuasion_potential"),
      (store_random_in_range, ":random_2", 0, ":persuasion_potential"),
      (store_add, ":rand", ":random_1", ":random_2"),
      (assign, reg0, ":rand"), (display_message, "@persuasion skill effect: {reg0}"),
      (val_add, ":persuasion_difficulty", ":rand"),
      (assign, reg0, ":persuasion_difficulty"), (display_message, "@total difficulty: {reg0}"),
      (assign, reg5, ":persuasion_difficulty"),
      (str_store_party_name, s50, "$g_encountered_party"),
      (troop_get_type, reg51, 1),
	  (val_mod, reg51, 2),	#gender fix chief moto
      (try_begin),
        (lt, ":persuasion_difficulty", -30),
        (str_store_string, s5, "str_persuasion_summary_very_bad"),
        (assign, reg30, 0),
      (else_try),
        (lt, ":persuasion_difficulty", -10),
        (str_store_string, s5, "str_persuasion_summary_bad"),
        (assign, reg30, 0),
      (else_try),
        (lt, ":persuasion_difficulty", 10),
        (str_store_string, s5, "str_persuasion_summary_average"),
        (assign, reg30, 1),
      (else_try),
        (lt, ":persuasion_difficulty", 30),
        (str_store_string, s5, "str_persuasion_summary_good"),
        (assign, reg30, 1),
      (else_try),
        (str_store_string, s5, "str_persuasion_summary_very_good"),
        (assign, reg30, 1),
      (try_end),
      (str_store_string, s20,"@Persuasion Attempt:(Persuasion strength: {reg5}) {s5}"),
      (try_begin),
        (eq, reg30, 1),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
        (call_script, "script_add_log_entry", logent_castle_captured_by_player, "trp_player",  "$g_encountered_party", 0, "$g_encountered_party_faction"),
        (call_script, "script_change_troop_renown", "trp_player", 5),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (assign, "$g_next_menu", "mnu_auto_return_to_map"),
        (party_remove_prisoners, "p_main_party", ":town_lord", 1),
        (call_script, "script_remove_troop_from_prison", ":town_lord"),
      (else_try),
        (eq, reg30, 0),
        (assign, "$g_next_menu", "mnu_castle_guard"),
      (try_end),
    ],
    [
      ("continue",[],
       "Continue...",
       [
         (jump_to_menu, "$g_next_menu"),
       ]),
    ],
  ),
####fire arrow persuadir con lord chief acaba

   (
    "castle_besiege",mnf_enable_hot_keys|mnf_scale_picture,
    "You are laying siege to {s1}. {s2} ^^{s3} ^^{s15}^^{s16}^^{s17}", #siege warfare anade
    "none",
    [
        (troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
        (try_begin),
          (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_siege_sighted_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_siege_sighted"),
        (try_end),
        (assign, "$g_siege_force_wait", 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
          (party_set_slot, "$g_encountered_party", slot_center_is_besieged_by, "p_main_party"),
          (store_current_hours, ":cur_hours"),
          (party_set_slot, "$g_encountered_party", slot_center_siege_begin_hours, ":cur_hours"),
          (assign, "$g_siege_method", 0),
          (assign, "$g_siege_sallied_out_once", 0),
          (assign, "$g_days_spent_starving", 0), #AJM chief THE $G MAKES IT PERSISTENT... SADLY ALSO GLOBAL BUT WHAT YA GONNA DO
          (assign, "$g_next_sally_at", 0), #AJM chief
        (try_end),

        (party_get_slot, ":town_food_store", "$g_encountered_party", slot_party_food_store),
        (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
        (assign, ":food_consumption", reg0),
        (assign, reg7, ":food_consumption"),
        (assign, reg8, ":town_food_store"),
        (store_div, reg3, ":town_food_store", ":food_consumption"),

        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (assign, reg6, 1),
        (else_try),
          (assign, reg6, 0),
        (try_end),

        (try_begin),
          (gt, reg3, 0),
          (str_store_string, s2, "@The {reg6?town's:castle's} food stores should last for {reg3} more days."),
        (else_try),
          (str_store_string, s2, "@The {reg6?town's:castle's} food stores have run out and the defenders are starving."),
#ajm chief asedios##############
          (try_begin),
            (gt, "$g_days_spent_starving", 6), #AJM ESSENTALLY PLAYER CLICKED WAIT 6 TIMES
            (jump_to_menu, "mnu_siege_defenders_starved_give_up"),
          (else_try), #AJM THE DEFENDERS ARE DESPERATE AND MAY SALLY IN AN ATTEMPT TO BREAK THE SIEGE

            #AJM DETERMINE THE ODDS
            (try_begin),
              (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
              (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
            (else_try),
              (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
            (try_end),
            (call_script, "script_calculate_battle_advantage"),
            (assign, ":battle_advantage", reg0),
            (val_mul, ":battle_advantage", 2),
            (val_div, ":battle_advantage", 3), #scale down the advantage a bit in sieges.
            (set_battle_advantage, ":battle_advantage"),

            #AJM ROLL A D100, AND APPLY 2x BATTLE ADVANTAGE TO IT (CAN BE NEGATIVE) TO DETERMINE THE ROLL
            #AJM AFFECTS OUR ODDS OF CHOOSING TO SALLY OUT
            (store_random_in_range, ":d100", 0, 100),
            (store_mul, ":roll_modifier", ":battle_advantage", 2),
            (try_begin),
              (le, ":roll_modifier", 0),
              (val_sub, ":d100", ":roll_modifier"), #AJM MINUS NEGATIVE = ADD; THE MORE DEFENDERS OUTNUMBER ATTACKERS, MORE LIKELY THEY ARE TO SALLY
            (else_try),
              (val_sub, ":d100", ":roll_modifier"), #AJM IF DEFENDERS ARE OUTNUMBERED, LESS LIKELY TO SALLY
            (try_end),

            (try_begin),
              (store_current_hours, "$g_sally_timer"),
              (ge, "$g_sally_timer", "$g_next_sally_at"),
              (store_add, "$g_next_sally_at", "$g_sally_timer", 12), #AJM WAIT 12 HOURS IN BETWEEN THINKING ABOUT SALLYING
              (ge, ":d100", 50), #AJM IF NOBODY HAS NUMBER ADVANTAGE, 50% CHANCE DEFENDERS SALLY OUT

              (set_party_battle_mode),
              (assign, "$g_siege_battle_state", 1),
              (try_begin),
                (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
                (assign, "$g_siege_battle_state", 0),
              (try_end),
              (assign, "$cant_talk_to_enemy", 0),
              (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
              (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
              (assign, "$g_siege_method", 0), #reset siege timer
              (jump_to_scene,":battle_scene"),
              (jump_to_menu, "mnu_siege_defenders_running_low_food_sally_drive_off_siege"),
            (try_end),
        (try_end),
        (try_end),
#ajm chief end#############

        (str_store_string, s3, "str_empty_string"),
        (try_begin),
          (ge, "$g_siege_method", 1),
          (store_current_hours, ":cur_hours"),
          (try_begin),
            (lt, ":cur_hours",  "$g_siege_method_finish_hours"),
            (store_sub, reg9, "$g_siege_method_finish_hours", ":cur_hours"),
            (try_begin),
              (eq, "$g_siege_method", 1),
              (str_store_string, s3, "@You're preparing to attack the walls, the work should finish in {reg9} hours."),
            (else_try),
              (eq, "$g_siege_method", 2),
              (str_store_string, s3, "@Your forces are building a siege tower and preparing to attack the walls. They estimate another {reg9} hours to complete the build."),
#siege warfare chief ram
			(else_try),
			  (eq, "$g_siege_method", 3),
			  (str_store_string, s3, "@Your forces are building a battering ram and preparing to attack the walls. They estimate another {reg9} hours to complete the build."),
#siege warfare ram acaba
            (try_end),
          (else_try),
            (try_begin),
              (eq, "$g_siege_method", 1),
              (str_store_string, s3, "@You are ready to attack the walls at any time."),
            (else_try),
              (eq, "$g_siege_method", 2),
              (str_store_string, s3, "@The siege tower is built and ready to make an assault."),
#siege warfare ram chief
			(else_try),
			  (eq, "$g_siege_method", 3),
			  (str_store_string, s3, "@The battering ram is built and ready to make an assault."),
#siege warfare acaba
            (try_end),
          (try_end),
        (try_end),
#Tempered chief added siege camp comment
		(str_store_string,s15,"str_siege_camp_none"),
		(try_begin),
			(party_slot_eq,"p_main_party",slot_party_siege_camp,1),
			(str_store_string,s15,"str_siege_camp_complete"),
		(else_try),
			(party_slot_eq,"p_main_party",slot_party_siege_camp,-1),
			(str_store_string,s15,"str_siege_camp_incomplete"),
		(try_end),
#Tempered changes end
####siege warfare chief
        (str_store_string, s16, "str_empty_string"),
            (try_begin),
              (eq, "$g_siege_circunvalation", 1),
              (str_store_string, s16, "@Your men are building a fence that surrounds the place."),
            (else_try),
              (eq, "$g_siege_circunvalation", 2),
              (str_store_string, s16, "@Your circunvallation is ready."),
            (try_end),
        (str_store_string, s17, "str_empty_string"),
            (try_begin),
              (eq, "$g_close_port", 1),
              (str_store_string, s17, "@Your forces are requisitioning and building ships."),
            (else_try),
              (eq, "$g_close_port", 2),
              (str_store_string, s17, "@Your fleet is at the entrance of the port."),
            (try_end),
#siege warfare chief
        #Check if enemy leaves the castle to us...
        (try_begin),
          (eq, "$g_castle_left_to_player",1), #we come here after dialog. Empty the castle and send parties away.
          (assign, "$g_castle_left_to_player",0),
          (store_faction_of_party, ":castle_faction", "$g_encountered_party"),
          (party_set_faction,"$g_encountered_party","fac_neutral"), #temporarily erase faction so that it is not the closest town
          (party_get_num_attached_parties, ":num_attached_parties_to_castle","$g_encountered_party"),
          (try_for_range_backwards, ":iap", 0, ":num_attached_parties_to_castle"),
            (party_get_attached_party_with_rank, ":attached_party", "$g_encountered_party", ":iap"),
            (party_detach, ":attached_party"),
            (party_get_slot, ":attached_party_type", ":attached_party", slot_party_type),
            (eq, ":attached_party_type", spt_kingdom_hero_party),
            (store_faction_of_party, ":attached_party_faction", ":attached_party"),
            (call_script, "script_get_closest_walled_center_of_faction", ":attached_party", ":attached_party_faction"),
            (try_begin),
              (gt, reg0, 0),
              (call_script, "script_party_set_ai_state", ":attached_party", spai_holding_center, reg0),
            (else_try),
              (call_script, "script_party_set_ai_state", ":attached_party", spai_patrolling_around_center, "$g_encountered_party"),
            (try_end),
          (try_end),
          (call_script, "script_party_remove_all_companions", "$g_encountered_party"),
          (change_screen_return),
          (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"), #recalculate so that
          (call_script, "script_party_copy", "p_encountered_party_backup", "p_collective_enemy"), #leaving troops will not be considered as captured
          (party_set_faction,"$g_encountered_party",":castle_faction"),
        (try_end),

        #Check for victory or defeat....
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", -1),
        (str_store_party_name, 1,"$g_encountered_party"),
        (call_script, "script_encounter_calculate_fit"),

        (assign, reg11, "$g_enemy_fit_for_battle"),
        (assign, reg10, "$g_friend_fit_for_battle"),


        (try_begin),
          (eq, "$g_leave_encounter",1),
          (change_screen_return),
        ##diplomacy chief begin
        (else_try),
          (party_slot_eq, "$g_encountered_party", slot_village_infested_by_bandits, "trp_peasant_woman"),
          (call_script, "script_party_count_fit_regulars","p_collective_enemy"),
          (assign, ":enemy_finished", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
            (assign, ":enemy_finished", 1),
          (else_try),
            (le, "$g_enemy_fit_for_battle", 0),
            (ge, "$g_friend_fit_for_battle", 1),
            (assign, ":enemy_finished", 1),
          (try_end),
          (this_or_next|eq, ":enemy_finished", 1),
          (eq, "$g_enemy_surrenders", 1),
          (assign, "$g_next_menu", "mnu_dplmc_town_riot_removed"),
          (jump_to_menu, "mnu_total_victory"),
        ##diplomacy chief end
        (else_try),
          (call_script, "script_party_count_fit_regulars","p_collective_enemy"),
          (assign, ":enemy_finished", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
            (assign, ":enemy_finished", 1),
          (else_try),
#COOP bugfix chief ##############
#            (le, "$g_enemy_fit_for_battle",0),
            (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
            (ge, "$g_friend_fit_for_battle", 1),
            (assign, ":enemy_finished", 1),
          (try_end),
          (this_or_next|eq, ":enemy_finished", 1),
          (eq, "$g_enemy_surrenders", 1),
		  (party_set_slot,"p_main_party",slot_party_siege_camp,0), #Tempered chief added for siege camp
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba

          (assign, "$g_next_menu", "mnu_castle_taken"),
          (jump_to_menu, "mnu_total_victory"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
          (assign, ":main_party_fit_regulars", reg0),
          (eq, "$g_battle_result", -1),
#COOP bugfix ##############
#          (eq, ":main_party_fit_regulars", 0), #all lost (TODO : )
           (le, ":main_party_fit_regulars",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
          (assign, "$g_next_menu", "mnu_captivity_start_castle_defeat"),
		  (party_set_slot,"p_main_party",slot_party_siege_camp,0), #Tempered chief added for siege camp
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba
          (jump_to_menu, "mnu_total_defeat"),
        (try_end),
    ],
    [
      ("siege_request_meeting",[(eq, "$cant_talk_to_enemy", 0),(neq, "$g_empieza_asedio", 0)],"Call for a meeting with the castle commander.", [
          (assign, "$cant_talk_to_enemy", 1),
          (assign, "$g_enemy_surrenders",0),
          (assign, "$g_castle_left_to_player",0),
          (assign, "$talk_context", tc_castle_commander),
          (party_get_num_attached_parties, ":num_attached_parties_to_castle","$g_encountered_party"),
          (try_begin),
            (gt, ":num_attached_parties_to_castle", 0),
            (party_get_attached_party_with_rank, ":leader_attached_party", "$g_encountered_party", 0),
            (call_script, "script_setup_party_meeting", ":leader_attached_party"),
          (else_try),
            (call_script, "script_setup_party_meeting", "$g_encountered_party"),
          (try_end),
           ]),

      ("wait_24_hours",[],"Wait until tomorrow.", [
          (assign,"$auto_besiege_town","$g_encountered_party"),
          (assign, "$g_siege_force_wait", 1),
          (store_time_of_day,":cur_time_of_day"),
          (val_add, ":cur_time_of_day", 1),
          (assign, ":time_to_wait", 31),
          (val_sub,":time_to_wait",":cur_time_of_day"),
          (val_mod,":time_to_wait",24),
          (val_add, ":time_to_wait", 1),
          (rest_for_hours_interactive, ":time_to_wait", 5, 1), #rest while attackable
          (assign, "$cant_talk_to_enemy", 0),
          (change_screen_return),
          ]),

#########Siege Warfare chief
            ("siege_warfare",[(eq, "$g_siege_realism", 1),],
       "Siege Warfare (Planning Siege).", [(assign, "$g_empieza_asedio", 1),(jump_to_menu,"mnu_siege_plan"),]),
            ("siege_assault",[(eq, "$g_siege_realism", 1)],
       "Siege Warfare (Preparing Assault).", [(assign, "$g_empieza_asedio", 1),(jump_to_menu,"mnu_siege_assault")]),
#########Siege warfare acaba


#Tempered chief  begin changes for siege camp
		("siege_camp",[	(party_slot_eq,"p_main_party",slot_party_siege_camp,0),(player_has_item,"itm_tools"),
						],"Entrench your position.",
					[	(call_script,"script_party_entrench_time"),
						(assign,"$auto_besiege_town","$g_encountered_party"),
						(assign, "$g_siege_force_wait", 1),
						(assign,":time_to_wait",reg5),
						(val_add,":time_to_wait",2),
						(rest_for_hours_interactive, ":time_to_wait", 5, 1), #rest while attackable
						(party_set_slot,"p_main_party",slot_party_siege_camp,-1),
						(assign, "$cant_talk_to_enemy", 0),
						(change_screen_return),
					]),
		("siege_camp_interupted",[(party_slot_eq,"p_main_party",slot_party_siege_camp,-1),(player_has_item,"itm_tools"),],"Continue to entrench your position",
					[	(assign,"$auto_besiege_town","$g_encountered_party"),
						(assign, "$g_siege_force_wait", 1),
						(rest_for_hours_interactive, 12, 5, 1),
						(assign, "$cant_talk_to_enemy", 0),
						(change_screen_return),
					]),

		("siege_camp_inspect",[(party_slot_eq,"p_main_party",slot_party_siege_camp,1),],"Inspect the siege camp.",
					[	(assign,"$auto_besiege_town","$g_encountered_party"),
						(assign, "$g_siege_force_wait", 1),
						#(set_jump_mission,"mt_siege_camp"),#Tempered todo have mt call script (call_script, "script_remove_siege_objects"),
						#(party_get_slot,":scene_to_use","$g_encountered_party",slot_center_siege_camp_scene),
#Tempered begin code for using standard entrench scenes
						(call_script,"script_visit_camp"),
#Tempered end code for standard entrench scenes
#Tempered begin code for town/castle siege camp scenes
#						(try_begin),
#							(party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
#							(party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
#						(else_try),
#							(party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
#						(try_end),
#Tempered end code for siege camp scenes

						# (jump_to_scene,":battle_scene"),
						# (change_screen_mission),
					]),

#Tempered end changes


      ("castle_lead_attack",
       [
         (eq, "$g_siege_realism", 0),
         (neg|troop_is_wounded, "trp_player"),
         (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
         (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours", "$g_siege_method_finish_hours"),
       ],
       "Lead your soldiers in an assault.",
       [
           (try_begin),
#Tempered chief begin code for town/castle siege camp scenes
#				(party_slot_eq,"p_main_party",slot_party_siege_camp,1),
#				(party_get_slot, ":battle_scene", "$g_encountered_party", slot_center_siege_camp),
#			(else_try),
#Tempered changes end
           (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
           (else_try),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
           (try_end),

           (call_script, "script_calculate_renown_value"),
           (call_script, "script_calculate_battle_advantage"),
           (assign, ":battle_advantage", reg0),
           (val_mul, ":battle_advantage", 2),
           (val_div, ":battle_advantage", 3), #scale down the advantage a bit in sieges.
           (set_battle_advantage, ":battle_advantage"),
           (set_party_battle_mode),
           (assign, "$g_siege_battle_state", 1),
           (assign, ":siege_sally", 0),
           (try_begin),
             (le, ":battle_advantage", -4), #we are outnumbered, defenders sally out
             (eq, "$g_siege_sallied_out_once", 0),
             (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
             (assign, "$g_siege_battle_state", 0),
             (assign, ":siege_sally", 1),
           (else_try),
             (party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),
             (set_jump_mission,"mt_castle_attack_walls_belfry"),
#siege warfare ram chief
		   (else_try),
		     (party_slot_eq, "$current_town", slot_center_siege_with_ram, 1),
			 (set_jump_mission, "mt_castle_attack_walls_ram"),
#chief acaba
           (else_try),
             (set_jump_mission,"mt_castle_attack_walls_ladder"),
           (try_end),
           (assign, "$cant_talk_to_enemy", 0),
           (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
           (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
           (assign, "$g_siege_method", 0), #reset siege timer
           (jump_to_scene,":battle_scene"),
           (try_begin),
             (eq, ":siege_sally", 1),
             (jump_to_menu, "mnu_siege_attack_meets_sally"),
           (else_try),
             (jump_to_menu, "mnu_battle_debrief"),
             (change_screen_mission),
           (try_end),
       ]),
      ("attack_stay_back",
       [
         (eq, "$g_siege_realism", 0),
        (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
         (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siege_method_finish_hours"),
         ],
       "Order your soldiers to attack while you stay back...", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_castle_attack_walls_simulate")]),

###COOP Siege attack chief#############################
##      ("coop_setup",
##       [
##        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
##        (this_or_next|ge, "$cheat_mode", 1),
##        (eq, "$coop_battle_state", coop_battle_state_none),
##         (ge, "$g_siege_method", 1),
##         (gt, "$g_friend_fit_for_battle", 3),
##         (store_current_hours, ":cur_hours"),
##         (ge, ":cur_hours", "$g_siege_method_finish_hours"),
##       ],
##       "Setup multiplayer battle.",
##       [
##        (assign, "$coop_battle_type", coop_battle_type_siege_player_attack),
##        (assign, "$coop_encountered_party", "$g_enemy_party"),
##        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
##        (try_begin),
##          (eq, "$coop_skip_menu", 1),
##          (change_screen_quit),
##        (try_end),
##
###TODO siege sally
###           (assign, "$g_siege_battle_state", 1),
###           (assign, ":siege_sally", 0),
###           (try_begin),
###             (le, ":battle_advantage", -4), #we are outnumbered, defenders sally out
###             (eq, "$g_siege_sallied_out_once", 0),
###             (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
###             (assign, "$g_siege_battle_state", 0),
###             (assign, ":siege_sally", 1),
###           (else_try),
###             (party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),
###             (set_jump_mission,"mt_castle_attack_walls_belfry"),
###           (else_try),
###             (set_jump_mission,"mt_castle_attack_walls_ladder"),
###           (try_end),
##
##       ]),
##
##
##      ("quit",[
##        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
##        (ge, "$g_siege_method", 1),
##      ],"Quit game (will not save).",
##      [
##        (change_screen_quit),
##      ]),
##
##      ("coop_use_result",[
##         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##         (eq, "$coop_battle_state", coop_battle_state_end_mp),
##         (ge, "$g_siege_method", 1),

##         (store_current_hours, ":cur_hours"),
##         (ge, ":cur_hours", "$g_siege_method_finish_hours"),
##      ],"Use multiplayer battle results.",
##      [
##
##        (call_script, "script_calculate_renown_value"),
##        (assign, "$cant_talk_to_enemy", 0),
##        (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
##        (assign, "$g_next_menu", "mnu_castle_besiege"),
##        (assign, "$g_siege_method", 0), #reset siege timer
##
##        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
##        (jump_to_menu, "mnu_battle_debrief"),
##      ]),
##
##      ("encounter_save",[(ge, "$g_siege_method", 1)],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (leave_encounter),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),
################################################## chief acaba

      ("build_ladders",[         (eq, "$g_siege_realism", 0),
(party_slot_eq, "$current_town", slot_center_siege_with_belfry, 0),(party_slot_eq, "$current_town", slot_center_siege_with_ram, 0),(eq, "$g_siege_method", 0)],
       "Prepare ladders to attack the walls.", [(jump_to_menu,"mnu_construct_ladders")]),

      ("build_siege_tower",[         (eq, "$g_siege_realism", 0),
(party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),(eq, "$g_siege_method", 0)],
       "Build a siege tower.", [(jump_to_menu,"mnu_construct_siege_tower")]),
#####siege warfare chief ram
    ("build_battering_ram", [(eq, "$g_siege_realism", 0),(party_slot_eq, "$current_town", slot_center_siege_with_ram, 1),
	                           (eq, "$g_siege_method", 0)],
       "Build a battering ram.", [(jump_to_menu,"mnu_battering_ram")]),
#siege warfare acaba
      ("cheat_castle_lead_attack",[(eq, "$cheat_mode", 1),
                                   (eq, "$g_siege_method", 0)],
       "{!}CHEAT: Instant build equipments.",
       [
         (assign, "$g_siege_method", 1),
         (assign, "$g_siege_method_finish_hours", 0),
         (jump_to_menu, "mnu_castle_besiege"),
       ]),

      ("cheat_conquer_castle",[(eq, "$cheat_mode", 1),
                                   ],
       "{!}CHEAT: Instant conquer castle.",
       [
        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
       ]),

      ("lift_siege",[],"Abandon the siege.",
       [
         (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
         (assign,"$g_player_besiege_town", -1),
		 (party_set_slot,"p_main_party",slot_party_siege_camp,0),  #Tempered chief added for siege camp
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba
         (change_screen_return)]),
    ]
  ),

#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
#-#-#-#Hunting chief Mod begin#-#-#-#
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
 ("deer_herd",0,
  "You encounter a herd of deer.",
  "none",
  [
  (try_begin),
     (gt, "$num_deers_killed",0),
     (troop_clear_inventory, "trp_temp_troop"),
     (troop_add_items, "trp_temp_troop", "itm_deer_meat", "$num_deers_killed"),
     (troop_add_items, "trp_temp_troop", "itm_raw_leather", "$num_deers_killed"),

     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
     (try_begin),
       (ge, "$num_deers_killed", ":num_deers"),
       (remove_party, "$g_encountered_party"),
     (else_try),
       (party_remove_members, "$g_encountered_party", "trp_deer", "$num_deers_killed"),
     (try_end),
     (assign,"$num_deers_killed",0),
         (troop_sort_inventory, "trp_temp_troop"),
     (change_screen_loot,"trp_temp_troop"),
   (try_end),
   (set_background_mesh, "mesh_pic_extra_caza"),
  ],
   [
     ("deer_kill",
     [
     (try_begin),
       (neg|party_is_active, "$g_encountered_party"),
       (disable_menu_option),
     (try_end),
     ]
     ,"Hunt some of the animals.",
      [
      (set_jump_mission,"mt_deer_hunting"),
      (jump_to_scene,"scn_random_scene_plain_forest2"),
      (change_screen_mission),
       ]
      ),
     ("leave",[],"Leave.",
      [(change_screen_return),
       ]
      ),
     ]
 ),
 ("deer_herd_kill_end",0,
  "You shouldn't be reading this.",
  "none",
  [(change_screen_return)],
   [
     ]
 ),
##coat
##   ("coat_herd",0,
##  "You encounter a herd of goat.",
##  "none",
##  [
##  (try_begin),
##     (gt, "$num_coats_killed",0),
##     (troop_clear_inventory, "trp_temp_troop"),
##     (troop_add_items, "trp_temp_troop", "itm_coat_meat", "$num_coats_killed"),
##
##     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
##     (try_begin),
##       (ge, "$num_coats_killed", ":num_deers"),
##       (remove_party, "$g_encountered_party"),
##     (else_try),
##       (party_remove_members, "$g_encountered_party", "trp_coat", "$num_coats_killed"),
##     (try_end),
##     (assign,"$num_coats_killed",0),
##         (troop_sort_inventory, "trp_temp_troop"),
##     (change_screen_loot,"trp_temp_troop"),
##   (try_end),
##   (set_background_mesh, "mesh_pic_extra_caza"),
##  ],
##   [
##     ("coat_kill",
##     [
##     (try_begin),
##       (neg|party_is_active, "$g_encountered_party"),
##       (disable_menu_option),
##     (try_end),
##     ]
##     ,"Hunt some of the animals.",
##      [
##      (set_jump_mission,"mt_coat_hunting"),
##      (jump_to_scene,"scn_random_scene_plain_forest2"),
##      (change_screen_mission),
##       ]
##      ),
##     ("leave",[],"Leave.",
##      [(change_screen_return),
##       ]
##      ),
##     ]
## ),
## ("coat_herd_kill_end",0,
##  "You shouldn't be reading this.",
##  "none",
##  [(change_screen_return)],
##   [
##     ]
## ),

   ("coat_herd",0,
  "You encounter a herd of goat. They belong to the flock of a pastor who swings his sling at you until you move away.",
  "none",
  [
  (try_begin),
     (gt, "$num_coatbs_killed",0),
     (troop_clear_inventory, "trp_temp_troop"),
     (troop_add_items, "trp_temp_troop", "itm_coat_2_meat", "$num_coatbs_killed"),
     (troop_add_items, "trp_temp_troop", "itm_raw_leather", "$num_coatbs_killed"),

     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
     (try_begin),
       (ge, "$num_coatbs_killed", ":num_deers"),
       (remove_party, "$g_encountered_party"),
     (else_try),
       (party_remove_members, "$g_encountered_party", "trp_coat_b", "$num_coatbs_killed"),
     (try_end),
     (assign,"$num_coatbs_killed",0),
         (troop_sort_inventory, "trp_temp_troop"),
     (change_screen_loot,"trp_temp_troop"),
   (try_end),
   (set_background_mesh, "mesh_pic_extra_caza"),
  ],
   [
##     ("coatb_kill",
##     [
##     (try_begin),
##       (neg|party_is_active, "$g_encountered_party"),
##       (disable_menu_option),
##     (try_end),
##     ]
##     ,"Hunt some of the animals.",
##      [
##      (set_jump_mission,"mt_coatb_hunting"),
##      (jump_to_scene,"scn_random_scene_plain_forest2"),
##      (change_screen_mission),
##       ]
##      ),
     ("leave",[],"Leave.",
      [(change_screen_return),
       ]
      ),
     ]
 ),
 ("coatb_herd_kill_end",0,
  "You shouldn't be reading this.",
  "none",
  [(change_screen_return)],
   [
     ]
 ),

   ("coatb_herd",0,
  "You encounter a herd of goat.",
  "none",
  [
  (try_begin),
     (gt, "$num_coatbs_killed",0),
     (troop_clear_inventory, "trp_temp_troop"),
     (troop_add_items, "trp_temp_troop", "itm_coat_2_meat", "$num_coatbs_killed"),
     (troop_add_items, "trp_temp_troop", "itm_raw_leather", "$num_coatbs_killed"),

     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
     (try_begin),
       (ge, "$num_coatbs_killed", ":num_deers"),
       (remove_party, "$g_encountered_party"),
     (else_try),
       (party_remove_members, "$g_encountered_party", "trp_coat_b", "$num_coatbs_killed"),
     (try_end),
     (assign,"$num_coatbs_killed",0),
         (troop_sort_inventory, "trp_temp_troop"),
     (change_screen_loot,"trp_temp_troop"),
   (try_end),
   (set_background_mesh, "mesh_pic_extra_caza"),
  ],
   [
     ("coatb_kill",
     [
     (try_begin),
       (neg|party_is_active, "$g_encountered_party"),
       (disable_menu_option),
     (try_end),
     ]
     ,"Hunt some of the animals.",
      [
      (set_jump_mission,"mt_coatb_hunting"),
      (jump_to_scene,"scn_random_scene_plain_forest2"),
      (change_screen_mission),
       ]
      ),
     ("leave",[],"Leave.",
      [(change_screen_return),
       ]
      ),
     ]
 ),
 ("coatb_herd_kill_end",0,
  "You shouldn't be reading this.",
  "none",
  [(change_screen_return)],
   [
     ]
 ),
###coats acaba

 ("boar_herd",0,
  "You encounter a herd of boars.",
  "none",
  [
  (try_begin),
     (gt, "$num_boars_killed",0),
     (troop_clear_inventory, "trp_temp_troop"),
     (troop_add_items, "trp_temp_troop", "itm_boar_meat", "$num_boars_killed"),
     (troop_add_items, "trp_temp_troop", "itm_bl_boar_fur", "$num_boars_killed"),

     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
     (try_begin),
       (ge, "$num_boars_killed", ":num_deers"),
       (remove_party, "$g_encountered_party"),
     (else_try),
       (party_remove_members, "$g_encountered_party", "trp_boar", "$num_boars_killed"),
     (try_end),
     (assign,"$num_boars_killed",0),
         (troop_sort_inventory, "trp_temp_troop"),
     (change_screen_loot,"trp_temp_troop"),
   (try_end),
   (set_background_mesh, "mesh_pic_extra_caza"),
  ],
   [
     ("boar_kill",[
     (try_begin),
       (neg|party_is_active, "$g_encountered_party"),
       (disable_menu_option),
     (try_end),
     ],"Hunt some of the animals.",
      [
      (set_jump_mission,"mt_boar_hunting"),
      (jump_to_scene,"scn_random_scene_plain_forest2"),
      (change_screen_mission),
       ]
      ),
     ("leave",[],"Leave.",
      [(change_screen_return),
       ]
      ),
     ]
 ),
 ("boar_herd_kill_end",0,
  "You shouldn't be reading this.",
  "none",
  [(change_screen_return)],
   [
     ]
 ),

 ("wolf_herd",0,
  "You encounter a pack of wolves.",
  "none",
  [
  (try_begin),
     (gt, "$num_wolfs_killed",0),
     (troop_clear_inventory, "trp_temp_troop"),
     (troop_add_items, "trp_temp_troop", "itm_wolf_meat", "$num_wolfs_killed"),
     (troop_add_items, "trp_temp_troop", "itm_furs", "$num_wolfs_killed"),

     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
     (try_begin),
       (ge, "$num_wolfs_killed", ":num_deers"),
       (remove_party, "$g_encountered_party"),
     (else_try),
       (party_remove_members, "$g_encountered_party", "trp_wolf", "$num_wolfs_killed"),
     (try_end),
     (assign,"$num_wolfs_killed",0),
         (troop_sort_inventory, "trp_temp_troop"),
     (change_screen_loot,"trp_temp_troop"),
   (try_end),
   (set_background_mesh, "mesh_pic_extra_caza"),
  ],
   [
     ("wolf_kill",[
     (try_begin),
       (neg|party_is_active, "$g_encountered_party"),
       (disable_menu_option),
     (try_end),
     ],"Hunt some of the animals.",
      [
      (set_jump_mission,"mt_wolf_hunting"),
      (jump_to_scene,"scn_random_scene_plain_forest2"),
      (change_screen_mission),
       ]
      ),
     ("leave",[],"Leave.",
      [(change_screen_return),
       ]
      ),
     ]
 ),
 ("wolf_herd_kill_end",0,
  "You shouldn't be reading this.",
  "none",
  [(change_screen_return)],
   [
     ]
 ),

   ("wilddonkey_herd",0,
  "You encounter a herd of Wild Donkey.",
  "none",
  [
  (try_begin),
     (gt, "$num_wilddonkeys_killed",0),
     (troop_clear_inventory, "trp_temp_troop"),
     (troop_add_items, "trp_temp_troop", "itm_wilddonkey_meat", "$num_wilddonkeys_killed"),

     (party_get_num_companions, ":num_deers", "$g_encountered_party"),
     (try_begin),
       (ge, "$num_wilddonkeys_killed", ":num_deers"),
       (remove_party, "$g_encountered_party"),
     (else_try),
       (party_remove_members, "$g_encountered_party", "trp_wilddonkey", "$num_wilddonkeys_killed"),
     (try_end),
     (assign,"$num_wilddonkeys_killed",0),
         (troop_sort_inventory, "trp_temp_troop"),
     (change_screen_loot,"trp_temp_troop"),
   (try_end),
   (set_background_mesh, "mesh_pic_extra_caza"),
  ],
   [
     ("wilddonkey_kill",
     [
     (try_begin),
       (neg|party_is_active, "$g_encountered_party"),
       (disable_menu_option),
     (try_end),
     ]
     ,"Hunt some of the animals.",
      [
      (set_jump_mission,"mt_wilddonkey_hunting"),
      (jump_to_scene,"scn_random_scene_plain_forest2"),
      (change_screen_mission),
       ]
      ),
     ("leave",[],"Leave.",
      [(change_screen_return),
       ]
      ),
     ]
 ),
 ("wilddonkey_herd_kill_end",0,
  "You shouldn't be reading this.",
  "none",
  [(change_screen_return)],
   [
     ]
 ),

  #-#-#-#-#-#-#-#-#-#-#-#-#-#-#
#-#-#-#Hunting chief Mod end#-#-#-#
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
######Siege warfare Chief
    (
    "siege_plan",0,
    "You meet with your advisers to plan the siege and try to conquer the settlement with the least possible casualties. Your strategy will be to render the place by famine and morale^^{s15}^{s16}^{s17}^{s18}^{s19}^{s20}",
    "none",
    [
        (set_background_mesh, "mesh_siegeplan"),
#string para circunvalacion
		(str_store_string,s15,"str_circunvalation_none"),
		(try_begin),
           (eq, "$g_siege_circunvalation", 1),
			(str_store_string,s15,"str_circunvalation_incomplete"),
		(else_try),
           (eq, "$g_siege_circunvalation", 2),
			(str_store_string,s15,"str_circunvalation_complete"),
		(try_end),
#
#string para cerrar puerto
                                          (try_begin),
(party_slot_eq,"$current_town",slot_town_port, 1),
		(str_store_string,s16,"str_puerto_none"),
		(try_begin),
           (eq, "$g_close_port", 1),
			(str_store_string,s16,"str_puerto_incomplete"),
		(else_try),
           (eq, "$g_close_port", 2),
			(str_store_string,s16,"str_puerto_complete"),
		(try_end),
	(try_end),

        ####strings traicion
		(str_store_string,s17,"str_empty_string"),
		(try_begin),
           (eq, "$g_traicion_interna", 2),
			(str_store_string,s17,"@>>Your attempt to find a traitor in the settlement has failed."),
		(else_try),
           (eq, "$g_traicion_interna", 3),
			(str_store_string,s17,"@>>You have found a traitor within the city that has supported your efforts to conquer."),
		(try_end),

#####strings quemar campos cercanos
		(str_store_string,s18,"str_empty_string"),
		(try_begin),
           (eq, "$g_campos_cercanos", 2),
			(str_store_string,s18,"@>>You've burned the crops and farms nearby."),
		(else_try),
           (eq, "$g_campos_cercanos", 1),
			(str_store_string,s18,"@>>Your men are burning and attacking crops and farms close by on your command."),
		(try_end),
         ####strings infiltrado
		(str_store_string,s19,"str_empty_string"),
		(try_begin),
           (eq, "$g_infiltracion_interna", 2),
			(str_store_string,s19,"@>>Your attempt to infiltrate your men in the settlement has failed."),
		(else_try),
           (eq, "$g_infiltracion_interna", 3),
			(str_store_string,s19,"@>>Your men have succeeded in infiltrating and damaging the enemy."),
		(try_end),
         ####saneamiento chief
		(str_store_string,s20,"str_empty_string"),
		(try_begin),
           (eq, "$g_siege_saneamiento", 0),
			(str_store_string,s20,"@>>Your camp smells horrible. The ground is muddy, your men defecate between tents, and you see rats running here and there."),
		(else_try),
           (eq, "$g_siege_saneamiento", 1),
			(str_store_string,s20,"@>>As a disciplined army, your men have latrines, pipelines and a water well to cool off and wash in weekly. A healthy camp prevents disease."),
		(try_end),

    ],
    [


#####disfrazarte para entrar en la ciudad e investigar sus defensas
              ("town_investigar",
        [
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

          (party_slot_eq|neg, "$g_encountered_party", slot_town_lord, "trp_player"), #chief anadido blood
        ],
       "Infiltrate yourself and attempt starting to investigate {s7} defenses.",
       [
         (faction_get_slot, ":player_alarm", "$g_encountered_party_faction", slot_faction_player_alarm),
         (party_get_num_companions, ":num_men", "p_main_party"),
         (party_get_num_prisoners, ":num_prisoners", "p_main_party"),
         (val_add, ":num_men", ":num_prisoners"),
         (val_mul, ":num_men", 3),
         (val_div, ":num_men", 8),
         (store_add, ":get_caught_chance", ":player_alarm", ":num_men"),
         (store_random_in_range, ":random_chance", 0, 100),
         (try_begin),
           (this_or_next|ge, ":random_chance", ":get_caught_chance"),
           (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
           (assign, "$g_last_defeated_bandits_town", 0),
           (assign, "$sneaked_into_town",1),
           (assign, "$town_entered", 1),
           (jump_to_menu,"mnu_sneak_into_town_suceeded2"),
           (assign, "$g_mt_mode", tcm_disguised),
         (else_try),
           (jump_to_menu,"mnu_sneak_into_town_caught"),
         (try_end),
         ]),

#traicion interna
              ("traicion_interna",
        [
      (eq, "$g_siege_circunvalation", 2),
      (eq, "$g_traicion_interna", 0),
       (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

          (party_slot_eq|neg, "$g_encountered_party", slot_town_lord, "trp_player"), #chief anadido blood
        ],
       "Find a traitor within {s7} defenses.",
       [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 10), # se muestra si el player tiene por lo menos 10 hombres
           (jump_to_menu,"mnu_traicion_interna2"),
      (else_try),
        (display_message,"@ You need to have more men for this work."),
      (try_end),
         ]),


      ("traicion_interna3",[           (eq, "$g_traicion_interna", 1),
                                                                                     (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siegewarfare_metodo"),
       ],
       "Any news on the men sent in search of a traitor?", [
          (store_random_in_range, ":rand", 0, 5),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_traicion_resultado1"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_traicion_resultado2"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_traicion_resultado3"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_traicion_resultado4"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_traicion_resultado5"),
          (try_end),
            ]),

###circunvalacion de asedio
      ("build_circunvalation",[
#obtiene numero de hombres de el ejercito del player
           (eq, "$g_siege_circunvalation", 0),],
       "Block Place. Build circunvallation around the settlement (200 men need).", [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 200), # se muestra si el player tiene por lo menos 200 hombres
           (jump_to_menu,"mnu_construct_circunvalation"),
      (else_try),
        (display_message,"@ You need to have more men for this work."),
      (try_end),
                 ]),

      ("close_circunvalation",[           (eq, "$g_siege_circunvalation", 1),
                                                   (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siegewarfare_metodo"),],
       "Your men have worked hard and the circunvalation is done (Order close it).", [
        #Reduce prosperity of the center by 3
        (call_script, "script_change_center_prosperity", "$g_encountered_party", -3),
      (party_set_slot,"$g_encountered_party",centro_bloqueado, 1),
       (assign, "$g_siege_circunvalation", 2),
           (jump_to_menu,"mnu_siege_plan")]),
#####circunvalacion acaba
              ####maniobras de infiltracion chief
                            ("infiltracion_interna",
        [
      (eq, "$g_siege_circunvalation", 2),
      (eq, "$g_infiltracion_interna", 0),
       (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

          (party_slot_eq|neg, "$g_encountered_party", slot_town_lord, "trp_player"), #chief anadido blood
        ],
       "Infiltrate some men in the defences of {s7} to cause damage.",
       [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 20), # se muestra si el player tiene por lo menos 10 hombres
           (jump_to_menu,"mnu_infiltracion_interna2"),
      (else_try),
        (display_message,"@ You need to have more men for this work."),
      (try_end),
         ]),

      ("infiltracion_interna3",[           (eq, "$g_infiltracion_interna", 1),
                                                                                     (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siegewarfare_metodo"),
       ],
       "Any news on the men sent to infiltrate?", [
          (store_random_in_range, ":rand", 0, 5),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_infiltracion_resultado1"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_infiltracion_resultado2"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_infiltracion_resultado3"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_infiltracion_resultado4"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_infiltracion_resultado5"),
          (try_end),
            ]),
####maniobras de infiltracion chief acaba
#####cerrar puerto
      ("closed_port",[
#obtiene numero de hombres de el ejercito del player
(party_slot_eq,"$g_encountered_party",slot_town_port, 1),
(eq, "$g_close_port", 0),
],
       "Order block Port / assault from the coast (150 men need).", [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 150), # se muestra si el player tiene por lo menos 200 hombres
           (jump_to_menu,"mnu_block_port"),
      (else_try),
        (display_message,"@ You need to have more men for this work."),
      (try_end),
      ]),


      ("closed_port2",[           (eq, "$g_close_port", 1),
                                                                                     (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siegewarfare_metodo"),
       ],
       "Many ships have been seized and your men are ready for action (Order closed port).", [
          (store_random_in_range, ":rand", 0, 8),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_port_battle1"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_port_battle2"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_port_battle3"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_port_battle4"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_port_battle5"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_port_battle6"),
                                          (else_try),
                                            (eq, ":rand", 6),
       (jump_to_menu,"mnu_port_battle7"),
                                          (else_try),
                                            (eq, ":rand", 7),
       (jump_to_menu,"mnu_port_battle8"),
          (try_end),
#####cerrar puerto
            ]),

      ("closed_port3",[
       ],
       "Coastal Assault (attack the settlement from the sea)", [
                                          (try_begin),
 (eq, "$g_close_port", 2),
       (jump_to_menu,"mnu_siege_assault"),
                                          (else_try),
        (display_message,"@ You need Block Port first."),
          (try_end),
            ]),

              #####construir letrinas, canalizaciones para evitar acumulacion de barro con la lluvia, cavar pozos para suministro de agua
                    ("build_varios",[
#obtiene numero de hombres de el ejercito del player
           (eq, "$g_siege_saneamiento", 0),],
       "Order the construction of sanitation to prevent disease.", [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 50), # se muestra si el player tiene por lo menos 200 hombres
           (jump_to_menu,"mnu_construct_saneamiento"),
      (else_try),
        (display_message,"@ You need to have more men for this work."),
      (try_end),
                 ]),
####construir chief letrinas, canalizaciones y pozos acaba
#destruir campos cercanos para obtener comida y empobrecer a la ciudad
      ("destruir_campos_a",[
           (eq, "$g_campos_cercanos", 0),],
       "Loot and destroy crops and farms nearby (for food and to impoverish the town).", [
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
      (try_begin),
          (gt, ":num_men", 50), # se muestra si el player tiene por lo menos 200 hombres
           (assign, "$g_campos_cercanos", 1),
          (assign,"$auto_besiege_town","$g_encountered_party"),
          (assign, "$g_siege_force_wait", 1),
          (store_time_of_day,":cur_time_of_day"),
          (val_add, ":cur_time_of_day", 1),
          (assign, ":time_to_wait", 31),
          (val_sub,":time_to_wait",":cur_time_of_day"),
          (val_mod,":time_to_wait",24),
          (val_add, ":time_to_wait", 1),
          (rest_for_hours_interactive, ":time_to_wait", 5, 1), #rest while attackable
          (assign, "$cant_talk_to_enemy", 0),
          (change_screen_return),
      (else_try),
        (display_message,"@ You need to have more men for this work."),
      (try_end),
                 ]),

      ("destruir_campos_b",[
           (eq, "$g_campos_cercanos", 1),],
       "What's new on the men who I sent to destroy crops and farms nearby?", [
#          (store_current_month, ":cur_month"),
                                          (try_begin),
          (this_or_next|eq, "$g_cur_month", 3),
          (this_or_next|eq, "$g_cur_month", 4),
          (eq, "$g_cur_month", 5),
        (jump_to_menu,"mnu_campos_cercanos1"),
                                          (else_try),
          (this_or_next|eq, "$g_cur_month", 9),
          (this_or_next|eq, "$g_cur_month", 10),
          (eq, "$g_cur_month", 11),
       (jump_to_menu,"mnu_campos_cercanos2"),
                                          (else_try),
          (this_or_next|eq, "$g_cur_month", 12),
          (this_or_next|eq, "$g_cur_month", 1),
          (eq, "$g_cur_month", 2),
       (jump_to_menu,"mnu_campos_cercanos3"),
                                          (else_try),
          (this_or_next|eq, "$g_cur_month", 6),
          (this_or_next|eq, "$g_cur_month", 7),
          (eq, "$g_cur_month", 8),
       (jump_to_menu,"mnu_campos_cercanos4"),
          (try_end),
                 ]),


      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),

      ("lift_siege",[],"Abandon the siege.",
       [
         (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
         (assign,"$g_player_besiege_town", -1),
		 (party_set_slot,"p_main_party",slot_party_siege_camp,0),  #Tempered chief added for siege camp
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba
         (change_screen_return)]),
    ]
  ),


###############assault
      (
    "siege_assault",0,
    "Time is gold and you fear the arrival of support for the place. Assaulting will mean heavy casualties, but it is your decision.^^{s17}^^{s18}",
    "none",
    [
        (set_background_mesh, "mesh_siegeassault"),
        (str_store_party_name,s4,"$current_town"),
        ####listos para asalto
		(str_store_string,s17,"str_empty_string"),
		(try_begin),
           (neq, "$g_listos_para_asalto", 1),
           (eq, "$g_siege_method", 1),
			(str_store_string,s17,"@>>The assault equipment is ready, the troops await your orders."),
		(else_try),
           (eq, "$g_listos_para_asalto", 1),
          (this_or_next|eq, "$g_cur_month", 3),
          (this_or_next|eq, "$g_cur_month", 4),
          (eq, "$g_cur_month", 5),
			(str_store_string,s17,"@>>You look at {s4}. Your men are silent while waiting for your order to charge towards death. Your muscles are tense, hot for battle, your mind cold and adrenaline fills your veins^\
A man breathes deeply. 'Do you smell that?', he asks, 'That is the scent of glory'. 'Are you ready to seize it?'."),
		(else_try),
           (eq, "$g_listos_para_asalto", 1),
          (this_or_next|eq, "$g_cur_month", 9),
          (this_or_next|eq, "$g_cur_month", 10),
          (eq, "$g_cur_month", 11),
			(str_store_string,s17,"@>>The steel of the weapons shine, banners sway in the wind and horns sound. The men whisper, many pray, ingratiate themselves with their god before facing the end of their lives. Up ahead there are only two things: victory or death.^\
 War ... war never changes."),
		(else_try),
           (eq, "$g_listos_para_asalto", 1),
          (this_or_next|eq, "$g_cur_month", 12),
          (this_or_next|eq, "$g_cur_month", 1),
          (eq, "$g_cur_month", 2),
			(str_store_string,s17,"@>>Winter is the worst time to fight, but there you are in the cold months, ready to undertake the conquest of {s4}. Many people think you're a daredevil, others a madman. But no one knows that someday you will be Brytenwalda."),
		(else_try),
           (eq, "$g_listos_para_asalto", 1),
          (this_or_next|eq, "$g_cur_month", 6),
          (this_or_next|eq, "$g_cur_month", 7),
          (eq, "$g_cur_month", 8),
			(str_store_string,s17,"@>>It's summer and hot, maybe too hot. But at that moment, you do not feel anything. As always, before the battle, you set aside time for a few inevitable memories of the past... Then, close your mind, ready for battle, prepared, in the worst case, to face death."),
		(try_end),
#(eq, "$g_mantlets_1", 0),
        		(str_store_string,s18,"str_empty_string"),
		(try_begin),
          (eq, "$g_mantlets_1", 1),
			(str_store_string,s18,"@>>Your men have finished building the mantlets. Now you can use them to protect your soldiers in the vanguard attack, and your main force for the final charge."),
    ],
    [

#####scout da pinceladas
              ("scout_investigar",
        [
          (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

          (party_slot_eq|neg, "$g_encountered_party", slot_town_lord, "trp_player"), #chief anadido blood
        ],
       "Order a scout to come close to the town and provide data on the defences of {s7}.",
       [
           (jump_to_menu,"mnu_informacion_ciudad"),
         ]),

              ("build_mantlet",
        [           (eq, "$g_mantlets_1", 0),
        ],
       "Build mantlets.",
       [
           (jump_to_menu,"mnu_build_mantles2"),
         ]),

      ("poniendo_elementos",
       [(neq, "$g_mantlets_1", 1),
       (neq, "$g_listos_para_asalto", 1),
       (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
         (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siege_method_finish_hours"),
         ],
       "Order the vanguard to place assault elements and prepare to charge with the main army under your command.", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_poner_escaleras")]),

      ("poniendo_elementos_mantles",
       [(eq, "$g_mantlets_1", 1),
       (neq, "$g_listos_para_asalto", 1),
       (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
         (store_current_hours, ":cur_hours"),
         (ge, ":cur_hours",  "$g_siege_method_finish_hours"),
         ],
       "Order the vanguard to use mantlets and place the elements of assault, and prepare to charge with the main army under your command.", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_poner_escaleras_mantlets")]),

      ("closed_port4",[         (neg|troop_is_wounded, "trp_player"),
           (eq, "$g_close_port", 2),
       ],
       "Coastal Assault: Your men are ready to engage and attack from the sea.", [
           (try_begin),
          (eq, "$g_encountered_party", "p_town_2"),
                                    (assign, ":battle_scene", "scn_town_2_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_7"),
                                    (assign, ":battle_scene", "scn_town_7_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_13"),
                                    (assign, ":battle_scene", "scn_town_13_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_17"),
                                    (assign, ":battle_scene", "scn_town_17_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_19"),
                                    (assign, ":battle_scene", "scn_town_19_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_27"),
                                    (assign, ":battle_scene", "scn_town_27_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_32"),
                                    (assign, ":battle_scene", "scn_town_32_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_33"),
                                    (assign, ":battle_scene", "scn_town_33_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_town_37"),
                                    (assign, ":battle_scene", "scn_town_37_walls2"),
           (else_try),
          (eq, "$g_encountered_party", "p_castle_42"),
                                    (assign, ":battle_scene", "scn_castle_42_exterior2"),
           (try_end),

           (call_script, "script_calculate_renown_value"),
           (call_script, "script_calculate_battle_advantage"),
           (assign, ":battle_advantage", reg0),
           (val_mul, ":battle_advantage", 2),
           (val_div, ":battle_advantage", 3), #scale down the advantage a bit in sieges.
           (set_battle_advantage, ":battle_advantage"),
           (set_party_battle_mode),
           (assign, "$g_siege_battle_state", 1),
           (assign, ":siege_sally", 0),
           (try_begin),
             (le, ":battle_advantage", -4), #we are outnumbered, defenders sally out
             (eq, "$g_siege_sallied_out_once", 0),
             (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
             (assign, "$g_siege_battle_state", 0),
             (assign, ":siege_sally", 1),
           (else_try),
             (party_slot_eq, "$current_town", slot_town_port, 1),
             (set_jump_mission,"mt_castle_attack_walls_ladder_coastal"),
           (try_end),
           (assign, "$cant_talk_to_enemy", 0),
           (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
           (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
           (assign, "$g_siege_method", 0), #reset siege timer
           (jump_to_scene,":battle_scene"),
           (try_begin),
             (eq, ":siege_sally", 1),
             (jump_to_menu, "mnu_siege_attack_meets_sally"),
           (else_try),
             (jump_to_menu, "mnu_battle_debrief"),
             (change_screen_mission),
           (try_end),
       ]),
###asalto desde mar

      ("castle_lead_attack",
       [
         (neg|troop_is_wounded, "trp_player"),
         (eq, "$g_listos_para_asalto", 1),
         (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
       ],
       "The hour has arrived. Lead your soldiers in an assault! Blood, sweat and steel...",
       [
           (try_begin),
#Tempered chief begin code for town/castle siege camp scenes
#				(party_slot_eq,"p_main_party",slot_party_siege_camp,1),
#				(party_get_slot, ":battle_scene", "$g_encountered_party", slot_center_siege_camp),
#			(else_try),
#Tempered changes end
           (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
           (else_try),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
           (try_end),

           (call_script, "script_calculate_renown_value"),
           (call_script, "script_calculate_battle_advantage"),
           (assign, ":battle_advantage", reg0),
           (val_mul, ":battle_advantage", 2),
           (val_div, ":battle_advantage", 3), #scale down the advantage a bit in sieges.
           (set_battle_advantage, ":battle_advantage"),
           (set_party_battle_mode),
           (assign, "$g_siege_battle_state", 1),
           (assign, ":siege_sally", 0),
           (try_begin),
             (le, ":battle_advantage", -4), #we are outnumbered, defenders sally out
             (eq, "$g_siege_sallied_out_once", 0),
             (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
             (assign, "$g_siege_battle_state", 0),
             (assign, ":siege_sally", 1),
           (else_try),
             (party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),
             (set_jump_mission,"mt_castle_attack_walls_belfry"),
#siege warfare ram chief
		   (else_try),
		     (party_slot_eq, "$current_town", slot_center_siege_with_ram, 1),
			 (set_jump_mission, "mt_castle_attack_walls_ram"),
#siege warfare acaba
           (else_try),
             (set_jump_mission,"mt_castle_attack_walls_ladder"),
           (try_end),
           (assign, "$cant_talk_to_enemy", 0),
           (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
           (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
           (assign, "$g_siege_method", 0), #reset siege timer
           (jump_to_scene,":battle_scene"),
           (try_begin),
             (eq, ":siege_sally", 1),
             (jump_to_menu, "mnu_siege_attack_meets_sally"),
           (else_try),
             (jump_to_menu, "mnu_battle_debrief"),
             (change_screen_mission),
           (try_end),
       ]),
      ("attack_stay_back",
       [
(eq, "$g_listos_para_asalto", 1),
        (ge, "$g_siege_method", 1),
         (gt, "$g_friend_fit_for_battle", 3),
         ],
       "Order your soldiers to assault while you stay back...", [(assign, "$cant_talk_to_enemy", 0),(jump_to_menu,"mnu_castle_attack_walls_simulate2")]),

###COOP Siege attack chief#############################
##      ("coop_setup",
##       [
##        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
##        (this_or_next|ge, "$cheat_mode", 1),
##        (this_or_next|eq, "$coop_battle_state", coop_battle_state_none),
##        (eq, "$g_listos_para_asalto", 1), #siege warfare chief
##         (ge, "$g_siege_method", 1),
##         (gt, "$g_friend_fit_for_battle", 3),
##         (store_current_hours, ":cur_hours"),
##         (ge, ":cur_hours", "$g_siege_method_finish_hours"),
##       ],
##       "Setup multiplayer battle.",
##       [
##        (assign, "$coop_battle_type", coop_battle_type_siege_player_attack),
##        (assign, "$coop_encountered_party", "$g_enemy_party"),
##        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
##        (try_begin),
##          (eq, "$coop_skip_menu", 1),
##          (change_screen_quit),
##        (try_end),
##
###TODO siege sally
###           (assign, "$g_siege_battle_state", 1),
###           (assign, ":siege_sally", 0),
###           (try_begin),
###             (le, ":battle_advantage", -4), #we are outnumbered, defenders sally out
###             (eq, "$g_siege_sallied_out_once", 0),
###             (set_jump_mission,"mt_castle_attack_walls_defenders_sally"),
###             (assign, "$g_siege_battle_state", 0),
###             (assign, ":siege_sally", 1),
###           (else_try),
###             (party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),
###             (set_jump_mission,"mt_castle_attack_walls_belfry"),
###           (else_try),
###             (set_jump_mission,"mt_castle_attack_walls_ladder"),
###           (try_end),
##
##       ]),
##
##
##      ("quit",[
##        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##        (this_or_next|eq, "$coop_battle_state", coop_battle_state_setup_sp),
##        (eq, "$g_listos_para_asalto", 1), #siege warfare chief
##        (ge, "$g_siege_method", 1),
##      ],"Quit game (will not save).",
##      [
##        (change_screen_quit),
##      ]),
##
##      ("coop_use_result",[
##         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##         (this_or_next|eq, "$coop_battle_state", coop_battle_state_end_mp),
##        (eq, "$g_listos_para_asalto", 1), #siege warfare chief
##         (ge, "$g_siege_method", 1),
##         (store_current_hours, ":cur_hours"),
##         (ge, ":cur_hours", "$g_siege_method_finish_hours"),
##      ],"Use multiplayer battle results.",
##      [
##
##        (call_script, "script_calculate_renown_value"),
##        (assign, "$cant_talk_to_enemy", 0),
##        (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
##        (assign, "$g_next_menu", "mnu_castle_besiege"),
##        (assign, "$g_siege_method", 0), #reset siege timer
##        (assign, "$g_listos_para_asalto", 0), #siege warfare chief
##
##        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
##        (jump_to_menu, "mnu_battle_debrief"),
##      ]),
##
##      ("encounter_save",[(eq, "$g_listos_para_asalto", 1),(ge, "$g_siege_method", 1)],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (leave_encounter),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),
################################################## chief acaba

#siege warfare ram
      ("build_ladders",[(party_slot_eq, "$current_town", slot_center_siege_with_belfry, 0),(party_slot_eq, "$current_town", slot_center_siege_with_ram, 0),(eq, "$g_siege_method", 0)],
       "Build equipment to prepare the assault on the fortress (ladders, mine, ramps...). Assault is unpredictable, with many casualties.", [(jump_to_menu,"mnu_construct_ladders")]),

      ("build_siege_tower",[(party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),(eq, "$g_siege_method", 0)],
       "Build Siege Tower and equipment to prepare the assault on the fortress . Assault is unpredictable, with many casualties.", [(jump_to_menu,"mnu_construct_siege_tower")]),
#siege warfare ram chief
                   ("build_battering_ram", [(party_slot_eq, "$current_town", slot_center_siege_with_ram, 1),
	                           (eq, "$g_siege_method", 0)],
       "Build a battering ram and equipment to prepare the assault on the fortress . Assault is unpredictable, with many casualties.", [(jump_to_menu,"mnu_battering_ram")]),
#siege warfare ram acaba
      ("cheat_castle_lead_attack",[(eq, "$cheat_mode", 1),
                                   (eq, "$g_siege_method", 0)],
       "{!}CHEAT: Instant build equipments.",
       [
         (assign, "$g_siege_method", 1),
         (assign, "$g_siege_method_finish_hours", 0),
         (jump_to_menu, "mnu_castle_besiege"),
       ]),

      ("cheat_conquer_castle",[(eq, "$cheat_mode", 1),
                                   ],
       "{!}CHEAT: Instant conquer castle.",
       [
        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
       ]),


      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),

      ("lift_siege",[],"Abandon the siege.",
       [
         (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
         (assign,"$g_player_besiege_town", -1),
		 (party_set_slot,"p_main_party",slot_party_siege_camp,0),  #Tempered chief added for siege camp
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba
         (change_screen_return)]),

              ]
  ),


  #####Siege warfare acaba


  (
    "siege_attack_meets_sally",0,
    "The defenders sally out to meet your assault.",
    "none",
    [
        (set_background_mesh, "mesh_pic_sally_out1"),
    ],
    [
      ("continue",[],
       "Continue...",
       [
             (jump_to_menu, "mnu_battle_debrief"),
             (change_screen_mission),
       ]),
    ]
  ),

  #AJM chief begin THIS MENU IS DISPLAYED WHEN THE DEFENDERS SALLY OUT DUE TO LOW FOOD STORES
  (
    "siege_defenders_running_low_food_sally_drive_off_siege",0,
    "Running low on food, the defenders sally out in a desperate attempt to break the siege.",
    "none",
    [
    ],
    [
      ("continue",[],
       "Continue...",
       [
             (jump_to_menu, "mnu_battle_debrief"),
             (change_screen_mission),
       ]),
    ]
  ),

  #AJM chief THIS MENU IS JUMPED TO FROM CASTLE_BESIEGE WHEN THEY SURRENDER DUE TO HUNGER
    (
    "siege_defenders_starved_give_up",0,
    "On the brink of starvation, the weakened defenders surrender rather than face a slow, agonizing death.",
    "none",
    [
    ],
    [
      ("continue",[],
       "Continue...",
       [
          (assign, "$g_enemy_surrenders",1),
          (jump_to_menu, "mnu_castle_besiege"), #AJM JUMP BACK TO CASTLE_BESIEGE, WHICH HANDLES THE SURRENDER WITH EXISTING CODE
       ]),
    ]
  ),
#ajm chief end#########


   (
    "castle_besiege_inner_battle",mnf_scale_picture,
    "{s1}",
    "none",
    [
        (troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
        (try_begin),
          (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_siege_sighted_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_siege_sighted"),
        (try_end),
        (assign, ":result", "$g_battle_result"),#will be reset at script_encounter_calculate_fit
        (call_script, "script_encounter_calculate_fit"),

# TODO: To use for the future:
            (str_store_string, s1, "@As a last defensive effort, you retreat to the main hall of the keep.\
 You and your remaining soldiers will put up a desperate fight here. If you are defeated, there's no other place to fall back to."),
            (str_store_string, s1, "@You've been driven away from the walls.\
 Now the attackers are pouring into the streets. IF you can defeat them, you can perhaps turn the tide and save the day."),
        (try_begin),
          (this_or_next|neq, ":result", 1),
          (this_or_next|le, "$g_friend_fit_for_battle", 0),
          (le, "$g_enemy_fit_for_battle", 0),
          (jump_to_menu, "$g_siege_final_menu"),
        (else_try),
          (call_script, "script_encounter_calculate_fit"),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (try_begin),
            (eq, "$g_siege_battle_state", 0),
            (eq, ":result", 1),
            (assign, "$g_battle_result", 0),
            (jump_to_menu, "$g_siege_final_menu"),
          (else_try),
            (eq, "$g_siege_battle_state", 1),
            (eq, ":result", 1),
            (str_store_string, s1, "@You've breached the town walls,\
 but the stubborn defenders continue to resist you in the streets!\
 You'll have to deal with them before you can attack the keep at the heart of the town."),
          (else_try),
            (eq, "$g_siege_battle_state", 2),
            (eq, ":result", 1),
            (str_store_string, s1, "@The town centre is yours,\
 but the remaining defenders have retreated to the castle.\
 It must fall before you can complete your victory."),
          (else_try),
            (jump_to_menu, "$g_siege_final_menu"),
          (try_end),
        (else_try),
          (try_begin),
            (eq, "$g_siege_battle_state", 0),
            (eq, ":result", 1),
            (assign, "$g_battle_result", 0),
            (jump_to_menu, "$g_siege_final_menu"),
          (else_try),
            (eq, "$g_siege_battle_state", 1),
            (eq, ":result", 1),
            (str_store_string, s1, "@The remaining defenders have retreated to the castle as a last defense. You must go in and crush any remaining resistance."),
          (else_try),
            (jump_to_menu, "$g_siege_final_menu"),
          (try_end),
        (try_end),
    ],
    [
      ("continue",[],
       "Continue...",
       [
           (try_begin),
             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
             (try_begin),
               (eq, "$g_siege_battle_state", 1),
               (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_center),
               (set_jump_mission, "mt_besiege_inner_battle_town_center"),
             (else_try),
               (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_castle),
               (set_jump_mission, "mt_besiege_inner_battle_castle"),
             (try_end),
           (else_try),
             (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_castle),
             (set_jump_mission, "mt_besiege_inner_battle_castle"),
           (try_end),
##           (call_script, "script_calculate_battle_advantage"),
##           (set_battle_advantage, reg0),
           (set_party_battle_mode),
           (jump_to_scene, ":battle_scene"),
           (val_add, "$g_siege_battle_state", 1),
           (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
           (jump_to_menu, "mnu_battle_debrief"),
           (change_screen_mission),
       ]),
    ]
  ),


  (
    "construct_ladders",0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take\
 {reg4} hours to build enough equipament for the assault.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),
#siege warfare cambia
     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 6),
#     (val_div, reg4, 3),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("build_ladders_cont",[],
       "Do it.", [
           (assign, "$g_siege_method", 1),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
           (store_sub, ":hours_takes", 15, reg0),
           (val_mul, ":hours_takes", 6), #chief cambia para mas horas
#           (val_div, ":hours_takes", 3),
           (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 240, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
        ],
  ),

#TEMPERED chief  TO DO    MAKE ENTRENCH OPTION HERE FOR SIEGES, COSTS HALF TIME OF BUILDING SIEGE TOWER. MAKE CORRESPONDING CHANGES TO SCENES
#TEMPERED    THIS IS MAINLY USEFUL FOR LONG SIEGES WHERE YOU ARE LIKELY TO BE ATTACKED BY OTHER PARTIES DURING SIEGE
#TEMPERED    ADD BOMBARDMENTS TO THE WALLS FROM TREBUCHETS IN ENCAMPMENT (FLAMING ROCK HITS RANDOMLY AROUND CASTLE WALLS FOR SHORT PERIOD)
#TEMPERED    TIME TAKEN TO BUILD WILL BE (PARTY ENGINEER SKILL X 2 = TOTAL, 24 - TOTAL = HOURS TAKEN)

  (
    "construct_siege_tower",0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that building Siege Tower and other equipament for assault will take\
 {reg4} hours.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 6),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("build_siege_tower_cont",[],
       "Start building.", [
           (assign, "$g_siege_method", 2),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
           (store_sub, ":hours_takes", 15, reg0),
           (val_mul, ":hours_takes", 6),
           (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 240, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
        ],
  ),

#siege warfare battering ram chief Cdvader
   (
    "battering_ram",0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that building a battering ram and other equipament for assault will take\
 {reg4} hours.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 6),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("build_battering_ram_cont",[],
       "Start building the battering ram.", [
           (assign, "$g_siege_method", 3),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
           (store_sub, ":hours_takes", 15, reg0),
           (val_mul, ":hours_takes", 6),
           (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 240, 5, 1),
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
        ],
  ),
###siege warfare acaba ram
###construir manteletes
  (
    "build_mantles2",0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take\
 {reg4} hours to build mantlets for the assault.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),
#siege warfare cambia
     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 6),
     (val_div, reg4, 3),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("build_ladders_cont",[],
       "Do it.", [
           (assign, "$g_mantlets_1", 1),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
           (store_sub, ":hours_takes", 15, reg0),
           (val_mul, ":hours_takes", 6), #chief cambia para mas horas
           (val_div, ":hours_takes", 3),
           (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 25, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
        ],
  ),
###construir manteletes acaba
   (
    "castle_attack_walls_simulate",mnf_disable_all_keys,
    "{s4}^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (try_begin),
          (set_background_mesh, "mesh_laddersassault"),
        (try_end),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 10),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 4),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),

        (assign, "$no_soldiers_left", 0),
        (try_begin),
          (call_script, "script_party_count_members_with_full_health","p_main_party"),
          (le, reg0, 0), #(TODO : compare with num_routed_us)
          (assign, "$no_soldiers_left", 1),
          (str_store_string, s4, "str_attack_walls_failure"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health","$g_encountered_party"),
          (le, reg0, 0), #(TODO : compare with num_routed_enemies)
          (assign, "$no_soldiers_left", 1),
          (assign, "$g_battle_result", 1),
          (str_store_string, s4, "str_attack_walls_success"),
        (else_try),
          (str_store_string, s4, "str_attack_walls_continue"),
        (try_end),
     ],
    [
##      ("lead_next_wave",[(eq, "$no_soldiers_left", 0)],"Lead the next wave of attack personally.", [
##           (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
##           (set_party_battle_mode),
##           (set_jump_mission,"mt_castle_attack_walls"),
##           (jump_to_scene,":battle_scene"),
##           (jump_to_menu,"mnu_castle_outside"),
##           (change_screen_mission),
##       ]),
##      ("continue_attacking",[(eq, "$no_soldiers_left", 0)],"Order your soldiers to keep attacking...", [
##                                    (jump_to_menu,"mnu_castle_attack_walls_3"),
##                                    ]),
##      ("call_soldiers_back",[(eq, "$no_soldiers_left", 0)],"Call your soldiers back.",[(jump_to_menu,"mnu_castle_outside")]),
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_castle_besiege")]),
    ]
  ),


####SIEGE WARFARE CHIEF menus extras
   (
    "castle_attack_walls_simulate2",mnf_disable_all_keys,
    "{s4}^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (try_begin),
          (set_background_mesh, "mesh_laddersassault"),
        (try_end),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 12),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 4),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),

        (assign, "$no_soldiers_left", 0),
        (try_begin),
          (call_script, "script_party_count_members_with_full_health","p_main_party"),
          (le, reg0, 0), #(TODO : compare with num_routed_us)
          (assign, "$no_soldiers_left", 1),
          (str_store_string, s4, "str_attack_walls_failure"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health","$g_encountered_party"),
          (le, reg0, 0), #(TODO : compare with num_routed_enemies)
          (assign, "$no_soldiers_left", 1),
          (assign, "$g_battle_result", 1),
          (str_store_string, s4, "str_attack_walls_success"),
        (else_try),
          (str_store_string, s4, "str_attack_walls_continue"),
        (try_end),
     ],
    [
##      ("lead_next_wave",[(eq, "$no_soldiers_left", 0)],"Lead the next wave of attack personally.", [
##           (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
##           (set_party_battle_mode),
##           (set_jump_mission,"mt_castle_attack_walls"),
##           (jump_to_scene,":battle_scene"),
##           (jump_to_menu,"mnu_castle_outside"),
##           (change_screen_mission),
##       ]),
##      ("continue_attacking",[(eq, "$no_soldiers_left", 0)],"Order your soldiers to keep attacking...", [
##                                    (jump_to_menu,"mnu_castle_attack_walls_3"),
##                                    ]),
##      ("call_soldiers_back",[(eq, "$no_soldiers_left", 0)],"Call your soldiers back.",[(jump_to_menu,"mnu_castle_outside")]),
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_siege_assault")]),
    ]
  ),



  (
    "sneak_into_town_suceeded2",0,
    "With the help of a disguise and night, you infiltrate the Town. It's time to consider their defenses.",
    "none",
    [],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$sneaked_into_town",1),
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),

#labores de saneamiento chief
    (
    "construct_saneamiento",0,
    "Sanitation is important to prevent rats and disease. It is possible to construct latrines and pipelines to prevent the accumulation of mud and filth floating with the rain, and dig a pit to ensure water supply. Do you want do it? ^^As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take\
 {reg4} hours.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),
#siege warfare cambia
     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 6),
     (val_div, reg4, 3),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("build_saneamiento",[],
       "Do it.", [
           (assign, "$g_siege_saneamiento", 1),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
           (store_sub, ":hours_takes", 15, reg0),
           (val_mul, ":hours_takes", 6), #chief cambia para mas horas
           (val_div, ":hours_takes", 3),
           (store_add, "$g_siege_method_finish_hours",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 25, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_castle_besiege")]),
        ],
  ),
#saneamiento acaba

  (
    "construct_circunvalation",0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take\
 {reg4} hours to build settlement circunvallation. Circunvallation prevents enemy skirmishes and food supplies from getting to the settlement. It also protects your troops during the siege and causes a penalty to the enemy's morale.",
    "none",
    [(set_background_mesh, "mesh_circunvalacion"),
     (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, reg4, 16, ":max_skill"),
     (val_mul, reg4, 10),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("build_circun_cont",[],
       "Do it.", [
           (assign, "$g_siege_circunvalation", 1),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
           (store_sub, ":hours_takes", 16, reg0),
           (val_mul, ":hours_takes", 10),
           (store_add, "$g_siegewarfare_metodo",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 110, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
        ],
  ),

  (
    "block_port",0,
    "To lock the port the requisition of as many boats of fishermen and merchants as possible is required, hire mercenary ships and make war canoes for our men. As the party member with the highest Looting skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take\
 {reg4} hours to do.",
    "none",
    [(set_background_mesh, "mesh_hacerbarco"),
        (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, reg4, 17, ":max_skill"),
     (val_mul, reg4, 6),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("requise_ships",[],
       "Do it.", [
           (assign, "$g_close_port", 1),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
           (store_sub, ":hours_takes", 17, reg0),
           (val_mul, ":hours_takes", 6),
           (store_add, "$g_siegewarfare_metodo",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 80, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
        ],
  ),

      ("traicion_interna2",0,
       "Your siege works begin to demoralize the defenders. Some soldiers are ready to contact the garrison or the inhabitants at {s7} and probe if someone would be willing to commit treason and facilitate the conquest. They need 500 scillingas for their troubles\
^^As the party member with the highest Tracking skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take to your men {reg4} hours to do.",
    "none",
    [(set_background_mesh, "mesh_infiltrado"),
       (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

        (call_script, "script_get_max_skill_of_player_party", "skl_tracking"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 5),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("intentar_traicion",[],
       "Allow these men to seek out a traitor.", [
       (store_troop_gold,":money","trp_player"),
      (try_begin),
        (gt,":money",499),
       (troop_remove_gold, "trp_player", 500),
           (assign, "$g_traicion_interna", 1),
           (store_current_hours, ":cur_hours"),
           (call_script, "script_get_max_skill_of_player_party", "skl_tracking"),
           (store_sub, ":hours_takes", 15, reg0),
           (val_mul, ":hours_takes", 5),
           (store_add, "$g_siegewarfare_metodo",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 60, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
      (else_try),
        (display_message,"str_money"),
      (try_end),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
        ],
  ),

#infiltracion chief
        ("infiltracion_interna2",0,
       "Circunvallation begins to demoralize the defenders. A good way to hasten the fall of {s7} is to infiltrate a group of men to cause damage to the defences, the stores of food, water deposits or dissension among the defenders. It is a difficult and risky maneuver, almost suicidal. Those you send in have high chances of not returning, but in case of success they could cause great damage to the enemy. They need 600 scillingas for their troubles\
^^As the party member with the highest Tracking skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take to your men {reg4} hours to do.",
    "none",
    [(set_background_mesh, "mesh_infiltrado"),
       (try_begin),
            (party_slot_eq, "$g_encountered_party", slot_party_type,spt_town),
            (str_store_string, s7, "str_town"),
          (else_try),
            (str_store_string, s7, "str_castle"),
          (try_end),

        (call_script, "script_get_max_skill_of_player_party", "skl_tracking"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, reg4, 15, ":max_skill"),
     (val_mul, reg4, 5),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ("intentar_infiltracion",[],
       "Allow these men to infiltrate and cause damage to the enemy.", [
       (store_troop_gold,":money","trp_player"),
      (try_begin),
        (gt,":money",599),
       (troop_remove_gold, "trp_player", 600),
           (assign, "$g_infiltracion_interna", 1),
           (store_current_hours, ":cur_hours"),

           (call_script, "script_get_max_skill_of_player_party", "skl_tracking"),
           (store_sub, ":hours_takes", 25, reg0),
           (val_mul, ":hours_takes", 5),
           (store_add, "$g_siegewarfare_metodo",":cur_hours", ":hours_takes"),
           (assign,"$auto_besiege_town","$current_town"),
           (rest_for_hours_interactive, 80, 5, 1), #rest while attackable. A trigger will divert control when attack is ready.
           (change_screen_return),
      (else_try),
        (display_message,"str_money"),
      (try_end),
           ]),
      ("go_back",[],
       "Go back.", [(jump_to_menu,"mnu_siege_plan")]),
        ],
  ),
#infiltracion chief acaba
#port battle chief
      ("port_battle1",0,
    "Advance your ships to the harbor entrance, approaching and putting to flight merchant ships and other boats with defenders of the city.",
    "none", [ (set_background_mesh, "mesh_portlucha"),
              ],
       [
           ("back_to_siege",[],"Close port.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
            (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 1),
          (assign, "$g_close_port", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("port_battle2",0,
    "Advancing your ships to the harbor entrance you find a chain that cuts off the place. At that time, they are cast on the ships of the place and those who support them. The struggle is fierce, many men die and the water turns red. Finally, your men set the enemy fleeing and cut the chain. Now you can block the port. ^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_portlucha"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),


              ],

        [("back_to_siege",[],"Close port.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
            (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 1),
          (assign, "$g_close_port", 2),

           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("port_battle3",0,
    "Your ships advance on the settlement's port, the merchants fleeing before them. It seems that soon you will close the port. But when you least expect it a chain divides your fleet into two, and enemy men and ships ambush your army, making a carnage. Your men must be removed. You'll have to try to close the port another day.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_portlucha"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],

        [("back_to_siege",[],"Run Away.",
       [
          (assign, "$g_close_port", 0),

##  (store_script_param, ":chance_to_die",1),
##  (store_script_param, ":chance_to_be_wounded",2),
##  (store_script_param, ":party_no",3),
##       (party_get_num_companion_stacks, ":num_stacks",":party_no"),
##
##       (try_for_range, ":i_stack", 0, ":num_stacks"),
##			(party_stack_get_size, ":stack_size",":party_no",":i_stack"),
##			(party_stack_get_troop_id, ":troop_id", ":party_no", ":i_stack"),
##
##			(str_store_troop_name,s1,":troop_id"),
##			(try_for_range,":unused",0,":stack_size"),
##				(neg|troop_is_hero,":troop_id"),
##				(store_random_in_range,":random_check",1,101),
##				(try_begin),
##					(le,":random_check",":chance_to_die"),
##					(party_remove_members,":party_no",":troop_id",15),
##				(display_message,"@A {s1} Die in battle."),
##				(else_try),
##					(le,":random_check",":chance_to_be_wounded"),
##					(party_remove_members,":party_no",":troop_id",30),
##				(display_message,"@A {s1} Die in battle."),
##				(try_end),
##			(try_end),
##	  (try_end),
##	(str_clear,s1),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
      ("port_battle4",0,
    "In the presence of your fleet, the merchant who supplied the settlement flees in terror. Now you can block access to the port.",
    "none", [ (set_background_mesh, "mesh_portlucha"),],

        [("back_to_siege",[],"Close port.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
            (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 1),
          (assign, "$g_close_port", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("port_battle5",0,
    "The enemy displayed their boats behind a chain in the harbor entrance. One of your men were thrown into the water and broke the chain, making him a hero. The chain defense is lost, the enemy retreats. Now you can close the port entrance.",
    "none", [ (set_background_mesh, "mesh_portlucha"),
              ],

        [("back_to_siege",[],"Close port.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
            (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 1),
          (assign, "$g_close_port", 2),

##  (store_script_param, ":party_no",1),
##       (party_get_num_companion_stacks, ":num_stacks",":party_no"),
##
##       (try_for_range, ":i_stack", 0, ":num_stacks"),
##			(party_stack_get_size, ":stack_size",":party_no",":i_stack"),
##			(party_stack_get_troop_id, ":troop_id", ":party_no", ":i_stack"),
##
##			(str_store_troop_name,s1,":troop_id"),
##			(try_for_range,":unused",0,":stack_size"),
##				(neg|troop_is_hero,":troop_id"),
##					(party_remove_members,":party_no",":troop_id",1),
##				(display_message,"@A {s1} Die in battle."),
##			(try_end),
##	  (try_end),
##	(str_clear,s1),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("port_battle6",0,
    "From the coast, you watch how your fleet is pitted against vessels defending the town. Fire and blood are the new boat owners. Although more numerous, your fleet has lost ground and is eventually beaten.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_portlucha"),
                      (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
],

        [("cowards",[],"Cowards!.",
       [
          (assign, "$g_close_port", 0),
            (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
      ("port_battle7",0,
    "Your fleet attacks at night, taking the enemy by surprise and quickly gain control of the entrance to the port without casualties. Now you can close the port.",
    "none", [ (set_background_mesh, "mesh_portlucha"),],

        [("back_to_siege",[],"Close port.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
            (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 1),
          (assign, "$g_close_port", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ]
  ),
      ("port_battle8",0,
    "The inexperience of your men steering the ships make your fleet an easy target for enemy warships, which sink your ships one by one, until finally, your fleet withdraws.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_portlucha"),
                      (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],

        [("cowards",[],"Cowards!.",
       [
          (assign, "$g_close_port", 0),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

####traicion interna
      ("traicion_resultado1",0,
    "They returned without news, no one is willing to become traitor.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),
              ],
       [
           ("back_behind",[],"Good, bad luck.",
       [
          (assign, "$g_traicion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("traicion_resultado2",0,
    "Sir! Our men have been discovered near the wall and are fighting their way out of the city. Look at them there in the sally port, they flee, but are surrounded...",
    "none",
       [
           (set_background_mesh, "mesh_infiltrado"),
              ],
        [
            ("ayudar_infiltrados",[],"Order: send a group of men to their aid.",
       [
           (jump_to_menu,"mnu_infiltrados_lucha"),
        ]),
        ("leave_men",[],"Leave the men to their fate. They knew what was coming.",
       [
           	(call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_party_morale", -10),
          (assign, "$g_traicion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("traicion_resultado3",0,
    "Your men have returned. A traitor within the settlement has set barns ablaze and will soon flee the town and join your army. With this action, the enemy will lose much of their food stock.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),],

        [("back_to_siege",[],"Well done.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -1),
         (party_get_slot, ":center_food_store", "$g_encountered_party", slot_party_food_store),
         (val_div, ":center_food_store", 2),
         (party_set_slot, "$g_encountered_party", slot_party_food_store, ":center_food_store"),
       (try_end),
                  (party_add_members, "p_main_party", "trp_townsman", 1),
          (assign, "$g_traicion_interna", 3),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("traicion_resultado4",0,
    "Your men have returned. They report there is a traitor who knows the routines of the garrison, and he is willing to lead a small force to ambush the enemy when they come to the water supplies, a nearby well outside the walls...",
    "none", [ (set_background_mesh, "mesh_infiltrado"),],

        [("atacar_emboscada",[],"Order: send a group of men with the traitor to carry out the ambush.",
       [
          (store_random_in_range, ":rand", 0, 3),
                                          (try_begin),
                                            (eq, ":rand", 0),
           (jump_to_menu,"mnu_emboscada_nada"),
                                          (else_try),
                                            (eq, ":rand", 1),
           (jump_to_menu,"mnu_emboscada_lose"),
                                          (else_try),
                                            (eq, ":rand", 2),
           (jump_to_menu,"mnu_emboscada_victory"),
          (try_end),
        ]),
        ("leave_men",[],"It makes me uneasy. Forget about it.",
       [
          (assign, "$g_traicion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("traicion_resultado5",0,
    "When your men come back, they tell you they have contacted a man who is in control of rations, and he has promised to raise the price of food to his fellow citizens to sow discontent making them more likely to abandon the fortress.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),
              ],

        [("traicion_moral",[],"Perfect!",
       [
          (assign, "$g_traicion_interna", 3),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

####infiltracion interna chief
        ("infiltracion_resultado1",0,
    "They returned without news, they were unable to enter the settlement.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),
              ],
       [
           ("back_behind",[],"Good, bad luck.",
       [
          (assign, "$g_infiltracion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("infiltracion_resultado2",0,
    "Sir! Our men have been discovered near the wall and are fighting their way out of the city. Look at them there in the sally port, they flee, but are surrounded...",
    "none",
       [
           (set_background_mesh, "mesh_infiltrado"),
              ],
        [
            ("ayudar_infiltrado",[],"Order: send a group of men to their aid.",
       [
           (jump_to_menu,"mnu_infiltrados_lucha2"),
        ]),
        ("leave_men",[],"Leave the men to their fate. They knew what was coming.",
       [
           	(call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_party_morale", -10),
          (assign, "$g_infiltracion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("infiltracion_resultado3",0,
    "Victory! They have managed to burn several food stores and stamping out a water well. The enemy is demoralized. Perhaps it is time to request their surrender.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),],

        [("back_to_siege",[],"Well, give them a barrel of mead.",
       [
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
         (party_get_slot, ":center_food_store", "$g_encountered_party", slot_party_food_store),
         (val_div, ":center_food_store", 3),
         (party_set_slot, "$g_encountered_party", slot_party_food_store, ":center_food_store"),
       (try_end),
#                  (party_add_members, "p_main_party", "trp_townsman", 1),
          (assign, "$g_infiltracion_interna", 3),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("infiltracion_resultado4",0,
    "Your men have returned. They said that many citizens are dissatisfied and some are persuaded to move to your side. If you agree, they leave the city at night and will join your army. Before they leave, they promise to cause unrest to facilitate the surrender of the place.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),],

        [("aceptar_si",[],"They are welcome.",
       [
          (store_random_in_range, ":rand", 0, 3),
                                          (try_begin),
                                            (eq, ":rand", 0),
                  (party_add_members, "p_main_party", "trp_townsman", 20),
                                          (else_try),
                                            (eq, ":rand", 1),
                  (party_add_members, "p_main_party", "trp_watchman", 10),
                                          (else_try),
                                            (eq, ":rand", 2),
                  (party_add_members, "p_main_party", "trp_refugee", 4),
          (try_end),
          (assign, "$g_infiltracion_interna", 3),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
        ("leave_men",[],"It makes me uneasy. Forget about it.",
       [
          (assign, "$g_infiltracion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("infiltracion_resultado5",0,
    "Oh, sir. The enemies have sent a bag with the heads of your men. Some of our soldiers have seen it and fear runs through the camp.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),
              ],

        [("infiltracion_moral",[],"Cowards! How can a couple of heads sink the morale of an army? Are they cattle or men?",
       [
          (assign, "$g_infiltracion_interna", 2),
            (call_script, "script_change_player_party_morale", -10),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
###infiltracion interna acaba

#traicion interna
             ("infiltrados_lucha",0,
    "Your men and the enemy fight to death at the foot of the wall, where everything is unfavorable to your troops. You watch as they fight, retreating back towards you. many bodies are left behind.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_infiltrado"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 60),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],

        [("regreso_lucha",[],"Good work. No one gets left behind.",
       [
           	(call_script, "script_change_player_honor", 5),
            (call_script, "script_change_player_party_morale", 5),
          (assign, "$g_traicion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

#infiltracion chief
             ("infiltrados_lucha2",0,
    "Your men and the enemy fight to death at the foot of the wall, where everything is unfavorable to your troops. You watch as they fight, retreating back towards you. many bodies are left behind.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_infiltrado"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 60),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],

        [("regreso_lucha2",[],"Good work. No one gets left behind.",
       [
           	(call_script, "script_change_player_honor", 5),
            (call_script, "script_change_player_party_morale", 5),
          (assign, "$g_infiltracion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
#infiltrados acaba
      ("emboscada_nada",0,
    "Your men move to shelter in the vegetation, away from the watchful eyes on the wall, but when they come to the meeting point, there is nobody. The alleged traitor has been discovered or has repented. Your men return disappointed.",
    "none", [ (set_background_mesh, "mesh_infiltrado"),],

        [("emboscada_nanai",[],"Do not worry, there will be another time.",
       [
          (assign, "$g_traicion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
#traicion interna
      ("emboscada_lose",0,
    "Alarm! Treason! The alleged traitor lead your men into an ambush. They are fighting desperately, leaving many men on the field.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_infiltrado"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],

        [("regreso_lucha",[],"Your worst fears have come true.",
       [
          (assign, "$g_traicion_interna", 2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

      ("emboscada_victory",0,
    "The traitor lead your men through the night to a hill which controls the path to a well. Your men took up positions in the vegetation, in silence, their faces stained black. Ahead. At daybreak, a large group of enemies are spotted out to get water. ^^A battle cry thrills the valley when your soldiers are falling like a tide of death on the enemy...^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_infiltrado"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 40),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],

        [("regreso_lucha",[],"Victory!",
       [
            (call_script, "script_change_player_party_morale", 3),
          (assign, "$g_traicion_interna", 3),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

###recogida y siembra de cosechas
            ("campos_cercanos1",0,
    "Sir, crops and farms have burned, but as there is still time to reap the harvest, it isn't possible to get food.",
    "none", [ (set_background_mesh, "mesh_pic_messenger1"),
              ],
       [
           ("back_behind_d",[],"Well done, do not worry.",
       [
          (assign, "$g_campos_cercanos", 2),
           	(call_script, "script_change_player_honor", -3),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
(call_script, "script_change_player_relation_with_center", "$current_town", -5),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
            ("campos_cercanos2",0,
    "Sir, crops and farms have burned, and as it is time to collect the harvest, we found an abundance of food.",
    "none", [ (set_background_mesh, "mesh_pic_messenger1"),
              ],
       [
           ("back_behind_c",[],"Well done, food always is welcome.",
       [
          (assign, "$g_campos_cercanos", 2),
           	(call_script, "script_change_player_honor", -3),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
(call_script, "script_change_player_relation_with_center", "$current_town", -10),
            (troop_add_item, "trp_player","itm_grain",0),
            (troop_add_item, "trp_player","itm_grain",0),
            (troop_add_item, "trp_player","itm_grain",0),
            (troop_add_item, "trp_player","itm_grain",0),
            (troop_add_item, "trp_player","itm_grain",0),
            (troop_add_item, "trp_player","itm_cattle_meat",0),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),
            ("campos_cercanos3",0,
    "Sir, we burned the fields, but as it is harvest time we could not collect grain; and farmers have removed the meat from the slaughter of winter.",
    "none", [ (set_background_mesh, "mesh_pic_messenger1"),
              ],
       [
           ("back_behind_b",[],"Food always is welcome.",
       [
          (assign, "$g_campos_cercanos", 2),
           	(call_script, "script_change_player_honor", -5),
          (call_script, "script_change_center_prosperity", "$g_encountered_party", -2),
(call_script, "script_change_player_relation_with_center", "$current_town", -15),
          (troop_add_item, "trp_player","itm_pork",0),
            (troop_add_item, "trp_player","itm_pork",0),
            (troop_add_item, "trp_player","itm_pork",0),
            (troop_add_item, "trp_player","itm_pork",0),
            (troop_add_item, "trp_player","itm_chicken",0),
            (troop_add_item, "trp_player","itm_cattle_meat",0),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

            ("campos_cercanos4",0,
    "We have encountered problems. The fields were burned but farmers struck back with support from some members of the garrison.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_pic_messenger1"),
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 40),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],
       [
           ("back_behind_a",[],"Scit!",
       [
          (assign, "$g_campos_cercanos", 2),
           	(call_script, "script_change_player_honor", -1),
(call_script, "script_change_player_relation_with_center", "$current_town", -2),
           (jump_to_menu,"mnu_siege_plan"),
        ]),
   ],
  ),

            ("poner_escaleras",0,
    "Your vanguard advances bringing ladders, shovels, hand rams and other useful siege equipment... A display of men armed with ranged weapons go forth attracting the enemy's missiles. The heart races in its bony cage, somehow all battles seem to be the first.^\
The thrill, terror and sweat is there, always. You noticed how your men did the Testudo formation and advanced over the walls...^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_laddersassault"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 10),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],
       [
           ("back_behind_esc1",[],"Your men have been met, it's your time...",
       [
          (assign, "$g_listos_para_asalto", 1),
           (jump_to_menu,"mnu_siege_assault"),
        ]),
   ],
  ),

            ("poner_escaleras_mantlets",0,
    "Your vanguard advances bringing ladders, mantlets, shovels, hand rams and other useful siege equipment... A display of men armed with ranged weapons go forth, guarded by mantlets, attracting the enemy's missiles. The heart races in its bony cage, somehow all battles seem to be the first.^\
The thrill, terror and sweat is there, always. You noticed how your men made the Testudo formation and advanced over the walls...^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [ (set_background_mesh, "mesh_laddersassault"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 35),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 15),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
              ],
       [
           ("back_behind_esc2",[],"Your men have been met, it's your time...",
       [
          (assign, "$g_listos_para_asalto", 1),
           (jump_to_menu,"mnu_siege_assault"),
        ]),
   ],
  ),

####
#####scout reporta datos de ciudad
        (
    "informacion_ciudad",0,
    "Lord of this place is {s21}^^I think {s4} has {reg6} defenders {s3}{s5}^^{s17}",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
#string descripcion
	 (call_script,"script_get_prosperity_for_spy_report","$current_town"),
	 (party_get_slot,":town_lord","$current_town",slot_town_lord),
	 (str_store_troop_name,s21,":town_lord"),

					(party_get_slot, ":center_food_store", "$current_town", slot_party_food_store),
					(call_script, "script_center_get_food_consumption", "$current_town"),
					(assign, ":food_consumption", reg0),
					(store_div, reg7, ":center_food_store", ":food_consumption"),
					(str_store_string,s3,"@^and food for {reg7} days."),
					(str_store_string,s5,"@^"),

			(party_collect_attachments_to_party, "$current_town", "p_collective_ally"),
			(party_get_num_companions, reg6, "p_collective_ally"),
			(str_store_party_name,s4,"$current_town"),
        #
#informacion asedio
		(str_store_string,s17,"str_empty_string"),
		(try_begin),
          (eq, "$current_town", "p_town_27"),
			(str_store_string,s17,"@Commander, this town is one big rock. Many before us have fled the place before a single blow was exchanged, so we must keep morale up among the men.\
The path to the main gate is formidably narrow and steep, but if we set up camp and build a battering ram we can break down the wall at the back entrance of the town.\
When the wall is down we can charge in without losing breath and the stairs to the town centre are smaller there."),
		(else_try),
          (eq, "$current_town", "p_town_6"),
			(str_store_string,s17,"@The rock of the Clyde. This is the mightiest fortress of the Northern Britons. Nobody ever took it by siege since your day.\
Controlling the mouth of the Clyde was where king Riderch Hael fought the Bernicians and the Picts."),
		(else_try),
          (eq, "$current_town", "p_castle_16"),
			(str_store_string,s17,"@This formidable stronghold is the jewel of the Dumnonian kingdom. Here many ships from Mediterannea arrived full of wine and luxuries. Legend says the warlord Arthur was born here."),
		(else_try),
          (eq, "$current_town", "p_town_39"),
			(str_store_string,s17,"@Dun Tauro, the fortress of the bull. This place seems like the work of giants, and for centuries the Picts have known its reputation."),
		(else_try),
          (eq, "$current_town", "p_town_3"),
			(str_store_string,s17,"@The seat of the brave Guotodin warriors. From here they launched their attack against the Bernicians, and their heroic death will never be forgotten. You can almost smell their courage from here."),
		(else_try),
          (eq, "$current_town", "p_castle_44"),
			(str_store_string,s17,"@ (Off topic) Historical note: Iudeu or Urbs Giudi as it was known to Bede is todays the impressive site of Stirling castle. This was the seat of the kingdom of Manau, or Manau Gododdin. It was the northernmost kingdom of the Britons, highly disputed between Picts, Alt Cluit, Gododdin, Scots and later Northumbrians. The region is famous for the later battlefields of Bannockburn and Stirling bridge, a witness to its strategic importance.\
^When Din Eydin was taken by the Bernicians, Iudeu may have became vulnerable to other ambitions. In 642 it was the likely objective of the battle of Strathcarron. The scottic forces of Domnal Brecc, king of Dal Riada, where beaten by the army of Owein of Alt Clut. Domnal was killed in the battle."),
		(else_try),
			(str_store_string,s17,"@ I am ready, my Lord."),
		(try_end),
#
    ],
        [("regreso_lucha",[],"Thank you. Your information is important!",
       [
           (jump_to_menu,"mnu_siege_assault"),
        ]),
   ],
  ),



#################menus extras acaba chief


   (
    "castle_attack_walls_with_allies_simulate",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
        (try_begin),
          (set_background_mesh, "mesh_pic_siege_attack1"),
        (try_end),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 10),
        (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
        (assign, ":friend_party_strength", reg0),
        (val_div, ":friend_party_strength", 10),

        (val_max, ":friend_party_strength", 1),

        (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 4),

##        (assign, reg0, ":player_party_strength"),
##        (assign, reg1, ":friend_party_strength"),
##        (assign, reg2, ":enemy_party_strength"),
##        (assign, reg3, "$g_enemy_party"),
##        (assign, reg4, "$g_ally_party"),
##        (display_message, "@{!}player_str={reg0} friend_str={reg1} enemy_str={reg2}"),
##        (display_message, "@{!}enemy_party={reg3} ally_party={reg4}"),

        (try_begin),
          (eq, ":friend_party_strength", 0),
          (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
        (else_try),
          (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
          (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
          (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
        (try_end),

        (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s10, s0),

        (call_script, "script_collect_friendly_parties"),

        (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),

        (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

        (assign, "$no_soldiers_left", 0),
        (try_begin),
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
          (le, reg0, 0), #(TODO : compare with num_routed_us)
          (assign, "$no_soldiers_left", 1),
          (str_store_string, s4, "str_attack_walls_failure"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (le, reg0, 0), #(TODO : compare with num_routed_enemies)
          (assign, "$no_soldiers_left", 1),
          (assign, "$g_battle_result", 1),
          (str_store_string, s4, "str_attack_walls_success"),
        (else_try),
          (str_store_string, s4, "str_attack_walls_continue"),
        (try_end),
     ],
    [
      ("continue",[],"Continue...",[(jump_to_menu,"mnu_besiegers_camp_with_allies")]),
    ]
  ),

###fire arrow chief
  (
    "castle_taken_without_bloodshed",0,
    "Nothing to see here.",
    "none",
    [
#      (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
#      (store_faction_of_party, ":old_faction", "$g_encountered_party"),
#      (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
#      (call_script, "script_give_center_to_lord", "$g_encountered_party", ":town_lord", 0),
#      (try_for_range, ":other_center", centers_begin, centers_end),
#        (party_slot_eq, ":other_center", slot_village_bound_center, "$g_encountered_party"),
#        (try_begin),
#          (party_slot_eq, ":other_center", slot_town_lord_old, ":town_lord"),
#          (call_script, "script_give_center_to_lord", ":other_center", ":town_lord", 0),
#        (else_try),
#          (call_script, "script_give_center_to_lord", ":other_center", "trp_player", 0),
#        (try_end),
#      (try_end),
#      (call_script, "script_add_log_entry", logent_castle_captured_by_player, "trp_player",  "$g_encountered_party", 0, "$g_encountered_party_faction"),
#      (call_script, "script_change_troop_renown", "trp_player", 5),
#      (change_screen_return),
    ],
    [
      ("continue",[],"Continue...",
       [
          (try_begin),
            (store_distance_to_party_from_party, ":distance", "p_main_party", "$g_encountered_party"),
            (lt, ":distance", 1),
            (assign, "$auto_enter_town", "$g_encountered_party"),
          (try_end),
          (change_screen_return),
        ]),
    ],
  ),
####fire arrow acaba

  (
    "castle_taken_by_friends",0,
    "Nothing to see here.",
    "none",
    [
        (party_clear, "$g_encountered_party"),
        (party_stack_get_troop_id, ":leader", "$g_encountered_party_2", 0),
        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, ":leader"),
        (store_troop_faction, ":faction_no", ":leader"),
        #Reduce prosperity of the center by 5
        (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
		(try_begin),
			(assign, ":damage", 20),
			(is_between, "$g_encountered_party", towns_begin, towns_end),
			(assign, ":damage", 40),
		(try_end),
		(try_begin),
			(neq, ":faction_no", "$g_encountered_party_faction"),
			(call_script, "script_faction_inflict_war_damage_on_faction", ":faction_no", "$g_encountered_party_faction", ":damage"),
		(try_end),

        (call_script, "script_give_center_to_faction", "$g_encountered_party", ":faction_no"),
        (call_script, "script_add_log_entry", logent_player_participated_in_siege, "trp_player",  "$g_encountered_party", 0, "$g_encountered_party_faction"),
##        (call_script, "script_change_troop_renown", "trp_player", 1),
        (change_screen_return),
    ],
    [
    ],
  ),

  (
    "castle_taken",mnf_disable_all_keys,
  ##diplomacy chief begin
    "{s3} has fallen to your troops, and you now have full control of the {reg2?town:castle}. You can plunder spoils of war worth {reg3} scillingas.\
{reg1? You may station troops here to defend it against enemies who may try to recapture it. Also, you should select now whether you will hold the {reg2?town:castle} yourself or give it to a faithful vassal...:}",# Only visible when castle is taken without being a vassal of a kingdom.
  ##diplomacy chief end
    "none",
    [(play_sound, "snd_cow_moo"), #anadido chief Sot
        (party_clear, "$g_encountered_party"),

        (try_begin),
          (eq, "$players_kingdom", "fac_player_supporters_faction"),
          (party_get_slot, ":new_owner", "$g_encountered_party", slot_town_lord),
          (neq, ":new_owner", "trp_player"),

          (try_for_range, ":unused", 0, 4),
            (call_script, "script_cf_reinforce_party", "$g_encountered_party"),
          (try_end),
        (try_end),

        (call_script, "script_lift_siege", "$g_encountered_party", 0),
        (assign, "$g_player_besiege_town", -1),

        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
        ##diplomacy chief begin
        #Reduce prosperity of the center by 5
        #(call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
  		 (try_begin),
  			 (is_between, "$g_encountered_party", towns_begin, towns_end),
  			 (store_random_in_range, ":random", 4000, 10000),
  		 (else_try),
  		   (store_random_in_range, ":random", 1000, 8000),
  		 (try_end),
  		 (val_div, ":random", 100),
  		 (val_mul, ":random", 100),
  		 (assign, "$diplomacy_var", ":random"),
  		 (assign, reg3, "$diplomacy_var"),
        ##diplomacy chief end

        (call_script, "script_change_troop_renown", "trp_player", 5),

		(assign, ":damage", 20),
		(try_begin),
			(is_between, "$g_encountered_party", towns_begin, towns_end),
			(assign, ":damage", 40),
		(try_end),
		(call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", "$g_encountered_party_faction", ":damage"),

		#removed, is it duplicate (useless)? See 20 lines above.
        #(call_script, "script_add_log_entry", logent_castle_captured_by_player, "trp_player", "$g_encountered_party", -1, "$g_encountered_party_faction"),

        (try_begin),
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
          (neq, "$players_kingdom", "fac_player_supporters_faction"),
          (call_script, "script_give_center_to_faction", "$g_encountered_party", "$players_kingdom"),
          (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "$players_kingdom"),
          (jump_to_menu, "mnu_castle_taken_2"),
        (else_try),
          (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
          (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "fac_player_supporters_faction"),
          (str_store_party_name, s3, "$g_encountered_party"),
          (assign, reg1, 0),
          (try_begin),
            (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
            (assign, reg1, 1),
          (try_end),
		  #(party_set_slot, "$g_encountered_party", slot_town_lord, stl_unassigned),
        (try_end),
        (assign, reg2, 0),
        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (assign, reg2, 1),
        (try_end),
    ],
    [
##diplomacy chief begin
          ("dplmc_spoils_yourself",[],"Plunder it and keep the spoils all for yourself.",
       [
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -12),
		 ##diplomacy start+
		 (assign, ":is_kingdom_leader", 0),
		 (try_begin),
			(is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
			(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
			(ge, ":faction_leader", 0),
			(this_or_next|eq, ":faction_leader", "trp_player"),
			(this_or_next|troop_slot_eq, ":faction_leader", slot_troop_spouse, "trp_player"),
				(troop_slot_eq, "trp_player", slot_troop_spouse, ":faction_leader"),
			(assign, ":is_kingdom_leader", 1),
		 (else_try),
			(eq, "$players_kingdom", "fac_player_supporters_faction"),
			(assign, ":is_kingdom_leader", 1),
		 (try_end),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
		   ##diplomacy start+
		   (this_or_next|eq, "$players_kingdom", ":troop_faction_no"),
			  (eq, "fac_player_supporters_faction", ":troop_faction_no"),
		   (this_or_next|eq, ":is_kingdom_leader", 1),
		   ##diplomacy end+
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (call_script, "script_change_player_relation_with_troop", ":troop_no", -2),
         (try_end),
         (try_begin),
           (gt, "$g_player_chamberlain", 0),
           (call_script, "script_dplmc_pay_into_treasury", "$diplomacy_var"),
         (else_try),
           (troop_add_gold, "trp_player", "$diplomacy_var"),
         (try_end),
         (call_script, "script_change_player_honor", -10),
         (assign, "$auto_enter_town", "$g_encountered_party"),
         (change_screen_return),
        ]),
      ("dplmc_spoils_accompanying_vassals",
      [
		##nested diplomacy start+
		#Add support for being the ruler or co-ruler of an original kingdom
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
		  (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
		  (this_or_next|eq, ":faction_leader", "trp_player"),
		  (this_or_next|troop_slot_eq, ":faction_leader", slot_troop_spouse, "trp_player"),
  		##nested diplomacy end+
          (eq, "$players_kingdom", "fac_player_supporters_faction"),
         (assign, ":vassal_count", 0),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
		   ##nested diplomacy start+
		   (this_or_next|eq, "$players_kingdom", ":troop_faction_no"),
		   ##nested diplomacy end+
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
           (ge, ":party_no", 1),
           (store_distance_to_party_from_party, ":distance","p_main_party", ":party_no"),
           (le, ":distance", 25),
           (val_add, ":vassal_count", 1),
         (try_end),
		 (gt, ":vassal_count", 0),
      ],"Plunder it and share the spoils equally between the vassals accompanying you and yourself.",
       [
         (assign, ":vassal_count", 1),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
			(this_or_next|eq, "$players_kingdom", ":troop_faction_no"),#support for other faction arrangements
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
           (ge, ":party_no", 1),
           (store_distance_to_party_from_party, ":distance","p_main_party", ":party_no"),
           (le, ":distance", 25),
           (val_add, ":vassal_count", 1),
         (try_end),
		 (store_div, ":gold_per_lord", "$diplomacy_var", ":vassal_count"),
		 #now loop through to add gold/relation
		 (try_for_range, ":troop_no", heroes_begin, heroes_end),#promoted lady support
			(troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
			(store_troop_faction, ":troop_faction_no", ":troop_no"),
			(this_or_next|eq, "$players_kingdom", ":troop_faction_no"),#support for other faction arrangements
				(eq, "fac_player_supporters_faction", ":troop_faction_no"),
			(troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
			(ge, ":party_no", 1),
			(store_distance_to_party_from_party, ":distance","p_main_party", ":party_no"),
			(le, ":distance", 25),
			#add gold
			(troop_add_gold, ":troop_no", ":gold_per_lord"),
			#Relation adjustment
			(store_random_in_range, reg0, 0, 1000),
			(val_add, reg0, ":gold_per_lord"),
			(val_div, reg0, 1000),
			(gt, reg0, 0),
			(val_min, reg0, 4),
			(assign, ":relation_change", reg0),
			#Modify for personality
			(try_begin),
				#Lords who dislike raiding will be displeased by looting a town (but not a castle)
				(party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
				(call_script, "script_dplmc_get_troop_morality_value", ":troop_no", tmt_humanitarian),
				(try_begin),
					(gt, reg0, 0),#Some lords like raiding settlements less than others
					(val_sub, ":relation_change", reg0),
					(val_min, ":relation_change", -1),
				(else_try),
					(lt, reg0, 0),#Some lords like raiding settlements more than others
					(val_sub, ":relation_change", reg0),
					(val_min, ":relation_change", 5),
				(else_try),
					(this_or_next|troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_custodian),
					(this_or_next|troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_benefactor),
						(troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_moralist),
					(val_sub, ":relation_change", 1),
			    (try_end),
			(try_end),
			(call_script, "script_change_player_relation_with_troop", ":troop_no", ":relation_change"),
		 (try_end),
		 ##nested diplomacy end+
         (val_div, "$diplomacy_var", ":vassal_count"),
         (try_begin),
           (gt, "$g_player_chamberlain", 0),
           (call_script, "script_dplmc_pay_into_treasury", "$diplomacy_var"),
         (else_try),
           (troop_add_gold, "trp_player", "$diplomacy_var"),
         (try_end),
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -8),
         (call_script, "script_change_player_honor", -5),
         (assign, "$auto_enter_town", "$g_encountered_party"),
         (change_screen_return),
        ]),
      ("dplmc_spoils_all_vassals",
      [
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
		  ##nested diplomacy start+
		  #Support for being co-ruler of an original kingdom
		  (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
		  (this_or_next|eq, ":faction_leader", "trp_player"),
		  (this_or_next|troop_slot_eq, ":faction_leader", slot_troop_spouse, "trp_player"),
		  ##nested diplomacy end+
          (eq, "$players_kingdom", "fac_player_supporters_faction"),
      ],"Plunder it and share the spoils equally between your vassals and yourself.",
       [
         (assign, ":vassal_count", 1),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
			(this_or_next|eq, ":troop_faction_no", "fac_player_supporters_faction"),
				(eq, ":troop_faction_no", "$players_kingdom"),
           (val_add, ":vassal_count", 1),
         (try_end),
		 (store_div, ":gold_per_lord", "$diplomacy_var", ":vassal_count"),
		 (try_for_range, ":troop_no", heroes_begin, heroes_end),
			(troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
			(store_troop_faction, ":troop_faction_no", ":troop_no"),
			(this_or_next|eq, ":troop_faction_no", "fac_player_supporters_faction"),
				(eq, ":troop_faction_no", "$players_kingdom"),
			(troop_add_gold, ":troop_no", ":gold_per_lord"),
			#Relation adjustment
			(store_random_in_range, reg0, 0, 1000),
			(val_add, reg0, ":gold_per_lord"),
			(val_div, reg0, 1000),
			(gt, reg0, 0),
			(val_min, reg0, 3),
			(assign, ":relation_change", reg0),
			#Modify for personality
			(try_begin),
				#Lords who dislike raiding will be displeased by looting a town (but not a castle)
				(party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
				(call_script, "script_dplmc_get_troop_morality_value", ":troop_no", tmt_humanitarian),
				(try_begin),
					(gt, reg0, 0),#Some lords like raiding settlements less than others
					(val_sub, ":relation_change", reg0),
					(val_min, ":relation_change", -1),
				(else_try),
					(lt, reg0, 0),#Some lords like raiding settlements more than others
					(val_sub, ":relation_change", reg0),
					(val_min, ":relation_change", 4),
				(else_try),
					(this_or_next|troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_custodian),
					(this_or_next|troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_benefactor),
						(troop_slot_eq, ":troop_no", slot_lord_reputation_type, lrep_moralist),
					(val_sub, ":relation_change", 1),
			    (try_end),
			(call_script, "script_change_player_relation_with_troop", ":troop_no", ":relation_change"),
 		    (try_end),
		 (try_end),
		 ##nested diplomacy end+
         (val_div, "$diplomacy_var", ":vassal_count"),
         (try_begin),
           (gt, "$g_player_chamberlain", 0),
           (call_script, "script_dplmc_pay_into_treasury", "$diplomacy_var"),
         (else_try),
           (troop_add_gold, "trp_player", "$diplomacy_var"),
         (try_end),
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -12),
         (assign, "$auto_enter_town", "$g_encountered_party"),
         (change_screen_return),
        ]),
##diplomacy chief end
      ("continue",[],"Continue...",
       [
         ##diplomacy chief begin
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
         ##diplomacy chief end
          (try_begin), #fire arrow chief
            (store_distance_to_party_from_party, ":distance", "p_main_party", "$g_encountered_party"), #fire arrow chief
            (lt, ":distance", 1), #fire arrow chief
            (assign, "$auto_enter_town", "$g_encountered_party"),
          (try_end), #fire arrow chief
         (change_screen_return),
        ]),
    ],
  ),
  (
    "castle_taken_2",mnf_disable_all_keys,
    "{s3} has fallen to your troops, and you now have full control of the castle.\
 It is time to send word to {s9} about your victory. {s5}",
    "none",
    [
        (str_store_party_name, s3, "$g_encountered_party"),
        (str_clear, s5),
        (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
        (str_store_troop_name, s9, ":faction_leader"),
        (try_begin),
          (eq, "$player_has_homage", 0),
          (assign, reg8, 0),
          (try_begin),
 		    ##diplomacy start+ FIX: Inserted missing argument
            #(party_slot_eq, "$g_encountered_party", spt_town), chief
			(party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
			##diplomacy end+
           (assign, reg8, 1),
          (try_end),
          (str_store_string, s5, "@However, since you are not a sworn {man/follower} of {s9}, there is no chance he would recognize you as the {lord/lady} of this {reg8?town:castle}."),
        (try_end),
    ],
    [
        ("castle_taken_claim",[(eq, "$player_has_homage", 1)],
		"Request that {s3} be awarded to you.",
        [
        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
        (assign, "$g_castle_requested_by_player", "$current_town"),
		(assign, "$g_castle_requested_for_troop", "trp_player"),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
        ]),

		("castle_taken_claim_2",[
		(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
		(is_between, ":spouse", active_npcs_begin, active_npcs_end),
		(troop_slot_eq, ":spouse", slot_troop_occupation, slto_kingdom_hero),
		(store_faction_of_troop, ":spouse_faction", ":spouse"),
		(eq, ":spouse_faction", "$players_kingdom"),
		],
		"Request that {s3} be awarded to your {wife/husband}.",
        [
        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, "trp_player"),
        (assign, "$g_castle_requested_by_player", "$current_town"),
		(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
		(assign, "$g_castle_requested_for_troop", ":spouse"),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
        ]),



      ("castle_taken_no_claim",[],"Ask no rewards.",
       [
        (party_set_slot, "$g_encountered_party", slot_center_last_taken_by_troop, -1),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
#        (jump_to_menu, "mnu_town"),
        ]),
    ],
  ),

###saquear castillo e irse

    (
    "saquear_centro",mnf_disable_all_keys,
  ##diplomacy chief begin
    "{s3} has fallen to your troops. You now have full control of the {reg2?town:castle}. You're only here for the booty. You can plunder spoils of war worth {reg3} scillingas.",# Only visible when castle is taken without being a vassal of a kingdom.
  ##diplomacy chief end
    "none",
    [  (set_background_mesh, "mesh_pic_extra_encuentro"),

        (play_sound, "snd_cow_moo"), #anadido chief Sot
        (party_clear, "$g_encountered_party"),
        (str_store_party_name, s3, "$g_encountered_party"),

         (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
         (assign,"$g_player_besiege_town", -1),
		 (party_set_slot,"p_main_party",slot_party_siege_camp,0),  #Tempered chief added for siege camp
      (party_set_slot,"$g_encountered_party",slot_saqueo_state,1), #ciudad saqueda
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acab
     ##diplomacy chief begin
        #Reduce prosperity of the center by 5
  		 (try_begin),
  			 (is_between, "$g_encountered_party", towns_begin, towns_end),
  			 (store_random_in_range, ":random", 10000, 17000),
  		 (else_try),
  		   (store_random_in_range, ":random", 4000, 11000),
  		 (try_end),
  		 (val_div, ":random", 100),
  		 (val_mul, ":random", 100),
  		 (assign, "$diplomacy_var", ":random"),
  		 (assign, reg3, "$diplomacy_var"),
        ##diplomacy chief end
#pierde relacion
        (party_get_slot, ":center_lord", "$g_encountered_party", slot_town_lord),
        (try_begin),
          (gt,  ":center_lord", 0),
          (call_script, "script_change_player_relation_with_troop", ":center_lord", -5),
        (try_end),
        (store_random_in_range, ":enmity", -35, -25),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", ":enmity"),
#pierde relacion
#gana moral
        (assign, ":morale_increase", 3),
        (store_div, ":money_gained_div_300", "$diplomacy_var", 300),
        (val_add, ":morale_increase", ":money_gained_div_300"),
        (call_script, "script_change_player_party_morale", ":morale_increase"),

#NPC companion changes begin
        (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),

        (call_script, "script_change_troop_renown", "trp_player", 5),
		    ],
    [
##diplomacy chief begin
      ("spoils_yourself",[],"Pillage the place and sell the population as slaves. Keep all spoils for yourself. Then leave center.",
       [
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -30),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (call_script, "script_change_player_relation_with_troop", ":troop_no", -4),
         (try_end),
           (troop_add_gold, "trp_player", "$diplomacy_var"),
         (call_script, "script_change_player_honor", -20),
         (assign, "$g_center_saqueo", 0),
         (change_screen_return),
        ]),
      ("spoils_accompanying_vassals",
      [
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
          (eq, "$players_kingdom", "fac_player_supporters_faction"),
         (assign, ":vassal_count", 0),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
           (ge, ":party_no", 1),
           (store_distance_to_party_from_party, ":distance","p_main_party", ":party_no"),
           (le, ":distance", 25),
           (val_add, ":vassal_count", 1),
         (try_end),
		 (gt, ":vassal_count", 0),
      ],"Pillage the place and sell the population as slaves. Share the spoils equally between the vassals accompanying you and yourself.",
       [
         (assign, ":vassal_count", 1),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
           (ge, ":party_no", 1),
           (store_distance_to_party_from_party, ":distance","p_main_party", ":party_no"),
           (le, ":distance", 25),
           (val_add, ":vassal_count", 1),
           (call_script, "script_change_player_relation_with_troop", ":troop_no", 3),
         (try_end),
         (val_div, "$diplomacy_var", ":vassal_count"),
         (try_begin),
           (troop_add_gold, "trp_player", "$diplomacy_var"),
         (try_end),
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -30),
         (call_script, "script_change_player_honor", -20),
     (assign, "$g_center_saqueo", 0),
         (change_screen_return),
        ]),
      ("spoils_all_vassals",
      [
          (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
          (eq, "$players_kingdom", "fac_player_supporters_faction"),
      ],"Pillage the place and sell the population as slaves. Share the spoils equally between your vassals and yourself. Then leave center.",
       [
         (assign, ":vassal_count", 1),
         (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
           (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
           (store_troop_faction, ":troop_faction_no", ":troop_no"),
           (eq, "fac_player_supporters_faction", ":troop_faction_no"),
           (val_add, ":vassal_count", 1),
           (call_script, "script_change_player_relation_with_troop", ":troop_no", 2),
         (try_end),
         (val_div, "$diplomacy_var", ":vassal_count"),
         (try_begin),
           (troop_add_gold, "trp_player", "$diplomacy_var"),
         (try_end),
         (call_script, "script_change_center_prosperity", "$g_encountered_party", -30),
         (call_script, "script_change_player_honor", -20),
        (assign, "$g_center_saqueo", 0),
         (change_screen_return),
        ]),
##diplomacy chief end
    ],
  ),

  (
    "saqueo_loot_continue",0,
    "This settlement has been looted.",
    "none",
    [
        (set_background_mesh, "mesh_pic_looted_village1"),
	],
    [
      ("continue",[],"Continue...",[(change_screen_return)]),
    ],
  ),
####saquear acaba chief


(
    "requested_castle_granted_to_player",0,
    "You receive a message from your liege, {s3}.^^\
 {reg4?She:He} has decided to grant {s2}{reg3? and the nearby village of {s4}:} to you, with all due incomes and titles, to hold in {reg4?her:his} name for as long as you maintain your oath of homage..",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger1"),
		(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
		(str_store_troop_name, s3, ":faction_leader"),
		(str_store_party_name, s2, "$g_center_to_give_to_player"),
		(try_begin),
			(party_slot_eq, "$g_center_to_give_to_player", slot_party_type, spt_castle),
			(assign, reg3, 1),
			(try_for_range, ":cur_village", villages_begin, villages_end),
				(party_slot_eq, ":cur_village", slot_village_bound_center, "$g_center_to_give_to_player"),
				(str_store_party_name, s4, ":cur_village"),
			(try_end),
		(else_try),
			(assign, reg3, 0),
		(try_end),
## Gender fix chief para alturas
     (troop_get_type, reg4, ":faction_leader"),
    (val_mod, reg4, 2),
                #gender fix chief acaba
   ],
    [
		("continue",[],"Continue.",
			[
			(call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
			(jump_to_menu, "mnu_give_center_to_player_2"),
			],
		),
	]
),



(
    "requested_castle_granted_to_player_husband",0,
    "You receive a message from your liege, {s3}.^^\
 {reg4?She:He} has decided to grant {s2}{reg3? and the nearby village of {s4}:} to your husband, {s7}.",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger1"),
		(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
		(str_store_troop_name, s3, ":faction_leader"),
		(str_store_party_name, s2, "$g_center_to_give_to_player"),
		(try_begin),
			(party_slot_eq, "$g_center_to_give_to_player", slot_party_type, spt_castle),
			(assign, reg3, 1),
			(try_for_range, ":cur_village", villages_begin, villages_end),
				(party_slot_eq, ":cur_village", slot_village_bound_center, "$g_center_to_give_to_player"),
				(str_store_party_name, s4, ":cur_village"),
			(try_end),
		(else_try),
			(assign, reg3, 0),
		(try_end),

## Gender fix chief para alturas
     (troop_get_type, reg4, ":faction_leader"),
    (val_mod, reg4, 2),
#gender fix chief acaba

		(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
		(str_store_troop_name, s11, ":spouse"),
		(str_store_string, s7, "str_to_your_husband_s11"),
    ],
    [
		("continue",[],"Continue.",
			[
			(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
			(call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", ":spouse", 0),
			],
		),
	]
),







(
    "requested_castle_granted_to_another",0,
    "You receive a message from your monarch, {s3}.^^\
 'I was most pleased to hear of your valiant efforts in the capture of {s2}. Your victory has gladdened all our hearts.\
 You also requested me to give you ownership of the castle, but that is a favour which I fear I cannot grant,\
 as you already hold significant estates in my realm.\
 Instead I have sent you {reg6} scillingas to cover the expenses of your campaign, but {s2} I give to {s5}.'\
 ",
    "none",
    [(set_background_mesh, "mesh_pic_messenger1"),
     (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
     (str_store_troop_name, s3, ":faction_leader"),
     (str_store_party_name, s2, "$g_center_to_give_to_player"),
     (party_get_slot, ":new_owner", "$g_center_to_give_to_player", slot_town_lord),
     (str_store_troop_name, s5, ":new_owner"),
     (assign, reg6, 900),

	 (assign, "$g_castle_requested_by_player", -1),
	 (assign, "$g_castle_requested_for_troop", -1),

    ],
    [
      ("accept_decision",[],"Accept the decision.",
       [
       (call_script, "script_troop_add_gold", "trp_player", reg6),
       (change_screen_return),
       ]),

       ("leave_faction",[],"You have been wronged! Renounce your oath to your liege! ",
       [
         (jump_to_menu, "mnu_leave_faction"),
         (call_script, "script_troop_add_gold", "trp_player", reg6),
        ]),
     ],
  ),


(
    "requested_castle_granted_to_another_female",0,
    "You receive a message from your monarch, {s3}.^^\
 'I was most pleased to hear of your valiant efforts in the capture of {s2}. Your victory has gladdened all our hearts.\
 You also requested me to give ownership of the castle to your husband, but that is a favour which I fear I cannot grant,\
 as he already holds significant estates in my realm.\
 Instead I have sent you {reg6} scillingas to cover the expenses of your campaign, but {s2} I give to {s5}.'\
 ",
    "none",
    [(set_background_mesh, "mesh_pic_messenger1"),
     (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
     (str_store_troop_name, s3, ":faction_leader"),
     (str_store_party_name, s2, "$g_center_to_give_to_player"),
     (party_get_slot, ":new_owner", "$g_center_to_give_to_player", slot_town_lord),
     (str_store_troop_name, s5, ":new_owner"),
     (assign, reg6, 900),

	 (assign, "$g_castle_requested_by_player", -1),
	 (assign, "$g_castle_requested_for_troop", -1),
    ],

    [
		("accept_decision",[],"Accept the decision.",
        [
        (call_script, "script_troop_add_gold", "trp_player", reg6),
        (change_screen_return),
        ]),
    ],
),




  (
    "leave_faction",0,
    "Renouncing your oath is a grave act. Your lord may condemn you and confiscate your lands and holdings.\
 However, if you return them of your own free will, he may let the betrayal go without a fight.",
    "none",
    [
    ],
    [
      ("leave_faction_give_back", [], "Renounce your oath and give up your holdings.",
       [
#Troop commentary changes begin
#        (call_script, "script_add_log_entry", logent_renounced_allegiance,   "trp_player",  -1, "$g_talk_troop", "$g_talk_troop_faction"),
#Troop commentary changes end
        (call_script, "script_player_leave_faction", 1), #1 means give back fiefs
        (change_screen_return),
        ]),
      ("leave_faction_hold", [
          (str_store_party_name, s2, "$g_center_to_give_to_player"),
          ], "Renounce your oath and rule your lands, including {s2}, in your own name.",
       [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0), #this should activate the player faction (it does not)
        (call_script, "script_player_leave_faction", 0), #"1" would mean give back fiefs
		(call_script, "script_activate_player_faction", "trp_player"), #Activating player faction should now work
        (change_screen_return),
        ]),
      ("leave_faction_cancel", [], "Remain loyal and accept the decision.",
       [
        (change_screen_return),
        ]),
    ],
  ),

  (
    "give_center_to_player",0,
    "Your lord offers to extend your fiefs!\
 {s1} sends word that he is willing to grant {s2} to you in payment for your loyal service,\
 adding it to your holdings. What is your answer?",
    "none",
    [(set_background_mesh, "mesh_pic_messenger1"),
     (store_faction_of_party, ":center_faction", "$g_center_to_give_to_player"),
     (faction_get_slot, ":faction_leader", ":center_faction", slot_faction_leader),
     (str_store_troop_name, s1, ":faction_leader"),
     (str_store_party_name, s2, "$g_center_to_give_to_player"),
    ],
    [
      ("give_center_to_player_accept",[],"Accept the offer.",
       [(call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (jump_to_menu, "mnu_give_center_to_player_2"),
        ]),
      ("give_center_to_player_reject",[],"Reject. You have no interest in holding {s2}.",
       [(party_set_slot, "$g_center_to_give_to_player", slot_town_lord, stl_rejected_by_player),
        (change_screen_return),
        ]),
    ],
  ),

  (
    "give_center_to_player_2",0,
    "With a brief ceremony, you are officially confirmed as the new lord of {s2}{reg3? and its bound village {s4}:}.\
 {reg3?They:It} will make a fine part of your fiefdom.\
 You can now claim the rents and revenues from your personal estates there, draft soldiers from the populace,\
 and manage the lands as you see fit.\
 However, you are also expected to defend your fief and your people from harm,\
 as well as maintaining the rule of law and order.",
    "none",
    [
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (assign, reg3, 0),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", slot_party_type, spt_castle),
        (try_for_range, ":cur_village", villages_begin, villages_end),
          (party_slot_eq, ":cur_village", slot_village_bound_center, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":cur_village"),
          (assign, reg3, 1),
        (try_end),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
    ],
  ),


  (
    "oath_fulfilled",0,
    "You had a contract with {s1} to serve him for a certain duration.\
 Your contract has now expired. What will you do?",
    "none",
    [
      (faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
      (str_store_troop_name, s1, ":faction_leader"),
     ],
    [
      ("renew_oath",[(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
                     (str_store_troop_name, s1, ":faction_leader")], "Renew your contract with {s1} for another month.",
       [
         (store_current_day, ":cur_day"),
         (store_add, "$mercenary_service_next_renew_day", ":cur_day", 30),
         (change_screen_return),
         ]),
      ("dont_renew_oath",[],"Become free of your bond.",
       [
         (call_script, "script_player_leave_faction", 1), #1 means give back fiefs
         (change_screen_return),
         ]),
    ]
  ),


##  (
##    "castle_garrison_stationed",0,
###    "The rest of the castle garrison recognizes that their situation is hopeless and surrenders. {s1} is at your mercy now. What do you want to do with this castle?",
##    "_",
##    "none",
##    [
##        (jump_to_menu, "mnu_town"),
##    ],
##    [],
##  ),

##  (
##    "castle_choose_captain",0,
##    "You will need to assign one of your companions as the castellan. Who will it be?",
##    "none",
##    [
##        (try_for_range, ":slot_no", 0, 20),
##          (troop_set_slot, "trp_temp_troop", ":slot_no", 0),
##        (try_end),
##        (assign, ":num_captains", 0),
##        (party_clear, "p_temp_party"),
##        (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
##        (try_for_range, ":i_s", 1,":num_stacks"),
##          (party_stack_get_troop_id, ":companion","p_main_party", ":i_s"),
##          (troop_slot_eq, ":companion", slot_troop_occupation, slto_player_companion),
##          (troop_set_slot, "trp_temp_troop", ":num_captains", ":companion"),
##        (try_end),
##    ],
##    [
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 0),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 0),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 1),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 1),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 2),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 2),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 3),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 3),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 4),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 4),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 5),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 5),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 6),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 6),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 7),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 7),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 8),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 8),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 9),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 9),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 10),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 10),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 11),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 11),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 12),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 12),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 13),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 13),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 14),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 14),(jump_to_menu,"mnu_castle_captain_chosen")]),
##      ("castellan_candidate",  [(troop_get_slot, ":captain", "trp_temp_troop", 15),(gt,":captain",0),(str_store_troop_name, s5,":captain")],
##         "{s5}",    [(troop_get_slot, "$selected_castellan", "trp_temp_troop", 15),(jump_to_menu,"mnu_castle_captain_chosen")]),
##
##      ("cancel",[],
##         "Cancel...",
##         [(jump_to_menu, "mnu_town")]),
##    ],
##  ),
##  (
##    "castle_captain_chosen",0,
##    "h this castle?",
##    "none",
##    [
##        (party_add_leader, "$g_encountered_party",  "$selected_castellan"),
##        (party_remove_members, "p_main_party", "$selected_castellan",1),
##        (party_set_slot, "$g_encountered_party", slot_town_lord, "trp_player"),
##        (party_set_faction, "$g_encountered_party", "fac_player_supporters_faction"),
##        (try_for_range, ":slot_no", 0, 20), #clear temp troop slots just in case
##          (troop_set_slot, "trp_temp_troop", ":slot_no", 0),
##        (try_end),
##        (jump_to_menu, "mnu_town"),
##        (change_screen_exchange_members,0),
##    ],
##    [],
##  ),

##  (
##    "under_siege_attacked_continue",0,
##    "Nothing to see here.",
##    "none",
##    [
##        (assign, "$g_enemy_party", "$g_encountered_party_2"),
##        (assign, "$g_ally_party", "$g_encountered_party"),
##        (party_set_next_battle_simulation_time, "$g_encountered_party", 0),
##        (call_script, "script_encounter_calculate_fit"),
##        (try_begin),
##          (call_script, "script_party_count_fit_regulars", "p_collective_enemy"),
##          (assign, ":num_enemy_regulars_remaining", reg(0)),
##          (assign, ":enemy_finished",0),
##          (try_begin),
##            (eq, "$g_battle_result", 1),
##            (eq, ":num_enemy_regulars_remaining", 0), #battle won
##            (assign, ":enemy_finished",1),
##          (else_try),
##            (eq, "$g_engaged_enemy", 1),
##            (le, "$g_enemy_fit_for_battle",0),
##            (ge, "$g_friend_fit_for_battle",1),
##            (assign, ":enemy_finished",1),
##          (try_end),
##          (this_or_next|eq, ":enemy_finished",1),
##          (eq,"$g_enemy_surrenders",1),
####          (assign, "$g_center_under_siege_battle", 0),
##          (assign, "$g_next_menu", -1),
##          (jump_to_menu, "mnu_total_victory"),
##        (else_try),
##          (assign, ":battle_lost", 0),
##          (try_begin),
##            (eq, "$g_battle_result", -1),
##            (assign, ":battle_lost",1),
##          (try_end),
##          (this_or_next|eq, ":battle_lost",1),
##          (eq,"$g_player_surrenders",1),
####          (assign, "$g_center_under_siege_battle", 0),
##          (assign, "$g_next_menu", "mnu_captivity_start_under_siege_defeat"),
##          (jump_to_menu, "mnu_total_defeat"),
##        (else_try),
##    # Ordinary victory.
##          (try_begin),
##          #check whether enemy retreats
##            (eq, "$g_battle_result", 1),
##            (store_mul, ":min_enemy_str", "$g_enemy_fit_for_battle", 2),
##            (lt, ":min_enemy_str", "$g_friend_fit_for_battle"),
##            (party_set_slot, "$g_enemy_party", slot_party_retreat_flag, 1),
##
##            (try_for_range, ":troop_no", kingdom_heroes_begin, kingdom_heroes_end),
##              (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
##              (troop_slot_eq, ":troop_no", slot_troop_is_prisoner, 0),
##              (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
##              (gt, ":party_no", 0),
##              (party_slot_eq, ":party_no", slot_party_ai_state, spai_besieging_center),
##              (party_slot_eq, ":party_no", slot_party_ai_object, "$g_encountered_party"),
##              (party_slot_eq, ":party_no", slot_party_ai_substate, 1),
##              (call_script, "script_party_set_ai_state", ":party_no", spai_undefined, -1),
##              (call_script, "script_party_set_ai_state", ":party_no", spai_besieging_center, ":center_no"),
##            (try_end),
##            (display_message, "@{!}TODO: Enemy retreated. The assault has ended, siege continues."),
##            (change_screen_return),
##          (try_end),
####          (assign, "$g_center_under_siege_battle", 0),
##        (try_end),
##        ],
##    [
##    ]
##  ),


  (
    "siege_started_defender",0,
    "{s1} is launching an assault against the walls of {s2}. You have {reg10} troops fit for battle against the enemy's {reg11}. You decide to...",
    "none",
    [
        (select_enemy,1),
        (assign, "$g_enemy_party", "$g_encountered_party_2"),
        (assign, "$g_ally_party", "$g_encountered_party"),
        (str_store_party_name, 1,"$g_enemy_party"),
        (str_store_party_name, 2,"$g_ally_party"),
        (call_script, "script_encounter_calculate_fit"),
        (try_begin),
          (eq, "$g_siege_first_encounter", 1),
          (call_script, "script_let_nearby_parties_join_current_battle", 0, 1),
          (call_script, "script_encounter_init_variables"),
        (try_end),

        (try_begin),
          (eq, "$g_siege_first_encounter", 0),
          (try_begin),
            (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
            (assign, ":num_enemy_regulars_remaining", reg0),
            (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
            (assign, ":num_ally_regulars_remaining", reg0),
            (assign, ":enemy_finished", 0),
            (try_begin),
              (eq, "$g_battle_result", 1),
#COOP bugfix chief ##############
#              (eq, ":num_enemy_regulars_remaining", 0), #battle won (sdsd = TODO : compare with num_routed_us)
              (this_or_next|le, ":num_enemy_regulars_remaining", 0), #battle won
              (le, ":num_enemy_regulars_remaining",  "$num_routed_enemies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
              (assign, ":enemy_finished",1),
            (else_try),
              (eq, "$g_engaged_enemy", 1),
#COOP bugfix chief ##############
#              (le, "$g_enemy_fit_for_battle",0),
              (this_or_next|le, ":num_enemy_regulars_remaining", 0),
              (le, "$g_enemy_fit_for_battle", "$num_routed_enemies"),  #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
              (ge, "$g_friend_fit_for_battle",1),
              (assign, ":enemy_finished",1),
            (try_end),
            (this_or_next|eq, ":enemy_finished",1),
            (eq,"$g_enemy_surrenders",1),
            (assign, "$g_next_menu", -1),
            (jump_to_menu, "mnu_total_victory"),
          (else_try),
            (assign, ":battle_lost", 0),
            (try_begin),
              (this_or_next|eq, "$g_battle_result", -1),
              (troop_is_wounded,  "trp_player"),
#COOP bugfix chief ##############
#              (eq, ":num_ally_regulars_remaining", 0), #(sdsd = TODO : compare with num_routed_allies)
              (le, ":num_ally_regulars_remaining",  "$num_routed_allies"), #replaced for above line because we do not want routed agents to spawn again in next turn of battle.
#########################
              (assign, ":battle_lost",1),
            (try_end),
            (this_or_next|eq, ":battle_lost",1),
            (eq,"$g_player_surrenders",1),
            (assign, "$g_next_menu", "mnu_captivity_start_under_siege_defeat"),
            (jump_to_menu, "mnu_total_defeat"),
          (else_try),
            # Ordinary victory/defeat.
            (assign, ":attackers_retreat", 0),
            (try_begin),
            #check whether enemy retreats
              (eq, "$g_battle_result", 1),
  ##            (store_mul, ":min_enemy_str", "$g_enemy_fit_for_battle", 2),
  ##            (lt, ":min_enemy_str", "$g_friend_fit_for_battle"),
              (assign, ":attackers_retreat", 1),
            (else_try),
              (eq, "$g_battle_result", 0),
              (store_div, ":min_enemy_str", "$g_enemy_fit_for_battle", 3),
              (lt, ":min_enemy_str", "$g_friend_fit_for_battle"),
              (assign, ":attackers_retreat", 1),
            (else_try),
              (store_random_in_range, ":random_no", 0, 100),
              (store_mul, ":num_ally_regulars_remaining_multiplied", ":num_ally_regulars_remaining", 13),
              (val_div, ":num_ally_regulars_remaining_multiplied", 10),
              (ge, ":num_ally_regulars_remaining_multiplied", ":num_enemy_regulars_remaining"),
              (lt, ":random_no", 10),
              (neq, "$new_encounter", 1),
              (assign, ":attackers_retreat", 1),
            (try_end),
            (try_begin),
              (eq, ":attackers_retreat", 1),
              (party_get_slot, ":siege_hardness", "$g_encountered_party", slot_center_siege_hardness),
              (val_add, ":siege_hardness", 100),
              (party_set_slot, "$g_encountered_party", slot_center_siege_hardness, ":siege_hardness"),
              (party_set_slot, "$g_enemy_party", slot_party_retreat_flag, 1),

              (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
                (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
                #(troop_slot_eq, ":troop_no", slot_troop_is_prisoner, 0),
                (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
                (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
                (gt, ":party_no", 0),
                (party_slot_eq, ":party_no", slot_party_ai_state, spai_besieging_center),
                (party_slot_eq, ":party_no", slot_party_ai_object, "$g_encountered_party"),
                (party_slot_eq, ":party_no", slot_party_ai_substate, 1),
                (call_script, "script_party_set_ai_state", ":party_no", spai_undefined, -1),
                (call_script, "script_party_set_ai_state", ":party_no", spai_besieging_center, "$g_encountered_party"),
              (try_end),
              (display_message, "@The enemy has been forced to retreat. The assault is over, but the siege continues."),
              (assign, "$g_battle_simulation_cancel_for_party", "$g_encountered_party"),
              (leave_encounter),
              (change_screen_return),
              (assign, "$g_battle_simulation_auto_enter_town_after_battle", "$g_encountered_party"),
            (try_end),
          (try_end),
        (try_end),
        (assign, "$g_siege_first_encounter", 0),
        (assign, "$new_encounter", 0),
        ],
    [
     ##diplomacy chief begin
      ("dplmc_negotiate_with_besieger",
      [
 	    (neq, "$freelancer_state", 1),	#+freelancer chief
       (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (party_slot_ge, "$current_town", slot_center_is_besieged_by, 1),
      ]
       ,"Negotiate with the besieger.",
       [
        (jump_to_menu, "mnu_dplmc_negotiate_besieger"),
        ]),
     ##diplomacy chief end
      ("siege_defender_join_battle",
       [
         (neg|troop_is_wounded, "trp_player"),
         ],
          "Join the battle.",[
              (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
              (assign, "$g_battle_result", 0),
              (try_begin),
                (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                (party_get_slot, ":battle_scene", "$g_encountered_party", slot_town_walls),
              (else_try),
                (party_get_slot, ":battle_scene", "$g_encountered_party", slot_castle_exterior),
              (try_end),
              (call_script, "script_calculate_battle_advantage"),
              (val_mul, reg0, 2),
              (val_div, reg0, 3), #scale down the advantage a bit.
              (set_battle_advantage, reg0),
              (set_party_battle_mode),
              (try_begin),
                (party_slot_eq, "$current_town", slot_center_siege_with_belfry, 1),
                (set_jump_mission,"mt_castle_attack_walls_belfry"),
#siege warfare ram chief
		      (else_try),
		        (party_slot_eq, "$current_town", slot_center_siege_with_ram, 1),
			    (set_jump_mission, "mt_castle_attack_walls_ram"),
#siege warfare ram chief cdvader acaba
              (else_try),
                (set_jump_mission,"mt_castle_attack_walls_ladder"),
              (try_end),
              (jump_to_scene,":battle_scene"),
              (assign, "$g_next_menu", "mnu_siege_started_defender"),
              (jump_to_menu, "mnu_battle_debrief"),
              (change_screen_mission)]),

      ("siege_defender_troops_join_battle",[
	    (neq, "$freelancer_state", 1),	#+freelancer chief
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
                                            (this_or_next|troop_is_wounded,  "trp_player"),
                                            (ge, reg0, 3)],
          "Order your men to join the battle without you.",[
              (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
              (select_enemy,1),
              (assign,"$g_enemy_party","$g_encountered_party_2"),
              (assign,"$g_ally_party","$g_encountered_party"),
              (assign,"$g_siege_join", 1),
              (jump_to_menu,"mnu_siege_join_defense")]),
	#+freelancer chief
	("join_wounded",[
	  (eq, "$freelancer_state", 1),
	  (troop_is_wounded, "trp_player"),
	  ],
	  "You are too wounded to fight.",[(leave_encounter),(change_screen_map)]),
	#+freelancer end
    ]
  ),

  (
    "siege_join_defense",mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
        (try_begin),
          (eq, "$g_siege_join", 1),
          (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
          (assign, ":player_party_strength", reg0),
          (val_div, ":player_party_strength", 5),
        (else_try),
          (assign, ":player_party_strength", 0),
        (try_end),

        (call_script, "script_party_calculate_strength", "p_collective_ally", 0),
        (assign, ":ally_party_strength", reg0),
        (val_div, ":ally_party_strength", 5),
        (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 10),

        (store_add, ":friend_party_strength", ":player_party_strength", ":ally_party_strength"),
        (try_begin),
          (eq, ":friend_party_strength", 0),
          (store_div, ":enemy_party_strength_for_p", ":enemy_party_strength", 2),
        (else_try),
          (assign, ":enemy_party_strength_for_p", ":enemy_party_strength"),
          (val_mul, ":enemy_party_strength_for_p", ":player_party_strength"),
          (val_div, ":enemy_party_strength_for_p", ":friend_party_strength"),
        (try_end),

        (val_sub, ":enemy_party_strength", ":enemy_party_strength_for_p"),
        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength_for_p", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_ally_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
        (party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),

        (inflict_casualties_to_party_group, "$g_enemy_party", ":friend_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s10, s0),
        (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),

        (try_begin),
          (call_script, "script_party_count_members_with_full_health","p_main_party"),
          (le, reg0, 0),
          (str_store_string, s4, "str_siege_defender_order_attack_failure"),
        (else_try),
          (call_script, "script_party_count_members_with_full_health","p_collective_enemy"),
          (le, reg0, 0),
          (assign, "$g_battle_result", 1),
          (str_store_string, s4, "str_siege_defender_order_attack_success"),
        (else_try),
          (str_store_string, s4, "str_siege_defender_order_attack_continue"),
        (try_end),
    ],
    [
      ("continue",[],"Continue...",[
          (jump_to_menu,"mnu_siege_started_defender"),
          ]),
    ]
  ),

  (
    "enter_your_own_castle",0,
    "{s10}",
    "none",
    [
      (try_begin),
        (neg|is_between, "$players_kingdom", npc_kingdoms_begin, npc_kingdoms_end),
        (faction_get_slot, ":faction_leader", "fac_player_supporters_faction", slot_faction_leader),
        (eq, ":faction_leader", "trp_player"),
        (str_store_string, s10, "@As you approach, you are spotted by the castle guards, who welcome you and open the gates for their {king/queen}."),
      (else_try),
        (str_store_string, s10, "@As you approach, you are spotted by the castle guards, who welcome you and open the gates for their {lord/lady}."),
      (try_end),

      (str_store_party_name, s2, "$current_town"),
    ],
    [
      ("continue",[],"Continue...",
       [ (jump_to_menu,"mnu_town"),
        ]),
    ],
  ),
#chief anade s15
  (
    "village",mnf_enable_hot_keys,
    "{s10} {s12}^{s11}^{s6}{s7} {s15}",
    "none",
    [
        (assign, "$current_town", "$g_encountered_party"),
        (call_script, "script_update_center_recon_notes", "$current_town"),

        (assign, "$g_defending_against_siege", 0), #required for bandit check
        (assign, "$g_battle_result", 0),
        (assign, "$qst_collect_taxes_currently_collecting", 0),
        (assign, "$qst_train_peasants_against_bandits_currently_training", 0),

        (try_begin),
          (gt, "$auto_enter_menu_in_center", 0),
          (jump_to_menu, "$auto_enter_menu_in_center"),
          (assign, "$auto_enter_menu_in_center", 0),
        (try_end),

        (try_begin),
          (neq, "$g_player_raiding_village",  "$current_town"),
          (assign, "$g_player_raiding_village", 0),
        (else_try),
          (jump_to_menu, "mnu_village_loot_continue"),
        (try_end),

        (try_begin),#Fix for collecting taxes
          (eq, "$g_town_visit_after_rest", 1),
          (assign, "$g_town_visit_after_rest", 0),
        (try_end),

        (str_store_party_name,s2, "$current_town"),
        (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
        (store_faction_of_party, ":center_faction", "$current_town"),
        (str_store_faction_name,s9,":center_faction"),
#sod chief fe faith empieza
                  #Sod chief fe faith empieza cristianismo
			(try_begin),
                  (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
                  		(party_get_slot, ":faith", "$current_town", slot_center_sod_local_faith),
			(try_begin),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
##				(lt, ":faith", -80),
				(str_store_string, s15, "@ ...(Pagan Village) Your faith is hated among the population..."),
			(else_try),
##				(lt, ":faith", -50),
##				(str_store_string, s15, "@ ...(Christian) Your faith is not tolerated here..."),
##			(else_try),
##				(lt, ":faith", -30),
##				(str_store_string, s15, "@ ...(Christian) Your faith is not accepted here..."),
##			(else_try),
##				(lt, ":faith", 0),
##				(str_store_string, s15, "@ ...(Christian) Your faith is not liked here..."),
##			(else_try),
				(lt, ":faith", 30),
				(str_store_string, s15, "@ ...(Christian Village) Your faith is tolerated here..."),
			(else_try),
				(lt, ":faith", 50),
				(str_store_string, s15, "@ ...(Christian Village) Your faith is accepted here..."),
			(else_try),
				(lt, ":faith", 80),
				(str_store_string, s15, "@ ...(Christian Village) Your faith is dominant here..."),
			(else_try),
				(lt, ":faith", 101),
				(str_store_string, s15, "@ ...(Christian Village) This village is a bastion of Your faith..."),
			(else_try),
				(str_store_string, s15, "@ ...Rumor spreads that Christian faith is nothing more than a veil, and the population continues to worship pagan gods..."),
			(try_end),
			(try_end),
		#SOD end chief
                  #Sod chief fe faith empieza paganismo
			(try_begin),
                  (this_or_next|eq, "$g_sod_faith", 2),
							 (eq, "$g_sod_faith", 3),

                  		(party_get_slot, ":faith", "$current_town", slot_center_sod_local_faith),
			(try_begin),
        (neg|party_slot_ge, "$current_town", center_religion_pagana, 1), #skip villages which are pagan.
##				(lt, ":faith", -80),
				(str_store_string, s15, "@ ...(Christian Village) Your faith is hated among the population..."),
##			(else_try),
##				(lt, ":faith", -50),
##				(str_store_string, s15, "@ ...(Pagan) Your faith is dominant here..."),
##			(else_try),
##				(lt, ":faith", -30),
##				(str_store_string, s15, "@ ...(Pagan) Your faith is accepted here..."),
##			(else_try),
##				(lt, ":faith", 0),
##				(str_store_string, s15, "@ ...(Pagan) Your faith is liked here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 30),
				(str_store_string, s15, "@ ...(Pagan Village) Your faith is liked here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 50),
				(str_store_string, s15, "@ ...(Pagan Village) Your faith is accepted here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 80),
				(str_store_string, s15, "@ ...(Pagan Village) Your faith is dominant here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 101),
				(str_store_string, s15, "@ ...(Pagan Village) This village is a bastion of Your faith..."),
			(else_try),
				(str_store_string, s15, "@ ...Rumor spreads that old pagan gods are being forgotten in favour of Christendom..."),
			(try_end),
			(try_end),
		#SOD end chief
        (try_begin),
          (ge, ":center_lord", 0),
          (str_store_troop_name,s8,":center_lord"),
          (str_store_string,s7,"@{s8} of {s9}"),
        (try_end),

        (str_clear, s10),
        (str_clear, s12),

        (try_begin),
          (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
          (str_store_string, s60, s2),

          (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
		  (try_begin),
			(eq, "$cheat_mode", 1),
			(assign, reg4, ":prosperity",),
			(display_message, "@{!}Prosperity: {reg4}"),
		  (try_end),

		  #(val_add, ":prosperity", 5),
          (store_div, ":str_id", ":prosperity", 10),
		  (val_min, ":str_id", 9),
		  (val_add, ":str_id", "str_village_prosperity_0"),
          (str_store_string, s10, ":str_id"),


          (store_div, ":str_id", ":prosperity", 20),
		  (val_min, ":str_id", 4),
		  (try_begin),
			(is_between, "$current_town", "p_village_91", villages_end),
			(val_add, ":str_id", "str_oasis_village_alt_prosperity_0"),
		  (else_try),
			(val_add, ":str_id", "str_village_alt_prosperity_0"),
		  (try_end),

          (str_store_string, s12, ":str_id"),
        (try_end),

        (str_clear, s11),
        (try_begin),
          (party_slot_eq, "$current_town", slot_village_state, svs_looted),
        (else_try),
          (eq, ":center_lord", "trp_player"),
          (str_store_string,s11,"@ This village and the surrounding lands belong to you."),
        (else_try),
          (ge, ":center_lord", 0),
          (str_store_string,s11,"@ You remember that this village and the surrounding lands belong to {s7}."),
        (else_try),
          (str_store_string,s11,"@ These lands belong to no one."),
        (try_end),

        (str_clear, s7),
        (try_begin),
          (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
          (party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
          (call_script, "script_describe_center_relation_to_s3", ":center_relation"),
          (assign, reg9, ":center_relation"),
          (str_store_string, s7, "@{!} {s3} ({reg9})."),
        (try_end),
        (str_clear, s6),
        (try_begin),
          (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
          (party_get_slot, ":bandit_troop", "$current_town", slot_village_infested_by_bandits),
          (store_character_level, ":player_level", "trp_player"),
          (store_add, "$qst_eliminate_bandits_infesting_village_num_bandits", ":player_level", 20), #chief sot cambia
          (val_mul, "$qst_eliminate_bandits_infesting_village_num_bandits", 22), #chief sot cambia
          (val_div, "$qst_eliminate_bandits_infesting_village_num_bandits", 20), #chief sot cambia
          (store_random_in_range, "$qst_eliminate_bandits_infesting_village_num_villagers", 25, 30),
          (assign, reg8, "$qst_eliminate_bandits_infesting_village_num_bandits"),
          (str_store_troop_name_by_count, s35, ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
          (str_store_string, s6, "@ The village is infested by {reg8} {s35}."),

          (assign, "$g_enemy_party", -1), #new, no known enemy party while saving village from bandits dfdf
          (assign, "$g_ally_party", -1), #new, no known enemy party while saving village from bandits dfdf

          (try_begin),
            (eq, ":bandit_troop", "trp_forest_bandit"),
            (set_background_mesh, "mesh_pic_forest_bandits1"),
          (else_try),
            (eq, ":bandit_troop", "trp_steppe_bandit"),
            (set_background_mesh, "mesh_pic_steppe_bandits1"),
          (else_try),
            (eq, ":bandit_troop", "trp_taiga_bandit"),
            (set_background_mesh, "mesh_pic_steppe_bandits1"),
          (else_try),
            (eq, ":bandit_troop", "trp_mountain_bandit"),
            (set_background_mesh, "mesh_pic_mountain_bandits1"),
          (else_try),
            (eq, ":bandit_troop", "trp_sea_raider"),
            (set_background_mesh, "mesh_pic_sea_raiders1"),
          (else_try), #puesto chief
            (eq, ":bandit_troop", "trp_black_khergit_horseman"),
            (set_background_mesh, "mesh_pic_sea_raiders1"),
          (else_try),
           ##diplmacy chief begin
            (eq, ":bandit_troop", "trp_peasant_woman"),
            (str_store_string, s6, "@ The peasants hired mercenaries and are rebelling against you."),
            (set_background_mesh, "mesh_pic_villageriot"),
          (else_try),
           ##diplomacy chief end
            (set_background_mesh, "mesh_pic_bandits1"),
          (try_end),
        (else_try),
          (party_slot_eq, "$current_town", slot_village_state, svs_looted),
          (str_store_string, s6, "@ The village has been pillaged. A handful of souls scatter as you pass through the burnt out houses."),
          (try_begin),
            (neq, "$g_player_raid_complete", 1),
            (play_track, "track_empty_village", 1),
          (try_end),
          (set_background_mesh, "mesh_pic_looted_village1"),
        (else_try),
          (party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
          (str_store_string, s6, "@ The village is being raided."),
        (else_try),
          (party_get_current_terrain, ":cur_terrain", "$current_town"),
          (try_begin),
            (this_or_next|eq, ":cur_terrain", rt_steppe),
            (this_or_next|eq, ":cur_terrain", rt_steppe_forest),
            (this_or_next|eq, ":cur_terrain", rt_desert),
            (             eq, ":cur_terrain", rt_desert_forest),
            (set_background_mesh, "mesh_pic_village_s1"),
          (else_try),
            (this_or_next|eq, ":cur_terrain", rt_snow),
            (             eq, ":cur_terrain", rt_snow_forest),
            (set_background_mesh, "mesh_pic_village_w1"),
          (else_try),
            (set_background_mesh, "mesh_pic_village_p1"),
          (try_end),
        (try_end),

        (try_begin),
          (eq, "$g_player_raid_complete", 1),
          (assign, "$g_player_raid_complete", 0),
          (jump_to_menu, "mnu_village_loot_complete"),
        (else_try),
          (party_get_slot, ":raider_party", "$current_town", slot_village_raided_by),
          (gt, ":raider_party", 0),
        # Process here...
        (try_end),

        (try_begin),
          (eq,"$g_leave_town",1),
          (assign,"$g_leave_town",0),
          (change_screen_return),
        (try_end),

        (try_begin),
          (store_time_of_day, ":cur_hour"),
          (ge, ":cur_hour", 5),
          (lt, ":cur_hour", 21),
          (assign, "$town_nighttime", 0),
        (else_try),
          (assign, "$town_nighttime", 1),
        (try_end),
    ],
    [
      ("village_manage",
      [
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
        (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player")
        ]
       ,"Manage this village.",
       [
           (assign, "$g_next_menu", "mnu_village"),
           (jump_to_menu, "mnu_center_manage"),
        ]),
###anadir guarnicion a villas chief
##            ("village_station_troops",
##       [
##           (party_slot_eq,"$current_town",slot_town_lord, "trp_player"),
##        ],
##          "Station a garrison here...",
##          [
##            (change_screen_exchange_members,1),
##           ]),
###chief hablar village elder desde menu
      ("Meet_with_village_elder",
       [
          (party_slot_eq, "$current_town", slot_village_state, 0),
          (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
         (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
         (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
          ## CC
          #(party_get_slot, ":town_elder", "$current_town", slot_town_elder),
          #(troop_slot_eq, ":town_elder", slot_troop_met, 1),
          ## CC
        ],
         "Meet with the elder.",
         [
           (try_begin),
             (call_script, "script_cf_enter_center_location_bandit_check"),
           (else_try),
             (party_get_slot, ":conversation_troop", "$current_town", slot_town_elder),
             (call_script, "script_setup_troop_meeting", ":conversation_troop", -1),
           (try_end),
          ]),
#hablar village elder desde menu acaba
      ("recruit_volunteers",
      [
        (call_script, "script_cf_village_recruit_volunteers_cond"),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda
       ]
       ,"Recruit Volunteers.",
       [
            (try_begin), #chief anadido
    (troop_slot_ge, "trp_player", slot_troop_renown, 30), #chief anadido
         (try_begin),
           (call_script, "script_cf_enter_center_location_bandit_check"),
         (else_try),
           (jump_to_menu, "mnu_recruit_volunteers"),
         (try_end),
		   (else_try), #chief anadido
             (display_message,"@You need more renown or to ask the Village Elder for help.",0xFFFFAAAA), #chief anadido
           (try_end), #chief anadido
        ]),
#reclutar forzosamente campesinos chief
            ("recruit_forzosamente",
      [
        (call_script, "script_cf_village_recruit_volunteers_cond2"),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda
       ]
       ,"Forcible recruitment.",
       [
         (try_begin),
           (call_script, "script_cf_enter_center_location_bandit_check"),
         (else_try),
           (jump_to_menu, "mnu_recruit_volunteers1"),
         (try_end),
        ]),
#reclutar forzosamente acaba chief
      ("village_center",[(neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
                         (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
                         (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),]
       ,"Go to the village center.",
       [
         (try_begin),
           (call_script, "script_cf_enter_center_location_bandit_check"),
         (else_try),
           (party_get_slot, ":village_scene", "$current_town", slot_castle_exterior),
           (modify_visitors_at_site,":village_scene"),
           (reset_visitors),
           (party_get_slot, ":village_elder_troop", "$current_town",slot_town_elder),
           (set_visitor, 11, ":village_elder_troop"),

            ##diplomacy chief begin
          (try_begin),
            (gt, "$g_player_chamberlain", 0),
            (call_script, "script_dplmc_appoint_chamberlain"),  #fix for wrong troops after update
            (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
            (eq, ":town_lord", "trp_player"),
            (set_visitor, 9, "$g_player_chamberlain"),
          (try_end),
            ##diplomacy end

           (call_script, "script_init_town_walkers"),

           (try_begin),
             (check_quest_active, "qst_hunt_down_fugitive"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_hunt_down_fugitive", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
             (neg|check_quest_failed, "qst_hunt_down_fugitive"),
             (set_visitor, 45, "trp_fugitive"),
           (try_end),
#chief bounty system
         #Bounty hunting
           (try_begin),
          (check_quest_active, "qst_bounty_1"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_bounty_1", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_bounty_1"),
             (neg|check_quest_failed, "qst_bounty_1"),
          (store_random_in_range, ":random", 0, 8 ),
          (try_begin),
            (eq, ":random", 0),
            (store_random_in_range, "$bounty_target_1", fugitives_begin, fugitives_end),
          (else_try),
            (eq, ":random", 1),
            (store_random_in_range, "$bounty_target_1", outlaws_begin, outlaws_end),
          (else_try),
            (eq, ":random", 2),
            (store_random_in_range, "$bounty_target_1", rogues_begin, rogues_end),
          (else_try),
            (eq, ":random", 3),
            (store_random_in_range, "$bounty_target_1", goblin_outlaws_begin, goblin_outlaws_end),
          (else_try),
            (eq, ":random", 4),
            (store_random_in_range, "$bounty_target_1", orc_outlaws_begin, orc_outlaws_end),
          (else_try),
            (eq, ":random", 5),
            (store_random_in_range, "$bounty_target_1", elf_outlaws_begin, elf_outlaws_end),
          (else_try),
            (eq, ":random", 6),
            (store_random_in_range, "$bounty_target_1", darkelf_outlaws_begin, darkelf_outlaws_end),
          (else_try),
            (store_random_in_range, "$bounty_target_1", saracen_outlaws_begin, saracen_outlaws_end),
          (try_end),
             (set_visitor, 45, "$bounty_target_1"),
           (try_end),
           (try_begin),
          (check_quest_active, "qst_bounty_2"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_bounty_2", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_bounty_2"),
             (neg|check_quest_failed, "qst_bounty_2"),
          (store_random_in_range, ":random", 0, 8 ),
          (try_begin),
            (eq, ":random", 0),
            (store_random_in_range, "$bounty_target_2", fugitives_begin, fugitives_end),
          (else_try),
            (eq, ":random", 1),
            (store_random_in_range, "$bounty_target_2", outlaws_begin, outlaws_end),
          (else_try),
            (eq, ":random", 2),
            (store_random_in_range, "$bounty_target_2", rogues_begin, rogues_end),
          (else_try),
            (eq, ":random", 3),
            (store_random_in_range, "$bounty_target_2", goblin_outlaws_begin, goblin_outlaws_end),
          (else_try),
            (eq, ":random", 4),
            (store_random_in_range, "$bounty_target_2", orc_outlaws_begin, orc_outlaws_end),
          (else_try),
            (eq, ":random", 5),
            (store_random_in_range, "$bounty_target_2", elf_outlaws_begin, elf_outlaws_end),
          (else_try),
            (eq, ":random", 6),
            (store_random_in_range, "$bounty_target_2", darkelf_outlaws_begin, darkelf_outlaws_end),
          (else_try),
            (store_random_in_range, "$bounty_target_2", saracen_outlaws_begin, saracen_outlaws_end),
          (try_end),
             (set_visitor, 45, "$bounty_target_2"),
           (try_end),
           (try_begin),
          (check_quest_active, "qst_bounty_3"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_bounty_3", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_bounty_3"),
             (neg|check_quest_failed, "qst_bounty_3"),
          (store_random_in_range, ":random", 0, 8 ),
          (try_begin),
            (eq, ":random", 0),
            (store_random_in_range, "$bounty_target_3", fugitives_begin, fugitives_end),
          (else_try),
            (eq, ":random", 1),
            (store_random_in_range, "$bounty_target_3", outlaws_begin, outlaws_end),
          (else_try),
            (eq, ":random", 2),
            (store_random_in_range, "$bounty_target_3", rogues_begin, rogues_end),
          (else_try),
            (eq, ":random", 3),
            (store_random_in_range, "$bounty_target_3", goblin_outlaws_begin, goblin_outlaws_end),
          (else_try),
            (eq, ":random", 4),
            (store_random_in_range, "$bounty_target_3", orc_outlaws_begin, orc_outlaws_end),
          (else_try),
            (eq, ":random", 5),
            (store_random_in_range, "$bounty_target_3", elf_outlaws_begin, elf_outlaws_end),
          (else_try),
            (eq, ":random", 6),
            (store_random_in_range, "$bounty_target_3", darkelf_outlaws_begin, darkelf_outlaws_end),
          (else_try),
            (store_random_in_range, "$bounty_target_3", saracen_outlaws_begin, saracen_outlaws_end),
          (try_end),
             (set_visitor, 45, "$bounty_target_3"),
           (try_end),
           (try_begin),
          (check_quest_active, "qst_bounty_4"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_bounty_4", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_bounty_4"),
             (neg|check_quest_failed, "qst_bounty_4"),
          (store_random_in_range, ":random", 0, 8 ),
          (try_begin),
            (eq, ":random", 0),
            (store_random_in_range, "$bounty_target_4", fugitives_begin, fugitives_end),
          (else_try),
            (eq, ":random", 1),
            (store_random_in_range, "$bounty_target_4", outlaws_begin, outlaws_end),
          (else_try),
            (eq, ":random", 2),
            (store_random_in_range, "$bounty_target_4", rogues_begin, rogues_end),
          (else_try),
            (eq, ":random", 3),
            (store_random_in_range, "$bounty_target_4", goblin_outlaws_begin, goblin_outlaws_end),
          (else_try),
            (eq, ":random", 4),
            (store_random_in_range, "$bounty_target_4", orc_outlaws_begin, orc_outlaws_end),
          (else_try),
            (eq, ":random", 5),
            (store_random_in_range, "$bounty_target_4", elf_outlaws_begin, elf_outlaws_end),
          (else_try),
            (eq, ":random", 6),
            (store_random_in_range, "$bounty_target_4", darkelf_outlaws_begin, darkelf_outlaws_end),
          (else_try),
            (store_random_in_range, "$bounty_target_4", saracen_outlaws_begin, saracen_outlaws_end),
          (try_end),
             (set_visitor, 45, "$bounty_target_4"),
           (try_end),
           (try_begin),
          (check_quest_active, "qst_bounty_5"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_bounty_5", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_bounty_5"),
             (neg|check_quest_failed, "qst_bounty_5"),
          (store_random_in_range, ":random", 0, 8 ),
          (try_begin),
            (eq, ":random", 0),
            (store_random_in_range, "$bounty_target_5", fugitives_begin, fugitives_end),
          (else_try),
            (eq, ":random", 1),
            (store_random_in_range, "$bounty_target_5", outlaws_begin, outlaws_end),
          (else_try),
            (eq, ":random", 2),
            (store_random_in_range, "$bounty_target_5", rogues_begin, rogues_end),
          (else_try),
            (eq, ":random", 3),
            (store_random_in_range, "$bounty_target_5", goblin_outlaws_begin, goblin_outlaws_end),
          (else_try),
            (eq, ":random", 4),
            (store_random_in_range, "$bounty_target_5", orc_outlaws_begin, orc_outlaws_end),
          (else_try),
            (eq, ":random", 5),
            (store_random_in_range, "$bounty_target_5", elf_outlaws_begin, elf_outlaws_end),
          (else_try),
            (eq, ":random", 6),
            (store_random_in_range, "$bounty_target_5", darkelf_outlaws_begin, darkelf_outlaws_end),
          (else_try),
            (store_random_in_range, "$bounty_target_5", saracen_outlaws_begin, saracen_outlaws_end),
          (try_end),
             (set_visitor, 45, "$bounty_target_5"),
           (try_end),
           (try_begin),
          (check_quest_active, "qst_bounty_6"),
             (neg|is_currently_night),
             (quest_slot_eq, "qst_bounty_6", slot_quest_target_center, "$current_town"),
             (neg|check_quest_succeeded, "qst_bounty_6"),
             (neg|check_quest_failed, "qst_bounty_6"),
          (store_random_in_range, ":random", 0, 8 ),
          (try_begin),
            (eq, ":random", 0),
            (store_random_in_range, "$bounty_target_6", fugitives_begin, fugitives_end),
          (else_try),
            (eq, ":random", 1),
            (store_random_in_range, "$bounty_target_6", outlaws_begin, outlaws_end),
          (else_try),
            (eq, ":random", 2),
            (store_random_in_range, "$bounty_target_6", rogues_begin, rogues_end),
          (else_try),
            (eq, ":random", 3),
            (store_random_in_range, "$bounty_target_6", goblin_outlaws_begin, goblin_outlaws_end),
          (else_try),
            (eq, ":random", 4),
            (store_random_in_range, "$bounty_target_6", orc_outlaws_begin, orc_outlaws_end),
          (else_try),
            (eq, ":random", 5),
            (store_random_in_range, "$bounty_target_6", elf_outlaws_begin, elf_outlaws_end),
          (else_try),
            (eq, ":random", 6),
            (store_random_in_range, "$bounty_target_6", darkelf_outlaws_begin, darkelf_outlaws_end),
          (else_try),
            (store_random_in_range, "$bounty_target_6", saracen_outlaws_begin, saracen_outlaws_end),
          (try_end),
             (set_visitor, 45, "$bounty_target_6"),
           (try_end),
# end Bounty Hunting chief

           (set_jump_mission,"mt_village_center"),
           (jump_to_scene,":village_scene"),
           (change_screen_mission),
         (try_end),
        ],"Door to the village center."),
      ("village_buy_food",[(party_slot_eq, "$current_town", slot_village_state, 0),
                           (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
                           ],"Buy supplies from the peasants.",
       [
         (try_begin),
           (call_script, "script_cf_enter_center_location_bandit_check"),
         (else_try),
           (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),

      #(try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
        #(store_sub, ":cur_good_price_slot", ":cur_goods", trade_goods_begin),
        #(val_add, ":cur_good_price_slot", slot_town_trade_good_prices_begin),
		#(party_get_slot, ":cur_price", "$current_town", ":cur_good_price_slot"),
	    #(call_script, "script_center_get_production", "$current_town", ":cur_goods"),
        #(assign, reg13, reg0),
	    #(call_script, "script_center_get_consumption", "$current_town", ":cur_goods"),
        #(str_store_party_name, s1, "$current_town"),
        #(str_store_item_name, s2, ":cur_goods"),
		#(assign, reg16, ":cur_price"),
        #(display_log_message, "@DEBUG:{s1}-{s2}, prd: {reg13}, con: {reg0}, raw: {reg1}, cns: {reg2}, fee: {reg16}"),
	  #(try_end),

           (change_screen_trade, ":merchant_troop"),
         (try_end),
         ]),

###comprar cattle chief
      ("comprar_cattle",[
 (party_slot_eq, "$current_town", slot_village_state, 0),
(neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
                                      (assign, ":quest_village", 0),
                                      (try_begin),
                                        (check_quest_active, "qst_deliver_cattle"),
                                        (quest_slot_eq, "qst_deliver_cattle", slot_quest_target_center, "$current_town"),
                                        (assign, ":quest_village", 1),
                                      (try_end),
                                      (eq, ":quest_village", 0),
                                      ],
   "I want to buy some cattle.",
       [
           (jump_to_menu, "mnu_comprar_cattle2"),
        ]),

####comprar cattle chief acaba


      ("village_attack_bandits",[(party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
                  ##diplomacy chief begin
        (neg|party_slot_eq, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),
        ##diplmacy chief end
                                 ],
       "Attack the bandits.",
       [(party_get_slot, ":bandit_troop", "$current_town", slot_village_infested_by_bandits),
        (party_get_slot, ":scene_to_use", "$current_town", slot_castle_exterior),
        (modify_visitors_at_site,":scene_to_use"),
        (reset_visitors),
        (set_visitors, 0, ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (set_visitors, 2, "trp_farmer", "$qst_eliminate_bandits_infesting_village_num_villagers"),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission,"mt_village_attack_bandits"),
        (jump_to_scene, ":scene_to_use"),
        (assign, "$g_next_menu", "mnu_village_infest_bandits_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", vba_normal),
        (change_screen_mission),
        ]),

###COOP Village chief bandits#############################
##      ("coop_setup",
##       [
##        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
##        (this_or_next|ge, "$cheat_mode", 1),
##        (eq, "$coop_battle_state", coop_battle_state_none),
##        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
##       ],
##       "Setup multiplayer battle.",
##       [
##        (assign, "$coop_battle_type", coop_battle_type_village_player_defend),
##
##        # (set_visitors, 0, ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
##        # (set_visitors, 2, "trp_farmer", "$qst_eliminate_bandits_infesting_village_num_villagers"),
##        (party_get_slot, ":bandit_troop", "$current_town", slot_village_infested_by_bandits),
##
##        (party_clear, "p_temp_wounded"), #use this party to temp make bandits
##        (party_add_members, "p_temp_wounded", ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
##        (assign, "$coop_encountered_party", "p_temp_wounded"),
##        (assign, "$g_ally_party", "$current_town"),
##
##        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
##        (try_begin),
##          (eq, "$coop_skip_menu", 1),
##          (change_screen_quit),
##        (try_end),
##       ]),
##
##      ("quit",[
##        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
##        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
##      ],"Quit game (will not save).",
##      [
##        (change_screen_quit),
##      ]),
##
##      ("coop_use_result",[
##         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##         (eq, "$coop_battle_state", coop_battle_state_end_mp),
##        (party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
##      ],"Use multiplayer battle results.",
##      [
##
##        (assign, "$g_next_menu", "mnu_village_infest_bandits_result"),
##        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
##        (jump_to_menu, "mnu_battle_debrief"),
##      ]),
##
##      ("encounter_save",[(party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1)],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),
##
################################################## chief acaba

      ("village_wait",
       [
           #(try_begin), #chief cambia y anade sot
           (party_slot_eq, "$current_town", slot_center_has_manor, 1),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
##        (else_try),
##        (eq, "$village_rest",1),
##        (try_end),
        ],
         "Rest here for some time.",
         [
           (assign,"$auto_enter_town","$current_town"),
           (assign, "$g_last_rest_center", "$current_town"),

           (try_begin),
             (party_is_active, "p_main_party"),
             (party_get_current_terrain, ":cur_terrain", "p_main_party"),
             (try_begin),
               (eq, ":cur_terrain", rt_desert),
               (unlock_achievement, ACHIEVEMENT_SARRANIDIAN_NIGHTS),
             (try_end),
           (try_end),

           (rest_for_hours_interactive, 24 * 7, 5, 1), #rest while attackable

           (change_screen_return),
          ]),

#TEMPERED chief ADDED REST OPTION FOR HIGH COMMONER RELATION
      ("village_guest_wait",
       [
                        (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
                         (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
                        (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
           (assign,":continue",0),
			(try_begin),
				(ge,"$commoner_trust",60),
				(assign,":continue",1),
			(try_end),
			(try_begin),
				(party_slot_eq, "$current_town", slot_center_has_manor, 1),
				(party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
				(assign,":continue",0),
			(try_end),
			(eq,":continue",1),
        ],
         "The villagers invite you to rest here as their honored guest.",
         [
           (assign,"$auto_enter_town","$current_town"),
           (assign, "$g_last_rest_center", "$current_town"),
           (rest_for_hours_interactive, 24 * 7, 5, 1), #rest while attackable
           (change_screen_return),
          ]),
#tempered chief acaba

             ##diplomacy chief begin
      ("dplmc_village_counter_insurgency",[
        (party_slot_eq, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),
        ],
       "Counter the insurgency.",
       [
          (store_random_in_range, ":enmity", -10, -5),
          (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
          (call_script, "script_calculate_battle_advantage"),
          (set_battle_advantage, reg0),
          (set_party_battle_mode),
          (assign, "$g_battle_result", 0),
          (assign, "$g_village_raid_evil", 1), #check
          (set_jump_mission,"mt_village_raid"),
          (party_get_slot, ":scene_to_use", "$current_town", slot_castle_exterior),
          (jump_to_scene, ":scene_to_use"),
          (assign, "$g_next_menu", "mnu_dplmc_village_riot_result"),

          (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
        ]),

      ("dplmc_village_negotiate",[
        (party_slot_eq, "$current_town", slot_village_infested_by_bandits, "trp_peasant_woman"),
        ],
       "Begin negotiations.",
       [
          (jump_to_menu, "mnu_dplmc_riot_negotiate"),
        ]),
        ##diplomacy chief end

      ("collect_taxes_qst",[(party_slot_eq, "$current_town", slot_village_state, 0),
                            (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
                            (check_quest_active, "qst_collect_taxes"),
                            (quest_get_slot, ":quest_giver_troop", "qst_collect_taxes", slot_quest_giver_troop),
                            (quest_slot_eq, "qst_collect_taxes", slot_quest_target_center, "$current_town"),
                            (neg|quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 4),
                            (str_store_troop_name, s1, ":quest_giver_troop"),
                            (quest_get_slot, reg5, "qst_collect_taxes", slot_quest_current_state),
                            ], "{reg5?Continue collecting taxes:Collect taxes} due to {s1}.",
       [(jump_to_menu, "mnu_collect_taxes"),]),

      ("train_peasants_against_bandits_qst",
       [
         (party_slot_eq, "$current_town", slot_village_state, 0),
         (check_quest_active, "qst_train_peasants_against_bandits"),
         (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
         (quest_slot_eq, "qst_train_peasants_against_bandits", slot_quest_target_center, "$current_town"),
         ], "Train the peasants.",
       [(jump_to_menu, "mnu_train_peasants_against_bandits"),]),

      ("village_hostile_action",[(party_slot_eq, "$current_town", slot_village_state, 0),
                                 (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
								 (neq, "$players_kingdom", "$g_encountered_party_faction"),
								 ], "Take a hostile action.",
       [(jump_to_menu,"mnu_village_hostile_action"),
           ]),

      ("village_reports",[(eq, "$cheat_mode", 1),], "{!}CHEAT! Show reports.",
       [(jump_to_menu,"mnu_center_reports"),
           ]),
###rigale chief
#puesto off hasta nueva version de rigale
      ("village_perform_basic_work",
      [
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
        (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda
      ],"Perform some very basic work for the village (be farmer).",
      [
      (try_begin),
          (display_message,"@ You start performing these hard peasantry basic work.",0xFF0000),

		(try_begin),
                (troop_slot_ge, "trp_player", slot_troop_renown, 40), #chief anadido
                (display_message,"@ Like farmer, you lose renown and reputation.",0xFF0000),
 		(call_script, "script_change_troop_renown", "trp_player", -2),
                (call_script, "script_change_player_honor", -1),
		(try_end),

          (rest_for_hours_interactive, 2, 5, 1),
          (change_screen_map),
          (assign,"$g_work_for_village_ongoing",24),
      (try_end),#rigale

      ]
      ),

###rigale chief acaba

      ("village_leave",[],"Leave...",[(change_screen_return,0)]),

    ],
  ),

###rigale chief village work
     (
    "village_basic_work",0,
    "{s3}",
    "none",
    [
		(str_clear,s1),
		(str_clear,s2),
		(str_clear,s3),

		(try_begin),
            (eq, "$g_player_is_captive", 1), #motomataru chief repara
                  (str_store_string,s3,"@ You've been carried off as prisoner. You stop your work."),
              (else_try),
                (party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
			(str_store_string,s3,"@ The village is being raided. You stop your work."),
		(else_try),
			(party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
			(str_store_string,s3,"@ The village is being infested by bandits. You stop your work."),
		(else_try),
			(store_random_in_range,reg1,10,30),
			(add_xp_to_troop, reg1, "trp_player"),
			(store_random_in_range,":item_to_give",1,11),
			(try_begin),
				(eq,":item_to_give",1),(assign,":item_to_give","itm_cheese",1),(else_try),
				(eq,":item_to_give",2),(assign,":item_to_give","itm_sausages",1),(else_try),
				(eq,":item_to_give",3),(assign,":item_to_give","itm_apples",1),(else_try),
				(eq,":item_to_give",4),(assign,":item_to_give","itm_pork",1),(else_try),
				(eq,":item_to_give",5),(assign,":item_to_give","itm_grain",1),(else_try),
				(eq,":item_to_give",6),(assign,":item_to_give","itm_honey",1),(else_try),
				(eq,":item_to_give",7),(assign,":item_to_give","itm_bread",1),(else_try),
				(eq,":item_to_give",8),(assign,":item_to_give","itm_ale",1),(else_try),
				(eq,":item_to_give",9),(assign,":item_to_give","itm_mead",1),(else_try),
				(eq,":item_to_give",10),(assign,":item_to_give","itm_chicken",1),(else_try),
			(try_end),
			(str_store_item_name,s1,":item_to_give"),
			(store_random_in_range,":increase_renown",1,6),
			(try_begin),
				(eq,":increase_renown",1),
				(call_script, "script_change_player_relation_with_center", "$current_town", 1),
				(str_store_string,s2,"@ You improve your renown with this village"),
			(else_try),
				(str_store_string,s2,"@ Alas, you don't improve your renown with this village"),
			(try_end),

			(troop_add_items,"trp_player",":item_to_give",1),
			(str_store_string,s3,"@Here are the results of your hard work: You exhaust yourself, You gain {reg1} xps, you receive some {s1}. {s2}. Peasant life is hard, but you feel good."),
		(try_end),
	],
    [
      ("continue",[],
      "Continue",[
        (try_begin), #motomataru chief repara
                  (this_or_next|eq, "$g_player_is_captive", 1),
                  (this_or_next|party_slot_eq, "$current_town",      slot_village_state, svs_being_raided),
                  (party_slot_ge, "$current_town",      slot_village_infested_by_bandits, 1),
                  (change_screen_return),
              (else_try),
                  (jump_to_menu,"mnu_village"),
              (try_end),
            ]),
      ],
  ),
###rigale chief acaba


  (
    "village_hostile_action",0,
    "What action do you have in mind?",
    "none",
    [],
    [
      ("village_take_food",[
          (party_slot_eq, "$current_town", slot_village_state, 0),
          (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
          (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
          (assign, ":town_stores_not_empty", 0),
          (try_for_range, ":slot_no", num_equipment_kinds, max_inventory_items + num_equipment_kinds),
            (troop_get_inventory_slot, ":slot_item", ":merchant_troop", ":slot_no"),
            (ge, ":slot_item", 0),
            (assign, ":town_stores_not_empty", 1),
          (try_end),
          (eq, ":town_stores_not_empty", 1),
          ],"Force the peasants to give you supplies.",
       [
           (jump_to_menu, "mnu_village_take_food_confirm")
        ]),
      ("village_steal_cattle",
       [
          (party_slot_eq, "$current_town", slot_village_state, 0),
          (party_slot_eq, "$current_town", slot_village_player_can_not_steal_cattle, 0),
          (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
          (party_get_slot, ":num_cattle", "$current_town", slot_village_number_of_cattle),
          (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
          (gt, ":num_cattle", 0),
          ],"Steal cattle.",
       [
           (jump_to_menu, "mnu_village_steal_cattle_confirm")
        ]),
##      #hacer esclavos entre los aldeanos chief
  #LAZERAS MODIFIED  {forced slaves}
  ("forcerecruit_volunteers",
     [
      (neg|party_slot_eq, "$current_town", slot_village_state, svs_looted),
     (neg|party_slot_eq, "$current_town", slot_village_state, svs_being_raided),
     (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
      ]
      ,"Enslave villagers.",
      [
       (jump_to_menu, "mnu_forced_prisoners"),
    ]),
  #LAZERAS MODIFIED  {forced forced slaves}##                  ("hacer_esclavos",
###chief hacer exclavos acaba
      ("village_loot",[(party_slot_eq, "$current_town", slot_village_state, 0),
                       (neg|party_slot_ge, "$current_town", slot_village_infested_by_bandits, 1),
                       (store_faction_of_party, ":center_faction", "$current_town"),
                       (store_relation, ":reln", "fac_player_supporters_faction", ":center_faction"),
                       (lt, ":reln", 0),
                       ],
       "Pillage and burn this village.",
       [
#           (party_clear, "$current_town"),
#           (party_add_template, "$current_town", "pt_villagers_in_raid"),
           (jump_to_menu, "mnu_village_start_attack"),
           ]),
      ("forget_it",[],
      "Forget it.",[(jump_to_menu,"mnu_village")]),
    ],
  ),

  (
    "recruit_volunteers",0,
    "{s18}",
    "none",
    [(party_get_slot, ":volunteer_troop", "$current_town", slot_center_volunteer_troop_type),
     (party_get_slot, ":volunteer_amount", "$current_town", slot_center_volunteer_troop_amount),
     (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
#AJM chief  increases # of guys that volunteer by 1 per rank
     (assign, ":troop_no", "trp_player"),
     (store_skill_level, ":skill", "skl_persuasion", ":troop_no"),
     (val_add, ":volunteer_amount", ":skill"),

     (val_min, ":volunteer_amount", ":free_capacity"),

     (store_troop_gold, ":gold", "trp_player"),
    # (store_div, ":gold_capacity", ":gold", 10),#10 denars per man cambiado chief
     (call_script, "script_cost_per_village_recruit"),    #MOTO      variable cost
           (store_div, ":gold_capacity", ":gold", reg0),#10 denars per      man MOTO variable cost

     (assign, ":party_capacity", ":free_capacity"),
     (val_min, ":party_capacity", ":gold_capacity"),
     (try_begin),
       (gt, ":party_capacity", 0),
       (val_min, ":volunteer_amount", ":party_capacity"),
     (try_end),
     (assign, reg5, ":volunteer_amount"),
     (assign, reg7, 0),
     (try_begin),
       (gt, ":volunteer_amount", ":gold_capacity"),
       (assign, reg7, 1), #not enough money
     (try_end),
     (try_begin),
       (eq, ":volunteer_amount", 0),
       (str_store_string, s18, "@No one here seems to be willing to join your party."),
     (else_try),
      (store_mul, reg6, ":volunteer_amount", reg0),#10 denars per      man MOTO variable cost
     #(store_mul, reg6, ":volunteer_amount", 10),#10 denars per man cambiado chief
       (str_store_troop_name_by_count, s3, ":volunteer_troop", ":volunteer_amount"),
       (try_begin),
         (eq, reg5, 1),
         (str_store_string, s18, "@One {s3} volunteers to follow you."),
       (else_try),
         (str_store_string, s18, "@{reg5} {s3} volunteer to follow you."),
       (try_end),
       (set_background_mesh, "mesh_pic_recruits"),
     (try_end),
    ],
    [
      ("continue_not_enough_gold",
      [
        (eq, reg7, 1),
      ],
      "I don't have enough money...",
      [
        (jump_to_menu,"mnu_village"),
      ]),

      ("continue",
      [
        (eq, reg7, 0),
        (eq, reg5, 0),
      ], #noone willing to join
      "Continue...",
      [
        (party_set_slot, "$current_town", slot_center_volunteer_troop_amount, -1),
        (jump_to_menu,"mnu_village"),
      ]),
      ("recruit_them",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Recruit them ({reg6} scillingas).",
      [
        (call_script, "script_village_recruit_volunteers_recruit"),

        (jump_to_menu,"mnu_village"),
      ]),

      ("forget_it",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Forget it.",
      [
        (jump_to_menu,"mnu_village"),
      ]),
    ],
  ),
#reclutar forzados campesinos chief empieza
  (
    "recruit_volunteers1",0,
    "Your men taken from their homes by force all villagers.",
    "none",
    [
       (call_script, "script_party_count_members_with_full_health","p_main_party"),
       (assign, ":player_party_size", reg0),
       (call_script, "script_party_count_members_with_full_health","$current_town"),
       (assign, ":villagers_party_size", reg0),
       (try_begin),
         (lt, ":player_party_size", 6),
         (ge, ":villagers_party_size", 40),
         (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
         (jump_to_menu, "mnu_village_start_attack"),
       (try_end),
    ],
    [
      ("let_them_keep_it",[],"Continue",[(jump_to_menu, "mnu_recruit_volunteers2")]),
    ],
  ),

  (
    "recruit_volunteers2",0,
    "{s18}",
    "none",
    [(party_get_slot, ":volunteer_troop", "$current_town", slot_center_volunteer_troop_type),
     (party_get_slot, ":volunteer_amount", "$current_town", slot_center_volunteer_troop_amount),
     (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
     (store_troop_gold, ":gold", "trp_player"),
     (store_div, ":gold_capacity", ":gold", 1),#10 denars per man
     (assign, ":party_capacity", ":free_capacity"),
     (val_min, ":party_capacity", ":gold_capacity"),
     (try_begin),
       (gt, ":party_capacity", 0),
       (val_min, ":volunteer_amount", ":party_capacity"),
     (try_end),
     (assign, reg5, ":volunteer_amount"),
     (assign, reg7, 0),
     (try_begin),
       (gt, ":volunteer_amount", ":gold_capacity"),
       (assign, reg7, 1), #not enough money
     (try_end),
     (try_begin),
       (eq, ":volunteer_amount", 0),
       (str_store_string, s18, "@Others Lords have gone through here, there are only old people and children."),
     (else_try),
       (store_mul, reg6, ":volunteer_amount", 1),#1 denars per man
       (str_store_troop_name_by_count, s3, ":volunteer_troop", ":volunteer_amount"),
       (try_begin),
         (eq, reg5, 1),
         (str_store_string, s18, "@One {s3} will join you reluctantly."),
       (else_try),
         (str_store_string, s18, "@{reg5} {s3} will join you reluctantly."),
       (try_end),
       (set_background_mesh, "mesh_pic_recruits"),
     (try_end),
    ],
    [
      ("continue_not_enough_gold",
      [
        (eq, reg7, 1),
      ],
      "I don't have enough money to equip them.",
      [
        (jump_to_menu,"mnu_village"),
      ]),

      ("continue",
      [
        (eq, reg7, 0),
        (eq, reg5, 0),
      ], #noone willing to join
      "Continue...",
      [
        (party_set_slot, "$current_town", slot_center_volunteer_troop_amount, -1),
        (jump_to_menu,"mnu_village"),
      ]),

            ("recruit_them",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Recruit them ({reg6} scillingas).",
      [
    (call_script, "script_change_player_honor", -5),
    (call_script, "script_change_player_party_morale", -5),
          (call_script, "script_change_player_relation_with_center", "$current_town", -10),
        (call_script, "script_village_recruit_volunteers_recruit2"),

        (jump_to_menu,"mnu_village"),
      ]),

      ("forget_it",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Forget it.",
      [
        (jump_to_menu,"mnu_village"),
      ]),
    ],
  ),

#reclutar forzados campesinos chief acaba

  (
    "village_hunt_down_fugitive_defeated",0,
    "A heavy blow from the fugitive sends you to the ground, and your vision spins and goes dark.\
 Time passes. When you open your eyes again you find yourself battered and bloody,\
 but luckily none of the wounds appear to be lethal.",
    "none",
    [],
    [
      ("continue",[],"Continue...",[(jump_to_menu, "mnu_village"),]),
    ],
  ),

  (
    "village_infest_bandits_result",0,
    "{s9}",
    "none",
    [(try_begin),
       (eq, "$g_battle_result", 1),
       (jump_to_menu, "mnu_village_infestation_removed"),
     (else_try),
       (str_store_string, s9, "@Try as you might, you could not defeat the bandits.\
 Infuriated, they raze the village to the ground to punish the peasants,\
 and then leave the burning wasteland behind to find greener pastures to plunder."),
       (set_background_mesh, "mesh_pic_looted_village1"),
     (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [(party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
        (call_script, "script_village_set_state",  "$current_town", svs_looted),
        (party_set_slot, "$current_town", slot_village_raid_progress, 0),
        (party_set_slot, "$current_town", slot_village_recover_progress, 0),
        (try_begin),
          (check_quest_active, "qst_eliminate_bandits_infesting_village"),
          (quest_slot_eq, "qst_eliminate_bandits_infesting_village", slot_quest_target_center, "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -10), #chief cambiado
          (call_script, "script_fail_quest", "qst_eliminate_bandits_infesting_village"),
          (call_script, "script_end_quest", "qst_eliminate_bandits_infesting_village"),
        (else_try),
          (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
          (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", slot_quest_target_center, "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -8), #chief cambiado
          (call_script, "script_fail_quest", "qst_deal_with_bandits_at_lords_village"),
          (call_script, "script_end_quest", "qst_deal_with_bandits_at_lords_village"),
        (else_try),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -6), #chief cambiado
        (try_end),
        (jump_to_menu, "mnu_village"),]),
    ],
  ),

  (
    "village_infestation_removed",mnf_disable_all_keys,
    "In a battle worthy of song, you and your men drive the bandits out of the village, making it safe once more.\
 The villagers have little left in the way of wealth after their ordeal,\
 but they offer you all they can find.",
    "none",
    [(party_get_slot, ":bandit_troop", "$g_encountered_party", slot_village_infested_by_bandits),
     (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
     (party_clear, "p_temp_party"),
     (party_add_members, "p_temp_party", ":bandit_troop", "$qst_eliminate_bandits_infesting_village_num_bandits"),
     (assign, "$g_strength_contribution_of_player", 50),
     (call_script, "script_party_give_xp_and_gold", "p_temp_party"),
     (try_begin),
       (check_quest_active, "qst_eliminate_bandits_infesting_village"),
       (quest_slot_eq, "qst_eliminate_bandits_infesting_village", slot_quest_target_center, "$g_encountered_party"),
       (call_script, "script_end_quest", "qst_eliminate_bandits_infesting_village"),
       #Add quest reward
       (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 5),
     (else_try),
       (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
       (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", slot_quest_target_center, "$g_encountered_party"),
       (call_script, "script_succeed_quest", "qst_deal_with_bandits_at_lords_village"),
       (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
     (else_try),
     #Add normal reward
       (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),
     (try_end),

     (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
     (try_for_range, ":slot_no", num_equipment_kinds ,max_inventory_items + num_equipment_kinds),
        (store_random_in_range, ":rand", 0, 100),
        (lt, ":rand", 70),
        (troop_set_inventory_slot, ":merchant_troop", ":slot_no", -1),
     (try_end),
    ],
    [
      ("village_bandits_defeated_accept",[],"Take it as your just due.",[(jump_to_menu, "mnu_village"),
                                                                         (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
                                                                         (troop_sort_inventory, ":merchant_troop"),
                                                                         (change_screen_loot, ":merchant_troop"),
                                                                       ]),

      ("village_bandits_defeated_cont",[],  "Refuse, stating that they need these items more than you do.",
	  [	(call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
		(call_script, "script_change_player_honor", 1),
		(jump_to_menu, "mnu_village")]),
    ],
  ),

  (
    "center_manage",0,
    "{s19}^{reg6?^^You are\
 currently building {s7}. The building will be completed after {reg8} day{reg9?s:}.:}",
    "none",
    [(assign, ":num_improvements", 0),
     (str_clear, s18),
     (try_begin),
       (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
       (assign, ":begin", village_improvements_begin),
       (assign, ":end", village_improvements_end),
       (str_store_string, s17, "@village"),
     (else_try),
       (assign, ":begin", walled_center_improvements_begin),
       (assign, ":end", walled_center_improvements_end),
       (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
       (str_store_string, s17, "@town"),
     (else_try),
       (str_store_string, s17, "@castle"),
     (try_end),

     (try_for_range, ":improvement_no", ":begin", ":end"),
       (party_slot_ge, "$g_encountered_party", ":improvement_no", 1),
       (val_add,  ":num_improvements", 1),
       (call_script, "script_get_improvement_details", ":improvement_no"),
       (try_begin),
         (eq,  ":num_improvements", 1),
         (str_store_string, s18, "@{!}{s0}"),
       (else_try),
         (str_store_string, s18, "@{!}{s18}, {s0}"),
       (try_end),
     (try_end),

     (try_begin),
       (eq,  ":num_improvements", 0),
       (str_store_string, s19, "@The {s17} has no improvements."),
     (else_try),
       (str_store_string, s19, "@The {s17} has the following improvements:{s18}."),
     (try_end),

     (assign, reg6, 0),
     (try_begin),
       (party_get_slot, ":cur_improvement", "$g_encountered_party", slot_center_current_improvement),
       (gt, ":cur_improvement", 0),
       (call_script, "script_get_improvement_details", ":cur_improvement"),
       (str_store_string, s7, s0),
       (assign, reg6, 1),
       (store_current_hours, ":cur_hours"),
       (party_get_slot, ":finish_time", "$g_encountered_party", slot_center_improvement_end_hour),
       (val_sub, ":finish_time", ":cur_hours"),
       (store_div, reg8, ":finish_time", 24),
       (val_max, reg8, 1),
       (store_sub, reg9, reg8, 1),
     (try_end),
    ],
    [
      ("center_build_manor",[(eq, reg6, 0),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_manor, 0),
                                  ],
       "Build a manor.",[(assign, "$g_improvement_type", slot_center_has_manor),
                         (jump_to_menu, "mnu_center_improve"),]),
      ("center_build_fish_pond",[(eq, reg6, 0),
                                 (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                                 (party_slot_eq, "$g_encountered_party", slot_center_has_fish_pond, 0),
                                  ],
       "Build a mill.",[(assign, "$g_improvement_type", slot_center_has_fish_pond),
                             (jump_to_menu, "mnu_center_improve"),]),
      ("center_build_watch_tower",[(eq, reg6, 0),
                                   (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                                   (party_slot_eq, "$g_encountered_party", slot_center_has_watch_tower, 0),
                                  ],
       "Build a watch tower.",[(assign, "$g_improvement_type", slot_center_has_watch_tower),
                               (jump_to_menu, "mnu_center_improve"),]),
      ("center_build_school",[(eq, reg6, 0),
                              (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                              (party_slot_eq, "$g_encountered_party", slot_center_has_school, 0),
                                  ],
       "Build a school.",[(assign, "$g_improvement_type", slot_center_has_school),
                          (jump_to_menu, "mnu_center_improve"),]),
      ("center_build_messenger_post",[(eq, reg6, 0),
                                      (party_slot_eq, "$g_encountered_party", slot_center_has_messenger_post, 0),
                                       ],
       "Build a messenger post.",[(assign, "$g_improvement_type", slot_center_has_messenger_post),
                                  (jump_to_menu, "mnu_center_improve"),]),
      ("center_build_prisoner_tower",[(eq, reg6, 0),
                                      (this_or_next|party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                                      (party_slot_eq, "$g_encountered_party", slot_party_type, spt_castle),
                                      (party_slot_eq, "$g_encountered_party", slot_center_has_prisoner_tower, 0),
                                       ],
       "Build a prisoner tower.",[(assign, "$g_improvement_type", slot_center_has_prisoner_tower),
                                  (jump_to_menu, "mnu_center_improve"),]),                            #Sod BUILDINGS BEGIN chief edificios
    ("center_build_sod1",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 1),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_temple1, 0),
                                  ],
		"Build a Christian monastery (Conversion factor).",[(assign, "$g_improvement_type", slot_center_has_temple1),
        (assign, "$g_pueblos_religion", 4),(jump_to_menu, "mnu_center_improve"),]),
    ("center_build_sod2",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 2),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_temple2, 0),
                                  ],
		"Build a celtic sacred forest (Conversion Factor).",[(party_set_slot,"$g_encountered_party",center_religion_pagana, 1),(assign, "$g_improvement_type", slot_center_has_temple2),
        (jump_to_menu, "mnu_center_improve"), ]),
    ("center_build_sod3",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 3),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_temple3, 0),
                                  ],
		"Build a temple to Woden (Conversion Factor).",[(party_set_slot,"$g_encountered_party",center_religion_pagana, 1),(assign, "$g_improvement_type", slot_center_has_temple3),
        (jump_to_menu, "mnu_center_improve"), ]),
	("center_build_sod5",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 4),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_temple5, 0),
                                  ],
		"Build a Christian monastery (Conversion Factor).",[(assign, "$g_improvement_type", slot_center_has_temple5),
        (assign, "$g_pueblos_religion", 4),(jump_to_menu, "mnu_center_improve"),]),
	("center_build_sod10",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 4),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_chapel5, 0),
                                  ],
		"Build a Christian Church (Conversion Factor).",[(assign, "$g_improvement_type", slot_center_has_chapel5),
       (assign, "$g_pueblos_religion", 4),(jump_to_menu, "mnu_center_improve"),]),
	("center_build_sod16",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 1),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_monastery1, 0),
                                  ],
		"Build a Christian Church (Conversion Factor).",[	(assign, "$g_improvement_type", slot_center_has_monastery1),
       (assign, "$g_pueblos_religion", 4),(jump_to_menu, "mnu_center_improve"),]),
    ("center_build_sod17",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 2),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_monastery2, 0),
                                  ],
		"Build a temple of The Old Celtic Gods (Conversion Factor).",[(party_set_slot,"$g_encountered_party",center_religion_pagana, 1),(assign, "$g_improvement_type", slot_center_has_monastery2),
        (jump_to_menu, "mnu_center_improve"), ]),
	("center_build_sod18",[(eq, reg6, 0),
							 (eq, "$g_sod_faith", 3),
                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_monastery3, 0),
                                  ],
		"Build a shrine to Germanic Gods (Conversion Factor).",[(party_set_slot,"$g_encountered_party",center_religion_pagana, 1),(assign, "$g_improvement_type", slot_center_has_monastery3),
        (jump_to_menu, "mnu_center_improve"), ]),
	("center_build_sod41",[(eq, reg6, 0),

                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_castle),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_blacksmith, 0),
                                  ],
		"Build a blacksmith.",[(assign, "$g_improvement_type", slot_center_has_blacksmith),
        (jump_to_menu, "mnu_center_improve"),]),
	("center_build_sod42",[(eq, reg6, 0),

                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_guild, 0),
                                  ],
		"Build a guild hall.",[(assign, "$g_improvement_type", slot_center_has_guild),
        (jump_to_menu, "mnu_center_improve"),]),
	("center_build_sod43",[(eq, reg6, 0),

                             (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
                             (party_slot_eq, "$g_encountered_party", slot_center_has_university, 0),
                                  ],
		"Build a library.",[(assign, "$g_improvement_type", slot_center_has_university),
        (jump_to_menu, "mnu_center_improve"),]),
#SoD BUILDINGS END chief edificios
      ("go_back_dot",[],"Go back.",[(jump_to_menu, "$g_next_menu")]),
    ],
  ),

  (
    "center_improve",0,
    "{s19} As the party member with the highest engineer skill ({reg2}), {reg3?you reckon:{s3} reckons} that building the {s4} will cost you\
 {reg5} scillingas and will take {reg6} days.",
    "none",
    [(call_script, "script_get_improvement_details", "$g_improvement_type"),
     (assign, ":improvement_cost", reg0),
     (str_store_string, s4, s0),
     (str_store_string, s19, s1),
     (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),
     (assign, reg2, ":max_skill"),

     (store_sub, ":multiplier", 20, ":max_skill"),
     (val_mul, ":improvement_cost", ":multiplier"),
     (val_div, ":improvement_cost", 20),

     (store_div, ":improvement_time", ":improvement_cost", 300), #ajm chief was 100
     (val_add, ":improvement_time", 3),

     (assign, reg5, ":improvement_cost"),
     (assign, reg6, ":improvement_time"),

     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s3, ":max_skill_owner"),
     (try_end),
    ],
    [
      ##diplomacy chief begin
      ("dplmc_improve_cont",
      [
        (gt, "$g_player_chamberlain", 0),
        (store_troop_gold, ":cur_gold", "trp_household_possessions"),
        (ge, ":cur_gold", reg5),
      ], "Go on. (Pay from treasury)",
        [
          (call_script, "script_dplmc_withdraw_from_treasury", reg5),
          (party_set_slot, "$g_encountered_party", slot_center_current_improvement, "$g_improvement_type"),
          (store_current_hours, ":cur_hours"),
          (store_mul, ":hours_takes", reg6, 24),
          (val_add, ":hours_takes", ":cur_hours"),
          (party_set_slot, "$g_encountered_party", slot_center_improvement_end_hour, ":hours_takes"),
          (jump_to_menu,"mnu_center_manage"),
         ]
      ),
      ##diplomacy chief end
      ("improve_cont",[(store_troop_gold, ":cur_gold", "trp_player"),
                       (ge, ":cur_gold", reg5)],
       "Go on.", [(troop_remove_gold, "trp_player", reg5),
                  (party_set_slot, "$g_encountered_party", slot_center_current_improvement, "$g_improvement_type"),
                  (store_current_hours, ":cur_hours"),
                  (store_mul, ":hours_takes", reg6, 24),
                  (val_add, ":hours_takes", ":cur_hours"),
                  (party_set_slot, "$g_encountered_party", slot_center_improvement_end_hour, ":hours_takes"),
                  (jump_to_menu,"mnu_center_manage"),
                  ]),
      ("forget_it",[(store_troop_gold, ":cur_gold", "trp_player"),
                     ##diplomacy chief begin
                    (store_troop_gold, ":cur_treasury", "trp_household_possessions"),
                    (this_or_next|ge, ":cur_treasury", reg5),
                    ##diplomacy chief end
                    (ge, ":cur_gold", reg5)],
       "Forget it.", [(jump_to_menu,"mnu_center_manage")]),
      ("improve_not_enough_gold",[(store_troop_gold, ":cur_gold", "trp_player"),
                                  ##diplomacy chief begin
                                  (store_troop_gold, ":cur_treasury", "trp_household_possessions"),
                                  (this_or_next|lt, ":cur_treasury", reg5),
                                  ##diplomacy chief end
                                  (lt, ":cur_gold", reg5)],
       "I don't have enough money for that.", [(jump_to_menu, "mnu_center_manage"),]),
    ],
  ),

  (
    "town_bandits_failed",mnf_disable_all_keys,
    "{s4} {s5}",
    "none",
    [
#      (call_script, "script_loot_player_items", 0),
      (store_troop_gold, ":total_gold", "trp_player"),
      (store_div, ":gold_loss", ":total_gold", 30),
      (store_random_in_range, ":random_loss", 40, 100),
      (val_add, ":gold_loss", ":random_loss"),
      (val_min, ":gold_loss", ":total_gold"),
      (troop_remove_gold, "trp_player",":gold_loss"),
      (party_set_slot, "$current_town", slot_center_has_bandits, 0),
      (party_get_num_companions, ":num_companions", "p_main_party"),
      (str_store_string, s4, "@The assasins beat you down and leave you for dead."),
      (str_store_string, s4, "@You have fallen. The bandits quickly search your body for every coin they can find,\
 then vanish into the night. They have left you alive, if only barely."),
      (try_begin),
        (gt, ":num_companions", 2),
        (str_store_string, s5, "@Luckily some of your companions come to search for you when you do not return, and find you lying by the side of the road. They hurry you to safety and dress your wounds."),
      (else_try),
        (str_store_string, s5, "@Luckily some passing townspeople find you lying by the side of the road, and recognise you as something other than a simple beggar. They carry you to the nearest inn and dress your wounds."),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",[(change_screen_return)]),
    ],
  ),

  (
    "town_bandits_succeeded",mnf_disable_all_keys,
    "The bandits fall before you as grain to a scythe! Soon you stand alone in the streets\
 while most of your attackers lie unconscious, dead or dying.\
 Searching the bodies, you find a purse which must have belonged to a previous victim of these brutes.\
 Or perhaps, it was given to them by someone who wanted to arrange a suitable ending to your life.",
    "none",
    [
      (party_set_slot, "$current_town", slot_center_has_bandits, 0),
      (assign, "$g_last_defeated_bandits_town", "$g_encountered_party"),
      (try_begin),
        (check_quest_active, "qst_deal_with_night_bandits"),
        (neg|check_quest_succeeded, "qst_deal_with_night_bandits"),
        (quest_slot_eq, "qst_deal_with_night_bandits", slot_quest_target_center, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_deal_with_night_bandits"),
      (try_end),
      (store_mul, ":xp_reward", "$num_center_bandits", 117),
      (add_xp_to_troop, ":xp_reward", "trp_player"),
      (store_mul, ":gold_reward", "$num_center_bandits", 50),
      (call_script, "script_troop_add_gold","trp_player",":gold_reward"),
    ],
    [
      ("continue",[],"Continue...",[(change_screen_return)]),
    ],
  ),


   (
    "village_steal_cattle_confirm",0,
    "As the party member with the highest looting skill ({reg2}), {reg3?you reckon:{s1} reckons} that you can steal as many as {reg4} heads of village's cattle.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, reg2, reg0),
      (assign, ":max_skill_owner", reg1),
      (try_begin),
        (eq, ":max_skill_owner", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":max_skill_owner"),
      (try_end),
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, reg4, reg0),
      ],
    [
      ("village_steal_cattle_confirm",[],"Go on.",
       [
         (rest_for_hours_interactive, 3, 5, 1), #rest while attackable
         (assign, "$auto_menu", "mnu_village_steal_cattle"),
         (change_screen_return),
       ]),
      ("forget_it",[],"Forget it.",[(change_screen_return)]),
    ],
  ),

  (
    "village_steal_cattle",mnf_disable_all_keys,
    "{s1}",
    "none",
    [
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, ":max_value", reg0),
      (val_add, ":max_value", 1),
      (store_random_in_range, ":random_value", 0, ":max_value"),
      #AJM chief looting skill increases cattle stolen
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, ":skill", reg0),
      (val_add, ":random_value", ":skill"),
###chief acaba
      (party_set_slot, "$current_town", slot_village_player_can_not_steal_cattle, 1),
      (party_get_slot, ":lord", "$current_town", slot_town_lord),
      (try_begin),
        (le, ":random_value", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -20),
        (store_faction_of_party, ":faction_no", "$current_town"), #fire arrow anade chief
        (call_script, "script_change_player_relation_with_faction" ,":faction_no", -10), #fire arrow anade chief
        (str_store_string, s1, "@You fail to steal any cattle."),
      (else_try),
        (assign, reg17, ":random_value"),
        (store_sub, reg12, ":random_value", 1),
        (try_begin),
          (gt, ":lord", 0),
          (call_script, "script_change_player_relation_with_troop", ":lord", -25), #chief cambia
          (call_script, "script_add_log_entry", logent_player_stole_cattles_from_village, "trp_player",  "$current_town", ":lord", "$g_encountered_party_faction"),
        (try_end),
        (call_script, "script_change_player_relation_with_center", "$current_town", -40), #chief cambia
        (store_faction_of_party, ":faction_no", "$current_town"), #fire arrow anade chief
        (call_script, "script_change_player_relation_with_faction" ,":faction_no", -20), #fire arrow anade chief
       (call_script, "script_change_player_honor", -5),
        (str_store_string, s1, "@You drive away {reg17} {reg12?heads:head} of cattle from the village's herd."),

        (try_begin),
          (eq, ":random_value", 3),
          (unlock_achievement, ACHIEVEMENT_GOT_MILK),
        (try_end),

      (call_script, "script_create_cattle_herd", "$current_town", ":random_value"),
        (party_get_slot, ":num_cattle", "$current_town", slot_village_number_of_cattle),
        (val_sub, ":num_cattle", ":random_value"),
        (party_set_slot, "$current_town", slot_village_number_of_cattle, ":num_cattle"),
      (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [
         (change_screen_return),
         ]),
    ],
  ),

###coger prisioneros chief
  #LAZERAS MODIFIED  {forced forced slaves}
("forced_prisoners",0,
    "{s18}",
    "none",
    [
       (call_script, "script_party_count_members_with_full_health","p_main_party"),
       (assign, ":player_party_size", reg0),
       (call_script, "script_party_count_members_with_full_health","$current_town"),
       (assign, ":villagers_party_size", reg0),
       (try_begin),
         (lt, ":player_party_size", 50), #chief cambia
         (ge, ":villagers_party_size", 40),
         (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
         (jump_to_menu, "mnu_village_start_attack"),
       (try_end),

  (assign,reg5, 0),
  (assign,reg7, 0),
     (party_get_free_prisoners_capacity, ":prisoner_capacity", "p_main_party"),
        (party_get_slot, ":lord", "$current_town", slot_town_lord),
  (try_begin),
    (gt, ":prisoner_capacity", 0),
    # Add prisoners
    (party_get_slot, ":mod_troop", "$current_town", slot_center_volunteer_troop_type),
    (store_random_in_range, ":random_prisoners", 0, 20),
    (store_random_in_range, ":random_profit", 0, 10),
    (store_random_in_range, ":random_replossmut", -1, -5),
    (assign,reg10,":mod_troop"),
    (assign,reg11,":random_replossmut"),
    (assign,reg40,":random_prisoners"),
    (try_begin),
    (gt, ":random_prisoners", ":prisoner_capacity"),
    (store_random_in_range, ":random_prisoners", 0, ":prisoner_capacity"),
    (else_try),
    (lt, ":random_prisoners", ":prisoner_capacity"),
    (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
    (assign, ":max_skill", reg0),
    (store_mul, ":bonus_loot", ":max_skill", 2),
    (store_add, ":new_limit", ":bonus_loot", ":random_prisoners"),
    (try_begin),
     (lt, ":new_limit", ":prisoner_capacity"),
      (assign, ":random_prisoners", ":new_limit"),
    (else_try),
      (gt, ":new_limit", ":prisoner_capacity"),
      (assign, ":random_prisoners", ":prisoner_capacity"),
     (try_end),
    (try_end),
   (try_begin),
     (gt, ":random_prisoners", 0),
    (assign,reg7,0),
    (assign,reg5,1),
    (assign,reg41,":random_prisoners"),
    #(display_message, "@Initial prisoners were {reg40} this was increased to {reg41} due to your looting skill",0x6495ed),
    (store_mul, ":forcedprofit",":random_prisoners",":random_profit"),
    (assign,reg44,":forcedprofit"),
    (try_begin),
     (gt,":random_prisoners", 0),
     (store_mul, ":forcedprofit",":random_prisoners",":random_profit"),
     (party_get_skill_level, ":player_looting", "p_main_party", "skl_looting"),
     (try_begin),
      (gt,":random_prisoners", 2),
      #New Edit to adjust cost by looting
      (val_div, ":player_looting", 2),
      (store_add, ":random_profit",":random_profit",":player_looting"),
      (store_mul, ":forcedprofit",":random_prisoners",":random_profit"),
     (try_end),
     (assign,reg45,":forcedprofit"),
     #(display_message, "@Initial profit {reg44} profit was increased to {reg45} due to your looting skill",0x6495ed),
     #New Edit to adjust cost by looting
    (try_end),
    (store_mul, ":forcedreploss",":random_prisoners",":random_replossmut"),
    (assign,reg1,":forcedreploss"),
    #New edit to adjust rep loss by persuation
    (party_get_skill_level, ":player_persuasion", "p_main_party", "skl_persuasion"),
    (try_begin),
         (gt, ":player_persuasion", 2),
     (val_div, ":player_persuasion", 2),
     (store_div, ":tempholder",":random_prisoners",":player_persuasion"),
     (store_add, ":forcedreploss",":forcedreploss",":tempholder"),
    (try_end),
    (assign,reg3,":forcedreploss"),
    #(display_message, "@Initial reputation {reg1} cost was reduced to {reg3} due to your persuasion skill",0x6495ed),
    #New edit to adjust rep loss by persuation]
    (str_store_party_name,s2, "$current_town"),
    (party_get_slot, ":lord", "$current_town", slot_town_lord),
    (assign,reg12,":lord"),
    (store_faction_of_party, ":center_faction", "$current_town"),
    (str_store_faction_name,s9,":center_faction"),
    (try_begin),
     (ge, ":lord", 0),
     (str_store_troop_name,s8,":lord"),
     (str_store_troop_name,s9,":mod_troop"),
    (try_end),
    (assign,reg1,":random_prisoners"),
    (assign,reg2,":forcedprofit"),
    (assign,reg3,":forcedreploss"),
    (str_store_string, s18, "@You will get {reg1} {s9} as prisoners and robb them of {reg2} scillingas. And it will cost you {reg3} reputation with {s2}. You also lose relation with {s8}. You will lose honour and reputation with villages."),
   (else_try),
    (str_store_string, s18, "@You didnt manage to capture any prisoners "),
    (assign, reg7, 1),
    (assign, reg5, 0),
   (try_end),
     (else_try),
   (str_store_string, s18, "@You have no free prisoner capacity and thus can not forciable take prisoners "),
   (assign, reg7, 0),
   (assign,reg5,0),
     (try_end),
       (set_background_mesh, "mesh_pic_payment1"),
 ],
 [
      ("no_prisoners_capacity",
      [
        (eq, reg7, 0),
        (eq, reg5, 0),
      ],
      "You have no free prisoners space.",
      [
        (jump_to_menu,"mnu_village"),
      ]),
      ("continue_no_prisoners_captured",
      [
        (eq, reg7, 1),
        (eq, reg5, 0),
      ],
      "You didnt manage to capture any prisoners...",
      [
        (jump_to_menu,"mnu_village"),
      ]),
      ("capture_prisoners",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Capture Prisoners.",
      [
  (assign,":random_prisoners",reg1),
  (assign,":forcedprofit",reg2),
  (assign,":forcedreploss",reg3),
  (assign,":mod_troop",reg10),
  (assign,":random_replossmut",reg11),
  (assign,":lord",reg12),
  (rest_for_hours_interactive, 3, 5, 1), #rest while attackable
  (call_script, "script_change_player_relation_with_center", "$current_town", ":forcedreploss"),
  (call_script, "script_change_player_relation_with_troop", ":lord", ":random_replossmut"),
  (call_script, "script_change_player_relation_with_troop", ":lord", -10),
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (call_script, "script_change_player_relation_with_center", ":center", -2),
      (try_end),
#chief acaba
        (call_script, "script_change_player_honor", -13),
  (troop_add_gold, "trp_player", ":forcedprofit"),
  (party_add_prisoners, "p_main_party", ":mod_troop", ":random_prisoners"),
  (try_begin),
   (store_faction_of_party, ":village_faction", "$current_town"),
   (store_relation, ":relation", "$players_kingdom", ":village_faction"),
   (ge, ":relation", 0),
   (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$current_town"),
  (try_end),
  (call_script, "script_add_log_entry", logent_village_extorted, "trp_player",  "$current_town", ":lord", "$g_encountered_party_faction"),
  (party_set_slot, "$current_town", slot_village_raided_by, -1),
  (change_screen_return),
  ]),

      ("forget_it",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Forget it.",
      [
        (jump_to_menu,"mnu_village"),
      ]),
    ],
 ),
  #coger aldeanos prisioneros chief acaba

   (
    "village_take_food_confirm",0,
    "It will be difficult to force and threaten the peasants into giving their precious supplies. You think you will need at least one hour.",
    #TODO: mention looting skill?
    "none",
    [],
    [
      ("village_take_food_confirm",[],"Go ahead.",
       [
         (rest_for_hours_interactive, 1, 5, 0), #rest while not attackable
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$auto_enter_menu_in_center", "mnu_village_take_food"),
         (change_screen_return),
         ]),
      ("forget_it",[],"Forget it.",[(jump_to_menu, "mnu_village_hostile_action")]),
    ],
  ),

  (
    "village_take_food",0,
    "The villagers grudgingly bring out what they have for you.",
    "none",
    [
       (call_script, "script_party_count_members_with_full_health","p_main_party"),
       (assign, ":player_party_size", reg0),
       (call_script, "script_party_count_members_with_full_health","$current_town"),
       (assign, ":villagers_party_size", reg0),
       (try_begin),
         (lt, ":player_party_size", 20), #chief cambia
         (ge, ":villagers_party_size", 40),
         (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
         (jump_to_menu, "mnu_village_start_attack"),
       (try_end),
    ],
    [
      ("take_supplies",[],"Take the supplies.",
       [
         (try_begin),
           (party_slot_ge, "$current_town", slot_center_player_relation, -55),
           (store_faction_of_party, ":faction_no", "$current_town"), #fire arrow chief
           (try_begin),
             (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
             (call_script, "script_change_player_relation_with_center", "$current_town", -5), #chief cambia
             (call_script, "script_change_player_relation_with_faction" ,":faction_no", -20), #fire arrow chief
           (else_try),
             (call_script, "script_change_player_relation_with_center", "$current_town", -10), #chief cambia
             (call_script, "script_change_player_relation_with_faction" ,":faction_no", -20), #fire arrow chief
           (try_end),
         (try_end),
         (party_get_slot, ":village_lord", "$current_town", slot_town_lord),
         (try_begin),
           (gt,  ":village_lord", 1),
          (call_script, "script_change_player_relation_with_troop", ":village_lord", -15), #chief cambia
          (try_end),
         (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
         (party_get_skill_level, ":player_party_looting", "p_main_party", "skl_looting"),
         (val_mul, ":player_party_looting", 3),
         (store_sub, ":random_chance", 70, ":player_party_looting"), #Increases the chance of looting by 3% per skill level
         (try_for_range, ":slot_no", num_equipment_kinds ,max_inventory_items + num_equipment_kinds),
           (store_random_in_range, ":rand", 0, 100),
           (lt, ":rand", ":random_chance"),
           (troop_set_inventory_slot, ":merchant_troop", ":slot_no", -1),
         (try_end),

###NPC companion changes begin
         (call_script, "script_objectionable_action", tmt_humanitarian, "str_steal_from_villagers"),
#NPC companion changes end
#Troop commentary changes begin
          (call_script, "script_add_log_entry", logent_village_extorted, "trp_player",  "$current_town", -1, -1),
          (store_faction_of_party,":village_faction",  "$current_town"),
		  (call_script, "script_faction_inflict_war_damage_on_faction", "$players_kingdom", ":village_faction", 5),
#Troop commentary changes end

         (jump_to_menu, "mnu_village"),
         (troop_sort_inventory, ":merchant_troop"),
         (change_screen_loot, ":merchant_troop"),
         ]),
      ("let_them_keep_it_2",[],"Let them keep it.",[(jump_to_menu, "mnu_village")]),
    ],
  ),


  (
    "village_start_attack",mnf_disable_all_keys|mnf_scale_picture,
    "Some of the angry villagers grab their tools and prepare to resist you.\
 It looks like you'll have a fight on your hands if you continue.",
    "none",
    [
       (set_background_mesh, "mesh_pic_villageriot"),
       (call_script, "script_party_count_members_with_full_health","p_main_party"),
       (assign, ":player_party_size", reg0),
       (call_script, "script_party_count_members_with_full_health","$current_town"),
       (assign, ":villagers_party_size", reg0),

       (try_begin),
	     (store_random_in_range, ":random_no", 55, 120), #chief blood
         (gt, ":player_party_size", ":random_no"), #chief blood
##         (gt, ":player_party_size", 25),
         (jump_to_menu, "mnu_village_loot_no_resist"),
       (else_try),
         (this_or_next|eq, ":villagers_party_size", 0),
         (eq, "$g_battle_result", 1),
         (try_begin),
           (eq, "$g_battle_result", 1),
           (store_random_in_range, ":enmity", -30, -15),
           (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
           (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
           (gt, ":town_lord", 0),
           (call_script, "script_change_player_relation_with_troop", ":town_lord", -15), #chief cambiado
           (store_faction_of_party, ":faction_no", "$current_town"), #fire arrow chief
           (call_script, "script_change_player_relation_with_faction" ,":faction_no", -20), #fire arrow chief
         (try_end),
         (jump_to_menu, "mnu_village_loot_no_resist"),
       (else_try),
         (eq, "$g_battle_result", -1),
         (jump_to_menu, "mnu_village_loot_defeat"),
       (try_end),
    ],
    [
      ("village_raid_attack",[],"Charge them.",[
          (store_random_in_range, ":enmity", -15, -10), #chief cambiado
          (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
          (try_begin),
            (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
            (gt, ":town_lord", 0),
           (call_script, "script_change_player_relation_with_troop", ":town_lord", -15), #chief cambiado
           (store_faction_of_party, ":faction_no", "$current_town"), #fire arrow chief
           (call_script, "script_change_player_relation_with_faction" ,":faction_no", -20), #fire arrow chief
          (try_end),
          (call_script, "script_calculate_battle_advantage"),
          (set_battle_advantage, reg0),
          (set_party_battle_mode),
          (assign, "$g_battle_result", 0),
          (assign, "$g_village_raid_evil", 1),
          (set_jump_mission,"mt_village_raid"),
          (party_get_slot, ":scene_to_use", "$current_town", slot_castle_exterior),
          (jump_to_scene, ":scene_to_use"),
          (assign, "$g_next_menu", "mnu_village_start_attack"),

		  (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
###NPC companion changes begin
          (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
#NPC companion changes end

          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
          ]),
###COOP Village attack chief#############################
##      ("coop_setup",
##       [
##        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
##        (this_or_next|ge, "$cheat_mode", 1),
##        (eq, "$coop_battle_state", coop_battle_state_none),
##       ],
##       "Setup multiplayer battle.",
##       [
##        (assign, "$coop_battle_type", coop_battle_type_village_player_attack),
##        (assign, "$coop_encountered_party", "$current_town"),
##
##        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
##        (try_begin),
##          (eq, "$coop_skip_menu", 1),
##          (change_screen_quit),
##        (try_end),
##       ]),
##
##
##       ("quit",[
##        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
##      ],"Quit game (will not save).",
##      [
##        (change_screen_quit),
##      ]),
##
##      ("coop_use_result",[
##         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##         (eq, "$coop_battle_state", coop_battle_state_end_mp),
##      ],"Use multiplayer battle results.",
##      [
##
##          (store_random_in_range, ":enmity", -10, -5),
##          (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),
##          (try_begin),
##            (party_get_slot, ":town_lord", "$current_town", slot_town_lord),
##            (gt, ":town_lord", 0),
##            (call_script, "script_change_player_relation_with_troop", ":town_lord", -3),
##          (try_end),
##
##         # (assign, "$g_village_raid_evil", 1), #not needed
##          (assign, "$g_next_menu", "mnu_village_start_attack"),
##
##          (call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$g_encountered_party"),
##          (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
##
##        (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
##        (jump_to_menu, "mnu_battle_debrief"),
##
##      ]),
##
##      ("encounter_save",[],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),
##
################################################## chief acaba

      ("village_raid_leave",[],"Leave this village alone.",[(change_screen_return)]),
    ],
  ),

###para esclavizar aldeanos chief anadido fire arrow
  (
    "village_raid_make_villagers_prisoners",0,
    "  ",
    "none",
    [
      (party_clear, "p_temp_party"),
      (assign, "$g_move_heroes", 0),
      (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "$current_town"),
      (call_script, "script_party_add_party_prisoners", "p_temp_party", "$current_town"),
      (party_get_num_companions, ":num_rescued_prisoners", "p_temp_party"),
      (party_get_num_prisoners,  ":num_captured_enemies", "p_temp_party"),
      (store_add, ":total_capture_size", ":num_rescued_prisoners", ":num_captured_enemies"),
      (assign, reg1, ":total_capture_size"),
      (eq, ":total_capture_size", 0),
      (jump_to_menu, "mnu_village_loot_no_resist"),
    ],
    [
      ("make_villagers_prisoners",[(gt,reg1, 0)],"Make villagers prisoners",
        [
          (change_screen_exchange_with_party, "p_temp_party"),
          (party_clear, "$current_town"),
        ]),
      ("continue",[],"Continue...",[(jump_to_menu, "mnu_village_loot_no_resist")]),
    ],
  ),
###ataque para esclavizar acaba

  (
    "village_loot_no_resist",0,
    "The villagers here are few and frightened, and they quickly scatter and run before you.\
 The village is at your mercy.",
    "none",
    [],
    [
      ("village_loot",[], "Plunder the village, then raze it.",
       [
          (call_script, "script_village_set_state", "$current_town", svs_being_raided),
          (party_set_slot, "$current_town", slot_village_raided_by, "p_main_party"),
          (assign,"$g_player_raiding_village","$current_town"),

		  (try_begin),
		    (store_faction_of_party, ":village_faction", "$current_town"),
			(store_relation, ":relation", "$players_kingdom", ":village_faction"),
			(ge, ":relation", 0),
			(call_script, "script_diplomacy_party_attacks_neutral", "p_main_party", "$current_town"),
		  (try_end),

          (rest_for_hours, 1, 5, 1), #rest chief while attackable (3 hours will be extended by the trigger)
          (change_screen_return),
           ]),
      ("village_raid_leave",[],"Leave this village alone.",[(change_screen_return)]),
    ],
  ),
  (
    "village_loot_complete",mnf_disable_all_keys,
    "On your orders your troops sack the village, pillaging everything of any value,\
 and then put the buildings to the torch. From the coins and valuables that are found, you get your share of {reg1} scillingas.",
    "none",
    [
        (get_achievement_stat, ":number_of_village_raids", ACHIEVEMENT_THE_BANDIT, 0),
        (get_achievement_stat, ":number_of_caravan_raids", ACHIEVEMENT_THE_BANDIT, 1),
        (val_add, ":number_of_village_raids", 1),
        (set_achievement_stat, ACHIEVEMENT_THE_BANDIT, 0, ":number_of_village_raids"),

        (try_begin),
          (ge, ":number_of_village_raids", 3),
          (ge, ":number_of_caravan_raids", 3),
          (unlock_achievement, ACHIEVEMENT_THE_BANDIT),
        (try_end),

        (party_get_slot, ":village_lord", "$current_town", slot_town_lord),
        (try_begin),
          (gt,  ":village_lord", 0),
          (call_script, "script_change_player_relation_with_troop", ":village_lord", -5),
        (try_end),
        (store_random_in_range, ":enmity", -35, -25),
        (call_script, "script_change_player_relation_with_center", "$current_town", ":enmity"),

        (store_faction_of_party, ":village_faction", "$current_town"),
        (store_relation, ":relation", ":village_faction", "fac_player_supporters_faction"),
        (try_begin),
          (lt, ":relation", 0),
          (call_script, "script_change_player_relation_with_faction", ":village_faction", -3),
        (try_end),

        (assign, ":money_gained", 50),
        (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
        (store_mul, ":prosperity_of_village_mul_5", ":prosperity", 5),
        (val_add, ":money_gained", ":prosperity_of_village_mul_5"),
        (call_script, "script_troop_add_gold", "trp_player", ":money_gained"),

        (assign, ":morale_increase", 3),
        (store_div, ":money_gained_div_100", ":money_gained", 100),
        (val_add, ":morale_increase", ":money_gained_div_100"),
        (call_script, "script_change_player_party_morale", ":morale_increase"),


        (faction_get_slot, ":faction_morale", ":village_faction",  slot_faction_morale_of_player_troops),
        (store_mul, ":morale_increase_mul_2", ":morale_increase", 200),
        (val_sub, ":faction_morale", ":morale_increase_mul_2"),
        (faction_set_slot, ":village_faction",  slot_faction_morale_of_player_troops, ":faction_morale"),



#NPC companion changes begin
        (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
#NPC companion changes end
        (assign, reg1, ":money_gained"),
      ],
    [
      ("continue",[], "Continue...",
       [
          (jump_to_menu, "mnu_close"),
          (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
          (assign, ":max_cattle", reg0),
          (val_mul, ":max_cattle", 3),
          (val_div, ":max_cattle", 2),
          (party_get_slot, ":num_cattle", "$current_town", slot_village_number_of_cattle),
          (val_min, ":max_cattle", ":num_cattle"),
          (val_add, ":max_cattle", 1),
          (store_random_in_range, ":random_value", 0, ":max_cattle"),
          (try_begin),
            (gt, ":random_value", 0),
            (call_script, "script_create_cattle_herd", "$current_town", ":random_value"),
            (val_sub, ":num_cattle", ":random_value"),
            (party_set_slot, "$current_town", slot_village_number_of_cattle, ":num_cattle"),
          (try_end),
          (troop_clear_inventory, "trp_temp_troop"),

		  #below line changed with below lines to make plunder result more realistic. Now only items produced in bound town can be stolen after raid.
          #(reset_item_probabilities,100),

          #begin of changes
          (party_get_slot, ":bound_town", "$current_town", slot_village_bound_center),
          (store_sub, ":item_to_price_slot", slot_town_trade_good_prices_begin, trade_goods_begin),          (reset_item_probabilities,100),
          (assign, ":total_probability", 0),
          (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
            (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
            (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
            (gt, ":cur_price", 0),
            (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
            (assign, ":cur_probability", reg0),
            (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
            (val_div, reg0, 3),
            (val_add, ":cur_probability", reg0),
            (val_mul, ":cur_probability", 4),
            (val_mul, ":cur_probability", average_price_factor),
            (val_div, ":cur_probability", ":cur_price"),
            #first only simulation
            #(set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
            (val_add, ":total_probability", ":cur_probability"),
          (try_end),

          (try_for_range, ":cur_goods", trade_goods_begin, trade_goods_end),
            (store_add, ":cur_price_slot", ":cur_goods", ":item_to_price_slot"),
            (party_get_slot, ":cur_price", ":bound_town", ":cur_price_slot"),
            (gt, ":cur_price", 0),
            (call_script, "script_center_get_production", ":bound_town", ":cur_goods"),
            (assign, ":cur_probability", reg0),
            (call_script, "script_center_get_consumption", ":bound_town", ":cur_goods"),
            (val_div, reg0, 3),
            (val_add, ":cur_probability", reg0),
            (gt, ":cur_probability", 0),
            (val_mul, ":cur_probability", 4),
            (val_mul, ":cur_probability", average_price_factor),
            (val_div, ":cur_probability", ":cur_price"),

            (val_mul, ":cur_probability", num_merchandise_goods),
            (val_mul, ":cur_probability", 100),
            (val_div, ":cur_probability", ":total_probability"),

            (set_item_probability_in_merchandise,":cur_goods",":cur_probability"),
          (try_end),
          #end of changes

          (troop_add_merchandise,"trp_temp_troop",itp_type_goods,30),
          (troop_sort_inventory, "trp_temp_troop"),
          (change_screen_loot, "trp_temp_troop"),
        ]),
    ],
  ),
  (

    "village_loot_defeat",mnf_scale_picture,
    "Fighting with courage and determination, the villagers manage to hold together and drive off your forces.",
    "none",
    [
        (set_background_mesh, "mesh_pic_villageriot"),
	],
    [
      ("continue",[],"Continue...",[(change_screen_return)]),
    ],
  ),

  (
    "village_loot_continue",0,
    "Do you wish to continue looting this village?",
    "none",
    [],
    [
      ("yosi_yes",[],"Yes.",[ (rest_for_hours, 3, 5, 1), #rest while attackable (3 hours will be extended by the trigger)
                              (change_screen_return),
                              ]),
      ("yono_no",[],"No.",[(call_script, "script_village_set_state", "$current_town", 0),
                            (party_set_slot, "$current_town", slot_village_raided_by, -1),
                            (assign, "$g_player_raiding_village", 0),
                            (change_screen_return)]),
    ],
  ),

  (
    "close",0,
    "Nothing.",
    "none",
    [
        (change_screen_return),
      ],
    [],
  ),

  (
    "town",mnf_enable_hot_keys,
    "{s10} {s14}^{s11}{s12}{s13}",
    "none",
    [
#chief anade saqueo
          (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_saqueo_state, 1),
          (jump_to_menu, "mnu_saqueo_loot_continue"),
        (else_try),
#chief saqueo acaba
#chief blood anadido
		  (party_get_slot, ":lord", "$current_town", slot_town_lord),
          (try_begin),
			(eq, ":lord", "trp_player"),
			(assign, "$sneaked_into_town",1),
			(assign, "$town_entered", 1),
			(assign, "$encountered_party_hostile", 0),
			(assign,"$entry_to_town_forbidden",0),
			(assign, "$encountered_party_friendly", 1),
			(assign,"$g_permitted_to_center",1),
          (try_end),
#chief blood anadido acaba
        (try_begin),
          (eq, "$sneaked_into_town", 1),
          (call_script, "script_music_set_situation_with_culture", mtf_sit_town_infiltrate),
        (else_try),
          (call_script, "script_music_set_situation_with_culture", mtf_sit_travel),
        (try_end),
        (store_encountered_party, "$current_town"),
      ## CC chief
        (try_begin),
          (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
          (ge, ":center_lord", 0),
          (set_fixed_point_multiplier, 100),
          (position_set_x, pos0, 70),
          (position_set_y, pos0, 5),
          (position_set_z, pos0, 75),
          (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", ":center_lord", pos0),
        (try_end),
      ## CC
        (call_script, "script_update_center_recon_notes", "$current_town"),
        (assign, "$g_defending_against_siege", 0),
        (str_clear, s3),
        (party_get_battle_opponent, ":besieger_party", "$current_town"),
        (store_faction_of_party, ":encountered_faction", "$g_encountered_party"),
        (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
        (try_begin),
          (gt, ":besieger_party", 0),
          (ge, ":faction_relation", 0),
          (store_faction_of_party, ":besieger_party_faction", ":besieger_party"),
          (store_relation, ":besieger_party_relation", ":besieger_party_faction", "fac_player_supporters_faction"),
          (lt, ":besieger_party_relation", 0),
          (assign, "$g_defending_against_siege", 1),
          (assign, "$g_siege_first_encounter", 1),
          (jump_to_menu, "mnu_siege_started_defender"),
        (try_end),

        (try_begin),
          (is_between, "$g_encountered_party", towns_begin, towns_end),
          (store_sub, ":encountered_town_no", "$g_encountered_party", towns_begin),
          (set_achievement_stat, ACHIEVEMENT_MIGRATING_COCONUTS, ":encountered_town_no", 1),

          (assign, ":there_are_villages_not_visited", 0),
          (try_for_range, ":cur_town", towns_begin, towns_end),
            (store_sub, ":encountered_town_no", ":cur_town", towns_begin),
            (get_achievement_stat, ":town_is_visited", ACHIEVEMENT_MIGRATING_COCONUTS, ":encountered_town_no"),
            (eq, ":town_is_visited", 0),
            (assign, ":there_are_villages_not_visited", 1),
          (try_end),

          (try_begin),
            (eq, ":there_are_villages_not_visited", 0),
            (unlock_achievement, ACHIEVEMENT_MIGRATING_COCONUTS),
          (try_end),
        (try_end),

        #Quest menus

        (assign, "$qst_collect_taxes_currently_collecting", 0),

        (try_begin),
          (gt, "$quest_auto_menu", 0),
          (jump_to_menu, "$quest_auto_menu"),
          (assign, "$quest_auto_menu", 0),
        (try_end),

        (try_begin),
##          (eq, "$g_center_under_siege_battle", 1),
##          (jump_to_menu,"mnu_siege_started_defender"),
##        (else_try),
          (eq, "$g_town_assess_trade_goods_after_rest", 1),
          (assign, "$g_town_assess_trade_goods_after_rest", 0),
          (jump_to_menu,"mnu_town_trade_assessment"),
        (try_end),

        (assign, "$talk_context", 0),
        (assign,"$all_doors_locked",0),

        (try_begin),
          (eq, "$g_town_visit_after_rest", 1),
          (assign, "$g_town_visit_after_rest", 0),
          (assign, "$town_entered", 1),
        (try_end),

        (try_begin),
          (eq,"$g_leave_town",1),
          (assign,"$g_leave_town",0),
          (assign,"$g_permitted_to_center",0),
          (leave_encounter),
          (change_screen_return),
        (try_end),

        (str_store_party_name, s2, "$current_town"),
        (party_get_slot, ":center_lord", "$current_town", slot_town_lord),
        (store_faction_of_party, ":center_faction", "$current_town"),
        (str_store_faction_name, s9, ":center_faction"),
                  #Sod chief fe faith empieza cristianismo
			(try_begin),
                  (this_or_next|eq, "$g_sod_faith", 1),
							 (eq, "$g_sod_faith", 4),
                  		(party_get_slot, ":faith", "$current_town", slot_center_sod_local_faith),
			(try_begin),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
##				(lt, ":faith", -80),
				(str_store_string, s15, "@ ...(Pagan Town) Your faith is hated among the population..."),
			(else_try),
##				(lt, ":faith", -50),
##				(str_store_string, s15, "@ ...(Christian) Your faith is not tolerated here..."),
##			(else_try),
##				(lt, ":faith", -30),
##				(str_store_string, s15, "@ ...(Christian) Your faith is not accepted here..."),
##			(else_try),
				(lt, ":faith", 0),
				(str_store_string, s15, "@ ...(Christian Town) Your faith is liked here..."),
			(else_try),
				(lt, ":faith", 30),
				(str_store_string, s15, "@ ...(Christian Town) Your faith is tolerated here..."),
			(else_try),
				(lt, ":faith", 50),
				(str_store_string, s15, "@ ...(Christian Town) Your faith is accepted here..."),
			(else_try),
				(lt, ":faith", 80),
				(str_store_string, s15, "@ ...(Christian Town) Your faith is dominant here..."),
			(else_try),
				(lt, ":faith", 101),
				(str_store_string, s15, "@ ...(Christian Town) This city is a bastion of Your faith..."),
			(else_try),
				(str_store_string, s15, "@ ...Rumor spreads that Christian faith is nothing more than a veil, and the population continues to worship pagan gods..."),
			(try_end),
			(try_end),
		#SOD end chief
                  #Sod chief fe faith empieza paganismo
			(try_begin),
                  (this_or_next|eq, "$g_sod_faith", 2),
							 (eq, "$g_sod_faith", 3),

                  		(party_get_slot, ":faith", "$current_town", slot_center_sod_local_faith),
			(try_begin),
        (neg|party_slot_ge, "$current_town", center_religion_pagana, 1), #skip villages which are pagan.
##				(lt, ":faith", -80),
				(str_store_string, s15, "@ ...(Christian Town) Your faith is hated among population..."),
##			(else_try),
##				(lt, ":faith", -50),
##				(str_store_string, s15, "@ ...(Pagan) Your faith is dominant here..."),
##			(else_try),
##				(lt, ":faith", -30),
##				(str_store_string, s15, "@ ...(Pagan) Your faith is accepted here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
                  (lt, ":faith", 0),
				(str_store_string, s15, "@ ...(Pagan Town) Your faith is tolerated here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 30),
				(str_store_string, s15, "@ ...(Pagan Town) Your faith is liked here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 50),
				(str_store_string, s15, "@ ...(Pagan Town) Your faith is accepted here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 80),
				(str_store_string, s15, "@ ...(Pagan Town) Your faith is dominant here..."),
			(else_try),
			(party_slot_eq, "$current_town", center_religion_pagana, 1),
				(lt, ":faith", 101),
				(str_store_string, s15, "@ ...(Pagan Town) This village is a bastion of Your faith..."),
			(else_try),
				(str_store_string, s15, "@ ...Rumor spreads that old pagan gods are being forgotten in favour of Christendom..."),
			(try_end),
			(try_end),
		#SOD end chief

        (try_begin),
          (ge, ":center_lord", 0),
          (str_store_troop_name,s8,":center_lord"),
          (str_store_string,s7,"@{s8} of {s9}"),
        (try_end),

        (try_begin),
          (party_slot_eq,"$current_town",slot_party_type, spt_town),

          (str_store_string, s60, s2),

		  (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
		  (try_begin),
			(ge, "$cheat_mode", 1),
			(assign, reg4, ":prosperity",),
			(display_message, "@{!}DEBUG -- Prosperity: {reg4}"),
		  (try_end),

	 #          (val_add, ":prosperity", 5),
          (store_div, ":str_id", ":prosperity", 10),
		  (val_min, ":str_id", 9),
		  (val_add, ":str_id", "str_town_prosperity_0"),
          (str_store_string, s10, ":str_id"),

          (store_div, ":str_id", ":prosperity", 20),
		  (val_min, ":str_id", 4),
		  (val_add, ":str_id", "str_town_alt_prosperity_0"),

          (str_store_string, s14, ":str_id"),


        (else_try),
		  (str_clear, s14),
          (str_store_string,s10,"@You are at {s2}."),
        (try_end),

        (try_begin),
          (party_slot_eq,"$current_town",slot_party_type, spt_castle),
          (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ Your own banner flies over the castle gate."),
		  (else_try),
			(gt, ":center_lord", -1),
			(troop_slot_eq, ":center_lord", slot_troop_spouse, "trp_player"),
            (str_store_string,s11,"str__you_see_the_banner_of_your_wifehusband_s7_over_the_castle_gate"),
		  (else_try),
            (ge, ":center_lord", 0),
            (str_store_string,s11,"@ You see the banner of {s7} over the castle gate."),
          (else_try),
##            (str_store_string,s11,"@ This castle seems to belong to no one."),
            (str_store_string,s11,"@ This castle has no garrison."),
          (try_end),
        (else_try),
          (try_begin),
            (eq, ":center_lord", "trp_player"),
            (str_store_string,s11,"@ Your own banner flies over the town gates. {s15}"),
		  (else_try),
			(gt, ":center_lord", -1),
			(troop_slot_eq, ":center_lord", slot_troop_spouse, "trp_player"),
            (str_store_string,s11,"str__the_banner_of_your_wifehusband_s7_flies_over_the_town_gates"),
          (else_try),
            (ge, ":center_lord", 0),
            (str_store_string,s11,"@ You see the banner of {s7} over the town gates. {s15}"),
          (else_try),
##            (str_store_string,s11,"@ The townsfolk here have declared their independence."),
            (str_store_string,s11,"@ This town has no garrison. {s15}"),
          (try_end),
        (try_end),

        (str_clear, s12),
        (try_begin),
          (party_slot_eq,"$current_town",slot_party_type, spt_town),
          (party_get_slot, ":center_relation", "$current_town", slot_center_player_relation),
          (call_script, "script_describe_center_relation_to_s3", ":center_relation"),
          (assign, reg9, ":center_relation"),
          (str_store_string, s12, "@{!} {s3} ({reg9})."),
        (try_end),

        (str_clear, s13),
        (try_begin),
          (gt,"$entry_to_town_forbidden",0),
          (str_store_string, s13, "@ You have successfully sneaked in."),
		(else_try),
		  (faction_slot_eq, ":center_faction", slot_faction_ai_state, sfai_feast),
		  (faction_slot_eq, ":center_faction", slot_faction_ai_object, "$current_town"),

          (str_store_string, s13, "str__the_lord_is_currently_holding_a_feast_in_his_hall"),
        (try_end),

        #forbidden to enter?
        (try_begin),
          (store_time_of_day,reg(12)),
          (ge,reg(12),5),
          (lt,reg(12),21),
          (assign,"$town_nighttime",0),
        (else_try),
          (assign,"$town_nighttime",1),
          (party_slot_eq,"$current_town",slot_party_type, spt_town),
          (str_store_string, s13, "str_town_nighttime"),
        (try_end),

        (try_begin),
          (party_slot_ge, "$current_town", slot_town_has_tournament, 1),
          (neg|is_currently_night),
          (party_set_slot, "$current_town", slot_town_has_tournament, 1),
           (str_store_string, s13, "@{s13} A Competition will be held here soon."),
        (try_end),

        (assign,"$castle_undefended",0),
        (party_get_num_companions, ":castle_garrison_size", "p_collective_enemy"),
        (try_begin),
          (eq,":castle_garrison_size",0),
          (assign,"$castle_undefended",1),
        (try_end),

#chief blood
		  (party_get_slot, ":lord", "$current_town", slot_town_lord),
          (try_begin),
			(eq, ":lord", "trp_player"),
			(assign, "$sneaked_into_town",0),
			(assign, "$town_entered", 1),
			(assign, "$encountered_party_hostile", 0),
			(assign,"$entry_to_town_forbidden",0),
			(assign, "$encountered_party_friendly", 1),
			(assign,"$g_permitted_to_center",1),
          (try_end),
#chief blood acaba
		(call_script, "script_set_town_picture"),

#		(str_clear, s5), #alert player that there are new rumors
#		(try_begin),
#			(eq, 1, 0),
#			(neg|is_currently_night),
#			(str_store_string, s5, "@^The buzz of excited voices as you come near the gate suggests to you that news of some import is circulating among the townsfolk."),
#			(lt, "$last_town_log_entry_checked", "$num_log_entries"),
#			(assign, "$g_town_rumor_log_entry", 0),
#			(try_for_range, ":log_entry", "$last_town_log_entry_checked", "$num_log_entries"),
#				(eq, ":log_entry", 4123), #placeholder to avoid having unused variable error message
#			(try_end),
#			(assign, "$last_town_log_entry_checked", "$num_log_entries"),
#		(try_end),
		(try_end), #chief saqueo
        ],
    [
      ("castle_castle",
      [
        (party_slot_eq,"$current_town",slot_party_type, spt_castle),

       (neq, "$current_town", "p_fort"), #para lair chief player
        (eq, "$sneaked_into_town", 0),

      (str_clear, s1),
        (try_begin),
          (store_faction_of_party, ":center_faction", "$current_town"),
          (faction_slot_eq, ":center_faction", slot_faction_ai_state, sfai_feast),
          (faction_slot_eq, ":center_faction", slot_faction_ai_object, "$current_town"),
          (str_store_string, s1, "str__join_the_feast"),
        (try_end),
        ],"Go to the Great Hall{s1}.", #chief sot cambia
       [
           (try_begin),
             (this_or_next|eq, "$all_doors_locked", 1),
             (eq, "$sneaked_into_town", 1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
		     (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
		     (neg|troop_slot_ge, "trp_player", slot_troop_renown, 50),
			 (neg|troop_slot_ge, "trp_player", slot_troop_renown, 125),
			 (neq, "$g_player_eligible_feast_center_no", "$current_town"),

			 (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
			 (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),

			 (neg|check_quest_active, "qst_wed_betrothed"),
			 (neg|check_quest_active, "qst_wed_betrothed_female"),

			 (neg|troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin), #Married players always make the cut

			 (jump_to_menu, "mnu_cannot_enter_court"),
		   (else_try),
             (assign, "$town_entered", 1),
             (call_script, "script_enter_court", "$current_town"),
           (try_end),
        ], "Door to the castle."),

      ("join_tournament", [(neg|is_currently_night),(party_slot_ge, "$current_town", slot_town_has_tournament, 1),]
       ,"Join the Competition.", #chief cambia sot
       [
           (call_script, "script_fill_tournament_participants_troop", "$current_town", 1),
           (assign, "$g_tournament_cur_tier", 0),
           (assign, "$g_tournament_player_team_won", -1),
           (assign, "$g_tournament_bet_placed", 0),
           (assign, "$g_tournament_bet_win_amount", 0),
           (assign, "$g_tournament_last_bet_tier", -1),
           (assign, "$g_tournament_next_num_teams", 0),
           (assign, "$g_tournament_next_team_size", 0),
           (jump_to_menu, "mnu_town_tournament"),
        ]),


      ("town_castle",[
          (party_slot_eq,"$current_town",slot_party_type, spt_town),
          (eq,"$entry_to_town_forbidden",0),
          (str_clear, s1),
          (try_begin),
            (store_faction_of_party, ":center_faction", "$current_town"),
            (faction_slot_eq, ":center_faction", slot_faction_ai_state, sfai_feast),
            (faction_slot_eq, ":center_faction", slot_faction_ai_object, "$current_town"),
            (str_store_string, s1, "str__join_the_feast"),
          (try_end),

          ],"Go to the Great hall{s1}.",
       [
            (try_begin), #chief anadido
        (this_or_next|party_slot_eq, "$current_town", slot_town_lord, "trp_player"), #chief anadido player es lord de la ciudad
    (troop_slot_ge, "trp_player", slot_troop_renown, 30), #chief anadido
          (try_begin),
             (this_or_next|eq, "$all_doors_locked", 1),
             (eq, "$sneaked_into_town", 1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
		     (this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
		     (neg|troop_slot_ge, "trp_player", slot_troop_renown, 50),
		     (neg|troop_slot_ge, "trp_player", slot_troop_renown, 125),
			 (neq, "$g_player_eligible_feast_center_no", "$current_town"),

			 (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
			 (faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),

			 (neg|check_quest_active, "qst_wed_betrothed"),
			 (neg|check_quest_active, "qst_wed_betrothed_female"),

			 (neg|troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin), #Married players always make the cut

             (jump_to_menu, "mnu_cannot_enter_court"),
			(else_try),
			  (assign, "$town_entered", 1),
              (call_script, "script_enter_court", "$current_town"),
           (try_end),
		   (else_try), #chief anadido
             (display_message,"@You need more renown or to ask the guard.",0xFFFFAAAA), #chief anadido
           (try_end), #chief anadido
        ], "Door to the castle."),

      ("town_center",
      [
        (party_slot_eq, "$current_town", slot_party_type, spt_town),
        (this_or_next|eq,"$entry_to_town_forbidden",0),
        (eq, "$sneaked_into_town",1)
      ],
      "Take a walk around the streets.",
       [
         #If the player is fighting his or her way out
         (try_begin),
           (eq, "$talk_context", tc_prison_break),
           (assign, "$talk_context", tc_escape),
           (assign, "$g_mt_mode", tcm_escape),
           (store_faction_of_party, ":town_faction", "$current_town"),
           (faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_3_troop),
           (faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
           (faction_get_slot, ":tier_4_troop", ":town_faction", slot_faction_tier_4_troop),
           (party_get_slot, ":town_scene", "$current_town", slot_town_center),
           (modify_visitors_at_site, ":town_scene"),
           (reset_visitors),
           #ideally we could alarm troops at locations
           (try_begin),
	         #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
             (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
             (store_current_hours, ":cur_time"),
             (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

             (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
             (store_time_of_day, ":cur_day_hour"),
             (try_begin), #there are 6 guards at day time (no fire ext)
               (ge, ":cur_day_hour", 6),
               (lt, ":cur_day_hour", 22),
               (set_visitors, 25, ":tier_2_troop", 2),
               (set_visitors, 26, ":tier_2_troop", 1),
               (set_visitors, 27, ":tier_3_troop", 2),
               (set_visitors, 28, ":tier_4_troop", 1),
             (else_try),  #only 4 guards because of night
               (set_visitors, 25, ":tier_2_troop", 1),
               (set_visitors, 26, ":tier_2_troop", 1),
               (set_visitors, 27, ":tier_3_troop", 1),
               (set_visitors, 28, ":tier_4_troop", 1),
             (try_end),
           (else_try),
	         #if guards have gone to some other important happening at nearby villages, then spawn only 1 guard. (example : fire)
             (store_time_of_day, ":cur_day_hour"),
             (try_begin), #only 2 guard because there is a fire at one owned village
               (ge, ":cur_day_hour", 6),
               (lt, ":cur_day_hour", 22),
               (set_visitors, 25, ":tier_2_troop", 1),
               (set_visitors, 26, ":tier_2_troop", 0),
               (set_visitors, 27, ":tier_3_troop", 1),
               (set_visitors, 28, ":tier_4_troop", 0),
             (else_try), #only 1 guard because both night and there is a fire at one owned village
               (set_visitors, 25, ":tier_2_troop", 1),
               (set_visitors, 26, ":tier_2_troop", 0),
               (set_visitors, 27, ":tier_3_troop", 0),
               (set_visitors, 28, ":tier_4_troop", 0),
             (try_end),
           (try_end),
           (set_jump_mission,"mt_town_center"),
           (jump_to_scene, ":town_scene"),
           (change_screen_mission),
            #If you're already at escape, then talk context will reset
         (else_try),
           (assign, "$talk_context", 0),
           (call_script, "script_cf_enter_center_location_bandit_check"),
           #All other circumstances...
         (else_try),
           (party_get_slot, ":town_scene", "$current_town", slot_town_center),
           (modify_visitors_at_site, ":town_scene"),
           (reset_visitors),
           (assign, "$g_mt_mode", tcm_default),
           (store_faction_of_party, ":town_faction","$current_town"),

           (try_begin),
             (neq, ":town_faction", "fac_player_supporters_faction"),
             (faction_get_slot, ":troop_prison_guard", "$g_encountered_party_faction", slot_faction_prison_guard_troop),
             (faction_get_slot, ":troop_castle_guard", "$g_encountered_party_faction", slot_faction_castle_guard_troop),
             (faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_2_troop),
             (faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
           (else_try),
             (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
             (faction_get_slot, ":troop_prison_guard", ":town_original_faction", slot_faction_prison_guard_troop),
             (faction_get_slot, ":troop_castle_guard", ":town_original_faction", slot_faction_castle_guard_troop),
             (faction_get_slot, ":tier_2_troop", ":town_original_faction", slot_faction_tier_2_troop),
             (faction_get_slot, ":tier_3_troop", ":town_original_faction", slot_faction_tier_3_troop),
           (try_end),
           (try_begin), #think about this, should castle guard have to go nearby fire too? If he do not go, killing 2 armored guard is too hard for player. For now he goes too.
             #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
             (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
             (store_current_hours, ":cur_time"),
             (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

             (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
             (set_visitor, 23, ":troop_castle_guard"),
           (try_end),
           (set_visitor, 24, ":troop_prison_guard"),

           (try_begin),
             (gt,":tier_2_troop", 0),
             (assign,reg0,":tier_3_troop"),
             (assign,reg1,":tier_3_troop"),
             (assign,reg2,":tier_2_troop"),
             (assign,reg3,":tier_2_troop"),
           (else_try),
             (assign,reg0,"trp_vaegir_infantry"),
             (assign,reg1,"trp_vaegir_infantry"),
             (assign,reg2,"trp_vaegir_archer"),
             (assign,reg3,"trp_vaegir_footman"),
           (try_end),
           (shuffle_range,0,4),

           (try_begin),
             #if guards have not gone to some other important happening at nearby villages, then spawn 4 guards. (example : fire)
             (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
             (store_current_hours, ":cur_time"),
             (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),

             (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
             (set_visitor,25,reg0),
             (set_visitor,26,reg1),
             (set_visitor,27,reg2),
             (set_visitor,28,reg3),
           (try_end),

           (party_get_slot, ":spawned_troop", "$current_town", slot_town_armorer),
           (set_visitor, 9, ":spawned_troop"),
           (party_get_slot, ":spawned_troop", "$current_town", slot_town_weaponsmith),
           (set_visitor, 10, ":spawned_troop"),
           (party_get_slot, ":spawned_troop", "$current_town", slot_town_elder),
           (set_visitor, 11, ":spawned_troop"),
           (party_get_slot, ":spawned_troop", "$current_town", slot_town_horse_merchant),
           (set_visitor, 12, ":spawned_troop"),
           (call_script, "script_init_town_walkers"),
           (set_jump_mission,"mt_town_center"),
           (assign, ":override_state", af_override_horse),
           (try_begin),
             (eq, "$sneaked_into_town", 1), #setup disguise
             (assign, ":override_state", af_override_all),
           (try_end),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 0, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 2, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 3, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 4, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 5, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 6, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_town_center", 7, ":override_state"),
           (try_begin),
             (eq, "$town_entered", 0),
             (assign, "$town_entered", 1),
             (eq, "$town_nighttime", 0),
             (set_jump_entry, 1),
           (try_end),
           (jump_to_scene, ":town_scene"),
           (change_screen_mission),
         (try_end),
      ],"Door to the town center."),

      ("town_tavern",[
          (party_slot_eq,"$current_town",slot_party_type, spt_town),
          (this_or_next|eq,"$entry_to_town_forbidden",0),
          (eq, "$sneaked_into_town",1),
#          (party_get_slot, ":scene", "$current_town", slot_town_tavern),
#          (scene_slot_eq, ":scene", slot_scene_visited, 1), #check if scene has been visited before to allow entry from menu. Otherwise scene will only be accessible from the town center.
          ]
       ,"Visit the mead hall", #chief sot cambia
       [
           (try_begin),
             (eq,"$all_doors_locked",1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
             (call_script, "script_cf_enter_center_location_bandit_check"),
           (else_try),
             (assign, "$town_entered", 1),
             (set_jump_mission, "mt_town_default"),
             (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_horse),
             (try_begin),
               (eq, "$sneaked_into_town",1),
               (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_all),
             (try_end),
             (party_get_slot, ":cur_scene", "$current_town", slot_town_tavern),
             (jump_to_scene, ":cur_scene"),
             (scene_set_slot, ":cur_scene", slot_scene_visited, 1),

             (assign, "$talk_context", tc_tavern_talk),
             (call_script, "script_initialize_tavern_variables"),

			 (store_random_in_range, ":randomize_attacker_placement", 0, 4),

             (modify_visitors_at_site, ":cur_scene"),
             (reset_visitors),

             (assign, ":cur_entry", 17),

			 #this is just a cheat right now
             #(troop_set_slot, "trp_belligerent_drunk", slot_troop_cur_center, "$g_encountered_party"),
			 (try_begin),
				(eq, "$cheat_mode", 1),
				(troop_get_slot, ":drunk_location", "trp_belligerent_drunk", slot_troop_cur_center),
				(try_begin),
					(eq, "$cheat_mode", 0),
				(else_try),
					(is_between, ":drunk_location", centers_begin, centers_end),
					(str_store_party_name, s4, ":drunk_location"),
					(display_message, "str_belligerent_drunk_in_s4"),
			    (else_try),
					(display_message, "str_belligerent_drunk_not_found"),
				(try_end),

				(troop_get_slot, ":promoter_location", "trp_fight_promoter", slot_troop_cur_center),
				(try_begin),
					(eq, "$cheat_mode", 0),
				(else_try),
					(is_between, ":promoter_location", centers_begin, centers_end),
					(str_store_party_name, s4, ":promoter_location"),
					(display_message, "str_roughlooking_character_in_s4"),
			    (else_try),
					(display_message, "str_roughlooking_character_not_found"),
				(try_end),
			 (try_end),

			 #this determines whether or not a lord who dislikes you will commission an assassin
			 (try_begin),
				(store_current_hours, ":hours"),
				(store_sub, ":hours_since_last_attempt", ":hours", "$g_last_assassination_attempt_time"),
				(gt, ":hours_since_last_attempt", 168),
				(try_for_range, ":lord", active_npcs_begin, active_npcs_end),
					(troop_slot_eq, ":lord", slot_lord_reputation_type, lrep_debauched),
					(troop_get_slot, ":led_party", ":lord", slot_troop_leaded_party),
					(party_is_active, ":led_party"),
					(party_get_attached_to, ":led_party_attached", ":led_party"),
					(eq, ":led_party_attached", "$g_encountered_party"),
					(call_script, "script_troop_get_relation_with_troop", "trp_player", ":lord"),
					(lt, reg0, -20),
					(assign, "$g_last_assassination_attempt_time", ":hours"),
#					(assign, "$g_last_assassination_attempt_location", "$g_encountered_party"),
#					(assign, "$g_last_assassination_attempt_perpetrator", ":lord"),

					(troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, "$g_encountered_party"),
				(try_end),
			 (try_end),

			 (try_begin),
				 (eq, ":randomize_attacker_placement", 0),
				 (call_script, "script_setup_tavern_attacker", ":cur_entry"),

				 (val_add, ":cur_entry", 1),
			 (try_end),

			 (try_begin),
				(eq, 1, 0),
				(troop_slot_eq, "trp_fight_promoter", slot_troop_cur_center, "$current_town"),
                (set_visitor, ":cur_entry", "trp_fight_promoter"),

                (val_add, ":cur_entry", 1),
			 (try_end),

             (party_get_slot, ":mercenary_troop", "$current_town", slot_center_mercenary_troop_type),
             (party_get_slot, ":mercenary_amount", "$current_town", slot_center_mercenary_troop_amount),
             (try_begin),
			   (gt, ":mercenary_troop", 0),
               (gt, ":mercenary_amount", 0),
               (set_visitor, ":cur_entry", ":mercenary_troop"),
               (val_add, ":cur_entry", 1),
             (try_end),

			 (try_begin),
				 (eq, ":randomize_attacker_placement", 1),
				 (call_script, "script_setup_tavern_attacker", ":cur_entry"),

				 (val_add, ":cur_entry", 1),
			 (try_end),

             (try_for_range, ":companion_candidate", companions_begin, companions_end),
               (troop_slot_eq, ":companion_candidate", slot_troop_occupation, 0),
               (troop_slot_eq, ":companion_candidate", slot_troop_cur_center, "$current_town"),
			   (neg|troop_slot_ge, ":companion_candidate", slot_troop_prisoner_of_party, centers_begin),

               (set_visitor, ":cur_entry", ":companion_candidate"),

               (val_add, ":cur_entry", 1),
             (try_end),

			 (try_begin),
				 (eq, ":randomize_attacker_placement", 2),
				 (call_script, "script_setup_tavern_attacker", ":cur_entry"),

				 (val_add, ":cur_entry", 1),
			 (try_end),

             (try_begin), #this doubles the incidence of ransom brokers and (below) minstrels
               (party_get_slot, ":ransom_broker", "$current_town", slot_center_ransom_broker),
               (gt, ":ransom_broker", 0),

               (assign, reg0, ":ransom_broker"),
               (assign, reg1, "$current_town"),

               (set_visitor, ":cur_entry", ":ransom_broker"),
               (val_add, ":cur_entry", 1),
			 (else_try),
			   (is_between, "$g_talk_troop", ransom_brokers_begin, ransom_brokers_end),
			   (store_add, ":alternative_town", "$current_town", 9),

			   (try_begin),
				(ge, ":alternative_town", towns_end),
				(val_sub, ":alternative_town", 22),
			   (try_end),
			   (try_begin),
				(eq, "$cheat_mode", 1),
			    (str_store_party_name, s3, "$current_town"),
			    (str_store_party_name, s4, ":alternative_town"),
			    (display_message, "@{!}DEBUG - Current town is {s3}, but also checking {s4}"),
			   (try_end),

               (party_get_slot, ":ransom_broker", ":alternative_town", slot_center_ransom_broker),
               (gt, ":ransom_broker", 0),

               (set_visitor, ":cur_entry", ":ransom_broker"),
               (val_add, ":cur_entry", 1),
             (try_end),

             (try_begin),
               (party_get_slot, ":tavern_traveler", "$current_town", slot_center_tavern_traveler),
               (gt, ":tavern_traveler", 0),
               (set_visitor, ":cur_entry", ":tavern_traveler"),
               (val_add, ":cur_entry", 1),
             (try_end),

             (try_begin),
               (party_get_slot, ":tavern_minstrel", "$current_town", slot_center_tavern_minstrel),
               (gt, ":tavern_minstrel", 0),

               (set_visitor, ":cur_entry", ":tavern_minstrel"),
               (val_add, ":cur_entry", 1),
			 (else_try),
			   (store_add, ":alternative_town", "$current_town", 9),
			   (try_begin),
				(ge, ":alternative_town", towns_end),
				(val_sub, ":alternative_town", 22),
			   (try_end),
 			   ##diplomacy start+ chief
			   #The above code makes assumptions about the number of towns that might not be true on other maps.
			   #Changing it to support variable sizes would not be hard, but I'm not convinced that it is so
			   #desirable in the first place.
			   (is_between, ":alternative_town", centers_begin, centers_end),
			   (party_slot_eq, ":alternative_town", slot_party_type, spt_town),
			   ##diplomacy end+
              (party_get_slot, ":tavern_minstrel", ":alternative_town", slot_center_tavern_minstrel),
               (gt, ":tavern_minstrel", 0),

               (set_visitor, ":cur_entry", ":tavern_minstrel"),
               (val_add, ":cur_entry", 1),
             (try_end),

## CC gambling begin chief
             (try_begin),
               (party_get_slot, ":prosperity", "$current_town", slot_town_prosperity),
               (val_mod, ":prosperity", 24),
               (store_time_of_day, ":cur_hour"),
               (store_sub, ":difference", ":prosperity", ":cur_hour"),
               (is_between, ":difference", -1, 2), # -1 0 1, 1/8 probability
               (set_visitor, ":cur_entry", "trp_especial_merchant"),
               (troop_set_name, "trp_especial_merchant", "@Mystic Merchant"),
               (call_script, "script_refresh_mystic_merchant_items", "trp_especial_merchant"),
               (val_add, ":cur_entry", 1),
             (try_end),
## CC gambling end

             (try_begin),
               (party_get_slot, ":tavern_bookseller", "$current_town", slot_center_tavern_bookseller),
               (gt, ":tavern_bookseller", 0),
               (set_visitor, ":cur_entry", ":tavern_bookseller"),
               (val_add, ":cur_entry", 1),
             (try_end),

			 (try_begin),
				 (eq, ":randomize_attacker_placement", 3),
				 (call_script, "script_setup_tavern_attacker", ":cur_entry"),
				 (val_add, ":cur_entry", 1),
			 (try_end),

             (try_begin),
               (neg|check_quest_active, "qst_eliminate_bandits_infesting_village"),
               (neg|check_quest_active, "qst_deal_with_bandits_at_lords_village"),
               (assign, ":end_cond", villages_end),
               (try_for_range, ":cur_village", villages_begin, ":end_cond"),
                 (party_slot_eq, ":cur_village", slot_village_bound_center, "$current_town"),
                 (party_slot_ge, ":cur_village", slot_village_infested_by_bandits, 1),
                 (neg|party_slot_eq, ":cur_village", slot_town_lord, "trp_player"),
                 (set_visitor, ":cur_entry", "trp_farmer_from_bandit_village"),
                 (val_add, ":cur_entry", 1),
                 (assign, ":end_cond", 0),
               (try_end),
             (try_end),

             (try_begin),
               (eq, "$g_starting_town", "$current_town"),

               (this_or_next|neg|check_quest_finished, "qst_collect_men"),
               (this_or_next|neg|check_quest_finished, "qst_learn_where_merchant_brother_is"),
               (this_or_next|neg|check_quest_finished, "qst_save_relative_of_merchant"),
               (this_or_next|neg|check_quest_finished, "qst_save_town_from_bandits"),
               (eq,  "$g_do_one_more_meeting_with_merchant", 1),

			   (assign, ":troop_of_merchant", 0),
#chief mercaderes
               (try_begin),
                 (eq, "$g_encountered_party_faction", "fac_kingdom_18"),
                 (assign, ":troop_of_merchant", "trp_swadian_merchant"),
               (else_try),
                 (eq, "$g_encountered_party_faction", "fac_kingdom_4"),
                 (assign, ":troop_of_merchant", "trp_vaegir_merchant"),
               (else_try),
                 (eq, "$g_encountered_party_faction", "fac_kingdom_1"),
                 (assign, ":troop_of_merchant", "trp_khergit_merchant"),
               (else_try),
                 (eq, "$g_encountered_party_faction", "fac_kingdom_23"),
                 (assign, ":troop_of_merchant", "trp_nord_merchant"),
               (else_try),
                 (eq, "$g_encountered_party_faction", "fac_kingdom_31"),
                 (assign, ":troop_of_merchant", "trp_rhodok_merchant"),
               (else_try),
                 (eq, "$g_encountered_party_faction", "fac_kingdom_28"),
                 (assign, ":troop_of_merchant", "trp_sarranid_merchant"),
               (try_end),
			   (gt, ":troop_of_merchant", 0),
#chief mercaderes acaba
               (set_visitor, ":cur_entry", ":troop_of_merchant"),
               (val_add, ":cur_entry", 1),
             (try_end),

             (change_screen_mission),
           (try_end),
        ],"Door to the tavern."),

#      ("town_smithy",[
#          (eq,"$entry_to_town_forbidden",0),
#          (eq,"$town_nighttime",0),
#          ],
#       "Visit the smithy.",
#       [
#           (set_jump_mission,"mt_town_default"),
#           (jump_to_scene,"$pout_scn_smithy"),
#           (change_screen_mission,0),
#        ]),


      ("town_merchant",
       [(party_slot_eq,"$current_town",slot_party_type, spt_town),
           (eq, 1, 0),
           (eq,"$town_nighttime",0),
           (this_or_next|eq,"$entry_to_town_forbidden",0),
           (eq, "$sneaked_into_town",1),
#           (party_get_slot, ":scene", "$current_town", slot_town_store),
#           (scene_slot_eq, ":scene", slot_scene_visited, 1), #check if scene has been visited before to allow entry from menu. Otherwise scene will only be accessible from the town center.
           ],
       "Speak with the merchant.",
       [
           (try_begin),
             (this_or_next|eq,"$all_doors_locked",1),
             (eq,"$town_nighttime",1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
             (assign, "$town_entered", 1),
             (set_jump_mission, "mt_town_default"),
             (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_horse),
             (try_begin),
               (eq, "$sneaked_into_town",1),
               (mission_tpl_entry_set_override_flags, "mt_town_default", 0, af_override_all),
             (try_end),
             (party_get_slot, ":cur_scene", "$current_town", slot_town_store),
             (jump_to_scene, ":cur_scene"),
             (scene_set_slot, ":cur_scene", slot_scene_visited, 1),
             (change_screen_mission),
           (try_end),
        ],"Door to the shop."),

      ("town_arena",
       [(party_slot_eq,"$current_town",slot_party_type, spt_town),
        (eq, "$sneaked_into_town", 0),
#           (party_get_slot, ":scene", "$current_town", slot_town_arena),
#           (scene_slot_eq,  ":scene", slot_scene_visited, 1), #check if scene has been visited before to allow entry from menu. Otherwise scene will only be accessible from the town center.
           ],
       "Enter the arena.",
       [
           (try_begin),
             (this_or_next|eq,"$all_doors_locked",1),
             (eq,"$town_nighttime",1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
             (assign, "$g_mt_mode", abm_visit),
             (assign, "$town_entered", 1),
             (set_jump_mission, "mt_arena_melee_fight"),
             (party_get_slot, ":arena_scene", "$current_town", slot_town_arena),
             (modify_visitors_at_site, ":arena_scene"),
             (reset_visitors),
             (set_visitor, 43, "trp_veteran_fighter"),
             (set_visitor, 44, "trp_hired_blade"),
             (set_jump_entry, 50),
             (jump_to_scene, ":arena_scene"),
             (scene_set_slot, ":arena_scene", slot_scene_visited, 1),
             (change_screen_mission),
           (try_end),
        ],"Door to the arena."),
      ("town_dungeon",
       [(eq, 1, 0)],
       "Never: Enter the prison.",
       [
           (try_begin),
		    (eq, "$talk_context", tc_prison_break),
			(gt, "$g_main_attacker_agent", 0),

		   	(neg|agent_is_alive, "$g_main_attacker_agent"),

			(agent_get_troop_id, ":agent_type", "$g_main_attacker_agent"),
			(try_begin),
			  (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
			  (party_get_slot, ":prison_guard_faction", "$current_town", slot_center_original_faction),
			(else_try),
			  (assign, ":prison_guard_faction", "$g_encountered_party_faction"),
			(try_end),
			(faction_slot_eq, ":prison_guard_faction", slot_faction_prison_guard_troop, ":agent_type"),

			(call_script, "script_deduct_casualties_from_garrison"),
            (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),

		   (else_try),
             (eq,"$all_doors_locked",1),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (else_try),
             (this_or_next|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
             (eq, "$g_encountered_party_faction", "$players_kingdom"),
             (assign, "$town_entered", 1),
             (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
           (else_try),
             (display_message,"str_door_locked",0xFFFFAAAA),
           (try_end),
        ],"Door to the dungeon."),

      ("castle_inspect",
      [
         (party_slot_eq,"$current_town",slot_party_type, spt_castle),
       (neq, "$current_town", "p_fort"), #para player lair chief player
      ],
       "Take a walk around the courtyard.",
       [
         (try_begin),
           (eq, "$talk_context", tc_prison_break),
           (assign, "$talk_context", tc_escape),

           (party_get_slot, ":cur_castle_exterior", "$current_town", slot_castle_exterior),
           (modify_visitors_at_site, ":cur_castle_exterior"),
           (reset_visitors),

           (assign, ":guard_no", 40),

           (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
           (try_for_range, ":troop_iterator", 0, ":num_stacks"),
             #nearby fire condition start
             (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
             (store_current_hours, ":cur_time"),
             (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),
             (this_or_next|eq, ":guard_no", 40),
             (neg|is_between, ":cur_time", ":last_nearby_fire_time", ":fire_finish_time"),
             #nearby fire condition end

             (lt, ":guard_no", 47),
             (party_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
             (neg|troop_is_hero, ":cur_troop_id"),
             (party_stack_get_size, ":stack_size","$g_encountered_party",":troop_iterator"),
             (party_stack_get_num_wounded, ":num_wounded","$g_encountered_party",":troop_iterator"),
             (val_sub, ":stack_size", ":num_wounded"),
             (gt, ":stack_size", 0),
             (party_stack_get_troop_dna,":troop_dna", "$g_encountered_party", ":troop_iterator"),
             (set_visitor, ":guard_no", ":cur_troop_id", ":troop_dna"),
             (val_add, ":guard_no", 1),
           (try_end),
           #(set_jump_entry, 1),
           (set_visitor, 7, "$g_player_troop"),

           (set_jump_mission,"mt_castle_visit"),
           (jump_to_scene, ":cur_castle_exterior"),
           (change_screen_mission),
            #If you're already at escape, then talk context will reset
         (else_try),
           (assign, "$talk_context", tc_town_talk),

           (assign, "$g_mt_mode", tcm_default),

           (party_get_slot, ":cur_castle_exterior", "$current_town", slot_castle_exterior),
           (modify_visitors_at_site,":cur_castle_exterior"),
           (reset_visitors),

           (try_begin),
             (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
             (faction_get_slot, ":troop_prison_guard", "$g_encountered_party_faction", slot_faction_prison_guard_troop),
           (else_try),
             (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
             (faction_get_slot, ":troop_prison_guard", ":town_original_faction", slot_faction_prison_guard_troop),
           (try_end),
           (set_visitor, 24, ":troop_prison_guard"),
         (call_script, "script_init_town_walkers"), #chief anadido walkers a castillos

           (assign, ":guard_no", 40),

           (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
           (try_for_range, ":troop_iterator", 0, ":num_stacks"),
             #nearby fire condition start
             (party_get_slot, ":last_nearby_fire_time", "$current_town", slot_town_last_nearby_fire_time),
             (store_current_hours, ":cur_time"),
             (store_add, ":fire_finish_time", ":last_nearby_fire_time", fire_duration),
             (neg|is_between, ":cur_time", ":fire_finish_time", ":last_nearby_fire_time"),

             (lt, ":guard_no", 47),
             (party_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
             (neg|troop_is_hero, ":cur_troop_id"),
             (party_stack_get_size, ":stack_size","$g_encountered_party",":troop_iterator"),
             (party_stack_get_num_wounded, ":num_wounded","$g_encountered_party",":troop_iterator"),
             (val_sub, ":stack_size", ":num_wounded"),
             (gt, ":stack_size", 0),
             (party_stack_get_troop_dna,":troop_dna","$g_encountered_party",":troop_iterator"),
             (set_visitor, ":guard_no", ":cur_troop_id", ":troop_dna"),

             (val_add, ":guard_no", 1),
           (try_end),

           (try_begin),
             (eq, "$town_entered", 0),
             (assign, "$town_entered", 1),
           (try_end),
           (set_jump_entry, 1),

           (assign, ":override_state", af_override_horse),
           (try_begin),
             (eq, "$sneaked_into_town", 1), #setup disguise
             (assign, ":override_state", af_override_all),
           (try_end),
           (set_jump_mission, "mt_castle_visit"),

           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 0, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 1, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 2, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 3, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 4, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 5, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 6, ":override_state"),
           (mission_tpl_entry_set_override_flags, "mt_castle_visit", 7, ":override_state"),

           (jump_to_scene, ":cur_castle_exterior"),
           (change_screen_mission),
         (try_end),
        ], "To the castle courtyard."),

     ("town_enterprise",
      [
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
        (party_get_slot, ":item_produced", "$current_town", slot_center_player_enterprise),
		(gt, ":item_produced", 1),
        (eq,"$entry_to_town_forbidden",0),
		(call_script, "script_get_enterprise_name", ":item_produced"),
		(str_store_string, s3, reg0),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda

      ],
      "Visit your {s3}.",
      [
        (store_sub, ":town_order", "$current_town", towns_begin),
		(store_add, ":master_craftsman", "trp_town_1_master_craftsman", ":town_order"),
        (party_get_slot, ":item_produced", "$current_town", slot_center_player_enterprise),
		(assign, ":enterprise_scene", "scn_enterprise_mill"),
		(try_begin),
			(eq, ":item_produced", "itm_bread"),
			(assign, ":enterprise_scene", "scn_enterprise_mill"),
		(else_try),
			(eq, ":item_produced", "itm_ale"),
			(assign, ":enterprise_scene", "scn_enterprise_brewery"),
		(else_try),
			(eq, ":item_produced", "itm_oil"),
			(assign, ":enterprise_scene", "scn_enterprise_oil_press"),
		(else_try),
			(eq, ":item_produced", "itm_wine"),
			(assign, ":enterprise_scene", "scn_enterprise_winery"),
		(else_try),
			(eq, ":item_produced", "itm_leatherwork"),
			(assign, ":enterprise_scene", "scn_enterprise_tannery"),
		(else_try),
			(eq, ":item_produced", "itm_wool_cloth"),
			(assign, ":enterprise_scene", "scn_enterprise_wool_weavery"),
		(else_try),
			(eq, ":item_produced", "itm_linen"),
			(assign, ":enterprise_scene", "scn_enterprise_linen_weavery"),
		(else_try),
			(eq, ":item_produced", "itm_velvet"),
			(assign, ":enterprise_scene", "scn_enterprise_dyeworks"),
		(else_try),
			(eq, ":item_produced", "itm_tools"),
			(assign, ":enterprise_scene", "scn_enterprise_smithy"),
		(try_end),
        (modify_visitors_at_site,":enterprise_scene"),
		(reset_visitors),
        (set_visitor,0,"trp_player"),
        (set_visitor,17,":master_craftsman"),
        (set_jump_mission,"mt_town_default"),
        (jump_to_scene,":enterprise_scene"),
        (change_screen_mission),
      ],"Door to your enterprise."),

    ("visit_lady",
	[

	(neg|troop_slot_ge, "trp_player", slot_troop_spouse, kingdom_ladies_begin),

	(assign, "$love_interest_in_town", 0),
	(assign, "$love_interest_in_town_2", 0),
	(assign, "$love_interest_in_town_3", 0),
	(assign, "$love_interest_in_town_4", 0),
	(assign, "$love_interest_in_town_5", 0),
	(assign, "$love_interest_in_town_6", 0),
	(assign, "$love_interest_in_town_7", 0),
	(assign, "$love_interest_in_town_8", 0),

	(try_for_range, ":lady_no", kingdom_ladies_begin, kingdom_ladies_end),
		(troop_slot_eq, ":lady_no", slot_troop_cur_center, "$current_town"),
		(call_script, "script_get_kingdom_lady_social_determinants", ":lady_no"),
		(assign, ":lady_guardian", reg0),

		(troop_slot_eq, ":lady_no", slot_troop_spouse, -1),
		(ge, ":lady_guardian", 0), #not sure when this would not be the case


		#must have spoken to either father or lady
		(this_or_next|troop_slot_ge, ":lady_no", slot_troop_met, 2),
			(troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 1),

		(neg|troop_slot_eq, ":lady_no", slot_troop_met, 4),

		#must have approached father
#		(this_or_next|troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 1),
#			(troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, -1),


		(try_begin),
			(eq, "$love_interest_in_town", 0),
			(assign, "$love_interest_in_town", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_2", 0),
			(assign, "$love_interest_in_town_2", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_3", 0),
			(assign, "$love_interest_in_town_3", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_4", 0),
			(assign, "$love_interest_in_town_4", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_5", 0),
			(assign, "$love_interest_in_town_5", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_6", 0),
			(assign, "$love_interest_in_town_6", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_7", 0),
			(assign, "$love_interest_in_town_7", ":lady_no"),
		(else_try),
			(eq, "$love_interest_in_town_8", 0),
			(assign, "$love_interest_in_town_8", ":lady_no"),
		(try_end),
	(try_end),

	(gt, "$love_interest_in_town", 0),
	],
	  "Attempt to visit a lady",
       [
        (jump_to_menu, "mnu_lady_visit"),
        ], "Door to the garden."),

###player lair acaba chief
#player lair empieza chief
#player lair chief
            ("lair_interior",
      [
       (eq, "$current_town", "p_fort"), #para lair chief player
        ],"Go to Hall.", #chief sot cambia
       [
##           (try_begin),
##             (this_or_next|eq,"$all_doors_locked",1),
##             (eq,"$town_nighttime",1),
##             (display_message,"str_door_locked",0xFFFFAAAA),
##           (else_try),
             (set_jump_mission, "mt_fort_interior"),
      (modify_visitors_at_site,"scn_fort_interior"),
             (reset_visitors),
           (try_begin),
             (eq, "$contratar_hoar", 1),
           (set_visitor, 43, "trp_quastuosa_6"),
           (try_end),
           (try_begin),
             (eq, "$contratar_pagano", 1),
           (set_visitor, 42, "trp_anglo_pagano"),
           (else_try),
             (eq, "$contratar_sacerdote", 1),
           (set_visitor, 42, "trp_picto_sacerdote"),
           (try_end),
             (set_jump_entry, 0),
	  (scene_set_slot, "scn_fort_exterior", slot_scene_visited, 1),
                 (jump_to_scene,"scn_fort_interior"),
             (change_screen_mission),
#           (try_end),
        ], "Door to the castle."),

	("hirefort_staff",
		[	       (eq, "$current_town", "p_fort"), #para player lair chief player
		],
		"Hire Staff.",
		[
			(jump_to_menu, "mnu_contratar_personal")
		]
	),


    ("lair_inspect", [
       (eq, "$current_town", "p_fort"), #para player lair chief player
          ],
       "Take a walk around your lair.",
       [
           (assign, "$talk_context", 0),
           (try_begin),
             (call_script, "script_cf_enter_center_location_bandit_check"),
           (else_try),
			(assign, ":fort_scene", "scn_fort_exterior"),

             (modify_visitors_at_site, ":fort_scene"),
             (reset_visitors),
             (assign, "$g_mt_mode", tcm_default),
			 (set_visitor, 11, "trp_fort_captain"),

             # Setup peasant walkers
             (try_for_range, ":visiterator", 32, 40),
               (store_random_in_range, ":sex", 0, 100),
               (try_begin),
	(lt,":sex",30), #10% risk of tripping
                 (set_visitor, ":visiterator", "trp_hunter_woman",),
               (else_try),
       (gt, ":sex", 30),
       (lt, ":sex", 60),
                 (set_visitor, ":visiterator", "trp_fighter_woman",),
               (else_try),
       (gt, ":sex", 60),
       (lt, ":sex", 90),
                 (set_visitor, ":visiterator", "trp_village_walker_2",),
               (else_try),
                 (set_visitor, ":visiterator", "trp_fort_walker",),
               (try_end),
             (try_end),

##                 (set_visitor, ":visiterator", "trp_village_walker_1",),
##               (else_try),
##                 (set_visitor, ":visiterator", "trp_village_walker_2",),
             # Setup guards based on best type of archer/melee troops currently in garrison
	         (assign, ":highest_archer_lvl", 0),
	         (assign, ":archer_id", 0),
	         (assign, ":highest_infantry_lvl", 0),
	         (assign, ":infantry_id", 0),
	         (assign, ":highest_cavalry_lvl", 0),
	         (assign, ":cavalry_id", 0),

			 #(party_get_num_companions, ":castle_garrison_size", "p_collective_enemy"),
	         (party_get_num_companion_stacks, ":num_stacks", "$g_encountered_party"),
	         (try_for_range, ":troop_iterator", 0, ":num_stacks"),
	           (party_stack_get_troop_id, ":cur_troop_id", "$g_encountered_party", ":troop_iterator"),
	           (neg|troop_is_hero, ":cur_troop_id"),
	           (party_stack_get_size, ":stack_size","$g_encountered_party",":troop_iterator"),
	           (party_stack_get_num_wounded, ":num_wounded","$g_encountered_party",":troop_iterator"),
	           (val_sub, ":stack_size", ":num_wounded"),
	           (gt, ":stack_size", 0),
		       (store_character_level, ":cur_level", ":cur_troop_id"),
	           (try_begin),
		         (troop_is_guarantee_ranged, ":cur_troop_id"),
		         (gt, ":cur_level", ":highest_archer_lvl"),
		         (assign, ":highest_archer_lvl", ":cur_level"),
		         (assign, ":archer_id", ":cur_troop_id"),
		         (party_stack_get_troop_dna,":archer_dna","$g_encountered_party",":troop_iterator"),
		       (else_try),
		         (gt, ":cur_level", ":highest_infantry_lvl"),
		         (assign, ":highest_infantry_lvl", ":cur_level"),
		         (assign, ":infantry_id", ":cur_troop_id"),
		         (party_stack_get_troop_dna,":infantry_dna","$g_encountered_party",":troop_iterator"),
		       (try_end),
		       (try_begin),
		         (troop_is_guarantee_horse, ":cur_troop_id"),
		         (gt, ":cur_level", ":highest_cavalry_lvl"),
		         (assign, ":highest_cavalry_lvl", ":cur_level"),
		         (assign, ":cavalry_id", ":cur_troop_id"),
		         (party_stack_get_troop_dna,":cavalry_dna","$g_encountered_party",":troop_iterator"),
		       (try_end),
	         (try_end),

	         # Slots 40-49 are the slots I used for archers and guards inside the fort intented for use in sieges as well
	         (try_begin),
	           (gt, ":archer_id", 0),
	           (try_for_range, ":visiterator", 40, 42),
	             (store_random_in_range, ":walker_dna", 0, 1000000),
	             (set_visitor, ":visiterator", ":archer_id", ":walker_dna"),
	           (try_end),
	           (try_for_range, ":visiterator", 48, 50),
	             (store_random_in_range, ":walker_dna", 0, 1000000),
	             (set_visitor, ":visiterator", ":archer_id", ":walker_dna"),
	           (try_end),
	         (try_end),
	         (try_begin),
	           (gt, ":infantry_id", 0),
	           (try_for_range, ":visiterator", 24, 30),	#I used slots 24-29 for stationary guard posts during visits
	             (store_random_in_range, ":walker_dna", 0, 1000000),
	             (set_visitor, ":visiterator", ":infantry_id", ":walker_dna"),
	           (try_end),

	           # these are 'patrols' that will path through specific points in the scene
	           (call_script, "script_set_walker_to_type", "trp_fort_rider", ":cavalry_id"),
	           (try_begin),
	             (gt, ":cavalry_id", 0),
	             (set_visitor, 20, ":cavalry_id", ":cavalry_dna"),	    # guard that patrols the perimeter
	             #(set_visitor, 20, "trp_fort_rider", ":cavalry_dna"),	    # TODO: Go back to using this type now that the patrol is working properly
	           (try_end),
	           (call_script, "script_set_walker_to_type", "trp_fort_walker", ":infantry_id"),
	           (set_visitor, 30, "trp_fort_walker", ":archer_dna"),		# guard that patrols the middle walkway
	           (set_visitor, 42, "trp_fort_walker", ":infantry_dna"),	# guards patrolling the front walls
	           (set_visitor, 44, "trp_fort_walker", ":walker_dna"),
	         (try_end),

             (call_script, "script_init_town_walkers"),
             (set_jump_mission,"mt_fort_visit"),
             (try_begin),
               (eq, "$town_entered", 0),
               (assign, "$town_entered", 1),
               (eq, "$town_nighttime", 0),
             (try_end),
               (set_jump_entry, 1),
             (jump_to_scene, ":fort_scene"),
             (change_screen_mission),
           (try_end),
        ], "To the fort square."),

      ("mylair_station_troops",
      [	         (eq, "$current_town", "p_fort"), #para player lair chief player

      ],
      "Manage the garrison.",
      [
        (change_screen_exchange_members,1),
		(display_message,"@The prison of your lair has low levels of security. Your captain will suggest not enclosing lords here!",0xFFFF0000),
      ]),
###player lair acaba chief
      ("trade_with_merchants",
       [
           (party_slot_eq,"$current_town",slot_party_type, spt_town)
        ],
         "Go to the marketplace.",
         [
           (try_begin),
             (call_script, "script_cf_enter_center_location_bandit_check"),
           (else_try),
             (jump_to_menu,"mnu_town_trade"),
           (try_end),
          ]),

      ("walled_center_manage",
      [
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_under_siege),
       (neq, "$current_town", "p_fort"), #para player lair chief player
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (assign, reg0, 1),
        (try_begin),
          (party_slot_eq, "$current_town", slot_party_type, spt_castle),
          (assign, reg0, 0),
        (try_end),
       ],
       "Manage this {reg0?town:castle}.",
       [
           (assign, "$g_next_menu", "mnu_town"),
           (jump_to_menu, "mnu_center_manage"),
       ]),

      ("walled_center_move_court",
      [
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_under_siege),
       (neq, "$current_town", "p_fort"), #para player lair chief player
        (faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (neq, "$g_player_court", "$current_town"),
      ],
      "Move your court here.",
      [
        (jump_to_menu, "mnu_establish_court"),
      ]),

#festin de mead chief
	("banquete_mead",
		[
        (neg|party_slot_eq, "$current_town", slot_village_state, svs_under_siege),
       (neq, "$current_town", "p_fort"), #para player lair chief player
        (party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
        (assign, reg0, 1),
        (try_begin),
          (party_slot_eq, "$current_town", slot_party_type, spt_castle),
          (assign, reg0, 0),
        (try_end),
		],
		"My men deserve a banquet in {reg0?town:castle}. Buy mead and food.",
		[
      (store_troop_gold,":money","trp_player"),
      (try_begin),
        (gt,":money",999),
       (troop_remove_gold, "trp_player", 1000),
           (jump_to_menu, "mnu_banquete_moral"),
      (else_try),
        (display_message,"str_money"),
      (try_end),
		]
	),
#festin acaba chief

      ("castle_station_troops",
      [
       (neq, "$current_town", "p_fort"), #para player lair chief player
		(party_get_slot, ":town_lord", "$current_town", slot_town_lord),
	    (str_clear, s10),

	    (assign, ":player_can_draw_from_garrison", 0),
		(try_begin), #option 1 - player is town lord
		  (eq, ":town_lord", "trp_player"),
		  (assign, ":player_can_draw_from_garrison", 1),
		(else_try), #option 2 - town is unassigned and part of the player faction
		  (store_faction_of_party, ":faction", "$g_encountered_party"),
		  (eq, ":faction", "fac_player_supporters_faction"),
		  (neg|party_slot_ge, "$g_encountered_party", slot_town_lord, active_npcs_begin), #ie, zero or -1

		  (assign, ":player_can_draw_from_garrison", 1),
		(else_try), #option 3 - town was captured by player
		  (lt, ":town_lord", 0), #ie, unassigned
		  (store_faction_of_party, ":castle_faction", "$g_encountered_party"),
		  (eq, "$players_kingdom", ":castle_faction"),

		  (eq, "$g_encountered_party", "$g_castle_requested_by_player"),

		  (str_store_string, s10, "str_retrieve_garrison_warning"),
		  (assign, ":player_can_draw_from_garrison", 1),
		(else_try),
		  (lt, ":town_lord", 0), #ie, unassigned
		  (store_faction_of_party, ":castle_faction", "$g_encountered_party"),
		  (eq, "$players_kingdom", ":castle_faction"),

		  (store_party_size_wo_prisoners, ":party_size", "$g_encountered_party"),
		  (eq, ":party_size", 0),

		  (str_store_string, s10, "str_retrieve_garrison_warning"),
		  (assign, ":player_can_draw_from_garrison", 1),
		(else_try),
		  (party_slot_ge, "$g_encountered_party", slot_town_lord, active_npcs_begin),
		  (store_faction_of_party, ":castle_faction", "$g_encountered_party"),
		  (eq, "$players_kingdom", ":castle_faction"),

		  (troop_slot_eq, "trp_player", slot_troop_spouse, ":town_lord"),

		  (assign, ":player_can_draw_from_garrison", 1),
		(try_end),

        (eq, ":player_can_draw_from_garrison", 1),
      ],
      "Manage the garrison {s10}",
      [
        (change_screen_exchange_members,1),
      ]),

      ("castle_wait",
      [
        #(party_slot_eq,"$current_town",slot_party_type, spt_castle),
        (this_or_next|ge, "$g_encountered_party_relation", 0),
        (eq,"$castle_undefended",1),
        (assign, ":can_rest", 1),
        (str_clear, s1),
        (try_begin),
          (neg|party_slot_eq, "$current_town", slot_town_lord, "trp_player"),
		  (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
          (neg|party_slot_eq, "$current_town", slot_town_lord, ":player_spouse"),

          (party_slot_ge, "$current_town", slot_town_lord, "trp_player"), #can rest for free in castles and towns with unassigned lords
          (store_faction_of_party, ":current_town_faction", "$current_town"),
          (neq, ":current_town_faction", "fac_player_supporters_faction"),
          (party_get_num_companions, ":num_men", "p_main_party"),
          (store_div, reg1, ":num_men", 4),
          (val_add, reg1, 1),
          (str_store_string, s1, "@ ({reg1} scillingas per night)"),
          (store_troop_gold, ":gold", "trp_player"),
          (lt, ":gold", reg1),
          (assign, ":can_rest", 0),
        (try_end),
        (eq, ":can_rest", 1),
      ],
      "Wait here for some time{s1}.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
	  (val_max, "$entertainement_on", 1), #chief entretenimiento bardo MOTO avoid overwriting higher value
        (try_begin),
          (party_is_active, "p_main_party"),
          (party_get_current_terrain, ":cur_terrain", "p_main_party"),
          (try_begin),
            (eq, ":cur_terrain", rt_desert),
            (unlock_achievement, ACHIEVEMENT_SARRANIDIAN_NIGHTS),
          (try_end),
        (try_end),

        (rest_for_hours_interactive, 24 * 7, 5, 0), #rest while not attackable
        (change_screen_return),
      ]),

##      ("rest_until_morning",

##       [
##           (this_or_next|ge, "$g_encountered_party_relation", 0),
##           (eq,"$castle_undefended",1),
##           (store_time_of_day,reg(1)),(neg|is_between,reg(1), 5, 18),
##           (eq, "$g_defending_against_siege", 0),
##        ],
##         "Rest until morning.",
##         [
##           (store_time_of_day,reg(1)),
##           (assign, reg(2), 30),
##           (val_sub,reg(2),reg(1)),
##           (val_mod,reg(2),24),
##           (assign,"$auto_enter_town","$current_town"),
##           (assign, "$g_town_visit_after_rest", 1),
##           (rest_for_hours_interactive, reg(2)),
##           (change_screen_return),
##          ]),
##
##      ("rest_until_evening",
##       [
##           (this_or_next|ge, "$g_encountered_party_relation", 0),
##           (eq,"$castle_undefended",1),
##           (store_time_of_day,reg(1)), (is_between,reg(1), 5, 18),
##           (eq, "$g_defending_against_siege", 0),
##        ],
##         "Rest until evening.",
##         [
##           (store_time_of_day,reg(1)),
##           (assign, reg(2), 20),
##           (val_sub,reg(2),reg(1)),
##           (assign,"$auto_enter_town","$current_town"),
##           (assign, "$g_town_visit_after_rest", 1),
##           (rest_for_hours_interactive, reg(2)),
##           (change_screen_return),
##          ]),
      ("town_alley",
      [
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT: Go to the alley.",
      [
        (party_get_slot, reg11, "$current_town", slot_town_alley),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, reg11),
        (change_screen_mission),
      ]),

#####rigale chief beggar pedir
##             ("start_begging",
##       [
##	      (party_slot_eq,"$current_town",slot_party_type, spt_town),
##			(try_begin),
##           (eq,"$begging_action_started",0),
##		   (str_store_string,s7,"@You start begging (gain a few coins, lose renown or honor)"),
##		   (else_try),
##           (eq,"$begging_action_started",1),
##		   (str_store_string,s7,"@You stop begging"),
##
##        ],
##         "{s7}",
##         [
##       (store_troop_gold,":money","trp_player"),
##      (try_begin),
##        (gt,":money",299),
##        (display_message, "@People know you're not a beggar."),
##      (else_try),
##		(assign, "$auto_enter_town", "$current_town"),
##           (try_begin),
##		     (eq,"$begging_action_started",0),
##			 (assign,"$begging_action_started",1),
##			 (change_screen_return),
##			(rest_for_hours_interactive, 24 * 7, 3, 0),
##
##           (else_try),
##		     (eq,"$begging_action_started",1),
##			 (assign,"$begging_action_started",0),
##           (try_end),
##      (try_end),
##          ]),
#####rigale chief acaba
#Menu que lleva a otros para ahorrar espacio en el menu principal
      ("masopciones",
       [(party_slot_eq,"$current_town",slot_party_type, spt_town),
        (this_or_next|eq,"$entry_to_town_forbidden",0),
        (eq, "$sneaked_into_town",1),],
       "Visit the sights of the town.",
       [(jump_to_menu, "mnu_town_masopciones"),]),
#mas opciones acaba chief
	#	Floris Bank Overhaul chief duh	//	Original Idea by Lazeras
	("town_bank",
       [(party_slot_eq, "$current_town", slot_party_type, spt_town),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda

        ],
       "Visit the landlords and moneylenders.",
       [
			(assign, reg10, 0),
			(start_presentation, "prsnt_bank"),
        ]),


#puerto y opciones de seafare de duh chief
            ("town_ports",
       [#(party_slot_eq,"$current_town",slot_party_type, spt_town),
	    (party_slot_eq,"$current_town",slot_town_port, 1),
        (this_or_next|eq,"$entry_to_town_forbidden",0),
        (eq, "$sneaked_into_town",1),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda

            ],
       "Visit town port.",
       [(jump_to_menu, "mnu_port"),]),

      ("collect_taxes_qst",
      [
        (check_quest_active, "qst_collect_taxes"),
        (quest_slot_eq, "qst_collect_taxes", slot_quest_target_center, "$current_town"),
        (neg|quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 4),
        (quest_get_slot, ":quest_giver_troop", "qst_collect_taxes", slot_quest_giver_troop),
        (str_store_troop_name, s1, ":quest_giver_troop"),
        (quest_get_slot, reg5, "qst_collect_taxes", slot_quest_current_state),
      ],
      "{reg5?Continue collecting taxes:Collect taxes} due to {s1}.",
      [
        (jump_to_menu, "mnu_collect_taxes"),
      ]),

     ("town_leave",[],"Leave...",
      [
        (assign, "$g_permitted_to_center",0),
        (change_screen_return,0),
      ],"Leave Area."),

      ("castle_cheat_interior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT! Interior.",
      [
        (set_jump_mission,"mt_ai_training"),
        (party_get_slot, ":castle_scene", "$current_town", slot_town_castle),
        (jump_to_scene,":castle_scene"),
        (change_screen_mission),
      ]),

      ("castle_cheat_town_exterior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT! Exterior.",
      [
        (try_begin),
          (party_slot_eq, "$current_town",slot_party_type, spt_castle),
          (party_get_slot, ":scene", "$current_town", slot_castle_exterior),
        (else_try),
          (party_get_slot, ":scene", "$current_town", slot_town_center),
        (try_end),
        (set_jump_mission,"mt_ai_training"),
        (jump_to_scene,":scene"),
        (change_screen_mission),
      ]),

      ("castle_cheat_dungeon",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT! Prison.",
      [
        (set_jump_mission,"mt_ai_training"),
        (party_get_slot, ":castle_scene", "$current_town", slot_town_prison),
        (jump_to_scene,":castle_scene"),
        (change_screen_mission),
      ]),

      ("castle_cheat_town_walls",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
      ],
      "{!}CHEAT! Town Walls.",
      [
        (party_get_slot, ":scene", "$current_town", slot_town_walls),
        (set_jump_mission,"mt_ai_training"),
        (jump_to_scene,":scene"),
        (change_screen_mission),
      ]),

      ("cheat_town_start_siege",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq, "$g_encountered_party", slot_center_is_besieged_by, -1),
        (lt, "$g_encountered_party_2", 1),
        (call_script, "script_party_count_fit_for_battle","p_main_party"),
        (gt, reg(0), 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (assign, reg6, 1),
        (else_try),
          (assign, reg6, 0),
        (try_end),
      ],
      "{!}CHEAT: Besiege the {reg6?town:castle}...",
      [
        (assign,"$g_player_besiege_town","$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]),

      ("center_reports",
      [
        (eq, "$cheat_mode", 1),
      ],
      "{!}CHEAT! Show reports.",
      [
        (jump_to_menu,"mnu_center_reports"),
      ]),

      ("sail_from_port",
      [
        (party_slot_eq,"$current_town",slot_party_type, spt_town),
        (eq, "$cheat_mode", 1),
        #(party_slot_eq,"$current_town",slot_town_near_shore, 1),
      ],
      "{!}CHEAT: Sail from port.",
      [
        (assign, "$g_player_icon_state", pis_ship),
        (party_set_flags, "p_main_party", pf_is_ship, 1),
        (party_get_position, pos1, "p_main_party"),
        (map_get_water_position_around_position, pos2, pos1, 6),
        (party_set_position, "p_main_party", pos2),
        (assign, "$g_main_ship_party", -1),
        (change_screen_return),
      ]),

    ]
   ),

  (
    "cannot_enter_court",0,
    "There is a feast in progress in the lord's hall, but you are not of sufficient status to be invited inside. Perhaps increasing your renown would win you admittance -- or you might also try distinguishing yourself at a tournament while the feast is in progress...",
    "none",
    [],
    [
	("continue", [],"Continue",
       [
        (jump_to_menu, "mnu_town"),
        ]),
	]),


  (
    "lady_visit",0,
    "Whom do you wish to visit?",
    "none",
    [],
    [

	("visit_lady_1", [
	(gt, "$love_interest_in_town", 0),
	(str_store_troop_name, s12, "$love_interest_in_town"),
	],
	  "Visit {s12}",
       [
	    (assign, "$love_interest_in_town", "$love_interest_in_town"),
        (jump_to_menu, "mnu_garden"),
        ]),



	("visit_lady_2", [
	(gt, "$love_interest_in_town_2", 0),
	(str_store_troop_name, s12, "$love_interest_in_town_2"),
	],
	  "Visit {s12}",
       [
	    (assign, "$love_interest_in_town", "$love_interest_in_town_2"),
        (jump_to_menu, "mnu_garden"),
        ]),

	("visit_lady_3", [
	(gt, "$love_interest_in_town_3", 0),
	(str_store_troop_name, s12, "$love_interest_in_town_3"),
	],
	  "Visit {s12}",
       [
	    (assign, "$love_interest_in_town", "$love_interest_in_town_3"),
        (jump_to_menu, "mnu_garden")], "Door to the garden."),


	("visit_lady_4", [(gt, "$love_interest_in_town_4", 0),(str_store_troop_name, s12, "$love_interest_in_town_4"),],
	"Visit {s12}",[(assign, "$love_interest_in_town", "$love_interest_in_town_4"),(jump_to_menu, "mnu_garden"),]),

	("visit_lady_5", [(gt, "$love_interest_in_town_5", 0),(str_store_troop_name, s12, "$love_interest_in_town_5"),],
	"Visit {s12}",[(assign, "$love_interest_in_town", "$love_interest_in_town_5"),(jump_to_menu, "mnu_garden"),]),

	("visit_lady_6",[(gt, "$love_interest_in_town_6", 0),(str_store_troop_name, s12, "$love_interest_in_town_6"),],
	"Visit {s12}",[(assign, "$love_interest_in_town", "$love_interest_in_town_6"),(jump_to_menu, "mnu_garden"),]),

	("visit_lady_7",[(gt, "$love_interest_in_town_7", 0),(str_store_troop_name, s12, "$love_interest_in_town_7"),],
	"Visit {s12}",[(assign, "$love_interest_in_town", "$love_interest_in_town_7"),(jump_to_menu, "mnu_garden"),]),

	("visit_lady_8",[(gt, "$love_interest_in_town_8", 0),(str_store_troop_name, s12, "$love_interest_in_town_8"),],
	"Visit {s12}",[(assign, "$love_interest_in_town", "$love_interest_in_town_8"),(jump_to_menu, "mnu_garden"),]),

	("leave",[], "Leave",[(jump_to_menu, "mnu_town")]),

    ]
	),


  (
    "town_tournament_lost",0,
    "You have been eliminated from the tournament.{s8}",
    "none",
    [
	(str_clear, s8),
	(try_begin),
		(this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
			(neg|troop_slot_ge, "trp_player", slot_troop_renown, 50),
		(neg|troop_slot_ge, "trp_player", slot_troop_renown, 125),
		(gt, "$g_player_tournament_placement", 4),
		(faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
		(faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),
		(str_store_string, s8, "str__however_you_have_sufficiently_distinguished_yourself_to_be_invited_to_attend_the_ongoing_feast_in_the_lords_castle"),
	(try_end),

        ],
    [
      ("continue", [], "Continue...",
       [(jump_to_menu, "mnu_town_tournament_won_by_another"),
        ]),
    ]
  ),

####menu con muchas opciones en ciudad para aligerar el primer menu
  (
    "town_masopciones",0,
    "The town is a hive of activity. You wish...",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_town1"),

        ],
    [
#reclutar en ciudades de somebody chief
      ("town_recruit",
       [
          (this_or_next|eq,"$entry_to_town_forbidden",0),
          (eq, "$sneaked_into_town",0),
    (party_slot_eq, "$current_town", slot_party_type, spt_town),
         (eq, "$reclutar_puede", 0),
   (store_faction_of_party, "$g_current_town_faction", "$current_town"),
(call_script,"script_cf_town_castle_recruit_volunteers_cond"),
          #	(store_faction_of_party, ":town_faction", "$current_town"),
##   (is_between, "$g_encountered_party_faction", kingdoms_begin, kingdoms_end),
##   (faction_get_slot, reg11, "$g_encountered_party_faction", slot_faction_town_troop_pool_available),
##   (ge, reg11, 1),
##   (eq, "$g_encountered_party_faction", "$players_kingdom"),
##   (hero_can_join),
                             (neq, "$freelancer_state", 1), #+freelancer chief #prevents player freelancer brytenwalda
   ],
       "Ask if anyone wants to join you.",
   [
          (store_random_in_range, ":rand", 0, 8),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_town_recruit_troops"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_town_recruit_troops"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_town_recruit_troops"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_town_recruit_troops2"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_town_recruit_troops2"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_town_recruit_troops3"),
                                          (else_try),
                                            (eq, ":rand", 6),
       (jump_to_menu,"mnu_town_recruit_troops3"),
                                          (else_try),
                                            (eq, ":rand", 7),
       (jump_to_menu,"mnu_town_recruit_troops3"),
          (try_end),
        ]),
#reclutar en ciudades acaba chief
#entretenimiento chief
      ("entertaiment",
       [(party_slot_eq,"$current_town",slot_party_type, spt_town),
	    (neq, "$entertainment_last_center", "$current_town"),	#MOTO in lieu of 12-hour trigger
        (this_or_next|eq,"$entry_to_town_forbidden",0),
        (eq, "$sneaked_into_town",1),],
       "Attempt a music performance or speech.",
       [(jump_to_menu, "mnu_choose_music"),]),
      #entretenimiento acaba bardo

      ##diplomacy chief begin
      ## CC
      ("meet_with_guild_master",
       [
           (party_slot_eq,"$current_town",slot_party_type, spt_town),
           #(party_get_slot, ":town_elder", "$current_town", slot_town_elder),
           #(troop_slot_eq, ":town_elder", slot_troop_met, 1),
        ],
         "Meet with the guild master.",
         [
           (try_begin),
             (call_script, "script_cf_enter_center_location_bandit_check"),
           (else_try),
             (party_get_slot, ":conversation_troop", "$current_town", slot_town_elder),
             (call_script, "script_setup_troop_meeting", ":conversation_troop", -1),
           (try_end),
          ]),
      ## CC
	  ##diplomacy chief end

      ("continue", [], "Back",
       [(jump_to_menu, "mnu_town"), #dunde torneo chief cambia
        ]),
#dunde torneos acaba chief
    ]
  ),


  (
    "town_tournament_won",mnf_disable_all_keys,
    "You have won the tournament of {s3}! You are filled with pride as the crowd cheers your name.\
 In addition to honour, fame and glory, you earn a prize of {reg9} scillingas. {s8}",
    "none",
    [
      ## CC chief
        (try_begin),
          (set_fixed_point_multiplier, 100),
          (position_set_x, pos0, 70),
          (position_set_y, pos0, 30),
          (position_set_z, pos0, 75),
          (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "trp_player", pos0),
        (try_end),
      ## CC
        (str_store_party_name, s3, "$current_town"),
        (call_script, "script_change_troop_renown", "trp_player", 15), #chief aumentado renombre ganado en torneo a 30
          (store_random_in_range, ":rand", 0, 20),
                                          (try_begin),
                                            (eq, ":rand", 0),
	(troop_add_item, "trp_player", "itm_greek_armored_horse", 0), #chief da objeto al ganar torneo
                                            	    (display_message, "@A expensive and armoured greek horse is gift you for your victory.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 1),
	(troop_add_item, "trp_player", "itm_khergit_arrows", 0), #chief da objeto al ganar torneo
                                            	    (display_message, "@A merchant gift you strange arrows, he tells you that he brought it from Constantinople.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 2),
	(troop_add_item, "trp_player", "itm_wolfpelt_mail_coat", 0), #chief da objeto al ganar torneo
                                            	    (display_message, "@They giving you a beautiful lorica adorned with a wolf skin. Armor fit for a Warlord.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 3),
	(troop_add_item, "trp_player", "itm_pict_sword", 0), #chief da objeto al ganar torneo
                                            	    (display_message, "@They gift you with a sword fit for a prince.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 4),
                                            	    (display_message, "@They will appreciate your participation in the tournament, and they apologize for not having a great gift to offer.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 5),
                                            	    (display_message, "@They will appreciate your participation in the tournament, and they apologize for not having a great gift to offer.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 6),
                                            	    (display_message, "@They will appreciate your participation in the tournament, and they apologize for not having a great gift to offer.", 0xFF0000),
                                          (else_try),
                                            (eq, ":rand", 7),
                                            	    (display_message, "@They will appreciate your participation in the tournament, and they apologize for not having a great gift to offer.", 0xFF0000),
                                          (else_try),
                                            	    (display_message, "@They will appreciate your participation in the tournament, and they apologize for not having a great gift to offer.", 0xFF0000),
          (try_end),

	#(troop_add_item, "trp_player", "itm_spear_1", 0), #chief da objeto al ganar torneo
        (call_script, "script_change_player_relation_with_center", "$current_town", 6), #chief cambiado
        (assign, reg9, 200),
        (add_xp_to_troop, 250, "trp_player"),
        (troop_add_gold, "trp_player", reg9),
        (str_clear, s8),
        (store_add, ":total_win", "$g_tournament_bet_placed", "$g_tournament_bet_win_amount"),
        (try_begin),
          (gt, "$g_tournament_bet_win_amount", 0),
          (assign, reg8, ":total_win"),
          (str_store_string, s8, "@Moreover, you earn {reg8} scillingas from the clever bets you placed on yourself..."),
        (try_end), #chief cambia a scillingas
		(try_begin),
			(this_or_next|neq, "$players_kingdom", "$g_encountered_party_faction"),
				(neg|troop_slot_ge, "trp_player", slot_troop_renown, 70),
			(neg|troop_slot_ge, "trp_player", slot_troop_renown, 145),

			(faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_state, sfai_feast),
			(faction_slot_eq, "$g_encountered_party_faction", slot_faction_ai_object, "$g_encountered_party"),
			(str_store_string, s8, "str_s8_you_are_also_invited_to_attend_the_ongoing_feast_in_the_castle"),
		(try_end),
        (troop_add_gold, "trp_player", ":total_win"),
        (assign, ":player_odds_sub", 0),
        (store_div, ":player_odds_sub", "$g_tournament_bet_win_amount", 5),
        (party_get_slot, ":player_odds", "$current_town", slot_town_player_odds),
        (val_sub, ":player_odds", ":player_odds_sub"),
        (val_max, ":player_odds", 250),
        (party_set_slot, "$current_town", slot_town_player_odds, ":player_odds"),
        (call_script, "script_play_victorious_sound"),

        (unlock_achievement, ACHIEVEMENT_MEDIEVAL_TIMES),
        ],
    [
      ("continue", [], "Continue...",
       [(jump_to_menu, "mnu_town"),
        ]),
    ]
  ),

  (
    "town_tournament_won_by_another",mnf_disable_all_keys,
    "As the only {reg3?fighter:man} to remain undefeated this day, {s1} wins the lists and the glory of this tournament.",
    "none",
    [
      (call_script, "script_get_num_tournament_participants"),
      (store_sub, ":needed_to_remove_randomly", reg0, 1),
      (try_begin),
        (troop_slot_eq, "trp_tournament_participants", 0, 0), #delete player from the participants
        (troop_set_slot, "trp_tournament_participants", 0, -1),
        (val_sub, ":needed_to_remove_randomly", 1),
      (try_end),
        (call_script, "script_remove_tournament_participants_randomly", ":needed_to_remove_randomly"),
        (call_script, "script_sort_tournament_participant_troops"),
        (troop_get_slot, ":winner_troop", "trp_tournament_participants", 0),
        (str_store_troop_name, s1, ":winner_troop"),
        (try_begin),
          (troop_is_hero, ":winner_troop"),
          (call_script, "script_change_troop_renown", ":winner_troop", 20),
        (try_end),
 ## Gender fix chief para alturas
        (troop_get_type, reg3, ":winner_troop"),
    (val_mod, reg3, 2),
#gender fix chief acaba
      ## CC
        (try_begin),
          (set_fixed_point_multiplier, 100),
          (position_set_x, pos0, 70),
          (position_set_y, pos0, 30),
          (position_set_z, pos0, 75),
          (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", ":winner_troop", pos0),
        (try_end),
      ## CC
        ],
    [
      ("continue", [], "Continue...",
       [(jump_to_menu, "mnu_town"),
        ]),
    ]
  ),

  (
    "town_tournament",mnf_disable_all_keys,
    "{s1}You are at tier {reg0} of the tournament, with {reg1} participants remaining. In the next round, there will be {reg2} teams with {reg3} {reg4?fighters:fighter} each.",
    "none",
    [
        (party_set_slot, "$current_town", slot_town_has_tournament, 0), #No way to return back if this menu is left
        (call_script, "script_sort_tournament_participant_troops"),#Moving trp_player to the top of the list
        (call_script, "script_get_num_tournament_participants"),
        (assign, ":num_participants", reg0),
        (try_begin),
          (neg|troop_slot_eq, "trp_tournament_participants", 0, 0),#Player is defeated

          (assign, ":player_odds_add", 0),
          (store_div, ":player_odds_add", "$g_tournament_bet_placed", 5),
          (party_get_slot, ":player_odds", "$current_town", slot_town_player_odds),
          (val_add, ":player_odds", ":player_odds_add"),
          (val_min, ":player_odds", 4000),
          (party_set_slot, "$current_town", slot_town_player_odds, ":player_odds"),

          (jump_to_menu, "mnu_town_tournament_lost"),
        (else_try),
          (eq, ":num_participants", 1),#Tournament won
          (jump_to_menu, "mnu_town_tournament_won"),
        (else_try),
          (try_begin),
            (le, "$g_tournament_next_num_teams", 0),
            (call_script, "script_get_random_tournament_team_amount_and_size"),
            (assign, "$g_tournament_next_num_teams", reg0),
            (assign, "$g_tournament_next_team_size", reg1),
          (try_end),
          (assign, reg2, "$g_tournament_next_num_teams"),
          (assign, reg3, "$g_tournament_next_team_size"),
          (store_sub, reg4, reg3, 1),
          (str_clear, s1),
          (try_begin),
            (eq, "$g_tournament_player_team_won", 1),
            (str_store_string, s1, "@Victory is yours! You have won this melee, but now you must prepare yourself for the next round. "),
          (else_try),
            (eq, "$g_tournament_player_team_won", 0),
            (str_store_string, s1, "@You have been bested in this melee, but the master of ceremonies declares a recognition of your skill and bravery, allowing you to take part in the next round. "),
          (try_end),
          (assign, reg1, ":num_participants"),
          (store_add, reg0, "$g_tournament_cur_tier", 1),
        (try_end),
        ],
    [
      ("tournament_view_participants", [], "View participants.",
       [(jump_to_menu, "mnu_tournament_participants"),
        ]),
      ("tournament_bet", [(neq, "$g_tournament_cur_tier", "$g_tournament_last_bet_tier")], "Place a bet on yourself.",
       [(jump_to_menu, "mnu_tournament_bet"),
        ]),
      ("tournament_join_next_fight", [], "Fight in the next round.",
       [
           (party_get_slot, ":arena_scene", "$current_town", slot_town_arena),
           (modify_visitors_at_site, ":arena_scene"),
           (reset_visitors),
           #Assuming that there are enough participants for the teams
		   (assign, "$g_player_tournament_placement", "$g_tournament_cur_tier"),
		   (try_begin),
		     (gt, "$g_player_tournament_placement", 4),
		     (assign, "$g_player_eligible_feast_center_no", "$current_town"),
		   (try_end),
           (val_add, "$g_tournament_cur_tier", 1),

           (store_mul, "$g_tournament_num_participants_for_fight", "$g_tournament_next_num_teams", "$g_tournament_next_team_size"),
           (troop_set_slot, "trp_tournament_participants", 0, -1),#Removing trp_player from the list
           (troop_set_slot, "trp_temp_array_a", 0, "trp_player"),
           (try_for_range, ":slot_no", 1, "$g_tournament_num_participants_for_fight"),
             (call_script, "script_get_random_tournament_participant"),
             (troop_set_slot, "trp_temp_array_a", ":slot_no", reg0),
           (try_end),
           (call_script, "script_shuffle_troop_slots", "trp_temp_array_a", 0, "$g_tournament_num_participants_for_fight"),


           (try_for_range, ":slot_no", 0, 4),#shuffle teams
             (troop_set_slot, "trp_temp_array_b", ":slot_no", ":slot_no"),
           (try_end),
           (call_script, "script_shuffle_troop_slots", "trp_temp_array_b", 0, 4),

           (assign, ":cur_slot", 0),
           (try_for_range, ":cur_team_offset", 0, "$g_tournament_next_num_teams"),
             (troop_get_slot, ":cur_team", "trp_temp_array_b", ":cur_team_offset"),

             (try_for_range, ":slot_no", 0, 8),#shuffle entry_points
               (troop_set_slot, "trp_temp_array_c", ":slot_no", ":slot_no"),
             (try_end),
             (call_script, "script_shuffle_troop_slots", "trp_temp_array_c", 0, 8),

             (try_for_range, ":cur_index", 0, "$g_tournament_next_team_size"),
               (store_mul, ":cur_entry_point", ":cur_team", 8),
               (troop_get_slot, ":entry_offset", "trp_temp_array_c", ":cur_index"),
               (val_add, ":cur_entry_point", ":entry_offset"),
               (troop_get_slot, ":troop_no", "trp_temp_array_a", ":cur_slot"),
               (set_visitor, ":cur_entry_point", ":troop_no"),
               (val_add, ":cur_slot", 1),
             (try_end),
           (try_end),

           (assign, "$g_tournament_next_num_teams", 0),
           (assign, "$g_tournament_next_team_size", 0),

           (assign, "$g_mt_mode", abm_tournament),

           (party_get_slot, ":town_original_faction", "$current_town", slot_center_original_faction),
           (assign, ":town_index_within_faction", 0),
           (assign, ":end_cond", towns_end),
           (try_for_range, ":cur_town", towns_begin, ":end_cond"),
             (try_begin),
               (eq, ":cur_town", "$current_town"),
               (assign, ":end_cond", 0), #break
             (else_try),
               (party_slot_eq, ":cur_town", slot_center_original_faction, ":town_original_faction"),
               (val_add, ":town_index_within_faction", 1),
             (try_end),
           (try_end),

           (set_jump_mission, "mt_arena_melee_fight"),

           (try_begin),
             (eq, ":town_original_faction", "fac_kingdom_1"),
             #Swadia
             (store_mod, ":mod", ":town_index_within_faction", 4),
             (try_begin),
               (eq, ":mod", 0),
               (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
             (else_try),
               (eq, ":mod", 1),
               (call_script, "script_set_items_for_tournament", 100, 100, 0, 0, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
             (else_try),
               (eq, ":mod", 2),
               (call_script, "script_set_items_for_tournament", 100, 0, 100, 0, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
             (else_try),
               (eq, ":mod", 3),
               (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 40, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
             (try_end),
           (else_try),
             (eq, ":town_original_faction", "fac_kingdom_2"),
             #Vaegirs
             (store_mod, ":mod", ":town_index_within_faction", 4),
             (try_begin),
               (eq, ":mod", 0),
               (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 0, 0, 0, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
             (else_try),
               (eq, ":mod", 1),
               (call_script, "script_set_items_for_tournament", 100, 50, 0, 0, 0, 20, 30, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
             (else_try),
               (eq, ":mod", 2),
               (call_script, "script_set_items_for_tournament", 100, 0, 50, 0, 0, 20, 30, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
             (else_try),
               (eq, ":mod", 3),
               (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 30, 0, 60, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
             (try_end),
           (else_try),
             (eq, ":town_original_faction", "fac_kingdom_3"),
             #Khergit
             (store_mod, ":mod", ":town_index_within_faction", 2),
             (try_begin),
               (eq, ":mod", 0),
               (call_script, "script_set_items_for_tournament", 100, 0, 0, 0, 0, 40, 60, 0, "itm_arena_tunic_red", "itm_steppe_helmet_red"),
             (else_try),
               (eq, ":mod", 1),
               (call_script, "script_set_items_for_tournament", 100, 50, 25, 0, 0, 30, 50, 0, "itm_arena_tunic_red", "itm_steppe_helmet_red"),
             (try_end),
           (else_try),
             (eq, ":town_original_faction", "fac_kingdom_4"),
             #Nords
             (store_mod, ":mod", ":town_index_within_faction", 3),
             (try_begin),
               (eq, ":mod", 0),
               (call_script, "script_set_items_for_tournament", 0, 0, 50, 80, 0, 0, 0, 0, "itm_arena_armor_red", -1),
             (else_try),
               (eq, ":mod", 1),
               (call_script, "script_set_items_for_tournament", 0, 0, 50, 80, 50, 0, 0, 0, "itm_arena_armor_red", -1),
             (else_try),
               (eq, ":mod", 2),
               (call_script, "script_set_items_for_tournament", 40, 0, 0, 100, 0, 0, 0, 0, "itm_arena_armor_red", -1),
             (try_end),
           (else_try),
             #Rhodoks
             (eq, ":town_original_faction", "fac_kingdom_5"),
             (call_script, "script_set_items_for_tournament", 25, 100, 60, 0, 30, 0, 30, 50, "itm_arena_tunic_red", "itm_arena_helmet_red"),
           (else_try),
             #Sarranids
             (store_mod, ":mod", ":town_index_within_faction", 2),
             (try_begin),
               (eq, ":mod", 0),
               (call_script, "script_set_items_for_tournament", 100, 40, 60, 0, 30, 30, 0, 0, "itm_arena_tunic_red", "itm_arena_turban_red"),
             (else_try),
               (call_script, "script_set_items_for_tournament", 50, 0, 60, 0, 30, 30, 0, 0, "itm_arena_tunic_red", "itm_arena_turban_red"),
             (try_end),
           (try_end),
           (jump_to_scene, ":arena_scene"),
           (change_screen_mission),
        ]),
      ("tournament_opciones", [], "Tournament Options", #chief anade options
       [(jump_to_menu, "mnu_torneo_opciones"),
        ]),
      ("leave_tournament",[],"Withdraw from the tournament.",
       [
           (jump_to_menu, "mnu_tournament_withdraw_verify"),
        ]),
    ]
  ),

  (
    "tournament_withdraw_verify",0,
    "Are you sure you want to withdraw from the tournament?",
    "none",
    [],
    [
      ("tournament_withdraw_yes", [], "Yes. This is a pointless affectation.",
       [(jump_to_menu, "mnu_town_tournament_won_by_another"),
        ]),
      ("tournament_withdraw_no", [], "No, not as long as there is a chance of victory!",
       [(jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),

  (
    "tournament_bet",0,
    "The odds against you are {reg5} to {reg6}.{reg1? You have already bet {reg1} scillingas on yourself, and if you win, you will earn {reg2} scillingas.:} How much do you want to bet?",
    "none",
    [
      (assign, reg1, "$g_tournament_bet_placed"),
      (store_add, reg2, "$g_tournament_bet_win_amount", "$g_tournament_bet_placed"),
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":player_odds", reg0),
      (assign, ":min_dif", 100000),
      (assign, ":min_dif_divisor", 1),
      (assign, ":min_dif_multiplier", 1),
      (try_for_range, ":cur_multiplier", 1, 50),
        (try_for_range, ":cur_divisor", 1, 50),
          (store_mul, ":result", 100, ":cur_multiplier"),
          (val_div, ":result", ":cur_divisor"),
          (store_sub, ":difference", ":player_odds", ":result"),
          (val_abs, ":difference"),
          (lt, ":difference", ":min_dif"),
          (assign, ":min_dif", ":difference"),
          (assign, ":min_dif_divisor", ":cur_divisor"),
          (assign, ":min_dif_multiplier", ":cur_multiplier"),
        (try_end),
      (try_end),
      (assign, reg5, ":min_dif_multiplier"),
      (assign, reg6, ":min_dif_divisor"),
      ],
    [
      ("bet_100_denars", [(store_troop_gold, ":gold", "trp_player"),
                          (ge, ":gold", 100)
                          ],
       "100 scillingas.",
       [
         (assign, "$temp", 100),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_50_denars", [(store_troop_gold, ":gold", "trp_player"),
                         (ge, ":gold", 50)
                         ],
       "50 scillingas.",
       [
         (assign, "$temp", 50),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_20_denars", [(store_troop_gold, ":gold", "trp_player"),
                         (ge, ":gold", 20)
                         ],
       "20 scillingas.",
       [
         (assign, "$temp", 20),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_10_denars", [(store_troop_gold, ":gold", "trp_player"),
                         (ge, ":gold", 10)
                         ],
       "10 scillingas.",
       [
         (assign, "$temp", 10),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
        ]),
      ("bet_5_denars", [(store_troop_gold, ":gold", "trp_player"),
                        (ge, ":gold", 5)
                        ],
       "5 scillingas.",
       [
         (assign, "$temp", 5),
         (jump_to_menu, "mnu_tournament_bet_confirm"),
         ]),
      ("go_back_dot", [], "Go back.",
       [
         (jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),

  (
    "tournament_bet_confirm",0,
    "If you bet {reg1} scillingas, you will earn {reg2} scillingas if you win the tournament. Is that all right?",
    "none",
    [
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":win_amount", reg0),
      (val_mul, ":win_amount", "$temp"),
      (val_div, ":win_amount", 100),
      (assign, reg1, "$temp"),
      (assign, reg2, ":win_amount"),
      ],
    [
      ("tournament_bet_accept", [],
       "Go ahead.",
       [
         (call_script, "script_tournament_place_bet", "$temp"),
         (jump_to_menu, "mnu_town_tournament"),
         ]),
      ("tournament_bet_cancel", [],
       "Forget it.",
       [
         (jump_to_menu, "mnu_tournament_bet"),
         ]),
    ]
  ),

  (
    "tournament_participants",0,
    "You ask one of the criers for the names of the tournament participants. They are:^{s11}",
    "none",
    [
        (str_clear, s11),
        (call_script, "script_sort_tournament_participant_troops"),
        (call_script, "script_get_num_tournament_participants"),
        (assign, ":num_participants", reg0),
        (try_for_range, ":cur_slot", 0, ":num_participants"),
          (troop_get_slot, ":troop_no", "trp_tournament_participants", ":cur_slot"),
          (str_store_troop_name, s12, ":troop_no"),
          (str_store_string, s11, "@{!}{s11}^{s12}"),
        (try_end),
        ],
    [
      ("go_back_dot", [], "Go back.",
       [(jump_to_menu, "mnu_town_tournament"),
        ]),
    ]
  ),


  (
    "collect_taxes",mnf_disable_all_keys,
    "As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} that collecting taxes from here will take {reg4} days...",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_trade"),
     (assign, ":max_skill", reg0),
     (assign, reg2, reg0),
     (assign, ":max_skill_owner", reg1),
     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s1, ":max_skill_owner"),
     (try_end),
     (assign, ":tax_quest_expected_revenue", 3000),
     (try_begin),
       (party_slot_eq, "$current_town", slot_party_type, spt_town),
       (assign, ":tax_quest_expected_revenue", 6000),
     (try_end),

     (try_begin),
       (quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 0),
       (store_add, ":max_skill_plus_thirty", ":max_skill", 30),
       (try_begin),
         (party_slot_eq, "$current_town", slot_party_type, spt_town),
         (store_div, "$qst_collect_taxes_total_hours", 24* 7 * 30, ":max_skill_plus_thirty"),
       (else_try),
         #Village
         (store_div, "$qst_collect_taxes_total_hours", 24 * 3 * 30, ":max_skill_plus_thirty"),
       (try_end),

       (call_script, "script_party_count_fit_for_battle", "p_main_party"),
       (val_add, reg0, 20),
       (val_mul, "$qst_collect_taxes_total_hours", 20),
       (val_div, "$qst_collect_taxes_total_hours", reg0),


       (quest_set_slot, "qst_collect_taxes", slot_quest_target_amount, "$qst_collect_taxes_total_hours"),
       (store_div, ":menu_begin_time", "$qst_collect_taxes_total_hours", 20),#between %5-%25
       (store_div, ":menu_end_time", "$qst_collect_taxes_total_hours", 4),
       (assign, ":unrest_begin_time", ":menu_end_time"),#between %25-%75
       (store_mul, ":unrest_end_time", "$qst_collect_taxes_total_hours", 3),
       (val_div, ":unrest_end_time", 4),

       (val_mul, ":tax_quest_expected_revenue", 2),
       (store_div, "$qst_collect_taxes_hourly_income", ":tax_quest_expected_revenue", "$qst_collect_taxes_total_hours"),

       (store_random_in_range, "$qst_collect_taxes_menu_counter", ":menu_begin_time", ":menu_end_time"),
       (store_random_in_range, "$qst_collect_taxes_unrest_counter", ":unrest_begin_time", ":unrest_end_time"),
       (assign, "$qst_collect_taxes_halve_taxes", 0),
     (try_end),
     (quest_get_slot, ":target_hours", "qst_collect_taxes", slot_quest_target_amount),
     (store_div, ":target_days", ":target_hours", 24),
     (val_mul, ":target_days", 24),
     (try_begin),
       (lt, ":target_days", ":target_hours"),
       (val_add, ":target_days", 24),
     (try_end),
     (val_div, ":target_days", 24),
     (assign, reg4, ":target_days"),
     ],
    [
      ("start_collecting", [], "Start collecting.",
       [(assign, "$qst_collect_taxes_currently_collecting", 1),
        (try_begin),
          (quest_slot_eq, "qst_collect_taxes", slot_quest_current_state, 0),
          (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 1),
        (try_end),
        (rest_for_hours_interactive, 1000, 5, 0), #rest while not attackable
        (assign,"$auto_enter_town","$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (change_screen_return),
        ]),
      ("collect_later", [], "Put it off until later.",
       [(try_begin),
          (party_slot_eq, "$current_town", slot_party_type, spt_town),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),
        ]),
    ]
  ),

  (
    "collect_taxes_complete",mnf_disable_all_keys,
    "You've collected {reg3} scillingas in taxes from {s3}. {s19} will be expecting you to take the money to him.",
    "none",
    [(str_store_party_name, s3, "$current_town"),
     (quest_get_slot, ":quest_giver", "qst_collect_taxes", slot_quest_giver_troop),
     (str_store_troop_name, s19, ":quest_giver"),
     (quest_get_slot, reg3, "qst_collect_taxes", slot_quest_gold_reward),
     (try_begin),
       (eq, "$qst_collect_taxes_halve_taxes", 0),
       (call_script, "script_change_player_relation_with_center", "$current_town", -2),
     (try_end),
     (call_script, "script_succeed_quest", "qst_collect_taxes"),
     ],
    [
      ("continue", [], "Continue...",
       [(change_screen_return),
        ]),
    ]
  ),

  (
    "collect_taxes_rebels_killed",0,
    "Your quick action and strong arm have successfully put down the revolt.\
 Surely, anyone with a mind to rebel against you will think better of it after this.",
    "none",
    [
    ],
    [
      ("continue", [], "Continue...",
       [(change_screen_map),
        ]),
    ]
  ),

  (
    "collect_taxes_failed",mnf_disable_all_keys,
    "You could collect only {reg3} scillingas as tax from {s3} before the revolt broke out.\
 {s1} won't be happy, but some silver will placate him better than nothing at all...",
    "none",
    [(str_store_party_name, s3, "$current_town"),
     (quest_get_slot, ":quest_giver", "qst_collect_taxes", slot_quest_giver_troop),
     (str_store_troop_name, s1, ":quest_giver"),
     (quest_get_slot, reg3, "qst_collect_taxes", slot_quest_gold_reward),
     (call_script, "script_fail_quest", "qst_collect_taxes"),
     (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 4),
     (rest_for_hours, 0, 0, 0), #stop resting
     ],
    [
      ("continue", [], "Continue...",
       [(change_screen_map),
        ]),
    ]
  ),
###saquear monasterio chief menu final de batalla
  (
    "monasterio_saqueado",mnf_disable_all_keys,
    "The monks'blood soaked ground and their bodies are fed to the crows. An easy victory, a great reward ... but you have created new enemies among Christians.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_monasterio"),
        ],
    [
      ("continue", [], "Continue...",
       [(change_screen_map),
        ]),
    ]
  ),

####saquear monasterio acaba chief

  (
    "collect_taxes_revolt_warning",0,
    "The people of {s3} are outraged at your demands and decry it as nothing more than extortion.\
 They're getting very restless, and they may react badly if you keep pressing them.",
    "none",
    [(str_store_party_name, s3, "$current_town"),
     ],
    [
      ("continue_collecting_taxes", [], "Ignore them and continue.",
       [(change_screen_return),]),
      ("halve_taxes", [(quest_get_slot, ":quest_giver_troop", "qst_collect_taxes", slot_quest_giver_troop),
                       (str_store_troop_name, s1, ":quest_giver_troop"),],
       "Agree to reduce your collection by half. ({s1} may be upset)",
       [(assign, "$qst_collect_taxes_halve_taxes", 1),
        (change_screen_return),
        ]),
    ]
  ),

  (
    "collect_taxes_revolt",0,
    "You are interrupted while collecting the taxes at {s3}. A large band of angry {reg9?peasants:townsmen} is marching nearer,\
 shouting about the exorbitant taxes and waving torches and weapons. It looks like they aim to fight you!",
    "none",
    [(str_store_party_name, s3, "$current_town"),
     (assign, reg9, 0),
     (try_begin),
       (party_slot_eq, "$current_town", slot_party_type, spt_village),
       (assign, reg9, 1),
     (try_end),
     ],
    [
      ("continue", [], "Continue...",
       [(set_jump_mission,"mt_back_alley_revolt"),
        (quest_get_slot, ":target_center", "qst_collect_taxes", slot_quest_target_center),
        (try_begin),
          (party_slot_eq, ":target_center", slot_party_type, spt_town),
          (party_get_slot, ":town_alley", ":target_center", slot_town_alley),
        (else_try),
          (party_get_slot, ":town_alley", ":target_center", slot_castle_exterior),
        (try_end),
        (modify_visitors_at_site,":town_alley"),
        (reset_visitors),
        (assign, ":num_rebels", 6),
        (store_character_level, ":level", "trp_player"),
        (val_div, ":level", 5),
        (val_add, ":num_rebels", ":level"),
        (set_visitors, 1, "trp_tax_rebel", ":num_rebels"),
        (jump_to_scene,":town_alley"),
        (change_screen_mission),
        ]),
    ]
  ),

# They must learn field discipline and the steadiness to follow orders in combat before they can be thought to use arms.",
  (
    "train_peasants_against_bandits",0,
    "As the party member with the highest training skill ({reg2}), {reg3?you expect:{s1} expects} that getting some peasants ready for practice will take {reg4} hours.",
    "none",
    [(call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
     (assign, ":max_skill", reg0),
     (assign, reg2, reg0),
     (assign, ":max_skill_owner", reg1),
     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s1, ":max_skill_owner"),
     (try_end),
     (store_sub, ":needed_hours", 20, ":max_skill"),
     (val_mul, ":needed_hours", 3),
     (val_div, ":needed_hours", 5),
     (store_sub, reg4, ":needed_hours", "$qst_train_peasants_against_bandits_num_hours_trained"),
     ],
    [
      ("make_preparation", [], "Train them.",
       [
         (assign, "$qst_train_peasants_against_bandits_currently_training", 1),
         (rest_for_hours_interactive, 1000, 5, 0), #rest while not attackable
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (change_screen_return),
         ]),
      ("train_later", [], "Put it off until later.",
       [
         (jump_to_menu, "mnu_village"),
        ]),
    ]
  ),

  (
    "train_peasants_against_bandits_ready",0,
    "You put the peasants through the basics of soldiering, discipline and obedience.\
 You think {reg0} of them {reg1?have:has} fully grasped the training and {reg1?are:is} ready for some practice.",
    "none",
    [
      (store_character_level, ":level", "trp_player"),
      (val_div, ":level", 10),
      (val_add, ":level", 1),
      (quest_get_slot, ":quest_target_amount", "qst_train_peasants_against_bandits", slot_quest_target_amount),
      (quest_get_slot, ":quest_current_state", "qst_train_peasants_against_bandits", slot_quest_current_state),
      (val_sub, ":quest_target_amount", ":quest_current_state"),
      (assign, ":max_random", ":level"),
      (val_min, ":max_random", ":quest_target_amount"),
      (val_add, ":max_random", 1),
      (store_random_in_range, ":random_number", 1, ":max_random"),
      (assign, "$g_train_peasants_against_bandits_num_peasants", ":random_number"),
      (assign, reg0, ":random_number"),
      (store_sub, reg1, ":random_number", 1),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", ":random_number"),
     ],
    [
      ("peasant_start_practice", [], "Start the practice fight.",
       [
         (set_jump_mission,"mt_village_training"),
         (quest_get_slot, ":target_center", "qst_train_peasants_against_bandits", slot_quest_target_center),
         (party_get_slot, ":village_scene", ":target_center", slot_castle_exterior),
         (modify_visitors_at_site, ":village_scene"),
         (reset_visitors),
         (set_visitor, 0, "trp_player"),
         (set_visitors, 1, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
         (set_jump_entry, 11),
         (jump_to_scene, ":village_scene"),
         (jump_to_menu, "mnu_train_peasants_against_bandits_training_result"),
         (music_set_situation, 0),
         (change_screen_mission),
         ]),
      ]
    ),

  (
    "train_peasants_against_bandits_training_result",mnf_disable_all_keys,
    "{s0}",
    "none",
    [
      (assign, reg5, "$g_train_peasants_against_bandits_num_peasants"),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
      (try_begin),
        (eq, "$g_train_peasants_against_bandits_training_succeeded", 0),
        (str_store_string, s0, "@You were beaten. The peasants are heartened by their success, but the lesson you wanted to teach them probably didn't get through..."),
      (else_try),
        (str_store_string, s0, "@After beating your last opponent, you explain to the peasants how to better defend themselves against such an attack. Hopefully they'll take the experience on board and will be prepared next time."),
        (quest_get_slot, ":quest_current_state", "qst_train_peasants_against_bandits", slot_quest_current_state),
        (val_add, ":quest_current_state", "$g_train_peasants_against_bandits_num_peasants"),
        (quest_set_slot, "qst_train_peasants_against_bandits", slot_quest_current_state, ":quest_current_state"),
      (try_end),
     ],
    [
      ("continue", [], "Continue...",
       [
         (try_begin),
           (quest_get_slot, ":quest_current_state", "qst_train_peasants_against_bandits", slot_quest_current_state),
           (quest_slot_eq, "qst_train_peasants_against_bandits", slot_quest_target_amount, ":quest_current_state"),
           (jump_to_menu, "mnu_train_peasants_against_bandits_attack"),
         (else_try),
           (change_screen_map),
         (try_end),
         ]),
      ]
    ),

  (
    "train_peasants_against_bandits_attack",0,
    "As you get ready to continue the training, a sentry from the village runs up to you, shouting alarums.\
 The bandits have been spotted on the horizon, riding hard for {s3}.\
 The elder begs that you organize your newly-trained militia and face them.",
    "none",
    [
	(str_store_party_name, s3, "$current_town"),
     ],
    [
      ("peasants_against_bandits_attack_resist", [], "Prepare for a fight!",
       [
        (store_random_in_range, ":random_no", 0, 3),
        (try_begin),
          (eq, ":random_no", 0),
          (assign, ":bandit_troop", "trp_bandit"),
        (else_try),
          (eq, ":random_no", 1),
          (assign, ":bandit_troop", "trp_mountain_bandit"),
        (else_try),
          (assign, ":bandit_troop", "trp_forest_bandit"),
        (try_end),
        (party_get_slot, ":scene_to_use", "$g_encountered_party", slot_castle_exterior),
        (modify_visitors_at_site, ":scene_to_use"),
        (reset_visitors),
        (store_character_level, ":level", "trp_player"),
        (val_div, ":level", 2),
        (store_add, ":min_bandits", ":level", 16),
        (store_add, ":max_bandits", ":min_bandits", 6),
        (store_random_in_range, ":random_no", ":min_bandits", ":max_bandits"),
        (set_visitors, 0, ":bandit_troop", ":random_no"),
        (assign, ":num_villagers", ":max_bandits"),
        (set_visitors, 2, "trp_trainee_peasant", ":num_villagers"),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission,"mt_village_attack_bandits"),
        (jump_to_scene, ":scene_to_use"),
        (assign, "$g_next_menu", "mnu_train_peasants_against_bandits_attack_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", vba_after_training),
        (change_screen_mission),
        ]),
      ]
    ),

  (
    "train_peasants_against_bandits_attack_result",mnf_disable_all_keys,
    "{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (str_store_string, s9, "@The bandits are broken!\
 Those few who remain alive and conscious run off with their tails between their legs,\
 terrified of the peasants and their new champion."),
	(call_script, "script_succeed_quest", "qst_train_peasants_against_bandits"),
        (jump_to_menu, "mnu_train_peasants_against_bandits_success"),
      (else_try),
        (call_script, "script_fail_quest", "qst_train_peasants_against_bandits"),
        (str_store_string, s9, "@Try as you might, you could not defeat the bandits.\
 Infuriated, they raze the village to the ground to punish the peasants,\
 and then leave the burning wasteland behind to find greener pastures to plunder."),
        (set_background_mesh, "mesh_pic_looted_village1"),
      (try_end),
     ],
    [
      ("continue", [], "Continue...",
       [(try_begin),
          (call_script, "script_village_set_state",  "$current_town", svs_looted),
          (party_set_slot, "$current_town", slot_village_raid_progress, 0),
          (party_set_slot, "$current_town", slot_village_recover_progress, 0),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
          (call_script, "script_end_quest", "qst_train_peasants_against_bandits"),
        (try_end),
        (change_screen_map),
	 ]),
      ]
    ),

   (
    "train_peasants_against_bandits_success",mnf_disable_all_keys,
    "The bandits are broken!\
 Those few who remain run off with their tails between their legs,\
 terrified of the peasants and their new champion.\
 The villagers have little left in the way of wealth after their ordeal,\
 but they offer you all they can find to show their gratitude.",
    "none",
    [(party_clear, "p_temp_party"),
     (call_script, "script_end_quest", "qst_train_peasants_against_bandits"),
     (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),

     (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
     (try_for_range, ":slot_no", num_equipment_kinds ,max_inventory_items + num_equipment_kinds),
        (store_random_in_range, ":rand", 0, 100),
        (lt, ":rand", 50),
        (troop_set_inventory_slot, ":merchant_troop", ":slot_no", -1),
     (try_end),
     (call_script, "script_add_log_entry", logent_helped_peasants, "trp_player",  "$current_town", -1, -1),
    ],
    [
      ("village_bandits_defeated_accept",[],"Take it as your just due.",[(jump_to_menu, "mnu_auto_return_to_map"),
                                                                         (party_get_slot, ":merchant_troop", "$current_town", slot_town_elder),
                                                                         (troop_sort_inventory, ":merchant_troop"),
                                                                         (change_screen_loot, ":merchant_troop"),
                                                                       ]),
      ("village_bandits_defeated_cont",[],  "Refuse, stating that they need these items more than you do.",[
	  (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
      (call_script, "script_change_player_honor", 1),
      (change_screen_map)]),
    ],
  ),

#seafare duh chief
  (
    "disembark",0,
    "Do you wish to disembark?^^\
 Do not land on cliffs, unless you wish to get stuck.",
    "none",
    [ (set_background_mesh, "mesh_pic_extra_navegando"),],
    [
      ("disembark_yes", [
    #Pos0 is set as the disembark position by the engine
			(position_get_x, ":x", pos0),
			(position_get_y, ":y", pos0),
			(store_sub, ":min_x", ":x", 1), #Radius of 5 map units...not the radius units from before, I don't think
			(store_add, ":max_x", ":x", 2),
			(store_sub, ":min_y", ":y", 1),
			(store_add, ":max_y", ":y", 2),
			(assign, ":no_cliffs", 1),
			(try_for_range, ":x", ":min_x", ":max_x"),
				(try_for_range, ":y", ":min_y", ":max_y"),
					(position_set_x, pos1, ":x"),
					(position_set_y, pos1, ":y"),
					(party_set_position, "p_temp_party", pos1),
					(party_get_position, pos1, "p_temp_party"),
					(position_get_z, ":z", pos1),
					(gt, ":z", 2), #There be cliffs
					(assign, ":no_cliffs", 0),
					(assign, ":max_y", 0),
					(assign, ":max_x", 0),
				(try_end), #Ys
			(try_end), #Xs
			(init_position, pos1),
			(party_set_position, "p_temp_party", pos1), #Reset Temp Party Position
			(eq, ":no_cliffs", 1),
          ], "Land the ship and leave it here for now.",
       [
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
	    (store_party_size, ":party_size", ":ship_no"),

		(try_begin),
			(ge, ":party_size", 10),
			(assign, "$g_player_icon_state", pis_normal),
			(party_set_flags, "p_main_party", pf_is_ship, 0),
			(party_get_position, pos1, "p_main_party"),
			(party_set_position, "p_main_party", pos0),
			(party_relocate_near_party, ":ship_no", "p_main_party", 0),
			(party_set_slot, ":ship_no", slot_ship_center, ship_wild_guarded),
			(enable_party, ":ship_no"),
			(party_set_icon, ":ship_no", "icon_ship_on_land"),
			(change_screen_return),
		(else_try),
			(lt, ":party_size", 10),
			(assign, "$g_player_icon_state", pis_normal),
			(party_set_flags, "p_main_party", pf_is_ship, 0),
			(party_get_position, pos1, "p_main_party"),
			(party_set_position, "p_main_party", pos0),
			(party_relocate_near_party, ":ship_no", "p_main_party", 0),
			(party_set_slot, ":ship_no", slot_ship_center, ship_wild_no_guard), #Wilderness
			(store_current_hours, ":time"),
			(val_add, ":time", 96),
			(party_set_slot, ":ship_no", slot_ship_time, ":time"),
			(enable_party, ":ship_no"),
			(party_set_icon, ":ship_no", "icon_ship_on_land"),
			(change_screen_return),
			(display_message, "@You should leave 10 men behind to guard your ship, otherwise it might get stolen."),
		(try_end),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
        ]),

##      ("disembark_yo", [      (try_for_range, ":cur_center", centers_begin, centers_end),
##          (party_slot_eq,":cur_center",slot_town_port, 1),
##                                  (party_get_position,pos1,"p_main_party"),
##                                    (party_get_position,pos2,":cur_center"),
##                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
##                                    (lt,":cur_distance",300),
##], "Closer to the coast.",
##       [
##        (assign, ":scene_to_use", "scn_shore"),
##		(modify_visitors_at_site, ":scene_to_use"),
##        (reset_visitors),
##		(assign,":count",20),
##		(try_for_range,":current_npc",companions_begin,companions_end),
##			(try_begin),
##				(main_party_has_troop,":current_npc"),
##				(set_visitor,":count",":current_npc"),
##			(try_end),
##			(val_add,":count",1),
##		(try_end),
##        (set_jump_mission,"mt_shore"),
##        (set_jump_entry, 0),
##        (jump_to_scene, ":scene_to_use"),
##        (change_screen_mission),
##        ]),


		("manage_crew", [], "Manage the crew.",
       [# (assign, ":ship_to_use", -1),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (assign, ":ship_to_use", ":ship_no"),
		# (try_end),
		(party_get_slot, ":ship_to_use", "p_main_party", slot_town_has_ship),
		# (gt, ":ship_to_use", -1),
		#(assign, reg6, ":ship_to_use"),
		#(display_message,"@You now own a ship and can disembark from this town."),
		(set_encountered_party, ":ship_to_use"),
		#(change_screen_exchange_with_party, ":ship_to_use"),
		#(change_screen_give_members, ":ship_to_use"),
		(change_screen_exchange_members,0),
        #(party_clear, "p_temp_party"),
        #(call_script, "script_party_copy", "p_temp_party", ":ship_to_use"),
		#(change_screen_exchange_with_party, "p_temp_party"),
		#(assign, "$g_next_menu", "mnu_disembark"),
		#(jump_to_menu, "mnu_manage_crew_done"),
		#(call_script, "script_party_add_party", ":ship_to_use", "p_temp_party"),
	   ]),

		("disembark_yes_2",
		[
		],
		"Dock at the port.",

		[
			(assign, reg1, 0),
			(try_for_range, ":town_no", towns_begin, towns_end),
				(party_slot_ge, ":town_no", slot_town_port, 1),
				(party_get_slot, ":radius", ":town_no", slot_town_port),
				(store_distance_to_party_from_party, ":dist", ":town_no", "p_main_party"),
				(val_add, ":radius", 4),
				(le, ":dist", ":radius"),
				(assign, "$g_player_icon_state", pis_normal),
				(party_set_flags, "p_main_party", pf_is_ship, 0),
				(party_relocate_near_party, "p_main_party", ":town_no", 0.5),
				(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
				(party_set_slot, ":ship_no", slot_ship_center, ":town_no"),
				(disable_party, ":ship_no"),
				(party_get_slot, ":num_ships", ":town_no", slot_town_has_ship),
				(val_add, ":num_ships", 1),
				(party_set_slot, ":town_no", slot_town_has_ship, ":num_ships"),
				(assign, reg1, 1),
				(change_screen_return),
			(try_end),
			(try_begin),
				(eq, reg1, 0),
				(display_message, "@There is no port in the surrounding area."),
			(try_end),
		]),


		("disembark_yes_3",
		[
			    #Pos0 is set as the disembark position by the engine
			(position_get_x, ":x", pos0),
			(position_get_y, ":y", pos0),
			(store_sub, ":min_x", ":x", 1), #Radius of 5 map units...not the radius units from before, I don't think
			(store_add, ":max_x", ":x", 2),
			(store_sub, ":min_y", ":y", 1),
			(store_add, ":max_y", ":y", 2),
			(assign, ":no_cliffs", 1),
			(try_for_range, ":x", ":min_x", ":max_x"),
				(try_for_range, ":y", ":min_y", ":max_y"),
					(position_set_x, pos1, ":x"),
					(position_set_y, pos1, ":y"),
					(party_set_position, "p_temp_party", pos1),
					(party_get_position, pos1, "p_temp_party"),
					(position_get_z, ":z", pos1),
					(gt, ":z", 2), #There be cliffs
					(assign, ":no_cliffs", 0),
					(assign, ":max_y", 0),
					(assign, ":max_x", 0),
				(try_end), #Ys
			(try_end), #Xs
			(init_position, pos1),
			(party_set_position, "p_temp_party", pos1), #Reset Temp Party Position
			(eq, ":no_cliffs", 1),

			#(party_get_position, pos1, "p_main_party"),
			#(map_get_land_position_around_position, pos2, pos1, 1),
			#(party_set_position, "p_main_party", pos2),
			#(party_get_current_terrain, ":terrain", "p_main_party"),
			#(neq, ":terrain", 1),
			#(assign, reg20, ":terrain"),
			#(display_message, "@Terrain is {reg20}"),
			#(party_set_position, "p_main_party", pos1),
		],
		"Yes, but send the ship to a port.",

		[
		    # (try_for_parties, ":ship_no"),
				# (party_slot_eq, ":ship_no", slot_ship_center, 250),
				# (store_party_size, ":party_size", ":ship_no"),
			# (try_end),
			(try_begin),
			    (party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
				(store_party_size, ":party_size", ":ship_no"),
				(ge, ":party_size", 30),
				(jump_to_menu, "mnu_send_ship_to_town"),
			(else_try),
				(display_message, "@You need at least a 30 men crew to send the ship to a town"),
			(try_end),
		]),

	("disembark_no", [], "No.",
       [	(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 1),
			(party_set_position, "p_main_party", pos2),
			(rest_for_hours_interactive, 1, 1),
			(change_screen_return),
        ]),
    ]
  ),

 (
	"Send_ship_to_town",0,
    "Send the ship to",
    "none",
	[
	],
	[
		("p_town_1",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_7"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_7"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_7", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_7", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_7"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_1"),
			# (disable_party, ":ship_no"),
		# (try_end),
        (change_screen_return),
		]),

		("p_town_17",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_17"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_17"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_17", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_17", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_17"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_1"),
			# (disable_party, ":ship_no"),
		# (try_end),
        (change_screen_return),
		]),

		("p_town_2",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_2"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_2"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_2", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_2", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_2"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_2"),
			# (disable_party, ":ship_no"),
		# (try_end),
        (change_screen_return),
		]),

		("p_castle_42",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_castle_42"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_castle_42"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_castle_42", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_castle_42", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_castle_42"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_6"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("p_town_27",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_27"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_27"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_27", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_27", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_27"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_12"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("p_town_13",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_13"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_13"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_13", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_13", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_13"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_13"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("p_town_15",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_15"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_15"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_15", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_15", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_15"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_15"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("p_town_32",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_32"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_32"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_32", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_32", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_32"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_19"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("p_town_33",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_33"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_33"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_33", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_33", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_33"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_19"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("p_town_37",
		[
			(store_faction_of_party, ":faction_1", "p_main_party"),
			(store_faction_of_party, ":faction_2", "p_town_37"),
			(store_relation, ":relation", ":faction_1", ":faction_2"),
			(ge, ":relation", 0),
			(str_store_party_name, s1, "p_town_37"),
		],
		"{s1}",
		[
		(party_get_slot, ":num_ships", "p_town_37", slot_town_has_ship),
		(val_add, ":num_ships", 1),
		(party_set_slot, "p_town_37", slot_town_has_ship, ":num_ships"),
		(assign, "$g_player_icon_state", pis_normal),
        (party_set_flags, "p_main_party", pf_is_ship, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
		(party_get_slot, ":ship_no", "p_main_party", slot_town_has_ship),
		(party_set_slot, ":ship_no", slot_ship_center, "p_town_37"),
		(party_set_slot, "p_main_party", slot_town_has_ship, 0),
		(disable_party, ":ship_no"),
		# (try_for_parties, ":ship_no"),
			# (party_slot_eq, ":ship_no", slot_ship_center, 250),
			# (party_set_slot, ":ship_no", slot_ship_center, "p_town_19"),
			# (disable_party, ":ship_no"),
		# (try_end),
		(change_screen_return),
		]),

		("abort",
		[],
		"Return to the ship",
		[(change_screen_return),
        ]),
	]),

  (
    "ship_reembark",0,
    "Do you wish to embark?",
    "none",
    [],
    [
      ("reembark_yes", [], "Yes.(Min crew 30, Max 90)",
       [(try_begin),
			(party_get_num_companions, reg6, "$g_encountered_party"),
			(party_get_num_companions, reg7, "p_main_party"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(assign, "$g_player_icon_state", pis_ship),
			(party_set_flags, "p_main_party", pf_is_ship, 1),
			(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 7),
			(party_set_position, "p_main_party", pos2),
			(party_set_slot, "$g_encountered_party", slot_ship_center, ship_player_sailing), #Player uses ship
			(party_set_slot, "p_main_party", slot_town_has_ship, "$g_encountered_party"),
			(disable_party, "$g_encountered_party"),
			(change_screen_return),
		(else_try),
			(display_message,"@Your crew exceeds the boundaries."),
		(try_end),
        ]),

		("manage_crew", [], "Manage the crew.",
       [	(change_screen_exchange_members,0),
	   ]),


      ("reembark_no", [], "No.",
       [(change_screen_return),
        ]),
    ]
  ),
  ###seafare duh cambios chief acaba
  (
    "center_reports",0,
    "Town Name: {s1}^Rent Income: {reg1} scillingas^Tariff Income: {reg2} scillingas^Food Stock: for {reg3} days",
    "none",
    [(party_get_slot, ":town_food_store", "$g_encountered_party", slot_party_food_store),
     (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
     (assign, ":food_consumption", reg0),
     (try_begin),
       (gt, ":food_consumption", 0),
       (store_div, reg3, ":town_food_store", ":food_consumption"),
     (else_try),
       (assign, reg3, 9999),
     (try_end),
     (str_store_party_name, s1, "$g_encountered_party"),
     (party_get_slot, reg1, "$g_encountered_party", slot_center_accumulated_rents),
     (party_get_slot, reg2, "$g_encountered_party", slot_center_accumulated_tariffs),
     ],
    [
      ("to_price_and_productions", [], "Show prices and productions.",
       [(jump_to_menu, "mnu_price_and_production"),
        ]),

      ("go_back_dot",[],"Go back.",
       [(try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
        ]),
    ]
  ),

  (
    "price_and_production",0,
    "Productions are:^(Note: base/modified by raw materials/modified by materials plus prosperity)^{s1}^^Price factors are:^{s2}",
    "none",
    [

	 (assign, ":calradian_average_urban_hardship", 0),
	 (assign, ":calradian_average_rural_hardship", 0),

	 (try_for_range, ":center", towns_begin, towns_end),
		(call_script, "script_center_get_goods_availability", ":center"),
		(val_add, ":calradian_average_urban_hardship", reg0),
	 (try_end),

	 (try_for_range, ":center", villages_begin, villages_end),
		(call_script, "script_center_get_goods_availability", ":center"),
		(val_add, ":calradian_average_rural_hardship", reg0),
	 (try_end),

     # MOTO replace hard-coded Calradian values chief
           # (val_div, ":calradian_average_rural_hardship", 110),
           # (val_div, ":calradian_average_urban_hardship", 22),
           (store_sub, reg0, villages_end, villages_begin),
           (val_div, ":calradian_average_rural_hardship", reg0),
           (store_sub, reg0, towns_end, towns_begin),
           (val_div, ":calradian_average_urban_hardship", reg0),
           # MOTO replace hard-coded Calradian values end


	 (call_script, "script_center_get_goods_availability", "$g_encountered_party"),

	 (assign, reg1, ":calradian_average_urban_hardship"),
	 (assign, reg2, ":calradian_average_rural_hardship"),

	 (try_begin),
		(ge, "$cheat_mode", 1),
		(str_store_string, s1, "str___hardship_index_reg0_avg_towns_reg1_avg_villages_reg2__"),
		(display_message, "@{!}DEBUG - {s1}"),
	 (try_end),


     (try_for_range, ":cur_good", trade_goods_begin, trade_goods_end),
	   (neq, ":cur_good", "itm_pork"), #tied to price of grain
	   (neq, ":cur_good", "itm_chicken"), #tied to price of grain
	   (neq, ":cur_good", "itm_butter"), #tied to price of cheese
	   (neq, ":cur_good", "itm_cattle_meat"),
	   (neq, ":cur_good", "itm_cabbages"), #possibly include later

	   (call_script, "script_center_get_production", "$g_encountered_party", ":cur_good"),
	   (assign, ":production", reg0),
	   (assign, ":base_production", reg2),
	   (assign, ":base_production_modded_by_raw_materials", reg1),

	   (call_script, "script_center_get_consumption", "$g_encountered_party", ":cur_good"),
	   (assign, ":consumer_consumption", reg2),
	   (assign, ":raw_material_consumption", reg1),
	   (assign, ":consumption", reg0),

       (store_sub, ":cur_good_price_slot", ":cur_good", trade_goods_begin),
       (val_add, ":cur_good_price_slot", slot_town_trade_good_prices_begin),
       (party_get_slot, ":price", "$g_encountered_party", ":cur_good_price_slot"),


	   (assign, ":total_centers", 0),
	   (assign, ":calradian_average_price", 0),
	   (assign, ":calradian_average_production", 0),
	   (assign, ":calradian_average_consumption", 0),


	   (try_for_range, ":center", centers_begin, centers_end),
		(neg|is_between, ":center", castles_begin, castles_end),
	    (val_add, ":total_centers", 1),
        (call_script, "script_center_get_production", ":center", ":cur_good"),
		(assign, ":center_production", reg2),
        (call_script, "script_center_get_consumption", ":center", ":cur_good"),
		(store_add, ":center_consumption", reg1, reg2),

        (party_get_slot, ":center_price", ":center", ":cur_good_price_slot"),
	    (val_add, ":calradian_average_price", ":center_price"),
	    (val_add, ":calradian_average_production", ":center_production"),
	    (val_add, ":calradian_average_consumption", ":center_consumption"),
	   (try_end),

	   (assign, ":calradian_total_production", ":calradian_average_production"),
	   (assign, ":calradian_total_consumption", ":calradian_average_consumption"),

	   (val_div, ":calradian_average_price", ":total_centers"),
	   (val_div, ":calradian_average_production", ":total_centers"),
	   (val_div, ":calradian_average_consumption", ":total_centers"),


       (str_store_item_name, s3, ":cur_good"),

       (assign, reg1, ":base_production"),
       (assign, reg2, ":base_production_modded_by_raw_materials"),
       (assign, reg3, ":production"),
       (assign, reg4, ":price"),

	   (assign, reg5, ":calradian_average_production"),
	   (assign, reg6, ":calradian_average_price"),

	   (assign, reg7, ":consumer_consumption"),
	   (assign, reg8, ":raw_material_consumption"),
	   (assign, reg9, ":consumption"),

	   (assign, reg10, ":calradian_average_consumption"),

	   (item_get_slot, ":production_slot", ":cur_good", slot_item_production_slot),
	   (party_get_slot, ":production_number", "$g_encountered_party", ":production_slot"),
	   (assign, reg11, ":production_number"),
	   (assign, reg12, ":calradian_total_production"),
	   (assign, reg13, ":calradian_total_consumption"),

	   (item_get_slot, ":production_string", ":cur_good", slot_item_production_string),
	   (str_store_string, s4, ":production_string"),

       (str_store_string, s1, "str___s3_price_=_reg4_calradian_average_reg6_capital_reg11_s4_base_reg1modified_by_raw_material_reg2modified_by_prosperity_reg3_calradian_average_production_base_reg5_total_reg12_consumed_reg7used_as_raw_material_reg8modified_total_reg9_calradian_consumption_base_reg10_total_reg13s1_"),



     (try_end),


     ],
    [
      ("go_back_dot",[],"Go back.",
       [(try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_village),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
        ]),
    ]
  ),

  (
    "town_trade",0,
    "You head towards the marketplace.",
    "none",
    [
######### JEDEDIAH chief Q START ######################################################
	(try_begin),
	(eq, "$jq_just_visited_CO", 1),
	(assign, "$jq_just_visited_CO", 0),
	(assign, ":merchant_troop", "$jq_current_shop"),
 	(change_screen_trade, ":merchant_troop"),
	(try_end),
######### JEDEDIAH Q END ########################################################
        ],
    [
      ("assess_prices",
       [
         (store_faction_of_party, ":current_town_faction", "$current_town"),
         (store_relation, ":reln", ":current_town_faction", "fac_player_supporters_faction"),
         (ge, ":reln", 0),
         ],
       "Assess the local prices.",
       [
           (jump_to_menu,"mnu_town_trade_assessment_begin"),
        ]),
# EGIII trophy trofeos chief
("trophies",[(this_or_next|player_has_item,"itm_trophy_a"),
(this_or_next|player_has_item,"itm_trophy_b"),
(player_has_item,"itm_trophy_c"),
],
       "Trade your battle trophies.",
       [
           (jump_to_menu,"mnu_trophy_trade"),
        ]),
########trofeos chief acaba
      ("trade_with_arms_merchant",[(party_slot_ge, "$current_town", slot_town_weaponsmith, 1)],
       "Trade with the arms merchant.",
       [
           (party_get_slot, ":merchant_troop", "$current_town", slot_town_weaponsmith),
############## JEDEDIAH Q START #################
	    (assign, "$jq_current_town", "$current_town"),
	    (assign, "$jq_current_shop", ":merchant_troop"),
############## JEDEDIAH Q END ###################
           (change_screen_trade, ":merchant_troop"),
        ]),
      ("trade_with_armor_merchant",[(party_slot_ge, "$current_town", slot_town_armorer, 1)],
       "Trade with the armor merchant.",
       [
           (party_get_slot, ":merchant_troop", "$current_town", slot_town_armorer),
############## JEDEDIAH Q START #################
	    (assign, "$jq_current_town", "$current_town"),
	    (assign, "$jq_current_shop", ":merchant_troop"),
############## JEDEDIAH Q END ###################
           (change_screen_trade, ":merchant_troop"),
        ]),
      ("trade_with_horse_merchant",[(party_slot_ge, "$current_town", slot_town_horse_merchant, 1)],
       "Trade with the horse merchant.",
       [
           (party_get_slot, ":merchant_troop", "$current_town", slot_town_horse_merchant),
############## JEDEDIAH Q START #################
	    (assign, "$jq_current_town", "$current_town"),
	    (assign, "$jq_current_shop", ":merchant_troop"),
############## JEDEDIAH Q END ###################
           (change_screen_trade, ":merchant_troop"),
        ]),
      ("trade_with_goods_merchant",[(party_slot_ge, "$current_town", slot_town_merchant, 1)],
       "Trade with the goods merchant.",
       [
           (party_get_slot, ":merchant_troop", "$current_town", slot_town_merchant),
############## JEDEDIAH Q START #################
	    (assign, "$jq_current_town", "$current_town"),
	    (assign, "$jq_current_shop", ":merchant_troop"),
############## JEDEDIAH Q END ###################
           (change_screen_trade, ":merchant_troop"),
        ]),

######### JEDEDIAH Q START ######################################################

 	("Companions_overview",[],"Companions overview.",
        [
	(assign, "$jq_in_market_menu", 1), # player is in market menu
	# Exit if no companions #
	(assign, ":heroes_in_party", 0),
	(try_for_range, reg3, companions_begin, companions_end),
   	(main_party_has_troop, reg3),
	(val_add, ":heroes_in_party", 1),
	 (try_end),
	    (try_begin),
	 	(eq, ":heroes_in_party", 0),
		(display_message,"@No companions in party!",0xFFFF0000),
	(else_try),
	(gt, "$jq_startpage", 1),
	(start_presentation, "prsnt_jq_extended_info"),
	(else_try),
	(start_presentation, "prsnt_jq_companions_quickview"),
     	(try_end),
	       	]),
######### JEDEDIAH Q END #############################################
      ("back_to_town_menu",[],"Head back.",
       [
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),

####################trofeos chief egIII
  ("trophy_trade",0,
    "You trade your battle trophies.",
    "none",
    [],
    [
("trade_trophy_a",[(player_has_item,"itm_trophy_a")],
       "Trade in your battle trophy.",
       [
(add_xp_to_troop,400,"trp_player"),
	(troop_remove_item,"trp_player","itm_trophy_a"),
                (call_script, "script_troop_add_gold", "trp_player", 500),
	   (jump_to_menu,"mnu_trophy_trade"),
        ]),
("trade_trophy_b",[(player_has_item,"itm_trophy_b")],
       "Trade in your war trophy.",
       [

	(add_xp_to_troop,800,"trp_player"),
	(call_script,"script_change_troop_renown", "trp_player" ,1),
	(troop_remove_item,"trp_player","itm_trophy_b"),
                (call_script, "script_troop_add_gold", "trp_player", 1000),
	   (jump_to_menu,"mnu_trophy_trade"),
        ]),
("trade_trophy_c",[(player_has_item,"itm_trophy_c")],
       "Trade in your epic trophy",
       [
	(add_xp_to_troop,1200,"trp_player"),
	(call_script,"script_change_troop_renown", "trp_player" ,3),
                (call_script, "script_troop_add_gold", "trp_player", 3000),
	(call_script,"script_change_player_honor",1),
	(troop_remove_item,"trp_player","itm_trophy_c"),
	   (jump_to_menu,"mnu_trophy_trade"),
        ]),

      ("back_to_town_menu",[],"Back.",
       [
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),
############################trofeos chief egIII acaba


  (
   "town_trade_assessment_begin",0,
   #"You overhear the following details about the roads out of town :^(experimental feature -- this may go into dialogs)^{s42}^You also overhear several discussions about the price of trade goods across the local area.^You listen closely, trying to work out the best deals around.",
   "You overhear several discussions about the price of trade goods across the local area.^You listen closely, trying to work out the best deals around.",
    "none",
    [
	(str_clear, s42),
##	(call_script, "script_merchant_road_info_to_s42", "$g_encountered_party"),

    ],

    [
      ("continue",[],"Continue...",
       [
           (assign,"$auto_enter_town", "$current_town"),
           (assign, "$g_town_assess_trade_goods_after_rest", 1),
           (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
           (val_div, reg0, 2),

           (store_sub, ":num_hours", 6, reg0),
           (assign, "$g_last_rest_center", "$current_town"),
           (assign, "$g_last_rest_payment_until", -1),
           (rest_for_hours, ":num_hours", 5, 0), #rest while not attackable
           (change_screen_return),
        ]),
      ("go_back_dot",[],"Go back.",
       [
           (jump_to_menu,"mnu_town_trade"),
        ]),
    ]
  ),

  (
    "town_trade_assessment",mnf_disable_all_keys,
    "As the party member with the highest trade skill ({reg2}), {reg3?you try to figure out:{s1} tries to figure out} the best goods to trade in. {s2}",
    "none",
    [

(call_script, "script_get_max_skill_of_player_party", "skl_trade"),
     (assign, ":max_skill", reg0),
     (assign, ":max_skill_owner", reg1),

     (assign, ":num_best_results", 0),
     (assign, ":best_result_1_item", -1),
     (assign, ":best_result_1_town", -1),
     (assign, ":best_result_1_profit", 0),
     (assign, ":best_result_2_item", -1),
     (assign, ":best_result_2_town", -1),
     (assign, ":best_result_2_profit", 0),
     (assign, ":best_result_3_item", -1),
     (assign, ":best_result_3_town", -1),
     (assign, ":best_result_3_profit", 0),
     (assign, ":best_result_4_item", -1),
     (assign, ":best_result_4_town", -1),
     (assign, ":best_result_4_profit", 0),
     (assign, ":best_result_5_item", -1),
     (assign, ":best_result_5_town", -1),
     (assign, ":best_result_5_profit", 0),

     (store_sub, ":num_towns", walled_centers_end, walled_centers_begin),
     (store_sub, ":num_goods", trade_goods_end, trade_goods_begin),
     (store_mul, ":max_iteration", ":num_towns", ":num_goods"),
     (val_mul, ":max_iteration", ":max_skill"),
     (val_div, ":max_iteration", 20),

     (assign, ":org_encountered_party", "$g_encountered_party"),

     (try_for_range, ":unused", 0, ":max_iteration"),
       (store_random_in_range, ":random_trade_good", trade_goods_begin, trade_goods_end),

       (store_random_in_range, ":random_town", towns_begin, towns_end),

       (party_get_slot, ":cur_merchant", ":org_encountered_party", slot_town_merchant),
	   (assign, ":num_items_in_town_inventory", 0),
       (try_for_range, ":i_slot", num_equipment_kinds, max_inventory_items + num_equipment_kinds),
         (troop_get_inventory_slot, ":slot_item", ":cur_merchant", ":i_slot"),
         (try_begin),
           (eq, ":slot_item", ":random_trade_good"),
		   (val_add, ":num_items_in_town_inventory", 1),
         (try_end),
       (try_end),

       (ge, ":num_items_in_town_inventory", 1),

       (assign, ":already_best", 0),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_1_item"),
         (eq, ":random_town", ":best_result_1_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_2_item"),
         (eq, ":random_town", ":best_result_2_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_3_item"),
         (eq, ":random_town", ":best_result_3_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_4_item"),
         (eq, ":random_town", ":best_result_4_town"),
         (val_add, ":already_best", 1),
       (try_end),

	   (try_begin),
         (eq, ":random_trade_good", ":best_result_5_item"),
         (eq, ":random_town", ":best_result_5_town"),
         (val_add, ":already_best", 1),
       (try_end),

       (le, ":already_best", 1),

       (store_item_value, ":random_trade_good_price", ":random_trade_good"),
       (assign, "$g_encountered_party", ":org_encountered_party"),
       (call_script, "script_game_get_item_buy_price_factor", ":random_trade_good"),
       (store_mul, ":random_trade_good_buy_price", ":random_trade_good_price", reg0),
       (val_div, ":random_trade_good_buy_price", 100),
       (val_max, ":random_trade_good_buy_price", 1),
       (assign, "$g_encountered_party", ":random_town"),
       (call_script, "script_game_get_item_sell_price_factor", ":random_trade_good"),
       (store_mul, ":random_trade_good_sell_price", ":random_trade_good_price", reg0),
       (val_div, ":random_trade_good_sell_price", 100),
       (val_max, ":random_trade_good_sell_price", 1),
       (store_sub, ":difference", ":random_trade_good_sell_price", ":random_trade_good_buy_price"),

       (try_begin),
	     (this_or_next|eq, ":best_result_1_item", ":random_trade_good"),
		 (this_or_next|eq, ":best_result_2_item", ":random_trade_good"),
		 (this_or_next|eq, ":best_result_3_item", ":random_trade_good"),
		 (this_or_next|eq, ":best_result_4_item", ":random_trade_good"),
		 (eq, ":best_result_5_item", ":random_trade_good"),

         (try_begin),
		   (eq, ":best_result_1_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_1_profit"),
           (assign, ":best_result_1_item", ":random_trade_good"),
           (assign, ":best_result_1_town", ":random_town"),
           (assign, ":best_result_1_profit", ":difference"),
         (else_try),
		   (eq, ":best_result_2_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_2_profit"),
           (assign, ":best_result_2_item", ":random_trade_good"),
           (assign, ":best_result_2_town", ":random_town"),
           (assign, ":best_result_2_profit", ":difference"),
		 (else_try),
		   (eq, ":best_result_3_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_3_profit"),
           (assign, ":best_result_3_item", ":random_trade_good"),
           (assign, ":best_result_3_town", ":random_town"),
           (assign, ":best_result_3_profit", ":difference"),
		 (else_try),
		   (eq, ":best_result_4_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":random_trade_good"),
           (assign, ":best_result_4_town", ":random_town"),
           (assign, ":best_result_4_profit", ":difference"),
		 (else_try),
		   (eq, ":best_result_5_item", ":random_trade_good"),
		   (gt, ":difference", ":best_result_5_profit"),
           (assign, ":best_result_5_item", ":random_trade_good"),
           (assign, ":best_result_5_town", ":random_town"),
           (assign, ":best_result_5_profit", ":difference"),
		 (try_end),
	   (else_try),
         (try_begin),
           (gt, ":difference", ":best_result_1_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":best_result_3_item"),
           (assign, ":best_result_4_town", ":best_result_3_town"),
           (assign, ":best_result_4_profit", ":best_result_3_profit"),
           (assign, ":best_result_3_item", ":best_result_2_item"),
           (assign, ":best_result_3_town", ":best_result_2_town"),
           (assign, ":best_result_3_profit", ":best_result_2_profit"),
           (assign, ":best_result_2_item", ":best_result_1_item"),
           (assign, ":best_result_2_town", ":best_result_1_town"),
           (assign, ":best_result_2_profit", ":best_result_1_profit"),
           (assign, ":best_result_1_item", ":random_trade_good"),
           (assign, ":best_result_1_town", ":random_town"),
           (assign, ":best_result_1_profit", ":difference"),
         (else_try),
           (gt, ":difference", ":best_result_2_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":best_result_3_item"),
           (assign, ":best_result_4_town", ":best_result_3_town"),
           (assign, ":best_result_4_profit", ":best_result_3_profit"),
           (assign, ":best_result_3_item", ":best_result_2_item"),
           (assign, ":best_result_3_town", ":best_result_2_town"),
           (assign, ":best_result_3_profit", ":best_result_2_profit"),
           (assign, ":best_result_2_item", ":random_trade_good"),
           (assign, ":best_result_2_town", ":random_town"),
           (assign, ":best_result_2_profit", ":difference"),
         (else_try),
           (gt, ":difference", ":best_result_3_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":best_result_3_item"),
           (assign, ":best_result_4_town", ":best_result_3_town"),
           (assign, ":best_result_4_profit", ":best_result_3_profit"),
           (assign, ":best_result_3_item", ":random_trade_good"),
           (assign, ":best_result_3_town", ":random_town"),
           (assign, ":best_result_3_profit", ":difference"),
         (else_try),
           (gt, ":difference", ":best_result_4_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
           (assign, ":best_result_4_item", ":random_trade_good"),
           (assign, ":best_result_4_town", ":random_town"),
           (assign, ":best_result_4_profit", ":difference"),
         (else_try),
           (gt, ":difference", ":best_result_5_profit"),
           (val_add, ":num_best_results", 1),
           (val_min, ":num_best_results", 5),
           (assign, ":best_result_5_item", ":best_result_4_item"),
           (assign, ":best_result_5_town", ":best_result_4_town"),
           (assign, ":best_result_5_profit", ":best_result_4_profit"),
         (try_end),
	   (try_end),
     (try_end),

     (assign, "$g_encountered_party", ":org_encountered_party"),

     (str_clear, s3),

     (assign, reg2, ":max_skill"),
     (try_begin),
       (eq, ":max_skill_owner", "trp_player"),
       (assign, reg3, 1),
     (else_try),
       (assign, reg3, 0),
       (str_store_troop_name, s1, ":max_skill_owner"),
     (try_end),
     (try_begin),
       (le, ":num_best_results", 0),
       (str_store_string, s2, "@However, {reg3?You are:{s1} is} unable to find any trade goods that would bring a profit."),
     (else_try),
       (try_begin),
         (ge, ":best_result_5_item", 0),
         (assign, reg6, ":best_result_5_profit"),
         (str_store_item_name, s4, ":best_result_5_item"),
         (str_store_party_name, s5, ":best_result_5_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} scillingas per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_4_item", 0),
         (assign, reg6, ":best_result_4_profit"),
         (str_store_item_name, s4, ":best_result_4_item"),
         (str_store_party_name, s5, ":best_result_4_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} scillingas per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_3_item", 0),
         (assign, reg6, ":best_result_3_profit"),
         (str_store_item_name, s4, ":best_result_3_item"),
         (str_store_party_name, s5, ":best_result_3_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} scillingas per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_2_item", 0),
         (assign, reg6, ":best_result_2_profit"),
         (str_store_item_name, s4, ":best_result_2_item"),
         (str_store_party_name, s5, ":best_result_2_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} scillingas per item.{s3}"),
       (try_end),
       (try_begin),
         (ge, ":best_result_1_item", 0),
         (assign, reg6, ":best_result_1_profit"),
         (str_store_item_name, s4, ":best_result_1_item"),
         (str_store_party_name, s5, ":best_result_1_town"),
         (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} scillingas per item.{s3}"),
       (try_end),
       (str_store_string, s2, "@{reg3?You find:{s1} finds} out the following:^{s3}"),
     (try_end),
     ],
    [
      ("continue",[],"Continue...",
       [
           (jump_to_menu,"mnu_town_trade"),
        ]),
    ]
  ),


  (
    "sneak_into_town_suceeded",0,
    "Disguised in the garments of a poor pilgrim, you fool the guards and make your way into the town.",
    "none",
    [],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$sneaked_into_town",1),
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),
  (
    "sneak_into_town_caught",0,
    "As you try to sneak in, one of the guards recognizes you and raises the alarm!\
 You must flee back through the gates before all the guards in the town come down on you!",
    "none",
    [
       (assign,"$auto_menu","mnu_captivity_start_castle_surrender"),
    ],
    [
      ("sneak_caught_fight",[],"Try to fight your way out!",
       [
           (assign,"$all_doors_locked",1),
           (party_get_slot, ":sneak_scene", "$current_town", slot_town_center), # slot_town_gate),
           (modify_visitors_at_site,":sneak_scene"),
           (reset_visitors),

           (try_begin),
             (this_or_next|eq, "$talk_context", tc_escape),
             (eq, "$talk_context", tc_prison_break),
             (set_jump_entry, 7),
           (else_try),
             (party_slot_eq, "$current_town", slot_party_type, spt_town),
             #(set_visitor,0,"trp_player"),
             (set_jump_entry, 0),
           (else_try),
             #(set_visitor,1,"trp_player"),
             (set_jump_entry, 1),
           (try_end),

           #(store_faction_of_party, ":town_faction","$current_town"),
           #(faction_get_slot, ":tier_2_troop", ":town_faction", slot_faction_tier_2_troop),
           #(faction_get_slot, ":tier_3_troop", ":town_faction", slot_faction_tier_3_troop),
           #(try_begin),
           #  (gt, ":tier_2_troop", 0),
           #  (gt, ":tier_3_troop", 0),
           #  (assign,reg0,":tier_3_troop"),
           #  (assign,reg1,":tier_3_troop"),
           #  (assign,reg2,":tier_2_troop"),
           #  (assign,reg3,":tier_2_troop"),
           #(else_try),
           #  (assign,reg0,"trp_swadian_skirmisher"),
           #  (assign,reg1,"trp_swadian_crossbowman"),
           #  (assign,reg2,"trp_swadian_infantry"),
           #  (assign,reg3,"trp_swadian_crossbowman"),
           #(try_end),
           #(assign,reg4,-1),
           #(shuffle_range,0,5),
           #(set_visitor,2,reg0),
           #(set_visitor,3,reg1),
           #(set_visitor,4,reg2),
           #(set_visitor,5,reg3),

           (set_jump_mission,"mt_sneak_caught_fight"),
           (set_passage_menu,"mnu_town"),
           (jump_to_scene,":sneak_scene"),
           (change_screen_mission),
        ]),
      ("sneak_caught_surrender",[],"Surrender.",
       [
           (jump_to_menu,"mnu_captivity_start_castle_surrender"),
        ]),
    ]
  ),
  (
    "sneak_into_town_caught_dispersed_guards",0,
    "You drive off the guards and cover your trail before running off, easily losing your pursuers in the maze of streets.",
    "none",
    [],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$sneaked_into_town",1),
           (assign, "$town_entered", 1),
           (jump_to_menu,"mnu_town"),
        ]),
    ]
  ),

  (
    "sneak_into_town_caught_ran_away",0,
    "You make your way back through the gates and quickly retreat to the safety of the countryside.{s11}",
    "none",
    [

	(str_clear, s11),
	(assign, ":at_least_one_escaper_caught", 0),

	(assign, ":end_cond", kingdom_ladies_end),
	(try_for_range, ":prisoner", active_npcs_begin, ":end_cond"),
	  (try_begin),
		(troop_slot_eq, ":prisoner", slot_troop_mission_participation, mp_prison_break_escaped),
        (assign, "$talk_context", tc_hero_freed),
        (assign, reg14, ":prisoner"),
        (call_script, "script_setup_troop_meeting", ":prisoner", -1),
        (troop_set_slot, ":prisoner", slot_troop_mission_participation, -1),

        (troop_get_slot, ":prison_center", ":prisoner", slot_troop_prisoner_of_party),
        (party_remove_prisoners, ":prison_center", ":prisoner", 1),
        (troop_set_slot, ":prisoner", slot_troop_prisoner_of_party, -1),

        (assign, ":end_cond", -1),
	  (else_try),
		(troop_slot_eq, ":prisoner", slot_troop_mission_participation, mp_prison_break_caught),
		(str_store_troop_name, s12, ":prisoner"),
		(try_begin),
			(eq, ":at_least_one_escaper_caught", 0),
			(str_store_string, s11, "str_s11_unfortunately_s12_was_wounded_and_had_to_be_left_behind"),
		(else_try),
			(str_store_string, s11, "str_s11_also_s12_was_wounded_and_had_to_be_left_behind"),
		(try_end),
		(assign, ":at_least_one_escaper_caught", 1),
	  (try_end),

	  (troop_set_slot, ":prisoner", slot_troop_mission_participation, 0), #new
	(try_end),
	],
    [
      ("continue",[],"Continue...",
       [
           (assign,"$auto_menu",-1),
           (store_encountered_party,"$last_sneak_attempt_town"),
           (store_current_hours,"$last_sneak_attempt_time"),
           (change_screen_return),
        ]),
    ]
  ),


  (
    "enemy_offer_ransom_for_prisoner",0,
    "{s2} offers you a sum of {reg12} scillingas in silver if you are willing to sell him {s1} ({s3}).", #fire arrow cambia chief
    "none",
    [(call_script, "script_calculate_ransom_amount_for_troop", "$g_ransom_offer_troop"),
     (assign, reg12, reg0),
     (str_store_troop_name, s1, "$g_ransom_offer_troop"),
     (store_troop_faction, ":faction_no", "$g_ransom_offer_troop"),
     (str_store_faction_name, s2, ":faction_no"),
     (str_store_party_name, s3, "$g_ransom_offer_party"), #fire arrow chief
     ],
    [
      ("ransom_accept",[],"Accept the offer.",
       [ ##diplomacy chief begin
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (call_script, "script_dplmc_pay_into_treasury", reg12),
        (else_try),
        ##diplomacy end
          (troop_add_gold, "trp_player", reg12),
        ##diplomacy chief begin
        (try_end),
        ##diplomacy end
        (party_remove_prisoners, "$g_ransom_offer_party", "$g_ransom_offer_troop", 1),
        #(troop_set_slot, "$g_ransom_offer_troop", slot_troop_is_prisoner, 0),
        (call_script, "script_remove_troop_from_prison", "$g_ransom_offer_troop"),
          (try_begin),
            (troop_get_type, ":is_female", "trp_player"),
            (eq, ":is_female", 1),

            (get_achievement_stat, ":number_of_lords_sold", ACHIEVEMENT_MAN_HANDLER, 0),
            (val_add, ":number_of_lords_sold", 1),
            (set_achievement_stat, ACHIEVEMENT_MAN_HANDLER, 0, ":number_of_lords_sold"),

            (eq, ":number_of_lords_sold", 3),
            (unlock_achievement, ACHIEVEMENT_MAN_HANDLER),
        (try_end),
      (change_screen_return),
        ]),
      ("ransom_reject",[],"Reject the offer.",
       [
        (call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -4),
        (call_script, "script_change_player_honor", -1),
        (assign, "$g_ransom_offer_rejected", 1),
        (change_screen_return),
        ]),
    ]
  ),

  (
    "training_ground",0,
    "You approach a training field where you can practice your martial skills. What kind of training do you want to do?",
    "none",
    [
      (store_add, "$g_training_ground_melee_training_scene", "scn_training_ground_ranged_melee_1", "$g_encountered_party"),
      (val_sub, "$g_training_ground_melee_training_scene", training_grounds_begin),
      (try_begin),
        (ge, "$g_training_ground_training_count", 3),
        (assign, "$g_training_ground_training_count", 0),
        (rest_for_hours, 1, 5, 1), #rest while attackable
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      (try_end),
      ],
    [
      ("camp_trainer",
       [], "Speak with the trainer.",
       [
         (set_jump_mission, "mt_training_ground_trainer_talk"),
         (modify_visitors_at_site, "$g_training_ground_melee_training_scene"),
         (reset_visitors),
         (set_jump_entry, 5),
         (jump_to_scene, "$g_training_ground_melee_training_scene"),
         (change_screen_mission),
         (music_set_situation, 0),
         ]),
      ("camp_train_melee",
       [
         (neg|troop_is_wounded, "trp_player"),
         (call_script, "script_party_count_fit_for_battle", "p_main_party"),
         (gt, reg0, 1),
         ], "Sparring practice.",
       [
         (assign, "$g_mt_mode", ctm_melee),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_1"),
         (music_set_situation, 0),
         ]),
      ("camp_train_archery",[], "Ranged weapon practice.",
       [
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_1"),
         (music_set_situation, 0),
         ]),
      ("camp_train_mounted",[], "Horseback practice.",
       [
         (assign, "$g_mt_mode", ctm_mounted),
         (jump_to_menu, "mnu_training_ground_selection_details_mounted"),
         (music_set_situation, 0),
         ]),

      ("go_to_track",[(eq, "$cheat_mode", 1)],"{!}Cheat: Go to track.",
       [
         (set_jump_mission, "mt_ai_training"),
         (store_add, ":scene_no", "scn_training_ground_horse_track_1", "$g_encountered_party"),
         (val_sub, ":scene_no", training_grounds_begin),
         (jump_to_scene, ":scene_no"),
         (change_screen_mission),
        ]
       ),
      ("go_to_range",[(eq, "$cheat_mode", 1)],"{!}Cheat: Go to range.",
       [
         (set_jump_mission, "mt_ai_training"),
         (jump_to_scene, "$g_training_ground_melee_training_scene"),
         (change_screen_mission),
        ]
       ),
      ("leave",[],"Leave.",
       [(change_screen_return),
        ]),
    ]
  ),

  ("training_ground_selection_details_melee_1",0,
   "How many opponents will you go against?",
   "none",
   [
     (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
     (troop_get_slot, "$temp", "trp_stack_selection_amounts", 1), #number of men fit
     (assign, "$temp_2", 1),
     ],
    [
      ("camp_train_melee_num_men_1",[(ge, "$temp", 1)], "One.",
       [
         (assign, "$temp", 1),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("camp_train_melee_num_men_2",[(ge, "$temp", 2)], "Two.",
       [
         (assign, "$temp", 2),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("camp_train_melee_num_men_3",[(ge, "$temp", 3)], "Three.",
       [
         (assign, "$temp", 3),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("camp_train_melee_num_men_4",[(ge, "$temp", 4)], "Four.",
       [
         (assign, "$temp", 4),
         (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
         ]),
      ("go_back_dot",[],"Cancel.",
       [
         (jump_to_menu, "mnu_training_ground"),
        ]),
      ]
  ),

  ("training_ground_selection_details_melee_2",0,
   "Choose your opponent #{reg1}:",
   "none",
   [
     (assign, reg1, "$temp_2"),
     (troop_get_slot, "$temp_3", "trp_stack_selection_amounts", 0), #number of slots
     ],
    [
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 1),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 1),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 2),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 2),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 3),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 3),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 4),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 4),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 5),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 5),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 6),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 6),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 7),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 7),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 8),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 8),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 9),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 9),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 10),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 10),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 11),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 11),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 12),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 12),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 13),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 13),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 14),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 14),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 15),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 15),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 16),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 16),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 17),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 17),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 18),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 18),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 19),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 19),]),
      ("s0", [(call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 20),], "{s0}",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", 20),]),
      ("training_ground_selection_details_melee_random", [], "Choose randomly.",
       [(call_script, "script_training_ground_sub_routine_2_for_melee_details", -1),]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),


  ("training_ground_selection_details_mounted",0,
   "What kind of weapon do you want to train with?",
   "none",
   [],
    [
      ("camp_train_mounted_details_1",[], "One handed weapon.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_one_handed_wpn, 0),
         ]),
      ("camp_train_mounted_details_2",[], "Polearm.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_polearm, 0),
         ]),
      ("camp_train_mounted_details_3",[], "Bow.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_bow, 0),
         ]),
      ("camp_train_mounted_details_4",[], "Thrown weapon.",
       [
         (call_script, "script_start_training_at_training_ground", itp_type_thrown, 0),
         ]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),


  ("training_ground_selection_details_ranged_1",0,
   "What kind of ranged weapon do you want to train with?",
   "none",
   [],
    [
      ("camp_train_ranged_weapon_bow",[], "Bow and arrows.",
       [
         (assign, "$g_mt_mode", ctm_ranged),
         (assign, "$temp", itp_type_bow),
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
         ]),
      ("camp_train_ranged_weapon_crossbow",[], "Javelins.", #chief cambia para practicas
       [
         (assign, "$g_mt_mode", ctm_ranged),
         (assign, "$temp", itp_type_crossbow),
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
         ]),
      ("camp_train_ranged_weapon_thrown",[], "Throwing Knives.",
       [
         (assign, "$g_mt_mode", ctm_ranged),
         (assign, "$temp", itp_type_thrown),
         (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
         ]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),


  ("training_ground_selection_details_ranged_2",0,
   "What range do you want to practice at?",
   "none",
   [],
    [
      ("camp_train_ranged_details_1",[], "10 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 10),
         ]),
      ("camp_train_ranged_details_2",[], "20 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 20),
         ]),
      ("camp_train_ranged_details_3",[], "30 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 30),
         ]),
      ("camp_train_ranged_details_4",[], "40 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 40),
         ]),
      ("camp_train_ranged_details_5",[(eq, "$g_mt_mode", ctm_ranged),], "50 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 50),
         ]),
      ("camp_train_ranged_details_6",[(eq, "$g_mt_mode", ctm_ranged),], "60 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 60),
         ]),
      ("camp_train_ranged_details_7",[(eq, "$g_mt_mode", ctm_ranged),], "70 yards.",
       [
         (call_script, "script_start_training_at_training_ground", "$temp", 70),
         ]),
      ("go_back_dot",[],"Go back.",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
  ),


  ("training_ground_description",0,
   "{s0}",
   "none",
   [],
    [
      ("continue", [], "Continue...",
       [
         (jump_to_scene, "$g_training_ground_training_scene"),
         (change_screen_mission),
        ]
       ),
      ]
  ),

  ("training_ground_training_result",mnf_disable_all_keys,
   "{s7}{s2}",
   "none",
   [
     (store_skill_level, ":trainer_skill", "skl_trainer", "trp_player"),
     (store_add, ":trainer_skill_multiplier", 5, ":trainer_skill"),
     (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
     (str_clear, s2),
     (troop_get_slot, ":num_fit", "trp_stack_selection_amounts", 1),
     (troop_get_slot, ":num_slots", "trp_stack_selection_amounts", 0),
     (try_begin),
       (gt, "$g_training_ground_training_success_ratio", 0),
       (store_mul, ":xp_ratio_to_add", "$g_training_ground_training_success_ratio", "$g_training_ground_training_success_ratio"),
       (try_begin),
         (eq, "$g_training_ground_training_success_ratio", 100),
         (val_mul, ":xp_ratio_to_add", 2), #2x when perfect
       (try_end),
       (try_begin),
         (eq, "$g_mt_mode", ctm_melee),
         (val_div, ":xp_ratio_to_add", 2),
       (try_end),
       (val_div, ":xp_ratio_to_add", 10), # value over 1000
       (try_begin),
         (gt, ":num_fit", 8),
         (val_mul, ":xp_ratio_to_add", 3),
         (assign, ":divisor", ":num_fit"),
         (convert_to_fixed_point, ":divisor"),
         (store_sqrt, ":divisor", ":divisor"),
         (convert_to_fixed_point, ":xp_ratio_to_add"),
         (val_div, ":xp_ratio_to_add", ":divisor"),
       (try_end),
##       (assign, reg0, ":xp_ratio_to_add"),
##       (display_message, "@xp earn ratio: {reg0}/1000"),
       (store_mul, ":xp_ratio_to_add_with_trainer_skill", ":xp_ratio_to_add", ":trainer_skill_multiplier"),
       (val_div, ":xp_ratio_to_add_with_trainer_skill", 10),
       (party_get_num_companion_stacks, ":num_stacks", "p_main_party"),
       (store_add, ":end_cond", ":num_slots", 2),
       (try_for_range, ":i_slot", 2, ":end_cond"),
         (troop_get_slot, ":amount", "trp_stack_selection_amounts", ":i_slot"),
         (troop_get_slot, ":troop_id", "trp_stack_selection_ids", ":i_slot"),
         (assign, ":end_cond_2", ":num_stacks"),
         (try_for_range, ":stack_no", 0, ":end_cond_2"),
           (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":stack_no"),
           (eq, ":stack_troop", ":troop_id"),
           (assign, ":end_cond_2", 0), #break
           (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":troop_id", ":stack_no", ":amount", ":xp_ratio_to_add_with_trainer_skill"),
           (str_store_troop_name_by_count, s1, ":troop_id", ":amount"),
           (assign, reg1, ":amount"),
           (str_store_string, s2, "@{s2}^{reg1} {s1} earned {reg0} experience."),
         (try_end),
       (try_end),
       (try_begin),
         (eq, "$g_mt_mode", ctm_melee),
         (store_mul, ":special_xp_ratio_to_add", ":xp_ratio_to_add", 3),
         (val_div, ":special_xp_ratio_to_add", 2),
         (try_for_range, ":enemy_index", 0, "$g_training_ground_training_num_enemies"),
           (troop_get_slot, ":troop_id", "trp_temp_array_a", ":enemy_index"),
           (assign, ":end_cond_2", ":num_stacks"),
           (try_for_range, ":stack_no", 0, ":end_cond_2"),
             (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":stack_no"),
             (eq, ":stack_troop", ":troop_id"),
             (assign, ":end_cond_2", 0), #break
             (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":troop_id", ":stack_no", 1, ":special_xp_ratio_to_add"),
             (str_store_troop_name, s1, ":troop_id"),
             (str_store_string, s2, "@{s2}^{s1} earned an additional {reg0} experience."),
           (try_end),
         (try_end),
       (try_end),
       (try_begin),
         (call_script, "script_cf_training_ground_sub_routine_for_training_result", "trp_player", -1, 1, ":xp_ratio_to_add"),
         (str_store_string, s2, "@^You earned {reg0} experience.{s2}"),
       (try_end),
     (try_end),
     (try_begin),
       (eq, "$g_training_ground_training_success_ratio", 0),
       (str_store_string, s7, "@The training didn't go well at all."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 25),
       (str_store_string, s7, "@The training didn't go well at all."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 50),
       (str_store_string, s7, "@The training didn't go very well."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 75),
       (str_store_string, s7, "@The training went quite well."),
     (else_try),
       (lt, "$g_training_ground_training_success_ratio", 99),

       (str_store_string, s7, "@The training went very well."),
     (else_try),
       (str_store_string, s7, "@The training went perfectly."),
     (try_end),

     ],
    [
      ("continue",[],"Continue...",
       [(jump_to_menu, "mnu_training_ground"),
        ]
       ),
      ]
   ),

##  ("marshall_selection_candidate_ask",0,
##   "{s15} will soon select a new marshall for {s23}. Some of the lords have suggested your name as a likely candidate.",
##   "none",
##   [
##     (try_begin),
##       (eq, "$g_presentation_marshall_selection_ended", 1),
##       (change_screen_return),
##     (try_end),
##     (faction_get_slot, ":king", "$players_kingdom", slot_faction_leader),
##     (str_store_troop_name, s15, ":king"),
##     (str_store_faction_name, s23, "$players_kingdom"),
##     ],
##    [
##      ("marshall_candidate_accept", [], "Let {s15} learn that you are willing to serve as marshall.",
##       [
##         (start_presentation, "prsnt_marshall_selection"),
##        ]
##       ),
##      ("marshall_candidate_reject", [], "Tell everyone that you are too busy these days.",
##       [
##         (try_begin),
##           (eq, "$g_presentation_marshall_selection_max_renown_2_troop", "trp_player"),
##           (assign, "$g_presentation_marshall_selection_max_renown_2", "$g_presentation_marshall_selection_max_renown_3"),
##           (assign, "$g_presentation_marshall_selection_max_renown_2_troop", "$g_presentation_marshall_selection_max_renown_3_troop"),
##         (else_try),
##           (assign, "$g_presentation_marshall_selection_max_renown_1", "$g_presentation_marshall_selection_max_renown_2"),
##           (assign, "$g_presentation_marshall_selection_max_renown_1_troop", "$g_presentation_marshall_selection_max_renown_2_troop"),
##           (assign, "$g_presentation_marshall_selection_max_renown_2", "$g_presentation_marshall_selection_max_renown_3"),
##           (assign, "$g_presentation_marshall_selection_max_renown_2_troop", "$g_presentation_marshall_selection_max_renown_3_troop"),
##         (try_end),
##         (start_presentation, "prsnt_marshall_selection"),
##        ]
##       ),
##      ]
##  ),




##    [
##      ("renew_oath",[],"Renew your oath to {s1} for another month.",[
##          (store_current_day, ":cur_day"),
##          (store_add, "$g_oath_end_day", ":cur_day", 30),
##          (change_screen_return)]),
##      ("dont_renew_oath",[],"Become free of your bond.",[
##          (assign, "$players_kingdom",0),
##          (assign, "$g_player_permitted_castles", 0),
##          (change_screen_return)]),
##    ]
##  ),


#####################################################################
## Captivity....
#####################################################################
#####################################################################
#####################################################################
#####################################################################
  (
    "captivity_avoid_wilderness",0,
    "Suddenly all the world goes black around you.\
 Many hours later you regain your conciousness and find yourself at the spot you fell.\
 Your enemies must have taken you up for dead and left you there.\
 However, it seems that none of your wound were lethal,\
 and altough you feel awful, you find out that can still walk.\
 You get up and try to look for any other survivors from your party.",
    "none",
    [
      ],
    []
  ),

  (
    "captivity_start_wilderness",0,
    "Stub",
    "none",
    [
          (assign, "$g_player_is_captive", 1),
          (try_begin),
            (eq,"$g_player_surrenders",1),
            (jump_to_menu, "mnu_captivity_start_wilderness_surrender"),
          (else_try),
            (jump_to_menu, "mnu_captivity_start_wilderness_defeat"),
          (try_end),
      ],
    []
  ),

  (
    "captivity_start_wilderness_surrender",0,
    "Stub",
    "none",
    [
       (assign, "$g_player_is_captive", 1),
       (assign,"$auto_menu",-1), #We need this since we may come here by something other than auto_menu
       (assign, "$capturer_party", "$g_encountered_party"),
       (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
      ],
    []
  ),
  (
    "captivity_start_wilderness_defeat",0,
    "Your enemies take you prisoner.",
    "none",
    [
       (assign, "$g_player_is_captive", 1),
       (assign,"$auto_menu",-1),
       (assign, "$capturer_party", "$g_encountered_party"),

       (try_begin),
         (party_stack_get_troop_id, ":party_leader", "$g_encountered_party", 0),
         (is_between, ":party_leader", active_npcs_begin, active_npcs_end),
         (troop_slot_eq, ":party_leader", slot_troop_occupation, slto_kingdom_hero),
         (store_sub, ":kingdom_hero_id", ":party_leader", active_npcs_begin),
         (set_achievement_stat, ACHIEVEMENT_BARON_GOT_BACK, ":kingdom_hero_id", 1),
       (try_end),

       (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
    ],
    []
  ),
  (
    "captivity_start_castle_surrender",0,
    "Stub",
    "none",
    [
       (assign, "$g_player_is_captive", 1),
       (assign,"$auto_menu",-1),
       (assign, "$capturer_party", "$g_encountered_party"),
       (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
      ],
    []
  ),
  (
    "captivity_start_castle_defeat",0,
    "Stub",
    "none",
    [
       (assign, "$g_player_is_captive", 1),
       (assign,"$auto_menu",-1),
       (assign, "$capturer_party", "$g_encountered_party"),
       (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
      ],
    []
  ),
  (
    "captivity_start_under_siege_defeat",0,
    "Your enemies take you prisoner.",
    "none",
    [
       (assign, "$g_player_is_captive", 1),
       (assign,"$auto_menu",-1),
       (assign, "$capturer_party", "$g_encountered_party"),
       (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ],
    []
  ),

  (
    "captivity_wilderness_taken_prisoner",0,
    "Your enemies take you prisoner.",
    "none",
    [
        (set_background_mesh, "mesh_pic_prisoner_wilderness1"),
     ],
    [
      ("continue",[],"Continue...",
       [
	     # Explanation of removing below code : heros are already being removed with 50% (was 75%, I decreased it) probability in mnu_total_defeat, why here there is additionally 30% removing of heros?
		 # See codes linked to "mnu_captivity_start_wilderness_surrender" and "mnu_captivity_start_wilderness_defeat" which is connected with here they all also enter
		 # "mnu_total_defeat" and inside the "mnu_total_defeat" there is script_party_remove_all_companions which removes 50% (was 75%, I decreased it) of compainons from player party.

         #(try_for_range, ":npc", companions_begin, companions_end),
         #  (main_party_has_troop, ":npc"),
         #  (store_random_in_range, ":rand", 0, 100),
         #  (lt, ":rand", 30),
         #  (remove_member_from_party, ":npc", "p_main_party"),
         #  (troop_set_slot, ":npc", slot_troop_occupation, 0),
         #  (troop_set_slot, ":npc", slot_troop_playerparty_history, pp_history_scattered),
         #  (assign, "$last_lost_companion", ":npc"),
         #  (store_faction_of_party, ":victorious_faction", "$g_encountered_party"),
         #  (troop_set_slot, ":npc", slot_troop_playerparty_history_string, ":victorious_faction"),
         #  (troop_set_health, ":npc", 100),
         #  (store_random_in_range, ":rand_town", towns_begin, towns_end),
         #  (troop_set_slot, ":npc", slot_troop_cur_center, ":rand_town"),
         #  (assign, ":nearest_town_dist", 1000),
         #  (try_for_range, ":town_no", towns_begin, towns_end),
         #    (store_faction_of_party, ":town_fac", ":town_no"),
         #    (store_relation, ":reln", ":town_fac", "fac_player_faction"),
         #    (ge, ":reln", 0),
         #    (store_distance_to_party_from_party, ":dist", ":town_no", "p_main_party"),
         #    (lt, ":dist", ":nearest_town_dist"),
         #    (assign, ":nearest_town_dist", ":dist"),
         #    (troop_set_slot, ":npc", slot_troop_cur_center, ":town_no"),
         #  (try_end),
         #(try_end),

		 (try_for_parties, ":party_no"), #seafare chief duh
			(party_slot_eq, ":party_no", slot_ship_center, ship_player_sailing), #Removes the ship that was used by the player, when he lost a battle at sea.
			(remove_party, ":party_no"),
		 (try_end), #seafare acaba

         (set_camera_follow_party, "$capturer_party"),
         (assign, "$g_player_is_captive", 1),
         (store_random_in_range, ":random_hours", 24, 48), #TEMPERED chief LENGTHENED TIME cambiado
         (call_script, "script_event_player_captured_as_prisoner"),
         (call_script, "script_stay_captive_for_hours", ":random_hours"),
         (assign,"$auto_menu","mnu_captivity_wilderness_check"),
         (change_screen_return),
         ]),
      ]
  ),
  (
    "captivity_wilderness_check",0,
    "stub",
    "none",
    [(jump_to_menu,"mnu_captivity_end_wilderness_escape")],
    []
  ),
  #modificado entero chief para que player no se quede colgado en mitad del mar
  (
    "captivity_end_wilderness_escape",0,
    "After painful days of being dragged about as a prisoner, you find a chance and escape from your captors!",
    "none",
    [
#chief
    (party_get_current_terrain,":terrain","p_main_party"),
    (assign,reg1,":terrain"),
#chief acaba
        (play_cue_track, "track_escape"),
        (troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
        (try_begin),
          (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_escape_1_fem1"),
        (else_try),
          (set_background_mesh, "mesh_pic_escape_11"),
        (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [
          (assign, "$g_player_is_captive", 0),

#cambia icono chief
           (try_begin),
                (this_or_next|eq,reg1,0), #terreno#water
                (this_or_next|eq,reg1, 7 ),#water
                 (eq,reg1, 8 ),#river
			(assign, "$g_player_icon_state", pis_normal),
			(party_set_flags, "p_main_party", pf_is_ship, 0),
               (try_end),
#cambia icono acaba
           (try_begin),
             (party_is_active, "$capturer_party"),
             (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
           (try_end),
#recoloca cerca de tierra
           (try_begin),
                (this_or_next|eq,reg1,0), #terreno#water
                (this_or_next|eq,reg1, 7 ),#water
                 (eq,reg1, 8 ),#river
                 (assign, ":closest_dist", 100000),
                 (try_for_range, ":cur_town", towns_begin, towns_end),
                # (party_slot_eq, ":cur_town", slot_town_port, 1),
                (store_distance_to_party_from_party, ":dist", ":cur_town", "p_main_party"),
                (lt, ":dist", ":closest_dist"),
                (assign, ":closest_dist", ":dist"),
               (try_end),
             (party_relocate_near_party, "p_main_party",":cur_town",1),
             (display_message,"@Some fishermen help you in the ocean, and they leave you in the nearest town.",0xFFFFAAAA),
             (try_end),
#recoloca en mar chief acaba
           (call_script, "script_set_parties_around_player_ignore_player", 8, 12), #it was radius:2 and hours:4, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.

           (assign, "$g_player_icon_state", pis_normal),
           (set_camera_follow_party, "p_main_party"),
           (rest_for_hours, 0, 0, 0), #stop resting
           (change_screen_return),
        ]),
    ]
  ),
  (
    "captivity_castle_taken_prisoner",0,
    "You are quickly surrounded by guards who take away your weapons. With curses and insults, they throw you into the dungeon where you must while away the miserable days of your captivity.",
    "none",
    [
        (troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
        (try_begin),
          (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_prisoner_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_prisoner_man"),
        (try_end),
    ],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$g_player_is_captive", 1),
           (store_random_in_range, ":random_hours", 24, 48), #TEMPERED chief LENGTHENED TIME cambiado
           (call_script, "script_event_player_captured_as_prisoner"),
           (call_script, "script_stay_captive_for_hours", ":random_hours"),
           (assign,"$auto_menu", "mnu_captivity_castle_check"),
           (change_screen_return)
        ]),
    ]
  ),
  (
    "captivity_rescue_lord_taken_prisoner",0,
    "You remain in disguise for as long as possible before revealing yourself.\
 The guards are outraged and beat you savagely before throwing you back into the cell for God knows how long...",
    "none",
    [
        (troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
        (try_begin),
          (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_prisoner_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_prisoner_man"),
        (try_end),
   ],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$g_player_is_captive", 1),
           (store_random_in_range, ":random_hours", 24, 48), #TEMPERED chief LENGTHENED TIME cambiado
           (call_script, "script_event_player_captured_as_prisoner"),
           (call_script, "script_stay_captive_for_hours", ":random_hours"),
           (assign,"$auto_menu", "mnu_captivity_castle_check"),
           (change_screen_return),
        ]),
    ]
  ),
  (
    "captivity_castle_check",0,
    "stub",
    "none",
    [
        (store_random_in_range, reg(7), 0, 10),
        (try_begin),
		  (party_is_active, "$capturer_party"),
		  (store_faction_of_party, ":capturer_faction", "$capturer_party"),
		  (is_between, ":capturer_faction", kingdoms_begin, kingdoms_end),
		  (store_relation, ":relation_w_player_faction", ":capturer_faction", "fac_player_faction"),
		  (ge, ":relation_w_player_faction", 0),
          (jump_to_menu,"mnu_captivity_end_exchanged_with_prisoner"),
		(else_try),
          (lt, reg(7), 4),

          (store_character_level, ":player_level", "trp_player"),
          (store_mul, "$player_ransom_amount", ":player_level", 50),
          (val_add, "$player_ransom_amount", 100),
          (store_troop_gold, reg3, "trp_player"),
          (store_div, ":player_gold_div_20", reg3, 20),
          (val_add, "$player_ransom_amount", ":player_gold_div_20"),

          (gt, reg3, "$player_ransom_amount"),
          (jump_to_menu,"mnu_captivity_end_propose_ransom"),
        (else_try),
          (lt, reg7, 7),
          (jump_to_menu,"mnu_captivity_end_exchanged_with_prisoner"),
        (else_try),
          (jump_to_menu,"mnu_captivity_castle_remain"),
        (try_end),
    ],
    []
  ),
  (
    "captivity_end_exchanged_with_prisoner",0,
    "After days of imprisonment, you are finally set free when your captors exchange you with another prisoner.",
    "none",
    [
      (play_cue_track, "track_escape"),
      ],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$g_player_is_captive", 0),
           (try_begin),
             (party_is_active, "$capturer_party"),
             (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
           (try_end),
           (call_script, "script_set_parties_around_player_ignore_player", 8, 12), #it was radius:2 and hours:12, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.
           (assign, "$g_player_icon_state", pis_normal),
           (set_camera_follow_party, "p_main_party"),
           (rest_for_hours, 0, 0, 0), #stop resting
           (change_screen_return),
        ]),
    ]
  ),
  (
    "captivity_end_propose_ransom",0,
    "You spend long hours in the sunless dank of the dungeon, more than you can count.\
 Suddenly one of your captors enters your cell with an offer;\
 he proposes to free you in return for {reg5} scillingas of your hidden wealth. You decide to...",
    "none",
    [
      (assign, reg5, "$player_ransom_amount"),
    ],
    [
      ("captivity_end_ransom_accept",
      [
        (store_troop_gold,":player_gold", "trp_player"),
        (ge, ":player_gold","$player_ransom_amount")
      ],"Accept the offer.",
      [
        (play_cue_track, "track_escape"),
        (assign, "$g_player_is_captive", 0),
        (troop_remove_gold, "trp_player", "$player_ransom_amount"),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 1),
        (try_end),
        (call_script, "script_set_parties_around_player_ignore_player", 8, 12), #it was radius:2 and hours:6, but players make lots of complains about consequent battle losses after releases from captivity then I changed this.
        (assign, "$g_player_icon_state", pis_normal),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0), #stop resting
        (change_screen_return),
      ]),
      ("captivity_end_ransom_deny",
      [
      ],"Refuse him, wait for something better.",
      [
        (assign, "$g_player_is_captive", 1),
           (store_random_in_range, reg(8), 24, 48), #Tempered chief lengthened time cambiado
        (call_script, "script_stay_captive_for_hours", reg8),
        (assign,"$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]),
    ]
  ),
  (
    "captivity_castle_remain",mnf_scale_picture|mnf_disable_all_keys,
    "More days pass in the darkness of your cell. You get through them as best you can,\
 enduring the kicks and curses of the guards, watching your underfed body waste away more and more...",
    "none",
    [
        (troop_get_type, ":is_female", "trp_player"),
 		(val_mod, ":is_female", 2),	#gender fix chief moto
       (try_begin),
          (eq, ":is_female", 1),
          (set_background_mesh, "mesh_pic_prisoner_fem"),
        (else_try),
          (set_background_mesh, "mesh_pic_prisoner_man"),
        (try_end),
        (store_random_in_range, ":random_hours", 24, 48), #TEMPERED chief LENGTHENED TIME cambiado
        (call_script, "script_stay_captive_for_hours", ":random_hours"),
        (assign,"$auto_menu", "mnu_captivity_castle_check"),

    ],
    [
      ("continue",[],"Continue...",
       [
           (assign, "$g_player_is_captive", 1),
           (change_screen_return),
        ]),
    ]
  ),

  (
    "kingdom_army_quest_report_to_army",0,
    "{s8} sends word that he wishes you to join {reg4?her:his} new military campaign.\
 You need to bring at least {reg13} troops to the army,\
 and are instructed to raise more men with all due haste if you do not have enough.",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
        (quest_get_slot, ":quest_target_troop", "qst_report_to_army", slot_quest_target_troop),
        (quest_get_slot, ":quest_target_amount", "qst_report_to_army", slot_quest_target_amount),
        (call_script, "script_get_information_about_troops_position", ":quest_target_troop", 0),
        (str_clear, s9),
        (try_begin),
          (eq, reg0, 1), #troop is found and text is correct
          (str_store_string, s9, s1),
        (try_end),
        (str_store_troop_name, s8, ":quest_target_troop"),
        (assign, reg13, ":quest_target_amount"),
 ## Gender fix chief para alturas
     (troop_get_type, reg4, ":quest_target_troop"),
    (val_mod, reg4, 2),
#gender fix chief acaba
     ],
    [
      ("continue",[],"Continue...",
       [
           (quest_get_slot, ":quest_target_troop", "qst_report_to_army", slot_quest_target_troop),
           (quest_get_slot, ":quest_target_amount", "qst_report_to_army", slot_quest_target_amount),
           (str_store_troop_name_link, s13, ":quest_target_troop"),
           (assign, reg13, ":quest_target_amount"),
           (setup_quest_text, "qst_report_to_army"),
           (str_store_string, s2, "@{s13} asked you to report to him with at least {reg13} troops."),
           (call_script, "script_start_quest", "qst_report_to_army", ":quest_target_troop"),
           (call_script, "script_report_quest_troop_positions", "qst_report_to_army", ":quest_target_troop", 3),
           (change_screen_return),
        ]),
     ]
  ),

  (
    "kingdom_army_quest_messenger",0,
    "{s8} sends word that he wishes to speak with you about a task he needs performed.\
 He requests you to come and see him as soon as possible.",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        (str_store_troop_name, s8, ":faction_marshall"),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "kingdom_army_quest_join_siege_order",0,
    "{s8} sends word that you are to join the siege of {s9} in preparation for a full assault.\
 Your troops are to take {s9} at all costs.",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger1"),
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        (quest_get_slot, ":quest_target_center", "qst_join_siege_with_army", slot_quest_target_center),
        (str_store_troop_name, s8, ":faction_marshall"),
        (str_store_party_name, s9, ":quest_target_center"),
      ],
    [
      ("continue",[],"Continue...",
       [
           (call_script, "script_end_quest", "qst_follow_army"),
           (quest_get_slot, ":quest_target_center", "qst_join_siege_with_army", slot_quest_target_center),
           (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
           (str_store_troop_name_link, s13, ":faction_marshall"),
           (str_store_party_name_link, s14, ":quest_target_center"),
           (setup_quest_text, "qst_join_siege_with_army"),
           (str_store_string, s2, "@{s13} ordered you to join the assault against {s14}."),
           (call_script, "script_start_quest", "qst_join_siege_with_army", ":faction_marshall"),
           (change_screen_return),
        ]),
     ]
  ),

  (
    "kingdom_army_follow_failed",0,
    "You have failed to follow {s8}. The marshal assumes that you were otherwise engaged, but would have appreciated your support.",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
        (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
        (str_store_troop_name, s8, ":faction_marshall"),
        (call_script, "script_abort_quest", "qst_follow_army", 1),
#        (call_script, "script_change_player_relation_with_troop", ":faction_marshall", -3),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),


  (
    "invite_player_to_faction_without_center",0,
    "You receive an offer of vassalage!^^\
 {s8} of {s9} has sent a royal herald to bring you an invitation in his own hand.\
 You would be granted the honour of becoming a vassal {lord/lady} of {s9},\
 and in return {s8} asks you to swear an oath of homage to him and fight in his military campaigns,\
 although he offers you no lands or titles.\
 He will surely be offended if you do not take the offer...",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
        (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", slot_faction_leader),
        (str_store_troop_name, s8, "$g_invite_faction_lord"),
        (str_store_faction_name, s9, "$g_invite_faction"),
      ],
    [
      ("faction_accept",[],"Accept!",
       [(str_store_troop_name,s1,"$g_invite_faction_lord"),
        (setup_quest_text,"qst_join_faction"),

        (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        (str_store_faction_name_link, s4, "$g_invite_faction"),
        (quest_set_slot, "qst_join_faction", slot_quest_giver_troop, "$g_invite_faction_lord"),
        (quest_set_slot, "qst_join_faction", slot_quest_expiration_days, 30),
		(quest_set_slot, "qst_join_faction", slot_quest_failure_consequence, 0),

        (str_store_string, s2, "@Find and speak with {s3} of {s4} to give him your oath of homage."),
        (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
        ]),
      ("faction_reject",[],"Decline the invitation.",
       [(call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        (call_script, "script_change_player_relation_with_faction", "$g_invite_faction", -10),
        (assign, "$g_invite_faction", 0),
        (assign, "$g_invite_faction_lord", 0),
        (assign, "$g_invite_offered_center", 0),
        (change_screen_return),
        ]),
     ]
  ),


  (
    "invite_player_to_faction",0,
    "You receive an offer of vassalage!^^\
 {s8} of {s9} has sent a royal herald to bring you an invititation in his own hand.\
 You would be granted the honour of becoming a vassal {lord/lady} of {s9},\
 and in return {s8} asks you to swear an oath of homage to him and fight in his military campaigns,\
 offering you the fief of {s2} for your loyal service.\
 He will surely be offended if you do not take the offer...",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
        (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", slot_faction_leader),
        (str_store_troop_name, s8, "$g_invite_faction_lord"),
        (str_store_faction_name, s9, "$g_invite_faction"),
        (str_store_party_name, s2, "$g_invite_offered_center"),
      ],
    [
      ("faction_accept",[],"Accept!",
       [(str_store_troop_name,s1,"$g_invite_faction_lord"),
        (setup_quest_text,"qst_join_faction"),

        (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        (str_store_faction_name_link, s4, "$g_invite_faction"),
        (quest_set_slot, "qst_join_faction", slot_quest_giver_troop, "$g_invite_faction_lord"),
        (quest_set_slot, "qst_join_faction", slot_quest_expiration_days, 30),
        (str_store_string, s2, "@Find and speak with {s3} of {s4} to give him your oath of homage."),
        (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
        ]),
      ("faction_reject",[],"Decline the invitation.",
       [(call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        (assign, "$g_invite_faction", 0),
        (assign, "$g_invite_faction_lord", 0),
        (assign, "$g_invite_offered_center", 0),
        (change_screen_return),
        ]),
     ]
  ),

  (
    "invite_player_to_faction_accepted",0,
    "In order to become a vassal, you must swear an oath of homage to {s3}.\
 You shall have to find him and give him your oath in person. {s5}",
    "none",
    [
        (call_script, "script_get_information_about_troops_position", "$g_invite_faction_lord", 0),
        (str_store_troop_name, s3, "$g_invite_faction_lord"),
        (str_store_string, s5, "@{!}{s1}"),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "question_peace_offer",0,
    "You Receive a Peace Offer^^The {s1} offers you a peace agreement. What is your answer?",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ##diplomacy chief begin
      (store_relation,  ":relation", "fac_player_supporters_faction", "$g_notification_menu_var1"),
      (try_begin),
        (ge, ":relation", 0),
        (change_screen_return),
      (try_end),
      ##diplomacy end
      ],
    [
      ("peace_offer_accept",[],"Accept",
       [
         (call_script, "script_diplomacy_start_peace_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
         (change_screen_return),
        ]),
        ##diplomacy chief begin
      ("dplmc_peace_offer_terms",[],"Dictate the peace terms",
       [
         (start_presentation, "prsnt_dplmc_peace_terms"),
        ]),
        ##diplomacy chief end
      ("peace_offer_reject",[],"Reject",
       [
         (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_truce_expired",0,
    "Truce Has Expired^^The truce between {s1} and {s2} has expired.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_feast_quest_expired",0,
    "{s10}",
    "none",
    [
    (str_store_string, s10, "str_feast_quest_expired"),
    ],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),

  (
    "notification_sortie_possible",0,
    "Enemy Sighted: Enemies have been sighted outside the walls of {s4}, and {s5} and others are preparing for a sortie. You may join them if you wish.",
    "none",
    [
	(str_store_party_name, s4, "$g_notification_menu_var1"),
	(party_stack_get_troop_id, ":leader", "$g_notification_menu_var2", 0),
	(str_store_troop_name, s5, ":leader"),
      ],
    [
      ("continue",[],"Continue",
       [
	   #stop auto-clock

	   (change_screen_return),
        ]),
     ]
  ),




  (
    "notification_casus_belli_expired",0,
    "Kingdom Fails to Respond^^The {s1} has not responded to the {s2}'s provocations, and {s3} suffers a loss of face among {reg4?her:his} more bellicose subjects...^",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
	  (faction_get_slot, ":faction_leader", "$g_notification_menu_var1", slot_faction_leader),
      (str_store_troop_name, s3, ":faction_leader"),
 ## Gender fix chief para alturas
      (troop_get_type, reg4, ":faction_leader"),
    (val_mod, reg4, 2),
#gender fix chief acaba
	   (call_script, "script_faction_follows_controversial_policy", "$g_notification_menu_var1", logent_policy_ruler_ignores_provocation),
	   (change_screen_return),

##      (set_fixed_point_multiplier, 100),
##      (position_set_x, pos0, 65),
##      (position_set_y, pos0, 30),
##      (position_set_z, pos0, 170),
##      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
##      ("continue",[],"Continue",
##       [
##	   (call_script, "script_faction_follows_controversial_policy", "$g_notification_menu_var1", logent_policy_ruler_ignores_provocation),
##	   (change_screen_return),
##        ]),
     ]
  ),

  (
    "notification_lord_defects",0,
    "Defection: {s4} has abandoned the {s5} and joined the {s7}, taking {reg4?her:his} his fiefs with him",
    "none",
	[
	  (assign, ":defecting_lord", "$g_notification_menu_var1"),
	  (assign, ":old_faction", "$g_notification_menu_var2"),
	  (str_store_troop_name, s4, ":defecting_lord"),
	  (str_store_faction_name, s5, ":old_faction"),
	  (store_faction_of_troop, ":new_faction", ":defecting_lord"),
	  (str_store_faction_name, s7, ":new_faction"),
 ## Gender fix chief para alturas
       (troop_get_type, reg4, ":defecting_lord"),
    (val_mod, reg4, 2),
#gender fix chief acaba
	],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
	),


  (
    "notification_treason_indictment",0,
    "Treason Indictment^^{s9}",
    "none",
    [
	  (assign, ":indicted_lord", "$g_notification_menu_var1"),
	  (assign, ":former_faction", "$g_notification_menu_var2"),
	  (faction_get_slot, ":former_faction_leader", ":former_faction", slot_faction_leader),

	  #Set up string
	  (try_begin),
			(eq, ":indicted_lord", "trp_player"),
			(str_store_troop_name, s7, ":former_faction_leader"),
			(str_store_string, s9, "str_you_have_been_indicted_for_treason_to_s7_your_properties_have_been_confiscated_and_you_would_be_well_advised_to_flee_for_your_life"),
	  (else_try),
			(str_store_troop_name, s4, ":indicted_lord"),
			(str_store_faction_name, s5, ":former_faction"),
			(str_store_troop_name, s6, ":former_faction_leader"),

 ## Gender fix chief para alturas
       (troop_get_type, reg4, ":indicted_lord"),
    (val_mod, reg4, 2),
#gender fix chief acaba
			(store_faction_of_troop, ":new_faction", ":indicted_lord"),
			(try_begin),
				(is_between, ":new_faction", kingdoms_begin, kingdoms_end),
				(str_store_faction_name, s10, ":new_faction"),
				(str_store_string, s11, "str_with_the_s10"),
			(else_try),
				(str_store_string, s11, "str_outside_calradia"),
			(try_end),
			(str_store_string, s9, "str_by_order_of_s6_s4_of_the_s5_has_been_indicted_for_treason_the_lord_has_been_stripped_of_all_reg4herhis_properties_and_has_fled_for_reg4herhis_life_he_is_rumored_to_have_gone_into_exile_s11"),
		(try_end),


	],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
	),


#motomataru chief cambia
  (
    "notification_border_incident",0,
    # "Border incident^^Word reaches you that {s9}. Though you don't know whether or not the rumors are true, you do know one thing -- this seemingly minor incident has raised passions among the {s4}, making it easier for them to go to war against the {s3}, if they want it...",
    "Border incident^^Word reaches you that {s9}. Though you don't know whether or not the rumors are true, you do know one thing -- this seemingly minor incident has raised passions among the people of {s4}, making it easier for them to go to war against {s3}...",
    "none",
    [
	  (assign, ":acting_village", "$g_notification_menu_var1"),
	  (assign, ":target_village", "$g_notification_menu_var2"),
	  (store_faction_of_party, ":acting_faction", ":acting_village"),

	  (try_begin),
			(eq, ":target_village", -1),
			(party_get_slot, ":target_faction", ":acting_village", slot_center_original_faction),
			(try_begin),
				(this_or_next|eq, ":target_faction", ":acting_faction"),
                              		(neg|faction_slot_eq, ":target_faction", slot_faction_state, sfs_active),
				(party_get_slot, ":target_faction", ":acting_village", slot_center_ex_faction),
			(try_end),

		    (str_store_party_name, s1, ":acting_village"),
		    (str_store_faction_name, s3, ":acting_faction"),
		    (str_store_faction_name, s4, ":target_faction"),
			(faction_get_slot, ":target_leader", ":target_faction", slot_faction_leader),
		    (str_store_troop_name, s5, ":target_leader"),

			(str_store_string, s9, "str_local_notables_from_s1_a_village_claimed_by_the_s4_have_been_mistreated_by_their_overlords_from_the_s3_and_petition_s5_for_protection"),
			(display_log_message, "@There has been an alleged border incident: {s9}"),

			(call_script, "script_add_log_entry", logent_border_incident_subjects_mistreated, ":acting_village", -1, -1, ":acting_faction"),


      (else_try),
			(store_faction_of_party, ":target_faction", ":target_village"),

		    (str_store_party_name, s1, ":acting_village"),
		    (str_store_party_name, s2, ":target_village"),
			(str_store_faction_name, s3, ":acting_faction"),	#MOTO chief move up from below
			(str_store_faction_name, s4, ":target_faction"),	#MOTO chief move up from below

			(store_random_in_range, ":random", 0, 3),
			(try_begin),
				(eq, ":random", 0),

				(str_store_string, s9, "str_villagers_from_s1_stole_some_cattle_from_s2"),
				# (display_log_message, "@There has been an alleged border incident: {s9}"), #moto chief
				(display_log_message, "@There has been an alleged border incident: the people of {s4} are considering war against {s3}"),	#MOTO make more helpful

				(call_script, "script_add_log_entry", logent_border_incident_cattle_stolen, ":acting_village", ":target_village", -1,":acting_faction"),

			(else_try),
				(eq, ":random", 1),

				(str_store_string, s9, "str_villagers_from_s1_abducted_a_woman_from_a_prominent_family_in_s2_to_marry_one_of_their_boys"),
				# (display_log_message, "@There has been an alleged border incident: {s9}"), #moto chief
				(display_log_message, "@There has been an alleged border incident: the people of {s4} are considering war against {s3}"),	#MOTO make more helpful

				(call_script, "script_add_log_entry", logent_border_incident_bride_abducted, ":acting_village", ":target_village", -1, ":acting_faction"),
			(else_try),
				(eq, ":random", 2),

				(str_store_string, s9, "str_villagers_from_s1_killed_some_farmers_from_s2_in_a_fight_over_the_diversion_of_a_stream"),
				# (display_log_message, "@There has been an alleged border incident: {s9}"), #moto chief
				(display_log_message, "@There has been an alleged border incident: the people of {s4} are considering war against {s3}"),	#MOTO make more helpful

			    (call_script, "script_add_log_entry", logent_border_incident_villagers_killed, ":acting_village", ":target_village", -1,":acting_faction"),
			(try_end),

	  (try_end),

	  # (str_store_faction_name, s3, ":acting_faction"),	MOTO chief pointless here
	  # (str_store_faction_name, s4, ":target_faction"),

	  (store_add, ":slot_provocation_days", ":acting_faction", slot_faction_provocation_days_with_factions_begin),
	  (val_sub, ":slot_provocation_days", kingdoms_begin),
	  (faction_set_slot, ":target_faction", ":slot_provocation_days", 30),

      ],
    [
      ("continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),



#chief cambia texto para quitar calradia
  (
    "notification_player_faction_active",0,
    "You now possess land in your name, without being tied to any kingdom. This makes you a monarch in your own right, with your court temporarily located at {s12}. However, the other kings in Britannia and Hibernia will at first consider you a threat, for if any upstart warlord can grab a throne, then their own legitimacy is called into question.^^You may find it desirable at this time to pledge yourself to an existing kingdom. If you want to continue as a sovereign monarch, then your first priority should be to establish an independent right to rule. You can establish your right to rule through several means -- marrying into a high-born family, recruiting new lords, governing your lands, treating with other kings, or dispatching your companions on missions.^^At any rate, your first step should be to appoint a chief minister from among your companions, to handle affairs of state. Different companions have different capabilities.^You may appoint new ministers from time to time. You may also change the location of your court, by speaking to the minister.",
    "none",
    [
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),

      (unlock_achievement, ACHIEVEMENT_CALRADIAN_TEA_PARTY),
      (play_track, "track_coronation"),
	(troop_add_item, "trp_player", "itm_sib_lombardy", 0), #chief corona al nuevo rey

	  (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
	    (lt, "$g_player_court", walled_centers_begin),
		(store_faction_of_party, ":walled_center_faction", ":walled_center"),
	    (eq, ":walled_center_faction", "fac_player_supporters_faction"),
		(assign, "$g_player_court", ":walled_center"),

		(try_begin),
			(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
			(is_between, ":spouse", kingdom_ladies_begin, kingdom_ladies_end),
			(troop_set_slot, ":spouse", slot_troop_cur_center, "$g_player_court"),
		(try_end),

		(str_store_party_name, s12, "$g_player_court"),
	  (try_end),

      ],
    [
      ("appoint_spouse",[
	  (troop_slot_ge, "trp_player", slot_troop_spouse, 1),
	  (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
	  (neg|troop_slot_eq, ":player_spouse", slot_troop_occupation, slto_kingdom_hero),
	  (str_store_troop_name, s10, ":player_spouse"),
	  ],"Appoint your wife, {s10}...",
       [
	   (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
	   (assign, "$g_player_minister", ":player_spouse"),
	   (jump_to_menu, "mnu_minister_confirm"),
	   ]),

      ("appoint_npc1",[
	  (main_party_has_troop, "trp_npc1"),
	  (str_store_troop_name, s10, "trp_npc1"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc1"),
	   (jump_to_menu, "mnu_minister_confirm"),
	   ]),

      ("appoint_npc2",[
	  (main_party_has_troop, "trp_npc2"),
	  (str_store_troop_name, s10, "trp_npc2"),],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc2"),
	   (jump_to_menu, "mnu_minister_confirm"),]),

      ("appoint_npc3",[
	  (main_party_has_troop, "trp_npc3"),
	  (str_store_troop_name, s10, "trp_npc3"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc3"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc4",[
	  (main_party_has_troop, "trp_npc4"),
	  (str_store_troop_name, s10, "trp_npc4"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc4"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc5",[
	  (main_party_has_troop, "trp_npc5"),
	  (str_store_troop_name, s10, "trp_npc5"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc5"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc6",[
	  (main_party_has_troop, "trp_npc6"),
	  (str_store_troop_name, s10, "trp_npc6"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc6"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc7",[
	  (main_party_has_troop, "trp_npc7"),
	  (str_store_troop_name, s10, "trp_npc7"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc7"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc8",[
	  (main_party_has_troop, "trp_npc8"),
	  (str_store_troop_name, s10, "trp_npc8"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc8"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc9",[
	  (main_party_has_troop, "trp_npc9"),
	  (str_store_troop_name, s10, "trp_npc9"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc9"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc10",[ #was npc9
	  (main_party_has_troop, "trp_npc10"),
	  (str_store_troop_name, s10, "trp_npc10"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc10"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc11",[
	  (main_party_has_troop, "trp_npc11"),
	  (str_store_troop_name, s10, "trp_npc11"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc11"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc12",[
	  (main_party_has_troop, "trp_npc12"),
	  (str_store_troop_name, s10, "trp_npc12"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc12"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc13",[
	  (main_party_has_troop, "trp_npc13"),
	  (str_store_troop_name, s10, "trp_npc13"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc13"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc14",[
	  (main_party_has_troop, "trp_npc14"),
	  (str_store_troop_name, s10, "trp_npc14"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc14"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc15",[
	  (main_party_has_troop, "trp_npc15"),
	  (str_store_troop_name, s10, "trp_npc15"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc15"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc16",[
	  (main_party_has_troop, "trp_npc16"),
	  (str_store_troop_name, s10, "trp_npc16"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc16"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_basher",[
	  (main_party_has_troop, "trp_npc_basher"),
	  (str_store_troop_name, s10, "trp_npc_basher"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_basher"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_sange",[
	  (main_party_has_troop, "trp_npc_sange"),
	  (str_store_troop_name, s10, "trp_npc_sange"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_sange"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_paintrain",[
	  (main_party_has_troop, "trp_npc_paintrain"),
	  (str_store_troop_name, s10, "trp_npc_paintrain"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_paintrain"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_hammertime",[
	  (main_party_has_troop, "trp_npc_hammertime"),
	  (str_store_troop_name, s10, "trp_npc_hammertime"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_hammertime"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_backwoodsharry",[
	  (main_party_has_troop, "trp_npc_backwoodsharry"),
	  (str_store_troop_name, s10, "trp_npc_backwoodsharry"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_backwoodsharry"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_tank",[
	  (main_party_has_troop, "trp_npc_tank"),
	  (str_store_troop_name, s10, "trp_npc_tank"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_tank"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_deadeye",[
	  (main_party_has_troop, "trp_npc_deadeye"),
	  (str_store_troop_name, s10, "trp_npc_deadeye"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_deadeye"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_probulator",[
	  (main_party_has_troop, "trp_npc_probulator"),
	  (str_store_troop_name, s10, "trp_npc_probulator"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_probulator"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_grim",[
	  (main_party_has_troop, "trp_npc_grim"),
	  (str_store_troop_name, s10, "trp_npc_grim"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_grim"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_npc_enchantress",[
	  (main_party_has_troop, "trp_npc_enchantress"),
	  (str_store_troop_name, s10, "trp_npc_enchantress"),
	  ],"Appoint {s10}",
       [
	   (assign, "$g_player_minister", "trp_npc_enchantress"),
	   (jump_to_menu, "mnu_minister_confirm"), ]),

      ("appoint_default",[],"Appoint a prominent citizen from the area...",
       [
	   (assign, "$g_player_minister", "trp_temporary_minister"),
	   (troop_set_faction, "trp_temporary_minister", "fac_player_supporters_faction"),
	   (jump_to_menu, "mnu_minister_confirm"),
        ]),
     ]
  ),

  (
    "minister_confirm",0,
    "{s9}can be found at your court in {s12}. You should consult periodically, to avoid the accumulation of unresolved issues that may sap your authority...",
    "none",
    [
    (try_begin),
        (eq, "$players_kingdom_name_set", 1),
        (change_screen_return),
    (try_end),

	(try_begin),
		(eq, "$g_player_minister", "trp_temporary_minister"),
		(str_store_string, s9, "str_your_new_minister_"),
	(else_try),
		(str_store_troop_name, s10, "$g_player_minister"),
		(str_store_string, s9, "str_s10_is_your_new_minister_and_"),
	(try_end),

	(try_begin),
		(main_party_has_troop, "$g_player_minister"),
		(remove_member_from_party, "$g_player_minister", "p_main_party"),
	(try_end),
	],
    [
      ("continue",[],"Continue...",
       [
         (start_presentation, "prsnt_name_kingdom"),
        ]),
     ]
  ),



  (
  "notification_court_lost",0,
  "{s12}",
  "none",
  [
    (try_begin),
		(is_between, "$g_player_court", centers_begin, centers_end),
		(str_store_party_name, s10, "$g_player_court"),
		(str_store_party_name, s11, "$g_player_court"),
	(else_try),
		(str_store_string, s10, "str_your_previous_court_some_time_ago"),
		(str_store_string, s11, "str_your_previous_court_some_time_ago"),
	(try_end),

	(assign, "$g_player_court", -1),
	(str_store_string, s14, "str_after_to_the_fall_of_s11_your_court_has_nowhere_to_go"),
	(try_begin),
		(faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),
		(str_store_string, s14, "str_as_you_no_longer_maintain_an_independent_kingdom_you_no_longer_maintain_a_court"),
	(try_end),

	(try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
		(eq, "$g_player_court", -1),
  ##diplomacy chief begin
    (neg|party_slot_eq, ":walled_center", slot_village_infested_by_bandits, "trp_peasant_woman"),
    ##diplomacy chief end
		(store_faction_of_party, ":walled_center_faction", ":walled_center"),
		(eq, ":walled_center_faction", "fac_player_supporters_faction"),
		(neg|party_slot_ge, ":walled_center", slot_town_lord, active_npcs_begin),

		(assign, "$g_player_court", ":walled_center"),
		(try_begin),
			(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
			(is_between, ":spouse", kingdom_ladies_begin, kingdom_ladies_end),
			(troop_set_slot, ":spouse", slot_troop_cur_center, "$g_player_court"),
			(str_store_party_name, s11, "$g_player_court"),
		(try_end),

		(str_store_string, s14, "str_due_to_the_fall_of_s10_your_court_has_been_relocated_to_s12"),
	(try_end),

	(try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
		(eq, "$g_player_court", -1),

		(store_faction_of_party, ":walled_center_faction", ":walled_center"),
		(eq, ":walled_center_faction", "fac_player_supporters_faction"),

		(assign, "$g_player_court", ":walled_center"),

		(try_begin),
			(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
			(is_between, ":spouse", kingdom_ladies_begin, kingdom_ladies_end),
			(troop_set_slot, ":spouse", slot_troop_cur_center, "$g_player_court"),
		(try_end),

		(party_get_slot, ":town_lord", ":walled_center", slot_town_lord),
		(str_store_party_name, s11, "$g_player_court"),
		(str_store_troop_name, s9, ":town_lord"),
		(str_store_string, s14, "str_after_to_the_fall_of_s10_your_faithful_vassal_s9_has_invited_your_court_to_s11_"),
	(try_end),

	(try_begin),
		(faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),
		(str_store_string, s14, "str_as_you_no_longer_maintain_an_independent_kingdom_you_no_longer_maintain_a_court"),
	(try_end),
	(str_store_string, s12, s14),
  ],
  [
      ("continue",[],"Continue...",[
	  (change_screen_return),
	  ]),
     ],
  ),



  (
    "notification_player_faction_deactive",0,
    "Your kingdom no longer holds any land.",
    "none",
    [
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [

	   (try_begin),


	   (try_end),
	   (assign, "$g_player_minister", -1),
	   (change_screen_return),
        ]),
     ]
  ),






  (
    "notification_player_wedding_day",0,
    "{s8} wishes to inform you that preparations for your wedding at {s10} have been complete, and that your presence is expected imminently .",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger1"),
		(str_store_troop_name, s8, "$g_notification_menu_var1"),
		(str_store_party_name, s10, "$g_notification_menu_var2"),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),


  (
    "notification_player_kingdom_holds_feast",0,
    "{s11}",
    "none",
    [
		(set_background_mesh, "mesh_pic_messenger1"),

		(str_store_troop_name, s8, "$g_notification_menu_var1"),
		(store_faction_of_troop, ":host_faction", "$g_notification_menu_var1"),
		(str_store_faction_name, s9, ":host_faction"),

#		(str_store_faction_name, s9, "$players_kingdom"),
		(str_store_party_name, s10, "$g_notification_menu_var2"),

		(str_clear, s12),
		(try_begin),
			(check_quest_active, "qst_wed_betrothed"),
			(quest_get_slot, ":giver_troop", "qst_wed_betrothed", slot_quest_giver_troop),
			(store_faction_of_troop, ":giver_troop_faction", ":giver_troop"),
			(eq, ":giver_troop_faction", "$players_kingdom"),
			(str_store_string, s12, "str_feast_wedding_opportunity"),
		(try_end),



		(str_store_string, s11, "str_s8_wishes_to_inform_you_that_the_lords_of_s9_will_be_gathering_for_a_feast_at_his_great_hall_in_s10_and_invites_you_to_be_part_of_this_august_assembly"),
		(try_begin),
			(eq, "$g_notification_menu_var1", 0),
			(str_store_string, s11, "str_the_great_lords_of_your_kingdom_plan_to_gather_at_your_hall_in_s10_for_a_feast"),
		(try_end),
		(str_store_string, s11, "@{!}{s11}{s12}"),

		(try_begin),
			(ge, "$cheat_mode", 1),
			(store_current_hours, ":hours_since_last_feast"),
			(faction_get_slot, ":last_feast_start_time", "$players_kingdom", slot_faction_last_feast_start_time),
			(val_sub, ":hours_since_last_feast", ":last_feast_start_time"),
			(assign, reg4, ":hours_since_last_feast"),
			(display_message, "@{!}DEBUG -- Hours since last feast started: {reg4}"),
		(try_end),

      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

#chief anade texto presentacion sot
  (
    "notification_center_under_siege",0,
    "{s1} has been besieged by {s2} of {s3}!^^The settlement is surrounded and under siege. Its warriors must cower behind the walls rather than face the enemy with blades in their hands!",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":troop_faction", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":troop_faction"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_village_raided",0,
    "Enemies have Laid Waste to a Fief^^{s1} has been raided by {s2} of {s3}!",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":troop_faction", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":troop_faction"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_village_raid_started",0,
    "Your Village is under Attack!^^{s2} of {s3} is laying waste to {s1}.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":troop_faction", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":troop_faction"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_one_faction_left",0,
    "Britannia and Hibernia Conquered by One Kingdom^^{s1} has defeated all rivals. You are BRYTENWALDA!.", #chief cambiado
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
	  (try_begin),
		(faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
		(unlock_achievement, ACHIEVEMENT_THE_GOLDEN_THRONE),
	  (else_try),
		(unlock_achievement, ACHIEVEMENT_MANIFEST_DESTINY),
	  (try_end),

        (try_begin),
            (troop_get_type, ":is_female", "trp_player"),
			(val_mod, ":is_female", 2),	#gender fix chief moto
            (eq, ":is_female", 1),
            (unlock_achievement, ACHIEVEMENT_EMPRESS),
        (try_end),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_oath_renounced_faction_defeated",0,
    "Your Old Faction was Defeated^^You won the battle against {s1}! This ends your struggle which started after you renounced your oath to them.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
	  (try_begin),
		(faction_slot_eq, "$g_notification_menu_var1", slot_faction_leader, "trp_player"),
		(unlock_achievement, ACHIEVEMENT_THE_GOLDEN_THRONE),
	  (else_try),
		(unlock_achievement, ACHIEVEMENT_MANIFEST_DESTINY),
	  (try_end),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_center_lost",0,
    "An Estate was Lost^^You have lost {s1} to {s2}.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),


  (
    "notification_troop_left_players_faction",0,
    "Betrayal!^^{s1} has left {s2} and joined {s3}.",
    "none",
    [
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$players_kingdom"),
      (str_store_faction_name, s3, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 55),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
      (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "notification_troop_joined_players_faction",0,
    "Good news!^^ {s1} has left {s2} and joined {s3}.",
    "none",
    [
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (str_store_faction_name, s3, "$players_kingdom"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 55),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
      (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),
#chief sot cambia texto abajo, y motomataru cambia texto y codigo
  (
    "notification_war_declared",0,
#    "Declaration of War^^{s1} has declared war against {s2}!^^The sword has been drawn from the sheath, and the shield taken down from the wall. War has been declared!",
    "Declaration of War^^{s1} has declared war against {s2}!^{s57}^The sword has been drawn from the sheath, and the shield taken down from the wall. War has been declared!",
    "none",
    [

#	  (try_begin),
#		(eq, "$g_include_diplo_explanation", "$g_notification_menu_var1"),
#		(assign, "$g_include_diplo_explanation", 0),
#		(str_store_string, s57, "$g_notification_menu_var1"),
#	  (else_try),
#	    (str_clear, s57),
#	  (try_end),
	  #MOTO salvage explanation (when multiple explanations needed, only last one valid)
	  (try_begin),
		(eq, "$g_last_acting_faction", "$g_notification_menu_var1"),
		(eq, "$g_last_target_faction", "$g_notification_menu_var2"),
		(str_store_string, s57, "@^{s64}^"),
		(assign, "$g_last_acting_faction", -1),
		(assign, "$g_last_target_faction", -1),
	  (else_try),
	    (str_clear, s57),
	  (try_end),
	  #MOTO salvage explanation end


	#to do the reason, have war_damage = 0 yield pre-war reasons Moto hace cambios chief
#      (try_begin),
#        (eq, "$g_notification_menu_var1", "fac_player_supporters_faction"),
#        (str_store_faction_name, s1, "$g_notification_menu_var2"),
#        (str_store_string, s2, "@you"),
#      (else_try),
#        (eq, "$g_notification_menu_var2", "fac_player_supporters_faction"),
#        (str_store_faction_name, s1, "$g_notification_menu_var1"),
#        (str_store_string, s2, "@you"),
#      (else_try),
        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),
#      (try_end),


      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),
#chief sot cambia texto abajo, motomataru cambia codigo
  (
    "notification_peace_declared",0,
#    "Peace Agreement^^{s1} and {s2} have made peace!^{s57}^^These two peoples have stopped fighting - for now. Perhaps one nation will use the time to sharpen a fresh knife to plunge into the heart of its enemy...",
    "Peace Agreement^^{s1} and {s2} have made peace!^{s57}^These two peoples have stopped fighting - for now. Perhaps one nation will use the time to sharpen a fresh knife to plunge into the heart of its enemy...",
    "none",
    [

	  (try_begin),
		#MOTO salvage explanation (when multiple explanations needed, only last one valid)
		# (eq, 1, 0), #Alas, this does not seem to work
		# (eq, "$g_include_diplo_explanation", "$g_notification_menu_var1"),
		# (assign, "$g_include_diplo_explanation", 0),
		(eq, "$g_last_acting_faction", "$g_notification_menu_var1"),
		(eq, "$g_last_target_faction", "$g_notification_menu_var2"),
		(str_store_string, s57, "@^{s64}^"),
		(assign, "$g_last_acting_faction", -1),
		(assign, "$g_last_target_faction", -1),
		#MOTO salvage explanation end
	  (else_try),
	    (str_clear, s57),
	  (try_end),

	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),


  (
    "notification_faction_defeated",0,
    "Faction Eliminated^^{s1} is no more!",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
      ],
    [
      ("continue",[],"Continue...",
       [
         (try_begin),
           (is_between, "$supported_pretender", pretenders_begin, pretenders_end),
           (troop_slot_eq, "$supported_pretender", slot_troop_original_faction, "$g_notification_menu_var1"),

		   #All rebels switch to kingdom
           (try_for_range, ":cur_troop", active_npcs_begin, active_npcs_end),
		     (troop_slot_eq, ":cur_troop", slot_troop_occupation, slto_kingdom_hero),
             (store_troop_faction, ":cur_faction", ":cur_troop"),
             (eq, ":cur_faction", "fac_player_supporters_faction"),
             (troop_set_faction, ":cur_troop", "$g_notification_menu_var1"),
             (call_script, "script_troop_set_title_according_to_faction", ":cur_troop", "$g_notification_menu_var1"),
             (try_begin),
               (this_or_next|eq, "$g_notification_menu_var1", "$players_kingdom"),
               (eq, "$g_notification_menu_var1", "fac_player_supporters_faction"),
               (call_script, "script_check_concilio_calradi_achievement"),
             (try_end),
		   (else_try), #all loyal lords gain a small bonus with the player
		     (troop_slot_eq, ":cur_troop", slot_troop_occupation, slto_kingdom_hero),
             (store_troop_faction, ":cur_faction", ":cur_troop"),
             (eq, ":cur_faction", "$g_notification_menu_var1"),
			 (call_script, "script_troop_change_relation_with_troop", ":cur_troop", "trp_player", 5),
           (try_end),

           (try_for_parties, ":cur_party"),
             (store_faction_of_party, ":cur_faction", ":cur_party"),
             (eq, ":cur_faction", "fac_player_supporters_faction"),
             (party_set_faction, ":cur_party", "$g_notification_menu_var1"),
           (try_end),

           (assign, "$players_kingdom", "$g_notification_menu_var1"),
		   (try_begin),
			(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
			(is_between, ":spouse", kingdom_ladies_begin, kingdom_ladies_end),
			(troop_set_faction, ":spouse", "$g_notification_menu_var1"),
		   (try_end),


           (call_script, "script_add_notification_menu", "mnu_notification_rebels_switched_to_faction", "$g_notification_menu_var1", "$supported_pretender"),

           (faction_set_slot, "$g_notification_menu_var1", slot_faction_state, sfs_active),
           (faction_set_slot, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),

           (faction_get_slot, ":old_leader", "$g_notification_menu_var1", slot_faction_leader),
           (troop_set_slot, ":old_leader", slot_troop_change_to_faction, "fac_commoners"),

           (faction_set_slot, "$g_notification_menu_var1", slot_faction_leader, "$supported_pretender"),
           (troop_set_faction, "$supported_pretender", "$g_notification_menu_var1"),

           (faction_get_slot, ":old_marshall", "$g_notification_menu_var1", slot_faction_marshall),
           (try_begin),
             (ge, ":old_marshall", 0),
			 (troop_get_slot, ":old_marshall_party", ":old_marshall", slot_troop_leaded_party),
             (party_is_active, ":old_marshall_party"),
             (party_set_marshall, ":old_marshall_party", 0),
           (try_end),

           (faction_set_slot, "$g_notification_menu_var1", slot_faction_marshall, "trp_player"),
           (faction_set_slot, "$g_notification_menu_var1", slot_faction_ai_state, sfai_default),
           (faction_set_slot, "$g_notification_menu_var1", slot_faction_ai_object, -1),
           (troop_set_slot, "$supported_pretender", slot_troop_occupation, slto_kingdom_hero),
		   (troop_set_slot, "$supported_pretender", slot_troop_renown, 1000),

           (party_remove_members, "p_main_party", "$supported_pretender", 1),
           (call_script, "script_set_player_relation_with_faction", "$g_notification_menu_var1", 0),
           (try_for_range, ":cur_kingdom", kingdoms_begin, kingdoms_end),
             (faction_slot_eq, ":cur_kingdom", slot_faction_state, sfs_active),
             (neq, ":cur_kingdom", "$g_notification_menu_var1"),
             (store_relation, ":reln", ":cur_kingdom", "fac_player_supporters_faction"),
             (set_relation, ":cur_kingdom", "$g_notification_menu_var1", ":reln"),
           (try_end),
           (assign, "$supported_pretender", 0),
           (assign, "$supported_pretender_old_faction", 0),
           (assign, "$g_recalculate_ais", 1),
           (call_script, "script_update_all_notes"),
         (try_end),
         (change_screen_return),
        ]),
     ]
  ),


  (
    "notification_rebels_switched_to_faction",0,
    "Rebellion Success^^ Your rebellion is victorious! Your faction now has the sole claim to the title of {s11}, with {s12} as the single ruler.",
    "none",
    [
      (str_store_faction_name, s11, "$g_notification_menu_var1"),
      (str_store_troop_name, s12, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
      ],
    [
      ("continue",[],"Continue...",
       [
         (assign, "$talk_context", tc_rebel_thanks),
         (start_map_conversation, "$g_notification_menu_var2", -1),
         (change_screen_return),
        ]),
     ]
  ),


  (
    "notification_player_should_consult",0,
    "Your minister send words that there are problems brewing in the realm which, if left untreated, could sap your authority. You should consult with him at your earliest convenience",
    "none",
    [
      ],
    [
      ("continue",[],"Continue...",
       [
	    (setup_quest_text, "qst_consult_with_minister"),

        (str_store_troop_name, s11, "$g_player_minister"),
        (str_store_party_name, s12, "$g_player_court"),

		(str_store_string, s2, "str_consult_with_s11_at_your_court_in_s12"),
	    (call_script, "script_start_quest", "qst_consult_with_minister", -1),


		(quest_set_slot, "qst_consult_with_minister", slot_quest_expiration_days, 30),
		(quest_set_slot, "qst_consult_with_minister", slot_quest_giver_troop, "$g_player_minister"),


	    (change_screen_return),
        ]),
     ]
  ),







  (
    "notification_player_feast_in_progress",0,
    "Feast in Preparation^^Your wife has started preparations for a feast in your hall in {s11}",
    "none",
    [
    (str_store_party_name, s11, "$g_notification_menu_var1"),
    ],
    [
      ("continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),


  (
    "notification_lady_requests_visit",0, #add this once around seven days after the last visit, or three weeks, or three months
    "An elderly woman approaches your party and passes one of your men a letter, sealed in plain wax. It is addressed to you. When you break the seal, you see it is from {s15}. It reads, 'I so enjoyed your last visit. {s14} I am currently in {s10}.{s12}'",
    "none",
    [

	  (assign, ":lady_no", "$g_notification_menu_var1"),
	  (assign, ":center_no", "$g_notification_menu_var2"),

      (str_store_troop_name, s15, ":lady_no"),
      (str_store_party_name, s10, ":center_no"),

	  (store_current_hours, ":hours_since_last_visit"),
	  (troop_get_slot, ":last_visit_hours", ":lady_no", slot_troop_last_talk_time),
	  (val_sub, ":hours_since_last_visit", ":last_visit_hours"),

	  (call_script, "script_get_kingdom_lady_social_determinants", ":lady_no"),
	  (assign, ":lady_guardian", reg0),

	  (str_store_troop_name, s16, ":lady_guardian"),
	  (call_script, "script_troop_get_family_relation_to_troop", ":lady_guardian", ":lady_no"),

	  (str_clear, s14),
	  (try_begin),
	    (lt, ":hours_since_last_visit", 336),
		(try_begin),
			(troop_slot_eq, ":lady_no", slot_lord_reputation_type, lrep_otherworldly),
			(str_store_string, s14, "str_as_brief_as_our_separation_has_been_the_longing_in_my_heart_to_see_you_has_made_it_seem_as_many_years"),
		(else_try),
			(str_store_string, s14, "str_although_it_has_only_been_a_short_time_since_your_departure_but_i_would_be_most_pleased_to_see_you_again"),
		(try_end),
	  (else_try),
	    (ge, ":hours_since_last_visit", 336),
		(try_begin),
			(troop_slot_eq, ":lady_no", slot_lord_reputation_type, lrep_ambitious),
			(str_store_string, s14, "str_although_i_have_received_no_word_from_you_for_quite_some_time_i_am_sure_that_you_must_have_been_very_busy_and_that_your_failure_to_come_see_me_in_no_way_indicates_that_your_attentions_to_me_were_insincere_"),
		(else_try),
			(troop_slot_eq, ":lady_no", slot_lord_reputation_type, lrep_moralist),
			(str_store_string, s14, "str_i_trust_that_you_have_comported_yourself_in_a_manner_becoming_a_gentleman_during_our_long_separation_"),
		(else_try),
			(str_store_string, s14, "str_it_has_been_many_days_since_you_came_and_i_would_very_much_like_to_see_you_again"),
	    (try_end),
	  (try_end),


	  (str_clear, s12),
	  (str_clear, s18),
	  (try_begin),
	    (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 0),
		(str_store_string, s12, "str__you_should_ask_my_s11_s16s_permission_but_i_have_no_reason_to_believe_that_he_will_prevent_you_from_coming_to_see_me"),
		(str_store_string, s18, "str__you_should_first_ask_her_s11_s16s_permission"),
	  (else_try),
	    (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, -1),
		(str_store_string, s12, "str__alas_as_we_know_my_s11_s16_will_not_permit_me_to_see_you_however_i_believe_that_i_can_arrange_away_for_you_to_enter_undetected"),
	  (else_try),
	    (troop_slot_eq, ":lady_guardian", slot_lord_granted_courtship_permission, 1),
		(str_store_string, s12, "str__as_my_s11_s16_has_already_granted_permission_for_you_to_see_me_i_shall_expect_your_imminent_arrival"),
	  (try_end),

      ],
    [

      ("continue_woman1",[],"Tell the woman to inform her mistress that you will come shortly",
       [

     	(assign, ":lady_to_visit", "$g_notification_menu_var1"),
	    (str_store_troop_name_link, s3, ":lady_to_visit"),
	    (str_store_party_name_link, s4, "$g_notification_menu_var2"),

		(str_store_string, s2, "str_visit_s3_who_was_last_at_s4s18"),
	    (call_script, "script_start_quest", "qst_visit_lady", ":lady_to_visit"),
		(quest_set_slot, "qst_visit_lady", slot_quest_giver_troop, ":lady_to_visit"), #don't know why this is necessary

		(try_begin),
			(eq, "$cheat_mode", 1),
			(quest_get_slot, ":giver_troop", "qst_visit_lady", slot_quest_giver_troop),
			(str_store_troop_name, s2, ":giver_troop"),
			(display_message, "str_giver_troop_=_s2"),
		(try_end),

		(quest_set_slot, "qst_visit_lady", slot_quest_expiration_days, 30),
	    (change_screen_return),
        ]),

      ("continue_woman2",[],"Tell the woman to inform her mistress that you are indisposed",
       [
	    (troop_set_slot, "$g_notification_menu_var1", slot_lady_no_messages, 1),
	    (change_screen_return),
        ]),
     ]
  ),



  ( #pre lady visit
    "garden",0,
    "{s12}",
    "none",
    [

    (call_script, "script_get_kingdom_lady_social_determinants", "$love_interest_in_town"),
	(assign, ":guardian_lord", reg0),
	(str_store_troop_name, s11, "$love_interest_in_town"),

	(try_begin),
		(call_script, "script_npc_decision_checklist_male_guardian_assess_suitor", ":guardian_lord", "trp_player"),
		(lt, reg0, 0),
		(troop_set_slot, ":guardian_lord", slot_lord_granted_courtship_permission, -1),
	(try_end),

	(assign, "$nurse_assists_entry", 0),
	(try_begin),
		(troop_slot_eq, ":guardian_lord", slot_lord_granted_courtship_permission, 1),
		(str_store_string, s12, "str_the_guards_at_the_gate_have_been_ordered_to_allow_you_through_you_might_be_imagining_things_but_you_think_one_of_them_may_have_given_you_a_wink"),
	(else_try), #the circumstances under which the lady arranges for a surreptitious entry
		(call_script, "script_troop_get_relation_with_troop", "trp_player", "$love_interest_in_town"),
		(gt, reg0, 0),

		(assign, ":player_completed_quest", 0),
		(try_begin),
			(check_quest_active, "qst_visit_lady"),
			(quest_slot_eq, "qst_visit_lady", slot_quest_giver_troop, "$love_interest_in_town"),
			(assign, ":player_completed_quest", 1),
		(else_try),
			(check_quest_active, "qst_formal_marriage_proposal"),
			(quest_slot_eq, "qst_formal_marriage_proposal", slot_quest_giver_troop, "$love_interest_in_town"),
			(this_or_next|check_quest_succeeded, "qst_formal_marriage_proposal"),
				(check_quest_failed, "qst_formal_marriage_proposal"),
			(assign, ":player_completed_quest", 1),
		(else_try),
			(check_quest_active, "qst_duel_courtship_rival"),
			(quest_slot_eq, "qst_duel_courtship_rival", slot_quest_giver_troop, "$love_interest_in_town"),
			(this_or_next|check_quest_succeeded, "qst_duel_courtship_rival"),
				(check_quest_failed, "qst_duel_courtship_rival"),
			(assign, ":player_completed_quest", 1),
		(try_end),

		(try_begin),
			(store_current_hours, ":hours_since_last_visit"),
			(troop_get_slot, ":last_visit_time", "$love_interest_in_town", slot_troop_last_talk_time),
			(val_sub, ":hours_since_last_visit", ":last_visit_time"),
			(this_or_next|ge, ":hours_since_last_visit", 96), #at least four days
				(eq, ":player_completed_quest", 1),

			(try_begin),
				(is_between, "$g_encountered_party", towns_begin, towns_end),
				(str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_don_this_dress_and_throw_the_hood_over_your_face_i_will_smuggle_you_inside_the_castle_to_meet_her_in_the_guise_of_a_skullery_maid__the_guards_will_not_look_too_carefully_but_i_beg_you_for_all_of_our_sakes_be_discrete"),
				(assign, "$nurse_assists_entry", 1),
			(else_try),
				(str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_wait_for_a_while_by_the_spring_outside_the_walls_i_will_smuggle_her_ladyship_out_to_meet_you_dressed_in_the_guise_of_a_shepherdess_but_i_beg_you_for_all_of_our_sakes_be_discrete"),
				(assign, "$nurse_assists_entry", 2),
			(try_end),
		(else_try),
			(str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter_however_as_you_walk_back_towards_your_lodgings_an_elderly_lady_dressed_in_black_approaches_you_i_am_s11s_nurse_she_whispers_urgently_her_ladyship_asks_me_to_say_that_yearns_to_see_you_but_that_you_should_bide_your_time_a_bit_her_ladyship_says_that_to_arrange_a_clandestine_meeting_so_soon_after_your_last_encounter_would_be_too_dangerous"),
		(try_end),
	(else_try),
		(str_store_string, s12, "str_the_guards_glare_at_you_and_you_know_better_than_to_ask_permission_to_enter"),
	(try_end),

	],
    [

	("enter",
	[
    (call_script, "script_get_kingdom_lady_social_determinants", "$love_interest_in_town"),
	(troop_slot_eq, reg0, slot_lord_granted_courtship_permission, 1)
	], "Enter",
	[
	(jump_to_menu, "mnu_town"),
	(call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
	]
	),

	("nurse",
	[
    (eq, "$nurse_assists_entry", 1),
	], "Go with the nurse",
	[
	(jump_to_menu, "mnu_town"),
	(call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
	]
	),


	("nurse_1",
	[
    (eq, "$nurse_assists_entry", 2),
	], "Wait by the spring",
	[
	(jump_to_menu, "mnu_town"),
	(call_script, "script_setup_meet_lady", "$love_interest_in_town", "$g_encountered_party"),
	]
	),

	("leave",
	[],
	"Leave",
	[(jump_to_menu, "mnu_town")]),

    ]


  ),


    (
    "kill_local_merchant_begin",0,
    "You spot your victim and follow him, observing as he turns a corner into a dark alley.\
 This will surely be your best opportunity to attack him.",
    "none",
    [
    ],
    [
      ("continue",[],"Continue...",
       [(set_jump_mission,"mt_back_alley_kill_local_merchant"),
        (party_get_slot, ":town_alley", "$qst_kill_local_merchant_center", slot_town_alley),
        (modify_visitors_at_site,":town_alley"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 1, "trp_local_merchant"),
        (jump_to_menu, "mnu_town"),
        (jump_to_scene,":town_alley"),
        (change_screen_mission),
        ]),
     ]
  ),


    (
    "debug_alert_from_s65",0,
    "DEBUG ALERT: {s65}",
    "none",
    [
    ],
    [
      ("continue",[],"Continue...",
       [
		(assign, "$debug_message_in_queue", 0),
        (change_screen_return),
        ]),
     ]
  ),
#Tempered  chief  ###########################################    SKIRMISHERS RETURN  ################################################

  ("skirmish_party",mnf_disable_all_keys,
  "   The skirmishers have returned from their assignment. ^The party leader reports that {reg5} men were lost during the engagement.",
  "none",
	[
		(party_get_num_companion_stacks, ":num_stacks","$skirmish_party_no"),
		(try_for_range, ":stack_no", 0, ":num_stacks"),
			(party_stack_get_troop_id,":stack_troop","$skirmish_party_no",":stack_no"),
			(eq,":stack_troop","trp_mercenary_skirmisher"),
			(party_stack_get_size,":stack_size","$skirmish_party_no",":stack_no"),
			(store_sub,":dead",":stack_size","$skirmish_size"),
			(val_abs,":dead"),
			(assign,reg5,":dead"),
		(try_end),
		(try_begin), #Tempered moral adjustment for dead skirmishers
			(ge,":dead",1),
			(set_background_mesh, "mesh_pic_wounded1"),
			(store_mul,":morale_penalty",":dead",3),
			(party_get_morale,":cur_morale","p_main_party"),
			(val_sub,":cur_morale",":morale_penalty"),
			(party_set_morale,"p_main_party",":cur_morale"),
			(display_message,"@Your party has lost morale."),
		(else_try),
			(eq,":dead",0),
			(set_background_mesh, "mesh_pic_victory1"),
			(party_get_morale,":cur_morale","p_main_party"),
			(val_add,":cur_morale",4),
			(try_begin),
				(gt,":cur_morale",99),
				(assign,":cur_morale",99),
			(try_end),
			(party_set_morale,"p_main_party",":cur_morale"),
			(display_message,"@Your party has gained morale."),
		(try_end),


	],

		[

			("resume_travelling",[ ],"Resume travelling.",
				[	(party_join),
					(change_screen_map),
				]
			),
		]
  ),


#Tempered chief #######################################  SPY RETURN MENU  #########################################


   ("spy_party",mnf_disable_all_keys,
   "   One of your spies has returned.",
   "none",
	[	(set_background_mesh, "mesh_pic_messenger1"),
		(party_get_num_companion_stacks, ":num_stacks","$g_encountered_party"),
		(try_for_range, ":stack_no", 0, ":num_stacks"),
			(party_stack_get_troop_id,":stack_troop","$g_encountered_party",":stack_no"),
			(try_begin),
				(eq,":stack_troop","trp_mercenary_skirmisher"),
				(party_stack_get_size,":stack_size","$g_encountered_party",":stack_no"),
				(party_remove_members,"$g_encountered_party",":stack_troop",":stack_size"),
				(assign,":number_moved",reg0),
				(party_force_add_members,"p_main_party",":stack_troop",":number_moved"),
				(remove_party,"$g_encountered_party"),
			(try_end),
		(try_end),
	],
		[
			("resume_travelling",[],"Resume travelling.",
				[
				(change_screen_return),
				]
			),
		]
  ),

#Tempered     #############################################  SPY REPORT MENU   NOT USED, USED PRESENTATION INSTEAD##############################################


   ("spy_report",0,
   "{s1}",
   "none",
	[	(set_background_mesh, "mesh_pic_messenger1"),
		(str_clear,s2),
		(try_for_range,":cur_center",centers_begin,centers_end),
			(party_get_slot,":spy_days",":cur_center",slot_spy_in_town),
			(party_get_slot,":center_type",":cur_center",slot_party_type),
				(try_begin),
					(ge,":spy_days",2),
					(str_clear,s3),
					(str_clear,s5),
					(str_clear,s7),
					(str_clear,s8),
						(try_begin),
							(eq,":center_type",4),
							(party_get_slot,reg4,":cur_center",slot_village_number_of_cattle),
							(str_store_string,s3,"@."),
							(str_store_string,s5,"@^The village has a herd of {reg4} cattle.^"),
						(else_try),
							(le,":center_type",3),
							(party_get_slot, ":center_food_store", ":cur_center", slot_party_food_store),
							(call_script, "script_center_get_food_consumption", ":cur_center"),
							(assign, ":food_consumption", reg0),
							(store_div, reg7, ":center_food_store", ":food_consumption"),
							(str_store_string,s3,"@ and food for {reg7} days."),
							(str_store_string,s5,"@^"),
							(assign,":hero_prisoners",0), #Tempered start hero prisoner notes
							(party_get_num_prisoner_stacks, ":num_prisoner_stacks",":cur_center"),
								(try_for_range, ":stack_no", 0, ":num_prisoner_stacks"),
									(party_prisoner_stack_get_troop_id, ":stack_troop",":cur_center",":stack_no"),
									(is_between,":stack_troop",kingdom_heroes_begin,kingdom_heroes_end),
									(val_add,":hero_prisoners",1),
									(str_store_troop_name,s6,":stack_troop"),
									(str_store_string,s7,"@{s7} {s6},"),
								(try_end),
							(try_begin),
								(ge,":hero_prisoners",1),
								(str_store_string,s8,"@The following lords are held prisoner here: {s7}"),
							(else_try),
								(eq,":hero_prisoners",0),
								(str_store_string,s8,"@There are no lords held prisoner here."),
							(try_end),
						(try_end),

					(party_collect_attachments_to_party, ":cur_center", "p_collective_ally"),
					(party_get_num_companions, reg6, "p_collective_ally"),
					(store_div,":full_days",":spy_days",2),
					(assign,reg5,":full_days"),
					(str_store_party_name,s4,":cur_center"),
					(str_store_string,s2,"@ {s2}^^{s4} for {reg5} days.^{s4} has {reg6} defenders{s3}{s5}{s8}"),
				(else_try),
					(eq,":spy_days",1),
					(str_store_party_name,s4,":cur_center"),
					(str_store_string,s2,"@ {s2}^^Your spy in {s4} is still gathering information."),
				(try_end),
		(try_end),
        (str_store_string, s1, "@Your spies have infiltrated the following areas:^{s2}"),
	],
		[
			("continue",[],"Continue...",
				[
				(str_clear,s1),
				(str_clear,s2),
				(str_clear,s3),
				(str_clear,s4),
				(str_clear,s5),
				(str_clear,s6),
				(str_clear,s7),
				(str_clear,s8),
				(jump_to_menu, "mnu_reports"),
				]
			),
		]
  ),

#Tempered    ##################################  SPY SABOTAGE MENU  ###############################################

   ("spy_sabotage",mnf_disable_all_keys,
   "{s4}",
   "none",
	[	(str_store_party_name,s1,"$spy_target"),
		(troop_get_type,":is_female","trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
		(assign,"$g_enemy_party","$spy_target"),
		(try_begin),
			(le,"$cur_choice",0),
			(start_presentation,"prsnt_sabotage"),
		(try_end),
		(try_begin),
			(eq,"$g_battle_result",-1),
			(party_get_slot, ":lord_troop_id", "$spy_target", slot_town_lord),
			(call_script, "script_change_player_relation_with_troop", ":lord_troop_id", -5),
			(call_script,"script_change_player_relation_with_center","$spy_target",-10),
			(call_script,"script_change_player_honor",2),
			(assign,"$g_spy_rescue_active",0),
			(assign,"$g_battle_result",0),
			(change_screen_map),
		(else_try),
			(eq,"$g_battle_result",1),
			(try_begin),
				(eq, ":is_female", 1),
				(set_background_mesh, "mesh_pic_wounded_fem1"),
			(else_try),
				(set_background_mesh, "mesh_pic_wounded1"),
			(try_end),
		(else_try),
			(ge,"$cur_choice",0),
			(set_background_mesh,"mesh_pic_messenger1"),
		(try_end),
	],
		[
                                                                                                                                                                                                            ####################  POISON FOOD  ################################
			("cancel_mission",[(this_or_next|eq,"$cur_choice",5),(eq,"$g_spy_rescue_active",-1),],"_RETURN_",
				[	(str_clear,s1),
					(str_clear,s4),
					(assign,"$cur_choice",0),
					(assign,"$g_spy_rescue_active",0),
					(change_screen_map),
				]
			),

#TEMPERED  PASSAGE 3, SPAWN POINT 7
			("rescue_town_center",
							[	(eq,"$g_spy_rescue_active",1),(neq,"$g_battle_result",1),
							],"_",

				[
						(display_message,"@You can not leave through this door."),
				], "Door to town center"
			),

		]
  ),



#TEMPERED  chief    #############################   SPY RESCUE MISSION DEFEAT MENU #############

   ("rescue_defeat",mnf_scale_picture|mnf_disable_all_keys,
   "After unknown hours in {s8}'s dungeon, {s9}",
   "none",
	[	(str_clear,s8),
		(str_clear,s9),
		(str_store_party_name,s8,"$spy_target"),
		(store_troop_gold,":cur_wealth","trp_player"),
		(store_character_level,":cur_level","trp_player"),
		(store_mul,":ransom",":cur_level",600),
		(troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
		(try_begin),
			(eq, ":is_female", 1),
			(set_background_mesh, "mesh_pic_prisoner_fem"),
		(else_try),
			(set_background_mesh, "mesh_pic_prisoner_man"),
		(try_end),
		(party_get_slot,":spy_days","$spy_target",slot_spy_in_town),
		(try_begin),
			(ge,":spy_days",1),
			(party_set_slot,"$spy_target",slot_spy_in_town,0),
			(party_set_slot,"$spy_target",slot_spy_sabotage,0),
			(party_force_add_members,"p_main_party","trp_mercenary_skirmisher",1),
			(party_get_slot,":cur_spy_count","p_main_party",slot_spies_deployed),
		    (val_sub,":cur_spy_count",1),
			(party_set_slot,"p_main_party",slot_spies_deployed,":cur_spy_count"),
			(str_store_string,s9,"@you hear a familiar voice.^Your spy has returned to rescue you.^Climb the damn rope this time. He says."),
			(call_script,"script_update_center_notes","$spy_target"),
			(display_message,"@ One of your spies has returned."),
		(else_try),
			(le,":spy_days",0),
			(try_begin),
				(ge,":cur_wealth",":ransom"),
				(str_store_string,s9,"@your party has secured your release by paying a hefty ransom."),
				(troop_remove_gold,"trp_player",":ransom"),
			(else_try),
				(str_store_string,s9,"@you see your chance and manage to escape."),
			(try_end),
		(try_end),
	],
	[
		("continue",[],"_CONTINUE_",
			[	(str_clear,s8),
				(str_clear,s9),
				(change_screen_map),
			]
		),

	]),


#Tempered   chief  ######################################  SPY CONFIRMATION  ##########################################
   ("spy_confirm",mnf_disable_all_keys,
   "Your spy in {s1} sends word that he will perform the mission within the next 12 hours.",
   "none",
	[	(set_background_mesh, "mesh_pic_messenger1"),
		(str_store_party_name,s1,"$spy_target"),
	],
		[
			("continue",[],"Continue...",
				[
				(str_clear,s1),
				(change_screen_map),
				]
			),
		]
  ),

#Tempered     chief  #########  WILDERNESS TRADE  ##########################################
   ("wilderness_trade",mnf_disable_all_keys,
   "Your messenger is ready to trade with {s7}.",
   "none",
	[	(set_background_mesh, "mesh_pic_messenger1"),
		(assign,":party_no","$target"),
		(party_stack_get_troop_id, ":leader", ":party_no", 0),
		(str_store_troop_name,s7,":leader"),
	],
		[
			("trade_with_party",[],"Trade",
				[
					(assign,":party_no","$target"),
					(party_stack_get_troop_id, ":leader", ":party_no", 0),
					(assign,"$g_encountered_party",":party_no"),
					(change_screen_trade, ":leader"),
				]
			),

			("continue",[],"_Return_",
				[
					(assign,":party_no","$target"),
					(party_stack_get_troop_id, ":leader", ":party_no", 0),
					(troop_get_inventory_capacity,":capacity","trp_temp_troop"),
					(try_for_range,":slot",0,":capacity"),
						(troop_get_inventory_slot,":cur_item","trp_temp_troop",":slot"),
						(gt,":cur_item",0),
						(troop_add_item,":leader",":cur_item"),
					(try_end),
					(troop_clear_inventory,"trp_temp_troop"),
					(party_remove_members,":party_no","trp_temp_troop",1),
					(str_clear,s6),
					(str_clear,s7),
					(change_screen_map),
				]
			),
		]
  ),
#TEMPERED MNU_WILDERNESS_DUEL_WIN
#CALLED FROM MT_WILDERNESS_DUEL
  (
    "wilderness_duel_win",mnf_disable_all_keys,
    "You have beaten {s1} in a duel, proving yourself to be an honorable and formidable opponent.^The lords of the realm will surely take note of your victory.",
    "none",
    [ 	(str_store_troop_name,s1,"$g_talk_troop"),
		(set_background_mesh, "mesh_pic_victory1"),
		(call_script,"script_change_troop_renown","$g_talk_troop",-10),
		(call_script,"script_change_troop_renown","trp_player",10),
		(call_script,"script_change_player_relation_with_troop","$g_talk_troop",-2),
		(assign,"$duel_encounter",-1),
		(str_store_string,s2,"@ You met {s1} in single combat and won."),
		(add_troop_note_from_sreg,"$g_talk_troop",3,s2, 1),
      ],
    [
      ("continue",[],"Continue...",
       [	(store_current_hours,":protected_until"),
			(val_add, ":protected_until", 24),
			(party_set_slot,"$g_encountered_party",slot_party_ignore_player_until,":protected_until"),
			(party_ignore_player, "$g_encountered_party", ":protected_until"),
			(store_faction_of_party,":faction_no","$g_encountered_party"),
			(call_script,"script_get_closest_walled_center_of_faction","$g_encountered_party",":faction_no"),
			(assign,":ai_object",reg0),
			(call_script,"script_party_set_ai_state","$g_encountered_party",spai_retreating_to_center,":ai_object"),
			(party_get_morale,":cur_morale","p_main_party"),
			(val_add,":cur_morale",10),
			(try_begin),
				(gt,":cur_morale",99),
				(assign,":cur_morale",99),
			(try_end),
			(party_set_morale,"p_main_party",":cur_morale"),
			(display_message,"@Your party has gained morale."),
			(str_clear,s1),
			(str_clear,s2),
			(change_screen_map),
        ]),
     ]
  ),

#TEMPERED MNU_WILDERNESS_DUEL_LOSE
#CALLED FROM MT_WILDERNESS_DUEL
  (
    "wilderness_duel_lose",mnf_disable_all_keys,
    "You have been defeated in a duel with {s1}.^Although you have upheld your honor, your reputation with the lords of the realm has suffered.",
    "none",
    [ 	(str_store_troop_name,s1,"$g_talk_troop"),
		(troop_get_type, ":is_female", "trp_player"),
		(val_mod, ":is_female", 2),	#gender fix chief moto
		(try_begin),
			(eq, ":is_female", 1),
			(set_background_mesh, "mesh_pic_wounded_fem1"),
		(else_try),
			(set_background_mesh, "mesh_pic_wounded1"),
		(try_end),
		(call_script,"script_change_troop_renown","trp_player",-10),
		(call_script,"script_change_troop_renown","$g_talk_troop",10),
		(call_script,"script_change_player_relation_with_troop","$g_talk_troop",1),
		(assign,"$duel_encounter",-1),
		(str_store_string,s2,"@ You met {s1} in single combat and lost."),
		(add_troop_note_from_sreg,"$g_talk_troop",3,s2, 1),

      ],
    [
      ("continue",[],"Continue...",
       [	(store_current_hours,":protected_until"),
			(val_add, ":protected_until", 24),
			(party_set_slot,"$g_encountered_party",slot_party_ignore_player_until,":protected_until"),
			(party_ignore_player, "$g_encountered_party", ":protected_until"),
			(store_faction_of_party,":faction_no","$g_encountered_party"),
			(call_script,"script_get_closest_walled_center_of_faction","$g_encountered_party",":faction_no"),
			(assign,":ai_object",reg0),
			(call_script,"script_party_set_ai_state","$g_encountered_party",spai_retreating_to_center,":ai_object"),
			(party_get_morale,":cur_morale","p_main_party"),
			(val_sub,":cur_morale",10),
			(try_begin),
				(gt,":cur_morale",99),
				(assign,":cur_morale",99),
			(try_end),
			(party_set_morale,"p_main_party",":cur_morale"),
			(display_message,"@Your party has lost morale."),
			(str_clear,s1),
			(str_clear,s2),
			(change_screen_map),
        ]),
     ]
  ),
#TEMPERED  MNU_MESSENGER_RETURN
#CALLED FROM SCRIPT GAME_EVENT_PARTY_ENCOUNTER

  (
    "messenger_return",mnf_disable_all_keys,
    "stub",
    "none",
    [	(try_begin),
			(eq,"$reply_shown",1),
			(start_presentation,"prsnt_view_reply"),
		(else_try),
			(eq,"$reply_shown",0),
			(change_screen_map),
		(try_end),
	],
    []
  ),

#TEMPERED  MNU_LOOT_WAGON
#

  (
    "loot_wagon",mnf_disable_all_keys,
    "stub",
    "none",
    [
		(try_begin),
			(le,"$next_screen",0),
			(start_presentation,"prsnt_manage_loot_wagon"),
		(else_try),
			(eq,"$next_screen",2),
			(assign,"$next_screen",0),
			(change_screen_exchange_with_party, "p_temp_loot_wagon"),
		(else_try),
			(eq,"$next_screen",1),
			(assign,"$next_screen",0),
			(start_presentation,"prsnt_wagon_leader"),
		(else_try),
			(eq,"$next_screen",3),
			(assign,"$next_screen",0),
			(start_presentation,"prsnt_loot_choose_town"),
		(else_try),
			(eq,"$next_screen",4),
			(assign,"$next_screen",0),
			(change_screen_loot, "trp_loot_wagon_storage_1"),
		(else_try),
			(eq,"$next_screen",5),
			(assign,"$next_screen",0),
			(call_script,"script_loot_wagon_ai"),
			(change_screen_map),
		(else_try),
			(eq,"$next_screen",6),
			(assign,"$next_screen",0),
			(change_screen_map),
		(try_end),
	],
    [
	]
  ),

#TEMPERED  BUILD NEW SUPPLY WAGON
#CALLED FROM CAMP MENU
  (
    "build_wagon",mnf_disable_all_keys,
    "Your men will spend time building a new supply wagon while you are in camp, as long as you have tools to build it and 2 ponies to pull it. ^It will take one or two days to complete the wagon.",
    "none",
    [
      ],
    [
      ("start_building",	[ 	(eq,"$owns_wagon",0),
								(lt,"$building_wagon",1),
								(call_script,"script_cf_has_wagon_parts"),
							],"Have the troops start building a supply wagon.",
       [	(troop_remove_items,"trp_player","itm_sumpter_horse",1),
			(troop_remove_items,"trp_player","itm_sumpter_horse",1),
			(assign,"$building_wagon",1),
			(troop_clear_inventory,"trp_loot_wagon_storage_1"),
			(display_message,"@ Your troops will build the wagon while you camp."),
			(change_screen_return),
        ]),

      ("continue_wg",	[ 	(try_begin),
							(gt,"$building_wagon",0),
							(str_store_string,s3,"@ The men are still building the"),
						(else_try),
							(lt,"$building_wagon",1),
							(eq,"$owns_wagon",0),
							(str_store_string,s3,"@ Wagon! I don't need no stinking"),
						(try_end),
					]," {s3} wagon.",
       [
			(change_screen_return),
        ]),
     ]
  ),


#TEMPERED chief END
####banquete moral mead chief
     (
    "banquete_moral",0,
    "Order your men to leave their weapons outside and invite them to your Great Hall, to sit at your table by rank. The nearest and dearest close to you.^\
 Some girls serve meat and mead in large quantities. You've spent a lot of money on this feast because your men deserve it.^\
 They are the ones who bleed with you, who have helped you conquer your domains. They are your faithful followers.^\
 The evening progresses, many men are drunk as vats, shout and sing. Some run off to vomit and others fight like gamecocks to attract the attention of a girl.^\
 Behind you a bard sings of your power and deeds. You act like a lord, you are a lord... a 'shepherd of men.'",
    "none",
    [
     (set_background_mesh, "mesh_festin"),
      ],
    [
      ("banquete_ok",[],"You drink, laugh and shout as they come.",
       [
      (call_script, "script_change_player_party_morale", 14),
      (call_script, "script_change_player_honor", -3),
      (rest_for_hours_interactive, 3, 5, 1), #rest while attackable
         (change_screen_return),
       ]),
      ("banquete_ok2",[],"You stay sober, taste the drink nearest to you, but no more than necessary.",[
      (call_script, "script_change_player_party_morale", 10),
      (rest_for_hours_interactive, 3, 5, 1), #rest while attackable
          (change_screen_return)]),
    ],
  ),
####banquete moral chief acaba
#comprar cattle chief
     (
    "comprar_cattle2",0,
    "There are {reg5} heads of cattle, each for {reg6} scillingas. How many do you want to buy?",
    "none",
    [
     (set_background_mesh, "mesh_pic_cattle"),
                (party_get_slot, reg5, "$g_encountered_party", slot_village_number_of_cattle),
                                        (gt, reg5, 0),
                                        (store_item_value, ":cattle_cost", "itm_cattle_meat"),
                                        (call_script, "script_game_get_item_buy_price_factor", "itm_cattle_meat"),
                                        (val_mul, ":cattle_cost", reg0),
                                        #Multiplied by 2 and divided by 100
                                        (val_div, ":cattle_cost", 50),
                                        (assign, "$temp", ":cattle_cost"),
                                        (assign, reg6, ":cattle_cost"),
     ],
    [
      ("cattle_ok",[
          (party_get_slot, ":num_cattle", "$g_encountered_party", slot_village_number_of_cattle),
                                              (ge, ":num_cattle", 1),
                                              (store_troop_gold, ":gold", "trp_player"),
                                              (ge, ":gold", "$temp"),
          ],"One.",
       [
(call_script, "script_buy_cattle_from_village", "$g_encountered_party", 1, "$temp"),
       ]),
      ("cattle_ok2",[(party_get_slot, ":num_cattle", "$g_encountered_party", slot_village_number_of_cattle),
                                              (ge, ":num_cattle", 5),
                                              (store_troop_gold, ":gold", "trp_player"),
                                              (store_mul, ":cost", "$temp", 5),
                                              (ge, ":gold", ":cost"),
                     ],"Five",[
(call_script, "script_buy_cattle_from_village", "$g_encountered_party", 5, "$temp"),
]),
      ("cattle_ok3",[
          ],"Forget it.",
       [
           (jump_to_menu,"mnu_village"),
          ]),
    ],
  ),
#cattle acaba chief

#EXPORT NPC'S
      ("export_import_npcs", mnf_enable_hot_keys,
       "Please choose an NPC, then press key C to view and export/import this character.^^You choose {reg0?{s0}:none}.",
       "none",
        [
          (assign, reg0, "$g_player_troop"),
          (str_store_troop_name, s0, "$g_player_troop"),
        ],
        [
          ("export_import_back",[],"Go back",
            [
              (assign, "$g_player_troop", "trp_player"),
              (set_player_troop, "$g_player_troop"),
              (jump_to_menu, "mnu_camp_action"),
            ]
          ),
        ]+[("export_import_npc"+str(x+1),
            [
              (store_add, ":dest_npc", "trp_npc1", x),
              (str_store_troop_name, s0, ":dest_npc"),
            ], "{s0}",
            [
              (store_add, ":dest_npc", "trp_npc1", x),
              (assign, "$g_player_troop", ":dest_npc"),
              (set_player_troop, "$g_player_troop"),
            ]) for x in range(0, 8)]+[
          ("export_import_next",[],"Next page", [(jump_to_menu, "mnu_export_import_npcs_2")]),
        ]
      ),

      ("export_import_npcs_2", mnf_enable_hot_keys,
        "Please choose an NPC, then press key C to view and export/import this character.^^You choose {reg0?{s0}:none}.",
        "none",
         [
           (assign, reg0, "$g_player_troop"),
           (str_store_troop_name, s0, "$g_player_troop"),
         ],
        [
          ("export_import_prev",[],"Previous page", [(jump_to_menu, "mnu_export_import_npcs")]),
        ]+[("export_import_npc"+str(x+1),
          [
            (store_add, ":dest_npc", "trp_npc1", x),
            (str_store_troop_name, s0, ":dest_npc"),
          ], "{s0}",
          [
            (store_add, ":dest_npc", "trp_npc1", x),
            (assign, "$g_player_troop", ":dest_npc"),
            (set_player_troop, "$g_player_troop"),
          ]) for x in range(8, 16)]
      ),
# chief CHANGES END######################

  (
    "auto_return_to_map",0,
    "stub",
    "none",
    [(change_screen_map)],
    []
  ),

    (
    "bandit_lair",0,
    "{s3}",
    "none",
    [
      (try_begin),
        (eq, "$loot_screen_shown", 1),

        (try_for_range, ":bandit_template", "pt_steppe_bandits", "pt_deserters"),
          (party_template_slot_eq, ":bandit_template", slot_party_template_lair_party, "$g_encountered_party"),
          (party_template_set_slot, ":bandit_template", slot_party_template_lair_party, 0),
        (try_end),

        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":template", "$g_encountered_party"),
	      (neq, ":template", "pt_looter_lair"),
          (remove_party, "$g_encountered_party"),
        (try_end),

        (assign, "$g_leave_encounter", 0),
        (change_screen_return),

      (else_try),
        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
        (str_store_troop_name_plural, s4, ":bandit_type"),
        (str_store_string, s5, "str_bandit_approach_defile"),

        (try_begin),
          (eq, ":bandit_type", "trp_desert_bandit"),
          (str_store_string, s5, "str_bandit_approach_defile"),
        (else_try),
          (eq, ":bandit_type", "trp_mountain_bandit"),
          (str_store_string, s5, "str_bandit_approach_cliffs"),
        (else_try),
          (eq, ":bandit_type", "trp_forest_bandit"),
          (str_store_string, s5, "str_bandit_approach_swamp"),
        (else_try),
          (eq, ":bandit_type", "trp_taiga_bandit"),
          (str_store_string, s5, "str_bandit_approach_swamp"),
        (else_try),
          (eq, ":bandit_type", "trp_steppe_bandit"),
          (str_store_string, s5, "str_bandit_approach_thickets"),
        (else_try),
          (eq, ":bandit_type", "trp_sea_raider"),
          (str_store_string, s5, "str_bandit_approach_cove"),
        (else_try), #chief anadido
          (eq, ":bandit_type", "trp_black_khergit_horseman"),
          (str_store_string, s5, "str_bandit_approach_cove"),
        (try_end),

        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable
          (str_store_string, s3, "str_bandit_hideout_preattack"),
        (else_try),
          (party_get_template_id, ":template", "$g_encountered_party"),
	      (eq, ":template", "pt_looter_lair"),
          (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 1), #used in place of global variable
          (str_store_string, s3, "str_lost_startup_hideout_attack"),
		(else_try),
          (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 1), #used in place of global variable
          (str_store_string, s3, "str_bandit_hideout_failure"),
        (else_try),
          (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 2), #used in place of global variable
          (str_store_string, s3, "str_bandit_hideout_success"),
        (try_end),
      (try_end),
    ],
    [
      ("continue_1",
      [
        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable
	  ],
	  "Attack the hideout...",

	  [
	    (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 1),
	    (party_get_template_id, ":template", "$g_encountered_party"),
	    (assign, "$g_enemy_party", "$g_encountered_party"),

	    (try_begin),
	      (eq, ":template", "pt_sea_raider_lair"),
	      (assign, ":bandit_troop", "trp_sea_raider"),
	      (assign, ":scene_to_use", "scn_lair_sea_raiders"),
	    (else_try),	#chief puesto
	      (eq, ":template", "pt_sea_raider_lair2"),
	      (assign, ":bandit_troop", "trp_black_khergit_horseman"),
	      (assign, ":scene_to_use", "scn_lair_sea_raiders2"),
	    (else_try),
	      (eq, ":template", "pt_forest_bandit_lair"),
	      (assign, ":bandit_troop", "trp_forest_bandit"),
	      (assign, ":scene_to_use", "scn_lair_forest_bandits"),
	    (else_try),
	      (eq, ":template", "pt_desert_bandit_lair"),
	      (assign, ":bandit_troop", "trp_desert_bandit"),
	      (assign, ":scene_to_use", "scn_lair_desert_bandits"),
	    (else_try),
	      (eq, ":template", "pt_mountain_bandit_lair"),
	      (assign, ":bandit_troop", "trp_mountain_bandit"),
	      (assign, ":scene_to_use", "scn_lair_mountain_bandits"),
	    (else_try),
	      (eq, ":template", "pt_taiga_bandit_lair"),
	      (assign, ":bandit_troop", "trp_taiga_bandit"),
	      (assign, ":scene_to_use", "scn_lair_taiga_bandits"),
	    (else_try),
	      (eq, ":template", "pt_steppe_bandit_lair"),
	      (assign, ":bandit_troop", "trp_steppe_bandit"),
	      (assign, ":scene_to_use", "scn_lair_steppe_bandits"),
	    (else_try),
	      (eq, ":template", "pt_looter_lair"),
	      (assign, ":bandit_troop", "trp_looter"),

	      (store_faction_of_party, ":starting_town_faction", "$g_starting_town"),

#cambiadas facciones abajo chief
	      (try_begin),
	        (eq, ":starting_town_faction", "fac_kingdom_18"), #player selected swadian city as starting town.
	        (assign, ":scene_to_use", "scn_lair_forest_bandits"),
	      (else_try),
	        (eq, ":starting_town_faction", "fac_kingdom_4"), #player selected Vaegir city as starting town.
	        (assign, ":scene_to_use", "scn_lair_taiga_bandits"),
	      (else_try),
	        (eq, ":starting_town_faction", "fac_kingdom_23"), #player selected Khergit city as starting town.
	        (assign, ":scene_to_use", "scn_lair_steppe_bandits"),
	      (else_try),
	        (eq, ":starting_town_faction", "fac_kingdom_1"), #player selected Nord city as starting town.
	        (assign, ":scene_to_use", "scn_lair_sea_raiders"),
	      (else_try),
	        (eq, ":starting_town_faction", "fac_kingdom_31"), #player selected Rhodok city as starting town.
	        (assign, ":scene_to_use", "scn_lair_mountain_bandits"),
	      (else_try),
	        (eq, ":starting_town_faction", "fac_kingdom_28"), #player selected Sarranid city as starting town.
	        (assign, ":scene_to_use", "scn_lair_desert_bandits"),
	      (try_end),
	    (try_end),

	    (modify_visitors_at_site,":scene_to_use"),
	    (reset_visitors),

        (store_character_level, ":player_level", "trp_player"),
        (store_add, ":number_of_bandits_will_be_spawned_at_each_period", 5, ":player_level"),
        (val_div, ":number_of_bandits_will_be_spawned_at_each_period", 3),

	    (try_for_range, ":unused", 0, ":number_of_bandits_will_be_spawned_at_each_period"),
	      (store_random_in_range, ":random_entry_point", 2, 11),
	      (set_visitor, ":random_entry_point", ":bandit_troop", 1),
	    (try_end),

	    (party_clear, "p_temp_casualties"),

	    (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission,"mt_bandit_lair"),

        (jump_to_scene, ":scene_to_use"),
        (change_screen_mission),
	  ]),

#COOP Bandit lair chief #############################
##      ("coop_setup",
##       [
##        (call_script, "script_coop_get_battle_state", 1), #sets coop_battle_state
##        (this_or_next|ge, "$cheat_mode", 1),
##        (eq, "$coop_battle_state", coop_battle_state_none),
##        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0), #used in place of global variable
##        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
##		    (is_between, ":bandit_type", bandits_begin, bandits_end),     #dont include looter lair
##       ],
##       "Setup multiplayer battle.",
##       [
##        (assign, "$coop_battle_type", coop_battle_type_bandit_lair),
##        (assign, "$coop_encountered_party", "$g_encountered_party"),
##
##        (store_character_level, ":player_level", "trp_player"),
##        (store_add, ":number_of_bandits_will_be_spawned", 5, ":player_level"),
##
##        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
##        (party_stack_get_size, ":stack_size", "$g_encountered_party", 0),
##        (val_sub, ":number_of_bandits_will_be_spawned", ":stack_size"),
##        (party_add_members, "$g_encountered_party", ":bandit_type", ":number_of_bandits_will_be_spawned"),
##
##        (call_script, "script_coop_copy_parties_to_file_sp"),#clears registers
##        (try_begin),
##          (eq, "$coop_skip_menu", 1),
##          (change_screen_quit),
##        (try_end),
##       ]),
##
##
##      ("quit",[
##        (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##        (eq, "$coop_battle_state", coop_battle_state_setup_sp),
##      ],"Quit game (will not save).",
##      [
##        (change_screen_quit),
##      ]),
##
##      ("coop_use_result",[
##         (this_or_next|ge, "$cheat_mode", 1),#always allow in cheat mode
##         (eq, "$coop_battle_state", coop_battle_state_end_mp),
##
##        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
##		    (is_between, ":bandit_type", bandits_begin, bandits_end),     #dont include looter lair
##      ],"Use multiplayer battle results.",
##      [
##      (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
##	    (assign, "$g_enemy_party", "$g_encountered_party"),
##
##      (call_script, "script_coop_copy_file_to_parties_sp"),	     #remove troops from parties
##      (party_add_members, "$g_encountered_party", ":bandit_type", 1), #add one to remember what type
##
##      (try_begin),
##        (eq, "$g_battle_result", 1), #player won
##        (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 2),
##      (else_try),
##        (eq, "$g_battle_result", -1), #enemy won
##        (party_set_slot, "$g_encountered_party", slot_party_ai_substate, 1),
##	    (try_end),
##      ]),
##
##      ("encounter_save",[
##        (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0),
##        (party_stack_get_troop_id, ":bandit_type", "$g_encountered_party", 0),
##		    (is_between, ":bandit_type", bandits_begin, bandits_end),     #dont include looter lair
##        ],"Give me time to save.",
##      [
##        (call_script, "script_coop_get_battle_state", 2),
##        (leave_encounter),
##        (change_screen_return),
##       # (rest_for_hours, 1, 1, 0),#rest while not attackable
##      ]),
##
################################################ chief acaba
###rigale chief
      ("trade_hideout", #rigale
      [
	   # (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0),
	   (lt,"$player_honor",-9),
	  ],
	  "Trade with the bandits.",
      [
        (change_screen_trade,"trp_brigand_hideout_merchant"),
      ]),
#rigale chief acaba

      ("leave_no_attack",
      [
	    (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 0),
	  ],
	  "Leave...",
      [
        (change_screen_return),
      ]),

	  ("leave_victory",
	  [
	    (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 2),
	  ],
	  "Continue...",
      [
        (try_for_range, ":bandit_template", "pt_steppe_bandits", "pt_deserters"),
          (party_template_slot_eq, ":bandit_template", slot_party_template_lair_party, "$g_encountered_party"),
          (party_template_set_slot, ":bandit_template", slot_party_template_lair_party, 0),
        (try_end),

        (party_get_template_id, ":template", "$g_encountered_party"),
        (try_begin),
          (neq, ":template", "pt_looter_lair"),
          (check_quest_active, "qst_destroy_bandit_lair"),
          (quest_slot_eq, "qst_destroy_bandit_lair", slot_quest_target_party, "$g_encountered_party"),
          (call_script, "script_succeed_quest", "qst_destroy_bandit_lair"),
        (try_end),

        (assign, "$g_leave_encounter", 0),
        (change_screen_return),

        (try_begin),
          (eq, "$loot_screen_shown", 0),
          (assign, "$loot_screen_shown", 1),
          (try_begin),
            (gt, "$g_ally_party", 0),
            (call_script, "script_party_add_party", "$g_ally_party", "p_temp_party"), #Add remaining prisoners to ally TODO: FIX it.
            (call_script,"script_cf_fix_party_size", "$g_ally_party",0),##NNY somebody chief patrullas
          (else_try),
            (party_get_num_attached_parties, ":num_quick_attachments", "p_main_party"),
            (gt, ":num_quick_attachments", 0),
            (party_get_attached_party_with_rank, ":helper_party", "p_main_party", 0),
            (call_script, "script_party_add_party", ":helper_party", "p_temp_party"), #Add remaining prisoners to our reinforcements
            (call_script,"script_cf_fix_party_size", ":helper_party",0),##NNY somebody chief patrullas
          (try_end),
          (troop_clear_inventory, "trp_temp_troop"),

          (party_get_num_companion_stacks, ":num_stacks", "p_temp_casualties"),
          (try_for_range, ":stack_no", 0, ":num_stacks"),
            (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
            (try_begin),
              (party_stack_get_size, ":stack_size", "p_temp_casualties", ":stack_no"),
              (party_stack_get_troop_id, ":stack_troop", "p_temp_casualties", ":stack_no"),
              (gt, ":stack_size", 0),
              (party_add_members, "p_total_enemy_casualties", ":stack_troop", ":stack_size"), #addition_to_p_total_enemy_casualties
              (party_stack_get_num_wounded, ":stack_wounded_size", "p_temp_casualties", ":stack_no"),
              (gt, ":stack_wounded_size", 0),
              (party_wound_members, "p_total_enemy_casualties", ":stack_troop", ":stack_wounded_size"),
            (try_end),
          (try_end),

          (call_script, "script_party_calculate_loot", "p_total_enemy_casualties"), #p_encountered_party_backup changed to total_enemy_casualties
          (gt, reg0, 0),
          (troop_sort_inventory, "trp_temp_troop"),
          (change_screen_loot, "trp_temp_troop"),
        (try_end),

        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":template", "$g_encountered_party"),
	      (eq, ":template", "pt_looter_lair"),
          (remove_party, "$g_encountered_party"),
        (try_end),
      ]),

	  ("leave_defeat",
	  [
	    (party_slot_eq, "$g_encountered_party", slot_party_ai_substate, 1),
	  ],
	  "Continue...",
      [
        (try_for_range, ":bandit_template", "pt_steppe_bandits", "pt_deserters"),
          (party_template_slot_eq, ":bandit_template", slot_party_template_lair_party, "$g_encountered_party"),
          (party_template_set_slot, ":bandit_template", slot_party_template_lair_party, 0),
        (try_end),

        (try_begin),
          (party_get_template_id, ":template", "$g_encountered_party"),
          (neq, ":template", "pt_looter_lair"),
          (check_quest_active, "qst_destroy_bandit_lair"),
          (quest_slot_eq, "qst_destroy_bandit_lair", slot_quest_target_party, "$g_encountered_party"),
          (call_script, "script_fail_quest", "qst_destroy_bandit_lair"),
        (try_end),

        (try_begin),
          (ge, "$g_encountered_party", 0),
          (party_is_active, "$g_encountered_party"),
          (party_get_template_id, ":template", "$g_encountered_party"),
	      (neq, ":template", "pt_looter_lair"),
          (remove_party, "$g_encountered_party"),
        (try_end),

        (assign, "$g_leave_encounter", 0),

		(try_begin),
			(party_is_active, "$g_encountered_party"),
			(party_set_slot, "$g_encountered_party", slot_party_ai_substate, 0),
        (try_end),

        (change_screen_return),
        ]),

     ]
  ),


  (
    "notification_player_faction_political_issue_resolved",0,
    "After consulting with the peers of the realm, {s10} has decided to confer {s11} on {s12}.",
    "none",
    [
	(assign, ":faction_issue_resolved", "$g_notification_menu_var1"),
	(assign, ":faction_decision", "$g_notification_menu_var2"),
	(faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
	(str_store_troop_name, s10, ":leader"),
	(try_begin),
		(eq, ":faction_issue_resolved", 1),
		(str_store_string, s11, "str_the_marshalship"),
	(else_try),
		(str_store_party_name, s11, ":faction_issue_resolved"),
	(try_end),
	(str_store_troop_name, s12, ":faction_decision"),

	],
    [
	   ("continue",
	   [],"Continue...",
       [
        (change_screen_return),
        ]),


	]
  ),

  (
    "notification_player_faction_political_issue_resolved_for_player",0,
    "After consulting with the peers of the realm, {s10} has decided to confer {s11} on you. You may decline the honor, but it will probably mean that you will not receive other awards for a little while.{s12}",
    "none",
    [
	(faction_get_slot, ":leader", "$players_kingdom", slot_faction_leader),
	(str_store_troop_name, s10, ":leader"),
	(faction_get_slot, ":issue", "$players_kingdom", slot_faction_political_issue),
	(try_begin),
		(eq, ":issue", 1),
		(str_store_string, s11, "str_the_marshalship"),
		(str_store_string, s12, "@^^Note that so long as you remain marshal, the lords of the realm will be expecting you to lead them on campaign. So, if you are awaiting a feast, either for a wedding or for other purposes, you may wish to resign the marshalship by speaking to your liege."),
	(else_try),
		(str_clear, s12),
		(str_store_party_name, s11, ":issue"),
	(try_end),
	],
    [
	   ("accept",
	   [],"Accept the honor",
       [
	    (faction_get_slot, ":issue", "$players_kingdom", slot_faction_political_issue),

		(try_begin),
			(eq, ":issue", 1),
		    (call_script, "script_check_and_finish_active_army_quests_for_faction", "$players_kingdom"),
			(call_script, "script_appoint_faction_marshall", "$players_kingdom", "trp_player"),
			(unlock_achievement, ACHIEVEMENT_AUTONOMOUS_COLLECTIVE),
            (else_try),
			(call_script, "script_give_center_to_lord", ":issue", "trp_player", 0), #Zero means don't add garrison
		(try_end),

		(faction_set_slot, "$players_kingdom", slot_faction_political_issue, 0),
		(try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),
			(store_faction_of_troop, ":active_npc_faction", ":active_npc"),
			(eq, ":active_npc_faction", "$players_kingdom"),
			(troop_set_slot, ":active_npc", slot_troop_stance_on_faction_issue, -1),
		(try_end),
        (change_screen_return),
        ]),

	   ("decline",
	   [],"Decline the honor",
       [
	    (faction_get_slot, ":issue", "$players_kingdom", slot_faction_political_issue),
		(try_begin),
			(is_between, ":issue", centers_begin, centers_end),
			(assign, "$g_dont_give_fief_to_player_days", 30),
		(else_try),
			(assign, "$g_dont_give_marshalship_to_player_days", 30),
		(try_end),

		(try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),
			(store_faction_of_troop, ":active_npc_faction", ":active_npc"),
			(eq, ":active_npc_faction", "$players_kingdom"),
			(troop_set_slot, ":active_npc", slot_troop_stance_on_faction_issue, -1),
		(try_end),
        (change_screen_return),
        ]),
	]
  ),

  ("start_phase_2_5",mnf_disable_all_keys,
    "{!}{s16}",
    "none",
    [
      (str_store_party_name, s1, "$g_starting_town"),
      (str_store_string, s16, "$g_journey_string"),
      (set_background_mesh, "mesh_pic_extra_barco"),
      #			(assign, "$g_realistic_casualties",1),	# chief bajas realistas blood
    ],
    [
      ("continue",[], "Continue...",
       [
		 (jump_to_menu, "mnu_start_phase_3"),
       ]),
    ]
  ),


  ("start_phase_3",mnf_disable_all_keys,
    "{s16}^^You are exhausted by the time you find the inn in {s1}, and fall asleep quickly. However, you awake before dawn and are eager to explore your surroundings. You venture out onto the streets, which are still deserted. All of a sudden, you hear a sound that stands the hairs of your neck on end -- the rasp of a blade sliding from its scabbard...",
    "none",
    [     (set_background_mesh, "mesh_pic_extra_malvado"),
      (assign, ":continue", 1),
      (try_begin),
        (eq, "$current_startup_quest_phase", 1),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
        (else_try),
          (str_store_string, s11, "str_wounded_by_bandit_at_alley_fight"),
        (try_end),
        (jump_to_menu, "mnu_start_phase_4"),
        (assign, ":continue", 0),
      (else_try),
        (eq, "$current_startup_quest_phase", 3),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_killed_bandit_at_alley_fight"),
        (else_try),
          (str_store_string, s11, "str_wounded_by_bandit_at_alley_fight"),
        (try_end),
        (jump_to_menu, "mnu_start_phase_4"),
        (assign, ":continue", 0),
      (try_end),

      (str_store_party_name, s1, "$g_starting_town"),
      (str_clear, s16),
      (eq, ":continue", 1),
    ],
    [
      ("continue",[], "Continue...",
       [
         (assign, "$g_starting_town", "$current_town"),
         (call_script, "script_player_arrived"),
         (party_set_morale, "p_main_party", 100),
         (set_encountered_party, "$current_town"),
         (call_script, "script_prepare_alley_to_fight"),
       ]),
    ]
  ),

  ("start_phase_4",mnf_disable_all_keys,
    "{s11}",
    "none",
    [
      (assign, ":continue", 1),
      (try_begin),
        (eq, "$current_startup_quest_phase", 2),
        (change_screen_return),
        (assign, ":continue", 0),
      (else_try),
        (eq, "$current_startup_quest_phase", 3),
        (str_store_string, s11, "str_merchant_and_you_call_some_townsmen_and_guards_to_get_ready_and_you_get_out_from_tavern"),
      (else_try),
        (eq, "$current_startup_quest_phase", 4),
        (try_begin),
          (eq, "$g_killed_first_bandit", 1),
          (str_store_string, s11, "str_town_fight_ended_you_and_citizens_cleaned_town_from_bandits"),
        (else_try),
          (str_store_string, s11, "str_town_fight_ended_you_and_citizens_cleaned_town_from_bandits_you_wounded"),
        (try_end),
      (try_end),

      (eq, ":continue", 1),
    ],
    [
      ("continue",
      [
        (this_or_next|eq, "$current_startup_quest_phase", 1),
        (eq, "$current_startup_quest_phase", 4),
      ],
      "Continue...",
      [
        (assign, "$town_entered", 1),

#cambiadas ciudades abajo chief mercaderes
        (try_begin),
          (eq, "$current_town", "p_town_1"),
          (assign, ":town_merchant", "trp_khergit_merchant"),
          (assign, ":town_room_scene", "scn_town_1_room"),
        (else_try),
          (eq, "$current_town", "p_town_13"),
          (assign, ":town_merchant", "trp_nord_merchant"),
          (assign, ":town_room_scene", "scn_town_5_room"),
        (else_try),
          (eq, "$current_town", "p_town_6"),
          (assign, ":town_merchant", "trp_swadian_merchant"),
          (assign, ":town_room_scene", "scn_town_6_room"),
        (else_try),
          (eq, "$current_town", "p_town_8"),
          (assign, ":town_merchant", "trp_vaegir_merchant"),
          (assign, ":town_room_scene", "scn_town_8_room"),
        (else_try),
          (eq, "$current_town", "p_town_35"),
          (assign, ":town_merchant", "trp_sarranid_merchant"),
          (assign, ":town_room_scene", "scn_town_10_room"),
        (else_try),
          (eq, "$current_town", "p_town_40"),
          (assign, ":town_merchant", "trp_rhodok_merchant"),
          (assign, ":town_room_scene", "scn_town_19_room"),
        (try_end),
#chief acaba
        (modify_visitors_at_site, ":town_room_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 9, ":town_merchant"),

        (assign, "$talk_context", tc_merchants_house),

        (assign, "$dialog_with_merchant_ended", 0),

        (set_jump_mission, "mt_meeting_merchant"),

        (jump_to_scene, ":town_room_scene"),
        (change_screen_mission),
      ]),

      ("continue",
      [
        (eq, "$current_startup_quest_phase", 3),
      ],
      "Continue...",
      [
        (call_script, "script_prepare_town_to_fight"),
      ]),
    ]
  ),


  ("lost_tavern_duel",mnf_disable_all_keys,
    "{s11}",
    "none",
    [
	(try_begin),
		(agent_get_troop_id, ":type", "$g_main_attacker_agent"),
		(eq, ":type", "trp_belligerent_drunk"),
		(str_store_string, s11, "str_lost_tavern_duel_ordinary"),
	(else_try),
		(agent_get_troop_id, ":type", "$g_main_attacker_agent"),
		(eq, ":type", "trp_hired_assassin"),
		(str_store_string, s11, "str_lost_tavern_duel_assassin"),
	(try_end),
	(troop_set_slot, "trp_hired_assassin", slot_troop_cur_center, -1),
        ],
    [
      ("continue",[],"Continue...",
       [
         (jump_to_menu, "mnu_town"),
       ]),
    ]
  ),


  ("establish_court",mnf_disable_all_keys,
    "To establish {s4} as your court will require a small refurbishment. In particular, you will need a set of tools and a bolt of fine cloth. it may also take a short while for some of your followers to relocate here. Do you wish to proceed?",
    "none",
    [
	(str_store_party_name, s4, "$g_encountered_party"),
	],

    [
      ("establish",[
	  (player_has_item, "itm_tools"),
	  (player_has_item, "itm_velvet"),
	  ],"Establish {s4} as your court",
       [
		(assign, "$g_player_court", "$current_town"),
	    (troop_remove_item, "trp_player", "itm_tools"),
	    (troop_remove_item, "trp_player", "itm_velvet"),
        (jump_to_menu, "mnu_town"),
       ]),


      ("continue",[],"Hold off...",
       [
         (jump_to_menu, "mnu_town"),
       ]),
    ]
  ),

  ("notification_relieved_as_marshal", mnf_disable_all_keys,
    "{s4} wishes to inform you that your services as marshal are no longer required. In honor of valiant efforts on behalf of the realm over the last {reg4} days, however, {reg8?she:he} offers you a purse of {reg5} scillingas.",
    "none",
    [
	(assign, reg4, "$g_player_days_as_marshal"),



	(store_div, ":renown_gain", "$g_player_days_as_marshal",4),
	(val_min, ":renown_gain", 20),
	(store_mul, ":denar_gain", "$g_player_days_as_marshal", 50),
	(val_max, ":denar_gain", 200),
	(val_min, ":denar_gain", 4000),
	(troop_add_gold, "trp_player", ":denar_gain"),
	(call_script, "script_change_troop_renown", "trp_player", ":renown_gain"),
	(assign, "$g_player_days_as_marshal", 0),
	(assign, "$g_dont_give_marshalship_to_player_days", 15),
	(assign, reg5, ":denar_gain"),

	(faction_get_slot, ":faction_leader", "$players_kingdom", slot_faction_leader),
	(str_store_troop_name, s4, ":faction_leader"),

 ## Gender fix chief para alturas
       (troop_get_type, reg8, ":faction_leader"),
    (val_mod, reg8, 2),
#gender fix chief acaba
	],

	 [
      ("continue",[],"Continue",
       [
         (change_screen_return),
       ]),
    ]
  ),


####introduccion chief para jugar en Brytenwalda
    (
    "introduccion_1",0,
    "My name is Mildgyd The Old, and if you delve into this world, I recommend you listen carefully...^^\
Britain. The Britons call her Ynys Prydein, the Irish call her Alba while the Angles and Saxons gave the name of Englaland to the lands they conquered. The old isle has seen many conquerors and invaders, and for centuries the blood of warriors has fed the earth. First the Britons were here. Then the Romans came and they subdued the island they called Britannia. Some of the Britons became Roman themselves, and in the north the legions kept fighting the barbarians for many years. But one day, the empire fell and the legions withdrew from the island.^^\
What remained of Roman Britain was raided by Picts and Irishmen alike. The great wall built by the Romans from the sea of Ireland to the sea of Germany was no longer of any use, and their forts were deserted. The Britons, who had worshipped the God of the Christians were the prey of the barbarians and their internecine wars.\
To help them against their foes, they invited among them the fierce Saxons. But it was not long before they broke the alliance and rose against those who had welcomed them. For many years wars scorched the land, and strong leaders left their legacies: Emrys, Arthur, Urien in the north. Among them, Arthur had achieved the greatest success, slaughtering the Jutes and the Saxons at Mynydd Badon and forcing them into a lasting peace for 50 years.^^\
But the worst foes of the Britons were the Britons themselves, and their kings spent more time killing each other than fighting the invaders. This was enough for the Angles and Saxons to conquer more and more land in Britain, taking one realm after another.",
    "none",
    [ (set_background_mesh, "mesh_pic_extra_combate"),],
    [
      ("introduccion_yes", [], "Continue...",
       [
          (jump_to_menu, "mnu_introduccion_1_1"),
        ]),
    ]
  ),

    (
    "introduccion_1_1",0,
    "Saxon kingdoms replaced them, and Britons fell under the rule of Saxon masters. Mercia, Wessex, Kent, East Anglia and Bernicia are today the most powerful kingdoms of the foreigners. After Urien Rheged was slain the kings of Bernicia brought the Old North to its knees. That was so, until Cadwallon of Gwynedd and Penda of Mercia joined forces and crushed the Angles of Bernicia and Deira and killed the Brytenwalda Edwin at Haethfelth. For one year the king of Gwynedd ravaged the realms north of the Humber, before being killed by Oswald, the new king of Bernicia.^^\
With his Briton allies Cadafael of Gwynedd and Cynddylan Pengwern, Penda the pagan king of Mercia is gathering his warbands for a new campaign against the Bernicians. From the far north, echoes the clash of swords between the Scots of Dal Riada, the Picts of Fortriu and the men of Alt Cluit. In the south the Britons of Dumnonia and Gwent are facing the threat of the Gaewissae and Hwicce. The warlords of Ireland are fighting each other to become the new Ard Ruire.^^\
My story is not over, warrior. It is for you to continue, to become a warlord praised by the bards for centuries to come, to lead this island to its fate.\
Once again women shall be widowed and horses carry arms instead of hay. Again the echoes of shouts from assaulting warriors shall fill the air, and the earth lie barren before scattering armies. Again mortal enemies shall rise equipped in armour.^^\
Ravens are calling, wolves are howling, spears clash and shields answer.",
    "none",
    [ (set_background_mesh, "mesh_pic_extra_combate"),],
    [
      ("introduccion_yes2", [], "Continue...",
       [
          (jump_to_menu, "mnu_introduccion_2"),
        ]),
    ]
  ),

    (
    "introduccion_2",0,
    "                              BRYTENWALDA PRESENTS:",
    "none",
    [ (set_background_mesh, "mesh_pic_extra_intro1"),],
    [
      ("introduccion_yes3", [], "Continue...",
       [
         (start_presentation, "prsnt_brytenwalda_story"),

          #(jump_to_menu, "mnu_introduccion_3"),
        ]),
      ("introduccion_yes4", [], "Back.",
       [
          (jump_to_menu, "mnu_start_game_0"),
        ]),
    ]
  ),

    (
    "introduccion_3",0,
    "In the first centuries after the departure of Roman troops, the ancient province of Britannia faced one of the biggest threats in its history...^^\
Taking advantage of the weakness of Britain, the Irish from the west and the Picts from the north threw themselves in like wolves onto prey to loot the remains of a once wealthy empire.^^\
From Europe several Germanic peoples arrived: Jutes, Angles and Saxons, and to a lesser extent, lower Frisians and other tribes.\
First came the warriors, thousands of them, invited by the Britons to help them against the raiding Picts and Irish. But the Anglo-Saxons rebelled and subdued the ground with anger and fire. Then came whole families, settlers of the new kingdoms created by the warriors. Conquered Britons adopted their cultures and language. This is the origin of what will become England.^^\
By the 7th century, the Anglo-Saxons ruled the eastern half of the island, and mighty kingdoms clashed together. The strongest king among the Angles and Saxons was known as Brytenwalda: Master of Britain. In year 636 AD, the title was held by Oswald, king of Bernicia, the northernmost kingdom of the Angles. The Britons of Gwynedd wanted to take revenge on him for the death of their king Cadwallon, and the pagan king Penda of Mercia wanted to take his power.^\
It is a heroic age, a time of fear and steel. A time that many do not know, but can now stir their interest.^^\
Brytenwalda team brings you the 7th century - The Dark Ages - attempting to recreate it as closely as a video game allows. We have for you a time machine...^\
If what we've told you excites eagerness, and curiosity has not deserted you, go forth and explore... Maybe, if you're lucky enough history will record your footsteps and your story will be told as we today speak of Arthur.",
    "none",
    [ (set_background_mesh, "mesh_pic_extra_intro2"),],
    [
      ("introduccion_yes4", [], "Let's go.",
       [
          (jump_to_menu, "mnu_start_game_0"),
        ]),
    ]
  ),

  ##########################grueso chief###################################


  ("economia_report",0,
   "You need see...",
   "none",
   [],
	[
           ("dplmc_show_economic_report",[],"View prosperity report.",
       [
           (jump_to_menu, "mnu_dplmc_economic_report"),
        ]
       ),

      ("spy_report",[],"View Spy reports.",
		[
			(start_presentation, "prsnt_spy_reports"),
        ]),

      ## CC chief arbol tropas
      ("action_view_upgrade_trees",[],"View upgrade trees.",
       [(start_presentation, "prsnt_upgrade_tree_1"),
        ]
       ),
           ("backl_report",[],"Back.",
       [
           (jump_to_menu, "mnu_reports"),
        ]
       ),
#chief arbol de tropas acaba


	]),


  ##Economic report, currently just for debugging purposes diplomacy chief
  ("dplmc_economic_report",0,
   "{s0}",
   "none",
   [
    (str_clear, s0),
    (str_clear, s1),
    (assign, reg0, 0),
    (str_store_string, s0, "@Prosperity Report^"),

    #Show average prosperity for each faction
    (try_for_range, ":faction", 0, kingdoms_end),
       (this_or_next|eq, ":faction", 0),
       (is_between, ":faction", kingdoms_begin, kingdoms_end),

       (this_or_next|eq, ":faction", 0),
       (faction_slot_eq, ":faction", slot_faction_state, sfs_active),

       (try_begin),
          (eq, ":faction", 0),
          (str_store_string, s1, "@Total"),
       (else_try),
          #MOTO chief fix report
                (str_store_faction_name, s1, ":faction"),
                # (faction_get_slot, reg0, ":faction",      slot_faction_adjective),
                # (gt, reg0, 0),
                # (str_store_string, s1, reg0),
                #MOTO end fix report
    (else_try),
          (str_store_faction_name, s1, ":faction"),
       (try_end),

       ##(1) Faction Prosperity, towns
       (assign, ":sum", 0),
       (assign, ":q_5", 0),
       (assign, ":q_4", 0),
       (assign, ":q_3", 0),
       (assign, ":q_2", 0),
       (assign, ":q_1", 0),
       (assign, ":num", 0),

       (try_for_range, ":center_no", towns_begin, towns_end),
          (store_faction_of_party, reg0, ":center_no"),
          (this_or_next|eq, ":faction", 0),
          (eq, reg0, ":faction"),
          (val_add, ":num", 1),
          (party_get_slot, reg0, ":center_no", slot_town_prosperity),
          (val_add, ":sum", reg0),
          (try_begin),
             (lt, reg0, 20),
             (val_add, ":q_1", 1),
          (else_try),
             (lt, reg0, 40),
             (val_add, ":q_2", 1),
          (else_try),
             (lt, reg0, 60),
             (val_add, ":q_3", 1),
          (else_try),
             (lt, reg0, 80),
             (val_add, ":q_4", 1),
          (else_try),
             (val_add, ":q_5", 1),
          (try_end),
       (try_end),

       (assign, reg0, ":num"),
       (val_max, reg0, 1),
       (store_div, reg0, ":sum", reg0),
       (str_store_string, s0, "@{s0}^{s1} Average Town Prosperity: {reg0}"),
       (assign, reg0, ":q_5"),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, reg0, 0),
          (str_store_string, s0, "@{s0}^{s1} towns with prosperity 80-100: {reg0}"),
       (try_end),
       (assign, reg0, ":q_4"),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, reg0, 0),
          (str_store_string, s0, "@{s0}^{s1} towns with prosperity 60-79: {reg0}"),
       (try_end),
       (assign, reg0, ":q_3"),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, reg0, 0),
          (str_store_string, s0, "@{s0}^{s1} towns with prosperity 40-59: {reg0}"),
       (try_end),
       (assign, reg0, ":q_2"),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, reg0, 0),
          (str_store_string, s0, "@{s0}^{s1} towns with prosperity 20-39: {reg0}"),
       (try_end),
       (assign, reg0, ":q_1"),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, reg0, 0),
          (str_store_string, s0, "@{s0}^{s1} towns with prosperity 0-19: {reg0}"),
       (try_end),

       (str_store_string, s0, "@{!}{s0}^"),

       ##(2) Faction Prosperity, villages
       (assign, ":sum", 0),
       (assign, ":q_5", 0),
       (assign, ":q_4", 0),
       (assign, ":q_3", 0),
       (assign, ":q_2", 0),
       (assign, ":q_1", 0),
       (assign, ":num", 0),

       (try_for_range, ":center_no", villages_begin, villages_end),
          (store_faction_of_party, reg0, ":center_no"),
          (this_or_next|eq, ":faction", 0),
          (eq, reg0, ":faction"),
          (val_add, ":num", 1),
          (party_get_slot, reg0, ":center_no", slot_town_prosperity),
          (val_add, ":sum", reg0),
          (try_begin),
             (lt, reg0, 20),
             (val_add, ":q_1", 1),
          (else_try),
             (lt, reg0, 40),
             (val_add, ":q_2", 1),
          (else_try),
             (lt, reg0, 60),
             (val_add, ":q_3", 1),
          (else_try),
             (lt, reg0, 80),
             (val_add, ":q_4", 1),
          (else_try),
             (val_add, ":q_5", 1),
          (try_end),
       (try_end),

       (assign, reg0, ":num"),
       (val_max, reg0, 1),
       (store_div, reg0, ":sum", reg0),
       (str_store_string, s0, "@{s0}^{s1} Average Village Prosperity: {reg0}"),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, ":q_5", 0),
          (assign, reg0, ":q_5"),
          (str_store_string, s0, "@{s0}^{s1} villages with prosperity 80-100: {reg0}"),
       (try_end),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, ":q_4", 0),
          (assign, reg0, ":q_4"),
          (str_store_string, s0, "@{s0}^{s1} villages with prosperity 60-79: {reg0}"),
       (try_end),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, ":q_3", 0),
          (assign, reg0, ":q_3"),
          (str_store_string, s0, "@{s0}^{s1} villages with prosperity 40-59: {reg0}"),
       (try_end),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, ":q_2", 0),
          (assign, reg0, ":q_2"),
          (str_store_string, s0, "@{s0}^{s1} villages with prosperity 20-39: {reg0}"),
       (try_end),
       (try_begin),
          (this_or_next|eq, ":faction", 0),
          (gt, ":q_1", 0),
          (assign, reg0, ":q_1"),
          (str_store_string, s0, "@{s0}^{s1} villages with prosperity 0-19: {reg0}"),
       (try_end),
       (str_store_string, s0, "@{!}{s0}^"),
    (try_end),
    ],
    [
      ("dplmc_backec",[],"Continue...",
       [
           (jump_to_menu, "mnu_reports"),
        ]),
      ]
  ),
##diplomacy end+ chief

###town port opciones, seafare de duh entre otras chief
  #Exa's OSP
(
   "port",0,
    "You visit the port of {s1}.\
 While you look around you feel the strong wind from the ocean pulling on your clothes.\
 Many ships are anchored here and you notice that crews are already loading them with native goods, while a group of men is still discharging their cargo.\
 One of them seems to be in charge of the harbor, so you walk up to them and ask him for help.\
 He looks at you and says:^What do you want lad? Don't ya see that I am busy?",
    "none",
    [
	(set_background_mesh,"mesh_pic_extra_barco"),
    (str_store_party_name,s1,"$current_town"),
	(try_begin),
		(eq, "$crew_screen_state", 1),
		(change_screen_exchange_members, 0, "$ship"),
		(assign, "$crew_screen_state", 2),
	(else_try),
		(eq, "$crew_screen_state", 2),
		(assign, "$crew_screen_state", 0),
		(start_presentation, "prsnt_manage_ships"),
	(else_try),
		(eq, "$crew_screen_state", 3),
		(jump_to_menu, "mnu_ship_notes"),
		(assign, "$crew_screen_state", 2),
	(try_end),
	(str_clear, s10), ##For the dummy options at the bottom
    ],
[
("town_port",[(party_slot_eq,"$current_town",slot_party_type, spt_town),
                         (party_slot_eq,"$current_town",slot_town_port, 1),
              ],
       "Visit town port",
       [
           (assign, "$talk_context", 0),
           (try_begin),
             (call_script, "script_cf_enter_center_location_bandit_check"),
           (else_try),

		(try_begin),
          (eq, "$current_town", "p_town_2"),
			(assign, ":port_scene", "scn_port"),
		(else_try),
          (eq, "$current_town", "p_town_13"),
			(assign, ":port_scene", "scn_port"),
		(else_try),
          (eq, "$current_town", "p_town_27"),
			(assign, ":port_scene", "scn_port"),
		(else_try),
          (eq, "$current_town", "p_town_7"),
			(assign, ":port_scene", "scn_port2"),
		(else_try),
          (eq, "$current_town", "p_town_17"),
			(assign, ":port_scene", "scn_port2"),
		(else_try),
          (eq, "$current_town", "p_town_37"),
			(assign, ":port_scene", "scn_port3"),
		(else_try),
          (eq, "$current_town", "p_town_32"),
			(assign, ":port_scene", "scn_port4"),
		(else_try),
          (eq, "$current_town", "p_town_33"),
			(assign, ":port_scene", "scn_port4"),
		(else_try),
			(assign, ":port_scene", "scn_port"),
		(try_end),

             (modify_visitors_at_site, ":port_scene"),
             (reset_visitors),
             (assign, "$g_mt_mode", tcm_default),
			 (set_visitor, 13, "trp_port_recruiter"),
			 (set_visitor, 14, "trp_port_keeper"),
			 (set_visitor, 15, "trp_port_slave_trader"),
             # Setup peasant walkers
             (try_for_range, ":visiterator", 32, 40),
               (store_random_in_range, ":sex", 0, 100),
               (try_begin),
	(lt,":sex",50), #10% risk of tripping
                 (set_visitor, ":visiterator", "trp_village_walker_1",),
               (else_try),
                 (set_visitor, ":visiterator", "trp_village_walker_2",),
               (try_end),
             (try_end),

             (call_script, "script_init_town_walkers"),
             (set_jump_mission,"mt_port_visit"),
             (try_begin),
               (eq, "$town_entered", 0),
               (assign, "$town_entered", 1),
               (eq, "$town_nighttime", 0),
             (try_end),
               (set_jump_entry, 1),
             (jump_to_scene, ":port_scene"),
           (change_screen_mission,0),
           (try_end),
        ]),
#Exa's OSP
#Chief buy ship sea battles con script de control de precio, si no tienes dinero no te da el barco
     ("buy_ships",[#(party_slot_eq,"$current_town",slot_party_type, spt_town),
                         (party_slot_eq,"$current_town",slot_town_port, 1),
                        ], "Buy a ship (20000 scillingas)",
     [
         (try_begin),
		(party_get_slot, ":num_ships", "$current_town", slot_town_has_ship),
		(le, ":num_ships", 4),
      (store_troop_gold,":money","trp_player"),
        (gt,":money",19999),
              (troop_remove_gold,"trp_player",20000),
		(val_add, ":num_ships", 1),
		(party_set_slot, "$current_town", slot_town_has_ship, ":num_ships"),
		(try_begin),
			(set_spawn_radius, 0),
			(spawn_around_party, "$current_town", "pt_ship"),
			(assign, ":new_ship", reg0),
			(party_set_slot, ":new_ship", slot_party_type, spt_ship),
			(party_set_slot, ":new_ship", slot_ship_center, "$current_town"),
			(assign, reg6, ":new_ship"),
		(try_end),
		(display_message,"@You now own a ship and can disembark from this town."),
        (display_message,"@ Remember: to disembark you need to click on a settlement or party.",0xFFFFAAAA),
	(else_try),
		(party_slot_ge, "$current_town", slot_town_has_ship, 5),
		(display_message, "@There is no room for any further ships in this harbor."),
	(else_try),
		(display_message,"@You don't have enough money to buy a ship."),
	(try_end),
        ]),

	("sail_from_port",
	[], "Set sail with your ship.(Min. crew 30, Max 90)",
	[
	(try_begin),
		(party_slot_eq, "$current_town", slot_town_has_ship, 1),
		(assign, ":break", 0),
		(try_for_parties, ":ship_no"),
		    (eq, ":break", 0),
		    (party_slot_eq, ":ship_no", slot_party_type, spt_ship),
			(party_slot_eq, ":ship_no", slot_ship_center, "$current_town"),
			(party_get_num_companions, reg6, ":ship_no"),
			(party_get_num_companions, reg7, "p_main_party"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(party_set_slot, ":ship_no", slot_ship_center, ship_player_sailing), #Represents the player
			(party_set_slot, "p_main_party", slot_town_has_ship, ":ship_no"), #Records that the Player Party has this ship
			(assign, ":break", 1),
		(try_end),
        (eq, ":break", 1),
		(party_set_slot, "$current_town", slot_town_has_ship, 0),
		(assign, "$g_player_icon_state", pis_ship),
		(party_set_flags, "p_main_party", pf_is_ship, 1),
		(party_get_position, pos1, "p_main_party"),
		(party_get_slot, ":dist", "$current_town", slot_town_port),
		(val_add, ":dist", 4),
		(map_get_water_position_around_position, pos2, pos1, ":dist"),
		(party_set_position, "p_main_party", pos2),
		(assign, "$g_main_ship_party", -1),  #CABA - might also store the ship party ID here??
		(change_screen_return),
	(else_try),
		(party_slot_ge, "$current_town", slot_town_has_ship, 2),
		(jump_to_menu, "mnu_choose_ship"), #CABA--move this to a presentation?
	(else_try),
		(display_message,"@You don't own a ship or your crew exceeds the boundaries. You need hire a ship (advance over sea)."),
	(try_end),
    ]),

	("manage_ships",
	[],
	"Manage ships.",
	[	(assign, reg6, -1),
	    (assign, reg8, -1),
	    (str_clear, s11),
		(str_clear, s12),
		(str_clear, s14),
		(start_presentation, "prsnt_manage_ships"),
	]),

	("View_notes",
	[],
	"View the ship registry.",
	[(jump_to_menu, "mnu_ship_notes"),
	]),

    ("back_to_town_menu",
	[],
	"Head back.",
    [(jump_to_menu,"mnu_town"),
    ]),

    ##To move the options up and away from the background image; s10 cleared when menu loads
	("dummy_1",	[],	"{s10}", []),
	("dummy_2",	[],	"{s10}", []),
	("dummy_3",	[],	"{s10}", []),
	("dummy_4",	[],	"{s10}", []),
	]),

#siguiente parte de seafare duh
  (
	"Ship_notes",0,
    "The royal trade guild keeps track of all ships in harbor towns. Viewing their registry will tell you where your ships are.^{s3}",
	"none",
	[	(str_clear, s3),
	    (try_for_range, ":town_no", towns_begin, castles_end),
		    (party_slot_ge, ":town_no", slot_town_port, 1),
			(party_get_slot, reg1, ":town_no", slot_town_has_ship),
			(str_store_party_name, s2, ":town_no"),
			(str_store_string, s3, "@{s3}^You have {reg1} ships in {s2}."),
		(try_end),
	(set_background_mesh,"mesh_pic_extra_barco2"),
	],
	[
	   ("back_to_town_menu",[],"Head back.",
       [
       (jump_to_menu,"mnu_port"),
       ]),
	]),

(
	"choose_ship",0,
    "The following list contains all the ships anchored in this town. Select one to set sail, but make sure your crew meets the requirements.",

	"none",
	[	(assign, reg1, 0),
		(assign, reg2, 0),
		(assign, reg3, 0),
		(assign, reg4, 0),
		(assign, reg5, 0),
		(try_for_parties, ":ship_no",),
		    (party_slot_eq, ":ship_no", slot_party_type, spt_ship),
			(party_slot_eq, ":ship_no", slot_ship_center, "$current_town"),
			(try_begin),
				(eq, reg1, 0),
				(assign, reg1, ":ship_no"),
			(else_try),
				(eq, reg2, 0),
				(assign, reg2, ":ship_no"),
			(else_try),
				(eq, reg3, 0),
				(assign, reg3, ":ship_no"),
			(else_try),
				(eq, reg4, 0),
				(assign, reg4, ":ship_no"),
			(else_try),
				(eq, reg5, 0),
				(assign, reg5, ":ship_no"),
			(try_end),
		(try_end),
	],
	[
		("ship_1",[
		    (neq, reg1, 0),
		    (str_store_party_name, s1, reg1),
			(str_store_string, s1, "@Choose {s1}"),
		],"{s1}",
		[
		(assign, ":ship_no", reg1),
		(try_begin),
			(party_get_num_companions, reg6, "p_main_party"),
			(is_between, reg6, 30, 91),
			(party_get_num_companions, reg7, ":ship_no"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(party_get_slot, ":num_ships", "$current_town", slot_town_has_ship),
			(val_sub, ":num_ships", 1),
			(party_set_slot, "$current_town", slot_town_has_ship, ":num_ships"),
			(party_set_slot, ":ship_no", slot_ship_center, ship_player_sailing), #Player uses ship
			(party_set_slot, "p_main_party", slot_town_has_ship, ":ship_no"), #Player tracking
			(assign, "$g_player_icon_state", pis_ship),
			(party_set_flags, "p_main_party", pf_is_ship, 1),
			(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 6),
			(party_set_position, "p_main_party", pos2),
			(assign, "$g_main_ship_party", -1),
			(change_screen_return),
		(else_try),
			(display_message,"@Your crew is either too small or too large."),
		(try_end),
		]),

		("ship_2",[
		    (neq, reg2, 0),
		    (str_store_party_name, s1, reg2),
			(str_store_string, s1, "@Choose {s1}"),
		],"{s1}",
		[
		(assign, ":ship_no", reg2),
		(try_begin),
			(party_get_num_companions, reg6, "p_main_party"),
			(is_between, reg6, 30, 91),
			(party_get_num_companions, reg7, ":ship_no"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(party_get_slot, ":num_ships", "$current_town", slot_town_has_ship),
			(val_sub, ":num_ships", 1),
			(party_set_slot, "$current_town", slot_town_has_ship, ":num_ships"),
			(party_set_slot, ":ship_no", slot_ship_center, ship_player_sailing), #Player uses ship
			(party_set_slot, "p_main_party", slot_town_has_ship, ":ship_no"), #Player tracking
			(assign, "$g_player_icon_state", pis_ship),
			(party_set_flags, "p_main_party", pf_is_ship, 1),
			(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 6),
			(party_set_position, "p_main_party", pos2),
			(assign, "$g_main_ship_party", -1),
			(change_screen_return),
		(else_try),
			(display_message,"@Your crew is either too small or too large."),
		(try_end),
		]),

		("ship_3",[
		    (neq, reg3, 0),
		    (str_store_party_name, s1, reg3),
			(str_store_string, s1, "@Choose {s1}"),
		],"{s1}",
		[
		(assign, ":ship_no", reg3),
		(try_begin),
			(party_get_num_companions, reg6, "p_main_party"),
			(is_between, reg6, 30, 91),
			(party_get_num_companions, reg7, ":ship_no"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(party_get_slot, ":num_ships", "$current_town", slot_town_has_ship),
			(val_sub, ":num_ships", 1),
			(party_set_slot, "$current_town", slot_town_has_ship, ":num_ships"),
			(party_set_slot, ":ship_no", slot_ship_center, ship_player_sailing), #Player uses ship
			(party_set_slot, "p_main_party", slot_town_has_ship, ":ship_no"), #Player tracking
			(assign, "$g_player_icon_state", pis_ship),
			(party_set_flags, "p_main_party", pf_is_ship, 1),
			(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 6),
			(party_set_position, "p_main_party", pos2),
			(assign, "$g_main_ship_party", -1),
			(change_screen_return),
		(else_try),
			(display_message,"@Your crew is either too small or too large."),
		(try_end),
		]),

		("ship_4",[
		    (neq, reg4, 0),
		    (str_store_party_name, s1, reg4),
			(str_store_string, s1, "@Choose {s1}"),
		],"{s1}",
		[
		(assign, ":ship_no", reg4),
		(try_begin),
			(party_get_num_companions, reg6, "p_main_party"),
			(is_between, reg6, 30, 91),
			(party_get_num_companions, reg7, ":ship_no"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(party_get_slot, ":num_ships", "$current_town", slot_town_has_ship),
			(val_sub, ":num_ships", 1),
			(party_set_slot, "$current_town", slot_town_has_ship, ":num_ships"),
			(party_set_slot, ":ship_no", slot_ship_center, ship_player_sailing), #Player uses ship
			(party_set_slot, "p_main_party", slot_town_has_ship, ":ship_no"), #Player tracking
			(assign, "$g_player_icon_state", pis_ship),
			(party_set_flags, "p_main_party", pf_is_ship, 1),
			(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 6),
			(party_set_position, "p_main_party", pos2),
			(assign, "$g_main_ship_party", -1),
			(change_screen_return),
		(else_try),
			(display_message,"@Your crew is either too small or too large."),
		(try_end),
		]),

		("ship_5",[
		    (neq, reg5, 0),
		    (str_store_party_name, s1, reg5),
			(str_store_string, s1, "@Choose {s1}"),
		],"{s1}",
		[
		(assign, ":ship_no", reg5),
		(try_begin),
			(party_get_num_companions, reg6, "p_main_party"),
			(is_between, reg6, 30, 91),
			(party_get_num_companions, reg7, ":ship_no"),
			(val_add, reg7, reg6),
			(is_between, reg7, 30, 91),
			(party_get_slot, ":num_ships", "$current_town", slot_town_has_ship),
			(val_sub, ":num_ships", 1),
			(party_set_slot, "$current_town", slot_town_has_ship, ":num_ships"),
			(party_set_slot, ":ship_no", slot_ship_center, ship_player_sailing), #Player uses ship
			(party_set_slot, "p_main_party", slot_town_has_ship, ":ship_no"), #Player tracking
			(assign, "$g_player_icon_state", pis_ship),
			(party_set_flags, "p_main_party", pf_is_ship, 1),
			(party_get_position, pos1, "p_main_party"),
			(map_get_water_position_around_position, pos2, pos1, 6),
			(party_set_position, "p_main_party", pos2),
			(assign, "$g_main_ship_party", -1),
			(change_screen_return),
		(else_try),
			(display_message,"@Your crew is either too small or too large."),
		(try_end),
		]),

	   ("back_to_town_menu",[],"Head back.",
       [
       (jump_to_menu,"mnu_port"),
       ]),
	]),

#chief acaba



  #rigale smoking food
      ("camp_smoking_food",0,
   "What food will you smoke ? Some of it may get lost in the process, and it will take some time.",
   "none",
   [],
    [
      ("smoke_fish",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_wilddonkey_meat", imod_rotten),
			(assign, ":player_has_smokable_fish", 1),
			(eq, ":player_has_smokable_fish", 1),
		  ],
		  "I will smoke my meat.",
		  [
			(call_script,"script_rigale_smoke_food","itm_wilddonkey_meat","itm_dried_meat"),
		  ]
      ),
      ("smoke_boar_meat",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_boar_meat", imod_rotten),
			(assign, ":player_has_smokable_boar_meat", 1),
			(eq, ":player_has_smokable_boar_meat", 1),
		  ],
		  "I will smoke my boar meat.",
		  [
			(call_script,"script_rigale_smoke_food","itm_boar_meat","itm_dried_meat"),
		  ]
      ),
      ("smoke_wolf_meat",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_wolf_meat", imod_rotten),
			(assign, ":player_has_smokable_wolf_meat", 1),
			(eq, ":player_has_smokable_wolf_meat", 1),
		  ],
		  "I will smoke my wolf meat.",
		  [
			(call_script,"script_rigale_smoke_food","itm_wolf_meat","itm_dried_meat"),
		  ]
      ),
      ("smoke_coat_meat",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_coat_meat", imod_rotten),
			(assign, ":player_has_smokable_coat_meat", 1),
			(eq, ":player_has_smokable_coat_meat", 1),
		  ],
		  "I will smoke my goat meat.",
		  [
			(call_script,"script_rigale_smoke_food","itm_coat_meat","itm_dried_meat"),
		  ]
      ),
      ("smoke_coat_2_meat",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_coat_2_meat", imod_rotten),
			(assign, ":player_has_smokable_coat_2_meat", 1),
			(eq, ":player_has_smokable_coat_2_meat", 1),
		  ],
		  "I will smoke my goat meat.",
		  [
			(call_script,"script_rigale_smoke_food","itm_coat_2_meat","itm_dried_meat"),
		  ]
      ),
       ("smoke_cattle_meat",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_cattle_meat", imod_rotten),
			(assign, ":player_has_smokable_beef", 1),
			(eq, ":player_has_smokable_beef", 1),
		  ],
		  "I will smoke my beef.",
		  [
			(call_script,"script_rigale_smoke_food","itm_cattle_meat","itm_dried_meat"),
		  ]
      ),
      ("smoke_venison",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_deer_meat", imod_rotten),
			(assign, ":player_has_smokable_venison", 1),
			(eq, ":player_has_smokable_venison", 1),
		  ],
		  "I will smoke my venison.",
		  [
			(call_script,"script_rigale_smoke_food","itm_deer_meat","itm_dried_meat"),
		  ]
      ),
      ("smoke_pork",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_pork", imod_rotten),
			(assign, ":player_has_smokable_pork", 1),
			(eq, ":player_has_smokable_pork", 1),
		  ],
		  "I will smoke my pork.",
		  [
			(call_script,"script_rigale_smoke_food","itm_pork","itm_sausages"),
		  ]
      ),
      ("smoke_pollo",
		  [
			(call_script, "script_cf_player_has_item_without_modifier", "itm_pork", imod_rotten),
			(assign, ":player_has_smokable_pollo", 1),
			(eq, ":player_has_smokable_pollo", 1),
		  ],
		  "I will smoke my chicken.",
		  [
			(call_script,"script_rigale_smoke_food","itm_chicken","itm_sausages"),
		  ]
      ),
      ("leave",
		  [	],
		  "Leave",
		  [
			(jump_to_menu, "mnu_camp"),
		  ]
      ),

	]
 ),
#rigale smoking food acaba
##  #freelancer empieza
#+freelancer start
#menu_world_map_soldier
    ("world_map_soldier",0,
    "What do you need to do soldier?",
    "none",
    [
	 (set_background_mesh, "mesh_pic_nord"),
	 (troop_get_slot, "$enlisted_party", "$enlisted_lord", slot_troop_leaded_party), #CABA - to refresh it? maybe not necessessary
	],
	[
		("join_commander_battle",[
			(party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
			(gt, ":commander_opponent", 0),
		],"Follow the commander into battle.",[
		    (party_set_slot, "p_freelancer_party_backup", slot_party_last_in_combat, 1), #needed to catch post-battle and detach any attached parties

			(try_begin),
				(neg|troop_is_guarantee_horse, "$player_cur_troop"),
				(troop_get_inventory_slot, ":horse", "trp_player", ek_horse),
				(gt, ":horse", 0),
				(troop_get_inventory_slot_modifier, ":horse_imod", "trp_player", ek_horse),
				(set_show_messages, 0),
				(troop_add_item, "trp_player", ":horse", ":horse_imod"),
				(troop_set_inventory_slot, "trp_player", ek_horse, -1),
				(set_show_messages, 1),
			(try_end),
			(start_encounter, "$enlisted_party"),
			(change_screen_map),
		]),

        ("enter_town",[(party_is_in_any_town,"$enlisted_party"),] ,"Enter stationed town.",
        [(party_get_cur_town, ":town_no", "$enlisted_party"),(start_encounter, ":town_no"),(change_screen_map),]),

		("commander",[(party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),(lt, ":commander_opponent", 0),],
		   "Request audience with your commander.",
        [(jump_to_menu, "mnu_commander_aud"),]),

#		("revolt",[],"Revolt against the commander!", #off hasta que este reparado
#        [(jump_to_menu, "mnu_ask_revolt"),]),

		("desert",[],"Desert the army.(keep equipment but lose relations)",
        [(jump_to_menu, "mnu_ask_desert"),]),

		("report",[],"Commander's Report",
		[(start_presentation, "prsnt_taragoth_lords_report"),]),

		("return_to_duty",[
			(party_get_battle_opponent, ":commander_opponent", "$enlisted_party"),
			(this_or_next|lt, ":commander_opponent", 0),
			(troop_is_wounded, "trp_player"),
		],"Return to duty.",
        [(change_screen_map),
		(assign, "$g_infinite_camping", 1),
        (rest_for_hours_interactive, 24 * 365, 5, 1),
		]),
    ]),

#menu_aud_with_commander
  (
    "commander_aud",0,
    "Your request for a meeting is relayed to your commander's camp, and finally {s6} appears from his tent to speak with you.",
    "none",
    [(set_background_mesh, "mesh_pic_extra_viejo"),(str_store_troop_name, s6, "$enlisted_lord")],
    [
      ("continue",[],
       "Continue...",
       [
		(try_begin),
			(neg|party_is_in_any_town, "$enlisted_party"),
			(start_encounter, "$enlisted_party"),
			(change_screen_map),
		(else_try),
			#Fake that it is a party encounter when enlisted party in a town (lines taken from script_game_event_party_encounter)
			(assign, "$g_encountered_party", "$enlisted_party"),
			(store_faction_of_party, "$g_encountered_party_faction","$g_encountered_party"),
			(store_relation, "$g_encountered_party_relation", "$g_encountered_party_faction", "fac_player_faction"),
			(party_get_slot, "$g_encountered_party_type", "$g_encountered_party", slot_party_type),
			(party_get_template_id,"$g_encountered_party_template","$g_encountered_party"),
			(assign, "$talk_context", tc_party_encounter),
			(call_script, "script_setup_party_meeting", "$g_encountered_party"),
		(try_end),
        ]),
		("reject_talk_lord",[],"No, nevermind.",
        [(change_screen_map),]),
    ]
  ),

    #menu_ask_revolt
    ("ask_revolt",0,
    "Are you sure you want to revolt?",
    "none",
    [(set_background_mesh, "mesh_pic_extra_intro2"),(str_store_troop_name, s6, "$enlisted_lord")],[
		("confirm_revolt",[],"Yes, {s6} will be the death of us all, it is time to act!",
        [(jump_to_menu, "mnu_revolt"),]),

		("reject_revolt",[],"No, I am loyal to {s6}.",
        [(change_screen_return),]),
    ]),

    #menu_revolt
    ("revolt",0,
    "Do you want to release the prisoners to help your men?",
    "none",
    [
        (set_background_mesh, "mesh_pic_extra_viejo"),
		(assign, "$cant_leave_encounter", 1),

        #revert parties to former settings
		(call_script, "script_freelancer_detach_party"),
		(call_script, "script_event_player_deserts"),
		#adds other troops to join player revolt
        (call_script, "script_get_desert_troops"),

        #decreases player relation to his commander and faction
        (call_script, "script_change_player_relation_with_troop", "$enlisted_lord", -10),

		(store_troop_faction, ":commander_faction", "$enlisted_lord"),
        (try_begin),
            (party_get_battle_opponent, ":commander_enemy", "$enlisted_party"),
            (gt, ":commander_enemy", 0),
            (store_faction_of_party, ":other_faction", ":commander_enemy"),
            (store_relation, ":relation", ":other_faction", ":commander_faction"),
            (store_sub, ":mod_relation", 100, ":relation"),
            (val_add, ":mod_relation", 5),
            (call_script, "script_change_player_relation_with_faction_ex", ":commander_faction", ":mod_relation"),
        (try_end),
    ],
    [
        ("revolt_prisoners",[],"Yes, I will take the risk for a greater advantage.",
        [
            (party_clear, "p_temp_party_2"),
            #loop adding commander's prisoners to player party as troops
            (party_get_num_prisoner_stacks, ":num_stacks", "$enlisted_party"),
            (try_for_range, ":cur_stack", 0, ":num_stacks"),
                (party_prisoner_stack_get_troop_id , ":prisoner_troop", "$enlisted_party", ":cur_stack"),
                (ge, ":prisoner_troop", 1),
                (party_prisoner_stack_get_size, ":stack_size", "$enlisted_party", ":cur_stack"),
                (party_remove_prisoners, "$enlisted_party", ":prisoner_troop", ":stack_size"),
                (party_add_members, "p_temp_party_2", ":prisoner_troop", ":stack_size"),
            (try_end),
			(party_attach_to_party, "p_temp_party_2", "p_main_party"),
            (start_encounter, "$enlisted_party"),
            (change_screen_map),
        ]),

        ("revolt_no_prisoners",[],"No, I don't trust prisoners.",
        [
			(start_encounter, "$enlisted_party"),
            (change_screen_map),
        ]),

    ]),


    #menu_ask_desert
    ("ask_desert",0,
    "Do you want to desert?",
    "none",
    [(set_background_mesh, "mesh_pic_extra_viejo"),],[
        ("confirm_desert",[],"Yes, this is pointless.",
        [(jump_to_menu, "mnu_desert"),]),

        ("reject_desert",[],"No, I am loyal to my commander.",
        [(change_screen_return),]),
    ]),

    #menu_desert
    ("desert",0,
    "While in the army you've made some good friends. Some could possibly follow you.",
    "none",
    [
        (set_background_mesh, "mesh_pic_extra_viejo"),

		(call_script, "script_freelancer_detach_party"),
		(call_script, "script_event_player_deserts"),
	],
    [
        ("desert_party",[],"Try to convince them to follow you.",[
            #1 in 4 chance of being caught with others
            (store_random_in_range, ":chance_caught", 0, 4),
            (try_begin),
                (eq, ":chance_caught", 0),
				(assign, "$g_encountered_party", "$enlisted_party"),
		        (jump_to_menu, "mnu_captivity_start_wilderness"),
            (else_try),
                (call_script, "script_get_desert_troops"),
				(call_script, "script_party_restore"),
                (call_script, "script_set_parties_around_player_ignore_player", 2, 4),
            (try_end),
            (change_screen_map),(display_message, "@You have deserted, and are now wanted!"), ]),

        ("desert_alone",[],"No, I have a better chance alone.",[
            #1 in 10 chance of being caught alone
            (store_random_in_range, ":chance_caught", 0, 10),
            (try_begin),
                (eq, ":chance_caught", 0),
                (assign, "$g_encountered_party", "$enlisted_party"),
		        (jump_to_menu, "mnu_captivity_start_wilderness"),
            (else_try),
			    (call_script, "script_party_restore"),
                (call_script, "script_set_parties_around_player_ignore_player", 2, 4),
            (try_end),
            (change_screen_map),
			(display_message, "@You have deserted, and are now wanted!"), ]),
    ]

		),

    #menu_upgrade_path
   ("upgrade_path",0,
    "In recognition of your excellent service, you have been promoted.",
    "none",[
		(set_background_mesh, "mesh_pic_extra_malvado"),
		(call_script, "script_freelancer_unequip_troop", "$player_cur_troop"),
		],
    [
        ("upgrade_path_1",[
            (troop_get_upgrade_troop, ":path_1_troop", "$player_cur_troop", 0),
            (ge, ":path_1_troop", 0),
            (str_store_troop_name, s66, ":path_1_troop"),],
        "{s66}",[
            (troop_get_upgrade_troop, "$player_cur_troop", "$player_cur_troop", 0),
			(store_troop_faction, ":commander_faction", "$enlisted_lord"),
			(faction_set_slot, ":commander_faction", slot_faction_freelancer_troop, "$player_cur_troop"),
			(call_script, "script_freelancer_equip_troop", "$player_cur_troop"),
			(str_store_troop_name, s5, "$player_cur_troop"),
		    (str_store_string, s5, "@Current rank: {s5}"),
            (add_quest_note_from_sreg, "qst_freelancer_enlisted", 3, s5, 1),
            (change_screen_map),]),

        ("upgrade_path_2",[
            (troop_get_upgrade_troop, ":path_2_troop", "$player_cur_troop", 1),
            (ge, ":path_2_troop", 1),
            (str_store_troop_name, s67, ":path_2_troop"),],
        "{s67}",[
            (troop_get_upgrade_troop, "$player_cur_troop", "$player_cur_troop", 1),
			(store_troop_faction, ":commander_faction", "$enlisted_lord"),
			(faction_set_slot, ":commander_faction", slot_faction_freelancer_troop, "$player_cur_troop"),
			(call_script, "script_freelancer_equip_troop", "$player_cur_troop"),
			(str_store_troop_name, s5, "$player_cur_troop"),
		    (str_store_string, s5, "@Current rank: {s5}"),
            (add_quest_note_from_sreg, "qst_freelancer_enlisted", 3, s5, 1),
            (change_screen_map),]),
    ]),
#+freelancer end
  #+freelancer end chief acaba

#-## Outposts chief empieza
#-## Outposts player lair chief
     ("encontrar_guarida", 0, "The Lair Management Menu. ^^ Choose an action:", "none", [],
         [("camp_build_watchtower", [(eq, "$watchtower_built", 0),], "Build your personal lair. (20000 scillingas)",
		    [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 20000),
		        (eq, "$watchtower_built", 0),
			    (troop_remove_gold, "trp_player", 20000),
			    (party_relocate_near_party, "p_fort", "p_main_party"),
				(store_faction_of_party, ":fac_player", "p_main_party"),
				(call_script, "script_give_center_to_faction_aux", "p_fort", ":fac_player"),
				(call_script, "script_give_center_to_lord", "p_fort", "trp_player", 0),
				(party_set_slot, "p_fort", slot_party_type, spt_castle),
			    (enable_party, "p_fort"),
			    (display_message, "@Lair built!"),
			    (assign, "$watchtower_built", 1),
		     (else_try),
			    (eq, "$watchtower_built", 1),
			    (display_message, "@You already have a watchtower built."),
			 (else_try),
			    (lt, ":gold_amount", 20000),
		        (display_message, "@You don't have enough scillingas to build a lair!."),
		     (try_end),
		    ]),
      ("fort_rename", [(eq, "$watchtower_built", 1),],
         "Rename this Lair.",
         [
(start_presentation, "prsnt_set_party_name2")
##(str_store_troop_name, s1, "trp_player"),
##		   (party_set_name, "p_fort", s1),
          ]),
	     ("camp_demolish_watchtower", [], "Demolish your personal lair. (500 scillingas)",
	        [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 500),
		        (eq, "$watchtower_built", 1),
			    (disable_party, "p_fort"),
			    (display_message, "@Lair demolished!"),
			    (assign, "$watchtower_built", 0),
		     (else_try),
			    (eq, "$watchtower_built", 0),
		        (display_message, "@You don't have a Lair built!"),
		     (else_try),
		        (lt, ":gold_amount", 500),
		        (display_message, "@You don't have enough scillingas to hire demolish-specialized engineers."),
		     (try_end),
		    ]),
		 ("camp_end_watchtower", [], "Return to your camp.",
		    [(jump_to_menu, "mnu_camp")])]),


     ("contratar_personal", 0, "The Lair Hire Staff Menu. ^^ Hire to:", "none", [],
         [
             ("contratar_hoar", [(eq, "$contratar_hoar", 0),], "Hire Hore. (1000 scillingas)",
		    [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 1000),
			    (troop_remove_gold, "trp_player", 1000),
			    (display_message, "@Hoar hired!"),
			    (assign, "$contratar_hoar", 1),
			 (else_try),
			    (lt, ":gold_amount", 1000),
		        (display_message, "@You don't have enough scillingas!."),
		     (try_end),
		    ]),
             ("despedir_hoar", [(eq, "$contratar_hoar", 1),], "Dismiss Hore. (500 scillingas)",
		    [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 500),
			    (troop_remove_gold, "trp_player", 500),
			    (display_message, "@Hoar Dismissed!"),
			    (assign, "$contratar_hoar", 0),
			 (else_try),
			    (lt, ":gold_amount", 500),
		        (display_message, "@You don't have enough scillingas!."),
		     (try_end),
		    ]),
             ("contratar_sacerdote", [(eq, "$contratar_sacerdote", 0),], "Hire Christian Cleric. (1000 scillingas)",
		    [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 1000),
			    (troop_remove_gold, "trp_player", 1000),
			    (display_message, "@Cleric hired!"),
			    (assign, "$contratar_sacerdote", 1),
			 (else_try),
			    (lt, ":gold_amount", 1000),
		        (display_message, "@You don't have enough scillingas!."),
		     (try_end),
		    ]),
             ("despedir_sacerdote", [(eq, "$contratar_sacerdote", 1),], "Dimissed Priest. (500 scillingas)",
		    [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 500),
			    (troop_remove_gold, "trp_player", 500),
			    (display_message, "@Priest Dimissed!"),
			    (assign, "$contratar_sacerdote", 0),
                                  (assign, "$contratar_pagano", 0),
			 (else_try),
			    (lt, ":gold_amount", 500),
		        (display_message, "@You don't have enough scillingas!."),
		     (try_end),
		    ]),
             ("contratar_sacpagano", [(eq, "$contratar_sacerdote", 0),], "Hire Pagan Priest. (1000 scillingas)",
		    [(store_troop_gold, ":gold_amount", "trp_player"),
		     (try_begin),
		        (ge, ":gold_amount", 1000),
			    (troop_remove_gold, "trp_player", 1000),
			    (display_message, "@Priest hired!"),
			    (assign, "$contratar_sacerdote", 1),
                     (assign, "$contratar_pagano", 1),
			 (else_try),
			    (lt, ":gold_amount", 1000),
		        (display_message, "@You don't have enough scillingas!."),
		     (try_end),
		    ]),
		 ("return_principal", [], "Return.",
		    [(jump_to_menu, "mnu_town")])]),
#-## Outposts end chief

###entretenimiento bardo chief
   ("choose_music",0,"What do you want to do?",
  "none",
      [
          # (assign, "$entertainement_on", 0), MOTO will kill morale bonus trigger (so done there)
      ],
      [
    ("simple",[],"I want to perform a simple piece of music.(1 hour)",
        [(assign, "$entertainment_type", entertainment_simple),
         # (assign, "$g_infinite_camping", 0),
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$g_last_rest_center", "$current_town"),
         (assign, ":num_hours", 1),
         (store_current_hours, "$entertainment_done_time"),
         (val_add, "$entertainment_done_time", ":num_hours"),
         (val_max, "$g_check_autos_at_hour", "$entertainment_done_time"),
         (assign, "$auto_menu", "mnu_perform_music"),
         # (val_add, ":num_hours", 1),
         (rest_for_hours, ":num_hours", ":num_hours", 0),
         (change_screen_return)]
     ),
    ("medium",[(store_skill_level,":skill_lvl","skl_entertain",0),
             (ge, ":skill_lvl", 2),
             # (ge, "$bardic_reputation", 130),    MOTO tweak entertainment
             ],"I want to perform a medium piece of music.(3 hours)",
        [(assign, "$entertainment_type", entertainment_medium),
         # (assign, "$g_infinite_camping", 0),
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$g_last_rest_center", "$current_town"),
         (assign, ":num_hours", 3),
         (store_current_hours, "$entertainment_done_time"),
         (val_add, "$entertainment_done_time", ":num_hours"),
         (val_max, "$g_check_autos_at_hour", "$entertainment_done_time"),
         (assign, "$auto_menu", "mnu_perform_music"),
         # (val_add, ":num_hours", 1),
         (rest_for_hours_interactive, ":num_hours", ":num_hours", 0),
         (change_screen_return)]
     ),
    ("complex",[(store_skill_level,":skill_lvl","skl_entertain",0),
             (ge, ":skill_lvl", 5),
             # (ge, "$bardic_reputation", 470),    MOTO tweak entertainment
             ],"I want to perform a complex piece of music.(5 hours)",
        [(assign, "$entertainment_type", entertainment_complex),
         # (assign, "$g_infinite_camping", 0),
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$g_last_rest_center", "$current_town"),
         (assign, ":num_hours", 5),
         (store_current_hours, "$entertainment_done_time"),
         (val_add, "$entertainment_done_time", ":num_hours"),
         (val_max, "$g_check_autos_at_hour", "$entertainment_done_time"),
         (assign, "$auto_menu", "mnu_perform_music"),
         # (val_add, ":num_hours", 1),
         (rest_for_hours_interactive, ":num_hours", ":num_hours", 0),
         (change_screen_return)]
     ),
    ("lordly",[(store_skill_level,":skill_lvl","skl_entertain",0),
             (ge, ":skill_lvl", 9),
             # (ge, "$bardic_reputation", 1150),    MOTO tweak entertainment
             ],"I want to perform a lordly piece of music.(15 hours)",
        [(assign, "$entertainment_type", entertainment_lordly),
         # (assign, "$g_infinite_camping", 0),
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$g_last_rest_center", "$current_town"),
         (assign, ":num_hours", 15),
         (store_current_hours, "$entertainment_done_time"),
         (val_add, "$entertainment_done_time", ":num_hours"),
         (val_max, "$g_check_autos_at_hour", "$entertainment_done_time"),
         (assign, "$auto_menu", "mnu_perform_music"),
         # (val_add, ":num_hours", 1),
         (rest_for_hours_interactive, ":num_hours", 5, 0),
         (change_screen_return)]
     ),
    ("royal",[(store_skill_level,":skill_lvl","skl_entertain",0),
             (ge, ":skill_lvl", 14),
             # (ge, "$bardic_reputation", 3550),    MOTO tweak entertainment
             ],"I want to perform a royal piece of music.(35 hours)",
        [(assign, "$entertainment_type", entertainment_royal),
         # (assign, "$g_infinite_camping", 0),
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$g_last_rest_center", "$current_town"),
         (assign, ":num_hours", 35),
         (store_current_hours, "$entertainment_done_time"),
         (val_add, "$entertainment_done_time", ":num_hours"),
         (val_max, "$g_check_autos_at_hour", "$entertainment_done_time"),
         (assign, "$auto_menu", "mnu_perform_music"),
         # (val_add, ":num_hours", 1),
         (rest_for_hours_interactive, ":num_hours", 5, 0),
         (change_screen_return)]
     ),
    ("speech",[],"I want to give a speech.(3 hours)",
        [(assign, "$entertainment_type", entertainment_speech),
         # (assign, "$g_infinite_camping", 0),
         (assign, "$auto_enter_town", "$current_town"),
         (assign, "$g_town_visit_after_rest", 1),
         (assign, "$g_last_rest_center", "$current_town"),
         (assign, ":num_hours", 3),
         (store_current_hours, "$entertainment_done_time"),
         (val_add, "$entertainment_done_time", ":num_hours"),
         (val_max, "$g_check_autos_at_hour", "$entertainment_done_time"),
         (assign,"$auto_menu","mnu_perform_music"),
         # (val_add, ":num_hours", 1),
         (rest_for_hours_interactive, ":num_hours", ":num_hours", 0),
         (change_screen_return)]
     ),
   ("leave_atras",[], "Leave",[(jump_to_menu, "mnu_town")]),
  ]
 ),

     ("perform_music", 0, "{s0}", "none", [
       (store_current_hours, ":cur_hours"),
       (try_begin),
           (lt, ":cur_hours", "$entertainment_done_time"),
           (str_store_string, s0, "@Interrupted, all your preparations go to waste."),
       (else_try),
           (try_begin),
               (eq, "$entertainment_type", entertainment_simple),
               (assign, "$entertainement_on", 1),
               (assign, "$entertainment_skill_required", 1),    #MOTO tweak entertainment
               # (assign, ":entertain_income_rate", 7),    MOTO tweak entertainment
               (assign, reg0, "$bardic_reputation"),    #MOTO tweak entertainment
               (val_max, reg0, 0),    #MOTO tweak entertainment
               (store_add, ":entertain_income_rate", reg0, 7),    #MOTO tweak entertainment
               (assign, ":entertain_income_type", income_denars),
               (assign, ":entertain_income_type2", income_bard_reputation),
               (str_store_string, s0, "@You perform some simple music."),
           (else_try),
               (eq, "$entertainment_type", entertainment_medium),
               (assign, "$entertainement_on", 1),
               (assign, "$entertainment_skill_required", 3),    #MOTO tweak entertainment
               # (assign, ":entertain_income_rate", 15),    MOTO tweak entertainment
               (assign, reg0, "$bardic_reputation"),    #MOTO tweak entertainment
               (val_max, reg0, 0),    #MOTO tweak entertainment
               (store_add, ":entertain_income_rate", reg0, 7),    #MOTO tweak entertainment
               (assign, ":entertain_income_type", income_denars),
               (assign, ":entertain_income_type2", income_bard_reputation),
               (str_store_string, s0, "@You perform some music."),
           (else_try),
               (eq, "$entertainment_type", entertainment_complex),
               (assign, "$entertainement_on", 1),
               (assign, "$entertainment_skill_required", 7),    #MOTO tweak entertainment
               # (assign, ":entertain_income_rate", 50),    MOTO tweak entertainment
               (assign, reg0, "$bardic_reputation"),    #MOTO tweak entertainment
               (val_max, reg0, 0),    #MOTO tweak entertainment
               (store_add, ":entertain_income_rate", reg0, 7),    #MOTO tweak entertainment
               (assign, ":entertain_income_type", income_denars),
               (assign, ":entertain_income_type2", income_bard_reputation),
               (str_store_string, s0, "@You perform some complex music."),
           (else_try),
               (eq, "$entertainment_type", entertainment_lordly),
               (assign, "$entertainement_on", 2),
               (assign, "$entertainment_skill_required", 11),    #MOTO tweak entertainment
               # (assign, ":entertain_income_rate", 90),    MOTO tweak entertainment
               (assign, reg0, "$bardic_reputation"),    #MOTO tweak entertainment
               (val_max, reg0, 0),    #MOTO tweak entertainment
               (store_add, ":entertain_income_rate", reg0, 7),    #MOTO tweak entertainment
               (assign, ":entertain_income_type", income_denars),
               (assign, ":entertain_income_type2", income_bard_reputation),
               (str_store_string, s0, "@You perform some lordly music."),
           (else_try),
               (eq, "$entertainment_type", entertainment_royal),
               (assign, "$entertainement_on", 3),
               (assign, "$entertainment_skill_required", 15),    #MOTO tweak entertainment
               # (assign, ":entertain_income_rate", 170),    MOTO tweak entertainment
               (assign, reg0, "$bardic_reputation"),    #MOTO tweak entertainment
               (val_max, reg0, 0),    #MOTO tweak entertainment
               (store_add, ":entertain_income_rate", reg0, 7),    #MOTO tweak entertainment
               (assign, ":entertain_income_type", income_denars),
               (assign, ":entertain_income_type2", income_bard_reputation),
               (str_store_string, s0, "@You perform some royal music."),
           (else_try),
               (eq, "$entertainment_type", entertainment_speech),
               (assign, "$entertainement_on", 3),    #for best troop morale bonus
               (assign, "$entertainment_skill_required", 1),    #MOTO tweak entertainment
               # (assign, ":entertain_income_rate", 9),    MOTO you'd have to have entertainment skill 20 for this to happen (see script_entertain_income)
               (troop_get_slot, ":entertain_income_rate", "trp_player", slot_troop_renown),
               (val_div, ":entertain_income_rate", 3),    #offset $entertainement_on
               (assign, ":entertain_income_type", income_reputation),
               (assign, ":entertain_income_type2", income_right_to_rule),
               (str_store_string, s0, "@You give a speech."),
           (else_try),
               (str_store_string, s0, "@{!}mnu_perform_music: you should not be reading this."),
           (try_end),

           #MOTO tweak entertainment start
           # (store_skill_level, ":max", "skl_entertain", "trp_player"),
           # (val_add, ":max", ":entertain_income_rate"),
           # (val_mul, ":max", "$entertainement_on"),

           (store_mul, ":min", ":entertain_income_rate", -1),
           (val_mul, ":min", "$entertainment_skill_required"),
           (val_div, ":min", 2),
           # (val_div, ":min", "$entertainement_on"),
           (store_skill_level, reg0, "skl_entertain", "trp_player"),
           (val_add, reg0, 1),    #prevent div by 0
           (val_div, ":min", reg0),

           # (store_random_in_range, ":income", ":min", ":max"),
           (store_random_in_range, ":income", ":min", ":entertain_income_rate"),
           # (store_div, ":reputation", "$bardic_reputation", 400),
           # (val_min, ":reputation", 1),
           # (val_add, ":reputation", 1),
           # (val_mul, ":income", ":reputation"),
           # (val_sub, ":income", ":reputation"),
           #MOTO tweak entertainment end
           (call_script, "script_entertain_income", ":income", ":entertain_income_type"),
           (call_script, "script_entertain_income", ":income", ":entertain_income_type2"),
           (assign, "$entertainment_last_center", "$current_town"),
       (try_end),
   ], [
       ("continue", [], "Continue...", [
           (rest_for_hours_interactive, 0, 0, 0), #stop resting
           (change_screen_return)])
      ]),
  ###chief acaba


#LAZERAS MODIFIED  {Top Tier Troops Recruit} chief
###########################################################################
  ("upgrade_to_hero",0,
   "You notice that one or more of your warriors exceeds your expectations in battle. ^You walk towards the lines of your troops, and ...",
   "none",
   [
       (assign, reg11, 0), # sub menu 1
       (assign, reg12, 0), # sub menu 2
       (assign, reg13, 0), # sub menu 3
       (assign, reg14, 0), # sub menu 4
       (assign, "$g_upgrade_talk", 0),
     ],
    [
      ("hero_1",
      [
         (assign, ":limit", reg10),
         (assign, ":found", 0),
         (try_for_range, ":hero_id", ":limit", additional_heroes_end),
            (eq, ":found", 0),
            (troop_get_slot, ":hero_ocu", ":hero_id", slot_troop_occupation),
            (gt, ":hero_ocu", 0),
            (neq, ":hero_ocu",slto_kingdom_hero),
            (neq, ":hero_ocu",slto_player_companion),
            (main_party_has_troop, ":hero_ocu"),
            (assign, ":found", 1),
            (assign, reg11, ":hero_id"),
         (try_end),
         (eq, ":found", 1),
         (str_store_troop_name,s1,reg11),
      ],"stop to talk to {s1}",
       [
           (assign, ":hero_id", reg11),
           (troop_get_slot, ":troop_id", ":hero_id", slot_troop_occupation),
           (assign, reg20, ":troop_id"),
           (assign, reg21, ":hero_id"),
           (assign, "$g_upgrade_talk", 1),
           (start_map_conversation, ":troop_id"),
           (change_screen_return),
        ]
       ),
      ("hero_2",
      [
         (ge, reg11, reg10),
         (store_add, ":limit", reg11, 1),
         (assign, ":found", 0),
         (try_for_range, ":hero_id", ":limit", additional_heroes_end),
            (eq, ":found", 0),
            (troop_get_slot, ":hero_ocu", ":hero_id", slot_troop_occupation),
            (gt, ":hero_ocu", 0),
            (neq, ":hero_ocu",slto_kingdom_hero),
            (neq, ":hero_ocu",slto_player_companion),
            (main_party_has_troop, ":hero_ocu"),
            (assign, ":found", 1),
            (assign, reg12, ":hero_id"),
         (try_end),
         (eq, ":found", 1),
         (str_store_troop_name,s1,reg12),
      ],"stop to talk to {s1}",
       [
           (assign, ":hero_id", reg12),
           (troop_get_slot, ":troop_id", ":hero_id", slot_troop_occupation),
           (assign, reg20, ":troop_id"),
           (assign, reg21, ":hero_id"),
           (assign, "$g_upgrade_talk", 1),
           (start_map_conversation, ":troop_id"),
           (change_screen_return),
        ]
       ),
      ("hero_3",
      [
         (gt, reg12, reg11),
         (store_add, ":limit", reg12, 1),
         (assign, ":found", 0),
         (try_for_range, ":hero_id", ":limit", additional_heroes_end),
            (eq, ":found", 0),
            (troop_get_slot, ":hero_ocu", ":hero_id", slot_troop_occupation),
            (gt, ":hero_ocu", 0),
            (neq, ":hero_ocu",slto_kingdom_hero),
            (neq, ":hero_ocu",slto_player_companion),
            (main_party_has_troop, ":hero_ocu"),
            (assign, ":found", 1),
            (assign, reg13, ":hero_id"),
         (try_end),
         (eq, ":found", 1),
         (str_store_troop_name,s1,reg13),
      ],"stop to talk to {s1}",
       [
           (assign, ":hero_id", reg13),
           (troop_get_slot, ":troop_id", ":hero_id", slot_troop_occupation),
           (assign, reg20, ":troop_id"),
           (assign, reg21, ":hero_id"),
           (assign, "$g_upgrade_talk", 1),
           (start_map_conversation, ":troop_id"),
           (change_screen_return),
        ]
       ),
      ("hero_4",
      [
         (gt, reg13, reg12),
         (store_add, ":limit", reg13, 1),
         (assign, ":found", 0),
         (try_for_range, ":hero_id", ":limit", additional_heroes_end),
            (eq, ":found", 0),
            (troop_get_slot, ":hero_ocu", ":hero_id", slot_troop_occupation),
            (gt, ":hero_ocu", 0),
            (neq, ":hero_ocu",slto_kingdom_hero),
            (neq, ":hero_ocu",slto_player_companion),
            (main_party_has_troop, ":hero_ocu"),
            (assign, ":found", 1),
            (assign, reg14, ":hero_id"),
         (try_end),
         (eq, ":found", 1),
         (str_store_troop_name,s1,reg14),
      ],"stop to talk to {s1}",
       [
           (assign, ":hero_id", reg14),
           (troop_get_slot, ":troop_id", ":hero_id", slot_troop_occupation),
           (assign, reg20, ":troop_id"),
           (assign, reg21, ":hero_id"),
           (assign, "$g_upgrade_talk", 1),
           (start_map_conversation, ":troop_id"),
           (change_screen_return),
        ]
       ),
      ("prev",
      [
          (gt, reg10, additional_heroes_begin),
          (assign, ":limit", reg10),
          (assign, ":found", 0),
          (try_for_range_backwards, ":hero_id", ":limit", additional_heroes_begin),
             (lt, ":found", 4),
             (troop_get_slot, ":hero_ocu", ":hero_id", slot_troop_occupation),
             (gt, ":hero_ocu", 0),
             (neq, ":hero_ocu",slto_kingdom_hero),
             (neq, ":hero_ocu",slto_player_companion),
             (main_party_has_troop, ":hero_ocu"),
             (assign, reg15, ":hero_id"),
             (val_add, ":found", 1),
         (try_end),
         (gt, ":found", 0),
      ],"go to the previous lines",
       [
          (assign, reg10, reg15),
          (jump_to_menu, "mnu_upgrade_to_hero"),
        ]
       ),
      ("next",
      [
          (gt, reg14, reg13),
          (store_add, ":limit", reg14, 1),
          (assign, ":found", 0),
          (try_for_range, ":hero_id", ":limit", additional_heroes_end),
             (eq, ":found", 0),
             (troop_get_slot, ":hero_ocu", ":hero_id", slot_troop_occupation),
             (gt, ":hero_ocu", 0),
             (neq, ":hero_ocu",slto_kingdom_hero),
             (neq, ":hero_ocu",slto_player_companion),
             (main_party_has_troop, ":hero_ocu"),
             (assign, ":found", 1),
         (try_end),
         (eq, ":found", 1),
      ],"go to the next lines",
       [
           (store_add, reg10, reg14, 1),
           (jump_to_menu, "mnu_upgrade_to_hero"),
        ]
       ),
      ("close",
      [
       ],"close",
       [
          (assign, "$g_upgrade_talk", 1),
          (change_screen_map),
       ]
      ),
    ]
  ),
#LAZERAS MODIFIED  {Top Tier Troops Recruit}

###saquear monasterio
      (
    "saquear_monasterio",mnf_disable_all_keys,
  ##diplomacy chief begin
    "Blood and treasure. Those of your men with less religious scruples are sent towards {s3}, killing anyone in their path and plundering its riches. The fire and death sweeping the place is rampant. You can plunder spoils of war worth {reg3} schillingas.",# Only visible when castle is taken without being a vassal of a kingdom.
  ##diplomacy chief end
    "none",
    [(set_background_mesh, "mesh_pic_extra_monasterio"),
        (play_sound, "snd_cow_moo"), #anadido chief Sot
        (party_clear, "$g_encountered_party"),
        (str_store_party_name, s3, "$g_encountered_party"),

      (party_set_slot,"$g_encountered_party",slot_saqueo_state,1), #ciudad saqueda
        #Reduce prosperity of the center by 5
  		 (try_begin),
  		   (store_random_in_range, ":random", 2000, 8000),
  		 (try_end),
  		 (val_div, ":random", 100),
  		 (val_mul, ":random", 100),
  		 (assign, "$diplomacy_var2", ":random"),
                 (call_script, "script_troop_add_gold", "trp_player", "$diplomacy_var2"),
  		 (assign, reg3, "$diplomacy_var2"),
        ##diplomacy chief end
#gana moral
        (assign, ":morale_increase", 3),
        (store_div, ":money_gained_div_300", "$diplomacy_var", 300),
        (val_add, ":morale_increase", ":money_gained_div_300"),
        (call_script, "script_change_player_party_morale", ":morale_increase"),

#penalizadores
            (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -7), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -7), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 3), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -7), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 5), #la q designemos

#NPC companion changes begin
        (call_script, "script_objectionable_action", tmt_humanitarian, "str_loot_village"),
		    ],
    [
##diplomacy chief begin
      ("spoils_woden",[(eq, "$g_sod_faith", 3),],"Sacrifice some monks in honor of Woden and keep the booty.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -20), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -8),
      (try_end),
         (change_screen_return),
        ]),
      ("spoils_old_gods",
      [(eq, "$g_sod_faith", 2),
      ],"Sacrifice some monks in honor of the old gods and goddesses and keep the booty.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -20), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -8),
      (try_end),
         (change_screen_return),
        ]),
      ("spoils_alls",
      [
      ],"Sacrifice some monks and keep the booty.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -20), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -8),
      (try_end),
         (change_screen_return),
        ]),
      ("attack",[
],"I want to help my people personally in the looting.",[
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -20), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -8),
      (try_end),


		(try_begin),
          (eq, "$g_encountered_party", "p_monasterio1"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                         (modify_visitors_at_site,"scn_monasterio1_atacadoporcosta"),
		         (else_try),
                         (modify_visitors_at_site,"scn_monasterio1_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio2"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                         (modify_visitors_at_site,"scn_monasterio2_atacadoporcosta"),
		         (else_try),
                         (modify_visitors_at_site,"scn_monasterio2_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio3"),
      (modify_visitors_at_site,"scn_monasterio2_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio4"),
      (modify_visitors_at_site,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio5"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                         (modify_visitors_at_site,"scn_monasterio1_atacadoporcosta"),
		         (else_try),
                         (modify_visitors_at_site,"scn_monasterio1_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio6"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                         (modify_visitors_at_site,"scn_monasterio3_atacadoporcosta"),
		         (else_try),
                         (modify_visitors_at_site,"scn_monasterio3_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio7"),
      (modify_visitors_at_site,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio8"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                         (modify_visitors_at_site,"scn_monasterio3_atacadoporcosta"),
		         (else_try),
                         (modify_visitors_at_site,"scn_monasterio3_costa"),
                           (try_end),
		(try_end),
        (reset_visitors),
        (assign, ":num_monks", 15),
        (store_character_level, ":level", "trp_player"),
        (val_div, ":level", 5),
        (val_add, ":num_monks", ":level"),
        (set_visitors, 1, "trp_monjes", ":num_monks"),

		(try_begin),
          (eq, "$g_encountered_party", "p_monasterio1"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                  (set_jump_mission,"mt_monasterio_atacado2"),
                 (jump_to_scene,"scn_monasterio1_atacadoporcosta"),
		         (else_try),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio1_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio2"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                  (set_jump_mission,"mt_monasterio_atacado2"),
                 (jump_to_scene,"scn_monasterio2_atacadoporcosta"),
		         (else_try),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio2_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio3"),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio2_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio4"),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio5"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                  (set_jump_mission,"mt_monasterio_atacado2"),
                 (jump_to_scene,"scn_monasterio1_atacadoporcosta"),
		         (else_try),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio1_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio6"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                  (set_jump_mission,"mt_monasterio_atacado2"),
                 (jump_to_scene,"scn_monasterio3_atacadoporcosta"),
		         (else_try),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio3_costa"),
                           (try_end),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio7"),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio1_normal"),
		(else_try),
          (eq, "$g_encountered_party", "p_monasterio8"),
		(try_begin),
                                  (party_get_position,pos1,"p_main_party"),
                                    (party_get_position,pos2,"$g_main_ship_party"),
                                    (get_distance_between_positions,":cur_distance",pos1,pos2),
                                    (lt,":cur_distance",400),
                  (set_jump_mission,"mt_monasterio_atacado2"),
                 (jump_to_scene,"scn_monasterio3_atacadoporcosta"),
		         (else_try),
                  (set_jump_mission,"mt_monasterio_atacado"),
                 (jump_to_scene,"scn_monasterio3_costa"),
                           (try_end),
		(try_end),
               (change_screen_mission),
]),

    ],
  ),
####saquear monasterio acaba chief
#panel comandante chief
      (
    "panel_comandante",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Before the Battle Begin...",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_viejo"),

	],
    [
      ("choice_1",[

(eq, "$g_empieza_discurso", 0),
          ],"Impassion your men with a rousing speech.",
       [
          (store_random_in_range, ":rand", 0, 16),
                                          (try_begin),
                                            (eq, ":rand", 0),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 8),
        (jump_to_menu,"mnu_discurso_1"),
                                          (else_try),
                                            (eq, ":rand", 1),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_2"),
                                          (else_try),
                                            (eq, ":rand", 2),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_3"),
                                          (else_try),
                                            (eq, ":rand", 3),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_4"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_discurso_5"),
                                          (else_try),
                                            (eq, ":rand", 5),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_6"),
                                          (else_try),
                                            (eq, ":rand", 6),
       (jump_to_menu,"mnu_discurso_7"),
                                          (else_try),
                                            (eq, ":rand", 7),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_8"),
                                          (else_try),
                                            (eq, ":rand", 8),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_9"),
                                          (else_try),
                                            (eq, ":rand", 9),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
       (jump_to_menu,"mnu_discurso_10"),
                                          (else_try),
                                            (eq, ":rand", 10),
       (jump_to_menu,"mnu_discurso_11"),
                                          (else_try),
                                            (eq, ":rand", 11),
       (jump_to_menu,"mnu_discurso_12"),
                                          (else_try),
       (jump_to_menu,"mnu_discurso_off"),
          (try_end),
        ]
       ),
      ("choice_2",[(eq, "$g_empieza_campeon", 0),
          ],"Call your enemy forward for a duel of honour.",
       [
          (store_random_in_range, ":rand", 0, 5),
                                          (try_begin),
                                            (eq, ":rand", 0),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 4),
        (jump_to_menu,"mnu_lucha_1_p"),
                                          (else_try),
                                            (eq, ":rand", 1),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 2),
       (jump_to_menu,"mnu_lucha_1_d"),
                                          (else_try),
                                            (eq, ":rand", 2),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 2),
       (jump_to_menu,"mnu_lucha_2_v"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_lucha_2_no"),
                                          (else_try),
       (jump_to_menu,"mnu_lucha_2_no"),
          (try_end),
        ]
       ),
      ("choice_3",[
        (eq, "$g_escaramuza_accion", 0),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
		(ge, ":tactics", 6),
          ],"Skirmishers: Send your men to hinder the enemy's advance.",
       [
        (assign, ":g_escaramuza_result2", 0),    #MOTO chief rewrite
                                          (try_begin),
               (troop_is_hero, "$g_talk_troop"),
        #MOTO rewrite start
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider", 6),
              # (ge, ":lider2", 7),
              # (assign, "$g_escaramuza_result", 1),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider", 7),
              # (ge, ":lider2", 8),
              # (assign, "$g_escaramuza_result", 1),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider", 8),
              # (ge, ":lider2", 9),
              # (assign, "$g_escaramuza_result", 1),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider", 9),
              # (ge, ":lider2", 10),
              # (assign, "$g_escaramuza_result", 1),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider2", 6),
              # (ge, ":lider", 7),
              # (assign, "$g_escaramuza_result", 2),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider2", 7),
              # (ge, ":lider", 8),
              # (assign, "$g_escaramuza_result", 2),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider2", 8),
              # (ge, ":lider", 9),
              # (assign, "$g_escaramuza_result", 2),
                                                # (else_try),
                 # (troop_is_hero, "$g_talk_troop"),
                # (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
              # (party_get_skill_level, ":lider2", "$g_talk_troop",      skl_tactics),
              # (lt, ":lider2", 9),
              # (ge, ":lider", 10),
              # (assign, "$g_escaramuza_result", 2),
                # (try_end),

                  (party_get_skill_level, ":lider", "p_main_party",      skl_tactics),
                  (store_skill_level, ":lider2", skl_tactics,      "$g_talk_troop"),
                  (store_sub, reg0, ":lider", ":lider2"),

                  (try_begin),
                      (lt, reg0, -1),    #AI better than player?
                      (assign, ":g_escaramuza_result2", 1),
                  (else_try),
                      (gt, reg0, 1),    #player better than AI?
                      (assign, ":g_escaramuza_result2", 2),
                  (try_end),
              (try_end),
              #MOTO rewrite end

              (store_random_in_range, ":rand", 0, 4),
                                                 (try_begin),
                                                (eq, ":rand", 0),
        (eq, ":g_escaramuza_result2", 1),    #MOTO chief rewrite
       (jump_to_menu,"mnu_escaramuza_1"),
                                              (else_try),
                                                (eq, ":rand", 1),
        (eq, ":g_escaramuza_result2", 2),    #MOTO rewrite
       (jump_to_menu,"mnu_escaramuza_2"),
                                              (else_try),
                                                (eq, ":rand", 2),
           (jump_to_menu,"mnu_escaramuza_2"),
                                              (else_try),
           (jump_to_menu,"mnu_escaramuza_3"),
              (try_end),
            ]
           ),
      ("choice_4",[
                  (this_or_next|eq, "$g_sod_faith", 2),
							 (eq, "$g_sod_faith", 3),
                  (eq, "$g_empieza_discurso", 0),
          ],"Make a sacrifice to the Gods.",
       [
          (store_random_in_range, ":rand", 0, 5),
                                          (try_begin),
                                            (eq, ":rand", 0),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 3),
        (jump_to_menu,"mnu_sacrificio_1"),
                                          (else_try),
                                            (eq, ":rand", 1),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 5),
       (jump_to_menu,"mnu_sacrificio_2"),
                                          (else_try),
                                            (eq, ":rand", 2),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 3),
       (jump_to_menu,"mnu_sacrificio_3"),
                                          (else_try),
                                            (eq, ":rand", 3),
		(party_get_skill_level, ":lider", "p_main_party", skl_leadership),
		(ge, ":lider", 5),
       (jump_to_menu,"mnu_sacrificio_4"),
                                          (else_try),
       (jump_to_menu,"mnu_sacrificio_off"),
          (try_end),
        ]
       ),
      ("choice_5",[],"Do nothing.",
       [
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),


###escaramuza chief
         (
    "escaramuza_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Sir, the enemy commander overcame your tactical skills, and before being prepared we were surprised by enemy missile troops that caused numerous casualties.^^Your casualties:{s8}",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_combate"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 50),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 50),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 48),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 48),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 46),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 46),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 44),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 44),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 42),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 42),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 40),
      (else_try),
        (assign, ":division_constant", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
   (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
   #(val_div, ":enemy_party_strength", 40),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
	],
    [
      ("defendiendo_1",[],"Damn.",
       [
        (assign, "$g_escaramuza_accion", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
         (
    "escaramuza_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Our men have been deployed in range, and have moved closer to the enemy causing them heavy casualties before returning.^^Enemy casualties were: {s9}",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_combate"),

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 40),
      (else_try),
        (assign, ":division_constant2", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 40),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
	],
    [
      ("defendiendo_2",[],"Well Done.",
       [
        (assign, "$g_escaramuza_accion", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
         (
    "escaramuza_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your men are approaching the enemy and find the enemy commander has deployed missile troops to protect his army's advance. To avoid losing men, your soldiers do not attack and return.",
    "none",
    [
	],
    [
      ("defendiendo_3",[],"Right.",
       [
        (assign, "$g_escaramuza_accion", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

  #lucha de campeones
       (
    "lucha_2_no",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "There seems to be no one willing to duel.",
    "none",
    [
	],
    [
      ("defendiendo_4",[],"Back.",
       [
         (assign, "$g_empieza_campeon", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "lucha_1_d",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "An enemy warrior moves towards your army and stops a stone's throw away. He carries stuffed lamb gut mead around his neck and throws it to the ground. You see him jump to warm up the muscles. He casts aside his cloak, removes his robe and boots and stands naked, equipped only with spear and shield.^\
He is a champion and points to your army challenging your men to face him.^\
Before you can speak, a boy runs out from the ranks. He isn't a veteran or the most capable of your troops, but he's certainly brave.^\
Your warrior, your champion, advances to the enemy and they circle each other, studying each other's moves. The nerves take hold of your warrior and he gives a jab with his spear lowering his shield. The enemy champion seizes the opportunity and swiftly plunges the blade of his spear into the heart of your warrior...^^\
You lost the duel.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_duelos"),
	],
    [
      ("defendiendo_5",[],"Back.",
       [
         (assign, "$g_empieza_campeon", 1),
           (call_script, "script_change_player_party_morale", -4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "lucha_2_v",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your men breaks away from the ranks and walks towards the enemy, pulling his coat halfway up to show his ass. A champion enemy runs towards him, wounded, and tosses a javelin that falls a few feet from your warrior. He then draws his sword and charges with a war cry.^\
Your man quickly prepares himself and stands ground, waiting with a spear in his hand.^\
Both champions hit the shields and try to hurt each other.^\
Watching closely you observe the first blood spilled, and the last, when your champion thrusts his spear through the mouth of his opponent. While catching his breath your champion turns around facing your men and shouts: 'I was too big a mouthful!'^^\
You have won the duel.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_duelos"),
	],
    [
      ("defendiendo_6",[],"Back.",
       [
         (assign, "$g_empieza_campeon", 1),
           (call_script, "script_change_player_party_morale", 4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "lucha_1_p",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The chief of your enemies stands out in front of his army and points towards you inviting you to a duel.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_guerreroelite"),
	],
    [
      ("defendiendo_7",[],"Accept.",
       [
         (assign, "$g_empieza_campeon", 1),
           (call_script, "script_change_player_party_morale", 1),
       (assign, "$duel_encounter",1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ("defendiendo_8",[],"Back.",
       [
         (assign, "$g_empieza_campeon", 1),
           (call_script, "script_change_player_party_morale", -4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

#sacrificios
         (
    "sacrificio_off",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The gods remain mute to your prayers and sacrifices.",
    "none",
    [
	],
    [
      ("sacri_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", -4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "sacrificio_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The viscera of the slaughtered animals are full of worms. A bad omen.^Maybe you should not fight today.",
    "none",
    [
	],
    [
      ("sacri_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", -10),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "sacrificio_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "As you look down onto the blood of the slaughtered animal, one of your men points to the horizon where an eagle takes flight with a snake in its claws. A good omen indeed. ^The time is ripe to attack the enemy.",
    "none",
    [
	],
    [
      ("sacri_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 10),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "sacrificio_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "As you thrust the sacrificial knife in the neck of the animal it escapes from your hands and runs a few yards before collapsing, facing the enemy. A bad omen. ^Maybe you should not fight today.",
    "none",
    [
	],
    [
      ("sacri_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", -10),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "sacrificio_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Digging into the intestines of the slaughtered animal you discover a silver pendant ring. A good omen. ^You're ready for battle.",
    "none",
    [
	],
    [
      ("sacri_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 10),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
#sacrificios acaba

  #discursos

       (
    "discurso_off",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You also step forward and try to make condescending remarks, but it's not convincing, nerves betray you and are unable to articulate a single word.",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", -4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "discurso_1",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'From this day to the ending of the world, but we in it shall be remembered; We few, we brothers of bravery shall prevail; for anyone who sheds his blood with me today shall be my brother.'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Excelent speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_2",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'When the young men and beautiful women of your village ask you where you got your battle scars, you can tell them, 'under arms in the greatest army, with the greatest general that Britannia and Hibernia has ever seen!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Normal speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_3",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'And to think that right now, across Bryten, cowards and old men are herding their goats, tending their crops, toiling and sweating for nothing! Yet here we freemen stand, our own toil about to begin - our own sweat and blood poised to run - and for what? For honor! For glory! For wealth!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 2),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_4",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'From across the known world we have travelled to meet our destinies on this field of battle, in this moment in time. Long after we have all expired, men will sing our names in the songs of our greatness, found here in these fields!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 2),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "discurso_5",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'My brothers! Once you were born; later, you grew into men. Yesterday we marched. Today we fight! Today we spill the blood of our host, and bring him to ruin. Today we smash his shields. All the days of your lives have led to this. Today we conquer or fall together as brothers. Tonight we feast at the table of the enemy!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 2),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "discurso_6",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'Men!  My brothers! Lo, though we marched many days, your prize awaits you. The prize, glory, is at hand in the groans of your enemy! Now go! Go to your destiny! Take your prize! Fight! Fight!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_7",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'My friends!  Hear me!  Now is the day when the songs of our hearths are written with the blood of our foes! You are the free men! None can assault our lands and stand to tell the tale. The host before us is great, but they do not fight for their homes, but to plunder yours. They will fall! Ready your spears! Hold fast, and never yield! No man will yield his land or his glory to the cowards in the rabble before us. Fight! Die, but never yield! Never, never, never!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
           (call_script, "script_change_player_party_morale", 2),
         (assign, "$g_empieza_discurso", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_8",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'We stand before our enemy, ready for battle. Draw your sword! Hold your spear! This shield-wall is our home. Let us welcome our enemy! Let him come! Let the shield-walls fall! All that is needed is your own arm and your own heart. Within this shield-wall you stand, my brothers. I know that within the breast of each man here is a fire so bright that I wage these walls protect our foes and not us! Our doom will be glory! No man can take it unless you give it to him.'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 2),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_9",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'Come, men! Let us go forth and face our foe on the Field of Battle! With men like you, our shield-wall will never break or fall to those craven dogs who come against us here! Like the heroes of old, let us go and make the slaughter, every man a hero, every man a True Man! This day we will glut the ravens!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 2),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_10",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'Remember your children and your wives. Remember your homes and your ancestors. Remember your gods and everything for which we fight today. We are here to build a better world! These men facing us know it, and fear our determination. They are so afraid to piss their pants and shake like leaves, unable to hold their spears.  Men! I am with you, with my sword and my shield, bleeding and sweating, proud to stand shoulder to shoulder with my Titans. Men! Fate awaits us, it's time to seize it!'",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Good speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 2),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),
       (
    "discurso_11",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'Let us go out from this burning place into the open and stand up to our enemies. Who dies, he will be with our god. Who dies not, his name will be honoured. I will go first, and what I do, you do. And God is my witness, I will never leave you, my brothers and knights!'.",
    "none",
    [
	],
    [
      ("defendiendo_1",[],"Back.",
       [
         (assign, "$g_empieza_discurso", 1),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

       (
    "discurso_12",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You observe the troops and move between them. While speaking you look each man in the eye, seeking to convey the intensity of the moment:^^'The sun will set on our enemy this evening, and we will rise as rays of sun on a spring day. You may be nervous and trembling now, but your shaking hands is nothing compared to theirs. They are but autumn leaves in the wind, and we are the howling storm that will scatter them across the meadows, never to be seen again. Brandish your spears and be the thunder that topples their tree. This land is ours, these woods, these hills, these fields, and so it will be season after season, year after year, forever and forever!'",
    "none",
    [	],
    [
      ("defendiendo_1",[],"Excellent speech. Back.",
       [
         (assign, "$g_empieza_discurso", 1),
           (call_script, "script_change_player_party_morale", 4),
       (jump_to_menu,"mnu_simple_encounter"),
        ]
       ),
      ]
  ),

#reclutar ciudades somebody chief
  ("town_recruit_troops",0,
    "It must be a special day because there are a large group of young noblemen gathered in the main square. {s18}. You have {reg15} scillingas to try to hire them with.",
    "none",
    [(set_background_mesh, "mesh_pic_extra_guerreroelite"),(store_troop_gold, reg15, "trp_player"),

        (store_faction_of_party, ":cur_faction", "$current_town"),
     (faction_get_slot, ":volunteer_troop", ":cur_faction", slot_faction_tier_4_troop),
     (party_get_slot, ":volunteer_amount", "$current_town", slot_center_volunteer_troop_amount),
     (party_get_free_companions_capacity, ":free_capacity", "p_main_party"),
     (store_troop_gold, ":gold", "trp_player"),
     (store_div, ":gold_capacity", ":gold", 290),#100 denars per man
     (assign, ":party_capacity", ":free_capacity"),
     (val_min, ":party_capacity", ":gold_capacity"),
     (try_begin),
       (gt, ":party_capacity", 0),
       (val_min, ":volunteer_amount", ":party_capacity"),
     (try_end),
     (assign, reg5, ":volunteer_amount"),
     (assign, reg7, 0),
     (try_begin),
       (gt, ":volunteer_amount", ":gold_capacity"),
       (assign, reg7, 1), #not enough money
     (try_end),
     (try_begin),
       (eq, ":volunteer_amount", 0),
       (str_store_string, s18, "@No one here seems to be willing to join your party."),
     (else_try),
       (store_mul, reg6, ":volunteer_amount", 290),#100 denars per man
       (str_store_troop_name_by_count, s3, ":volunteer_troop", ":volunteer_amount"),
       (try_begin),
         (eq, reg5, 1),
         (str_store_string, s18, "@One young nobleman volunteers to follow you."),
       (else_try),
         (str_store_string, s18, "@{reg5} young noblemen volunteer to follow you."),
       (try_end),
       (set_background_mesh, "mesh_pic_recruits"),
     (try_end),
    ],
    [
      ("continue_not_enough_gold",
      [
        (eq, reg7, 1),
      ],
      "I don't have enough money...",
      [
  (assign, "$reclutar_puede", 1),
 (jump_to_menu, "mnu_town"),
      ]),

      ("continue",
      [
        (eq, reg7, 0),
        (eq, reg5, 0),
      ], #noone willing to join
      "Continue...",
      [
        (party_set_slot, "$current_town", slot_center_volunteer_troop_amount, -1),
  (assign, "$reclutar_puede", 1),
  (jump_to_menu, "mnu_town"),
      ]),

      ("recruit_them",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Recruit them ({reg6} scillingas).",
      [
      (try_begin),
    (troop_slot_ge, "trp_player", slot_troop_renown, 400), #chief anadido
        (call_script, "script_town_recruit_nobles_recruit"),
     (assign, "$reclutar_puede", 1),
     (jump_to_menu, "mnu_town"),
      (else_try),
        (display_message,"@They laugh at you because they think you're a starving beggar. Come back when you're someone important (you need more renown).",0xFFFFAAAA),
      (try_end),
      ]),

      ("forget_it",
      [
        (eq, reg7, 0),
        (gt, reg5, 0),
      ],
      "Forget it.",
      [
  (assign, "$reclutar_puede", 1),
  (jump_to_menu, "mnu_town"),
      ]),
    ],
  ),
##  ("town_recruit_troops",0,
##    "It must be a special day because there are a large group of young noblemen gathered in the main square. You have {reg15} scillingas to try to hire them with.",
##    "none", [ (set_background_mesh, "mesh_pic_extra_guerreroelite"),
##          (store_troop_gold, reg15, "trp_player"),],
##
#do some python hackery (still the same amount of compiled code)
##   [("recruit_troop_"+str(x+1),
##      [
##        (troops_can_join, 1),#room in party
##      (ge, reg11, 1),#troops are available
##	(store_faction_of_party, "$g_current_town_faction", "$current_town"),
##
##      (faction_slot_ge, "$g_current_town_faction", slot_faction_num_troops, x+1),#check faction allowed # of troop types
##      (faction_get_slot, ":recruit_troop", "$g_current_town_faction", x + slot_faction_town_troop_1),
##      (troop_get_slot, ":troop_cost", ":recruit_troop", slot_troop_recruit_price),
##      (ge, reg15, ":troop_cost"),#player can afford
##
##      (str_store_troop_name, s11, ":recruit_troop"),
##      (assign, reg1, ":troop_cost"),
##      (str_store_string, s11, "str_recruit_town"),
##      ], "{s11}",
##   [
##      (try_begin),
##    (troop_slot_ge, "trp_player", slot_troop_renown, 400), #chief anadido
##      (faction_get_slot, ":recruit_troop", "$g_current_town_faction", x + slot_faction_town_troop_1),
##      (troop_get_slot, ":troop_cost", ":recruit_troop", slot_troop_recruit_price),
##      (party_add_members,"p_main_party",":recruit_troop",1),
##      (troop_remove_gold,"trp_player", ":troop_cost"),
##      (val_sub, reg11, 1),
##      (faction_set_slot, "$g_current_town_faction", slot_faction_town_troop_pool_available, reg11),
##      (else_try),
##        (display_message,"@They laugh at you because they think you're a starving beggar. Come back when you're someone important (you need more renown).",0xFFFFAAAA),
##      (try_end),
##   ]) for x in range(0, 7)]
##      +[("back_to_town_menu",[],"Head back.",
##       [
##           (assign, "$reclutar_puede", 1),
##           (jump_to_menu,"mnu_town"),
##        ]),
##   ]
##  ),

    ("town_recruit_troops2",0,
    "Nobody want join to you.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
          [("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede", 1),
           (jump_to_menu,"mnu_town"),
        ]),
   ]
  ),

      ("town_recruit_troops3",0,
    "There are some beggars and townwalkers interested in joining your army.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (50 scillingas)",
   [
      (party_add_members,"p_main_party","trp_townsman",4),
      (troop_remove_gold,"trp_player", 50),
           (assign, "$reclutar_puede", 1),
           (jump_to_menu,"mnu_town"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede", 1),
           (jump_to_menu,"mnu_town"),
        ]),
   ]
  ),

  #reclutar en ciudades somebody acaba chief
  #reclutar refugees chief refugiados
      ("refugee_recruit_troops1",0,
    "There are some widow and orphan interested in joining and try to find a new life with your soldiers.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (20 scillingas)",
   [
      (party_add_members,"p_main_party","trp_refugee",2),
      (party_add_members,"p_main_party","trp_peasant_woman",2),
      (troop_remove_gold,"trp_player", 20),
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
        ]),
   ]
  ),

      ("refugee_recruit_troops2",0,
    "Nobody want join to you.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
          [("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
        ]),
   ]
  ),

      ("refugee_recruit_troops3",0,
    "There are some shepherds and farmers interested in joining your army.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (60 scillingas)",
   [
      (party_add_members,"p_main_party","trp_shepherd",2),
      (party_add_members,"p_main_party","trp_farmer",3),
      (troop_remove_gold,"trp_player", 60),
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
        ]),
   ]
  ),

      ("refugee_recruit_troops4",0,
    "There are some young warriors interested in joining your army.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (150 scillingas)",
   [
      (party_add_members,"p_main_party","trp_manhunter",4),
      (troop_remove_gold,"trp_player", 150),
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_celidon_forest"),
        ]),
   ]
  ),

#refugiados acaba chief
  #monasterio reclutas
        ("refugee_recruit_troops12",0,
    "There are some widow and orphan interested in joining and try to find a new life with your soldiers.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (20 scillingas)",
   [
      (party_add_members,"p_main_party","trp_refugee",2),
      (party_add_members,"p_main_party","trp_peasant_woman",2),
      (troop_remove_gold,"trp_player", 20),
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
        ]),
   ]
  ),

      ("refugee_recruit_troops22",0,
    "Nobody want join to you.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
          [("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
        ]),
   ]
  ),

      ("refugee_recruit_troops32",0,
    "There are some shepherds and farmers interested in joining your army.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (60 scillingas)",
   [
      (party_add_members,"p_main_party","trp_shepherd",2),
      (party_add_members,"p_main_party","trp_farmer",3),
      (troop_remove_gold,"trp_player", 60),
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
        ]),
   ]
  ),

      ("refugee_recruit_troops42",0,
    "There are a cleric and some young warriors interested in joining your army.",
    "none", [ (set_background_mesh, "mesh_pic_payment"),
          (store_troop_gold, reg15, "trp_player"),],
       [("acept_them",[], "Hire them (400 scillingas)",
   [
      (party_add_members,"p_main_party","trp_picto_sacerdote",1),
      (party_add_members,"p_main_party","trp_manhunter",4),
      (troop_remove_gold,"trp_player", 400),
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
   ]),
        ("back_to_town_menu",[],"Head back.",
       [
           (assign, "$reclutar_puede_refuges", 1),
           (jump_to_menu,"mnu_monasterio_visit"),
        ]),
   ]
  ),
#monasterio reclutas chief acaba
#restaurar faccion chief
        # restoration begin
      (
        "notification_kingdom_restoration",0,
        "Rebellion!!!^^ People of the defeated kingdom of {s13} have taken up their weapons and {s14} gets a fief from {s12}, {s13} is restored! Long live the King!",
        "none",
        [
          (troop_get_slot, ":original_faction", "$g_notification_menu_var1", slot_troop_original_faction),
          (faction_get_slot, ":original_king", ":original_faction", slot_faction_leader),
          (str_store_troop_name, s11, "$g_notification_menu_var1"),
          (str_store_faction_name, s12, "$g_notification_menu_var2"),
          (str_store_faction_name, s13, ":original_faction"),
          (str_store_troop_name, s14, ":original_king"),

          (set_fixed_point_multiplier, 100),
          (position_set_x, pos0, 65),
          (position_set_y, pos0, 30),
          (position_set_z, pos0, 170),
          (try_begin),
            (is_between, ":original_faction", "fac_kingdom_1", kingdoms_end), #Excluding player kingdom
            (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_for_menu", ":original_faction", pos0),
          (else_try),
            (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", ":original_faction", pos0),
          (try_end),
          ],
        [
          ("continue",[],"Continue...",
            [
              (troop_get_slot, ":original_faction", "$g_notification_menu_var1", slot_troop_original_faction),
              ## start peace
              (try_for_range, ":cur_kingdom", kingdoms_begin, kingdoms_end),
                (neq, ":cur_kingdom", ":original_faction"),
                (neq, ":cur_kingdom", "$g_notification_menu_var2"),
                (call_script, "script_diplomacy_start_peace_between_kingdoms", ":cur_kingdom", ":original_faction", 0),
              (try_end),
              ## start war
              (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var2", ":original_faction", logent_faction_declares_war_to_regain_territory),	#MOTO chief pass log entries
#              (call_script, "script_diplomacy_start_war_between_kingdoms", "$g_notification_menu_var2", ":original_faction", 1),
              (call_script, "script_update_all_notes"),
              (change_screen_return),
            ]),
         ]
      ),
      ## restoration end chief

  ##diplomacy chief begin
  (
    "dplmc_notification_alliance_declared",0,
    "Alliance Agreement^^{s1} and {s2} have formed an alliance!^{s57}",
    "none",
    [

	  (str_clear, s57),

	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_defensive_declared",0,
    "Defensive Pact^^{s1} and {s2} have agreed to a defensive pact!^{s57}",
    "none",
    [

	  (str_clear, s57),

	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_trade_declared",0,
    "Trade Agreement^^{s1} and {s2} have signed a trade agreement!^{s57}",
    "none",
    [

	  (str_clear, s57),

	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_nonaggression_declared",0,
    "Non-aggression Treaty^^{s1} and {s2} have concluded a non-aggression treaty!^{s57}",
    "none",
    [
	  (str_clear, s57),

	  (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":faction_1", "$g_notification_menu_var1", kingdoms_begin),
      (store_sub, ":faction_2", "$g_notification_menu_var2", kingdoms_begin),
      (val_mul, ":faction_1", 128),
      (val_add, ":faction_1", ":faction_2"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":faction_1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_question_alliance_offer",0,
    "You Receive an Alliance Offer^^The {s1} wants to form an alliance with you. What is your answer?",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_alliance_offer_accept",[],"Accept",
       [
         (call_script, "script_dplmc_start_alliance_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
         (change_screen_return),
        ]),
      ("dplmc_alliance_offer_reject",[],"Reject",
       [
         (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_question_defensive_offer",0,
    "You Receive a Pact Offer^^The {s1} offers you a defensive pact. What is your answer?",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_defensive_offer_accept",[],"Accept",
       [
         (call_script, "script_dplmc_start_defensive_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
         (change_screen_return),
        ]),
      ("dplmc_defensive_offer_reject",[],"Reject",
       [
         (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_question_trade_offer",0,
    "You Receive a Pact Offer^^The {s1} offers you a trade pact. What is your answer?",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_trade_offer_accept",[],"Accept",
       [
         (call_script, "script_dplmc_start_trade_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
         (change_screen_return),
        ]),
      ("dplmc_trade_offer_reject",[],"Reject",
       [
         (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_question_nonaggression_offer",0,
    "You Receive a Pact Offer^^The {s1} offers you a non-aggression treaty. What is your answer?",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_nonaggression_offer_accept",[],"Accept",
       [
         (call_script, "script_dplmc_start_nonaggression_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
         (change_screen_return),
        ]),
      ("dplmc_nonaggression_offer_reject",[],"Reject",
       [
         (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -2),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_alliance_expired",0,
    "Alliance Has Expired^^The alliance between {s1} and {s2} has expired and was degraded to a defensive pact.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_defensive_expired",0,
    "Defensive Pact Has Expired^^The defensive pact between {s1} and {s2} has expired and was degraded to a trade agreement.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),


  (
    "dplmc_notification_trade_expired",0,
    "Trade Agreement Has Expired^^The trade agreement between {s1} and {s2} has expired and was degraded to a non-aggression treaty.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      ],
    [
      ("dplmc_continue",[],"Continue",
       [
	   (change_screen_return),
        ]),
     ]
  ),

  ("dplmc_dictate_terms",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Dictate your peace terms.",
    "none",
    [(set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),],
    [
      ("dplmc_demand_4000",[(gt, "$g_player_chamberlain", 0),],"Demand 4000 scillingas",
      [
        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "fac_player_supporters_faction", -1),
        (assign, ":goodwill", reg0),
        (store_random_in_range, ":random", 0, 4),

        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -3),
        (try_begin),
          (le, ":random", ":goodwill"),
          (call_script, "script_dplmc_pay_into_treasury", 4000),
          (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_notification_menu_var1", "fac_player_supporters_faction", 1),
          (change_screen_return),
        (else_try),
          (jump_to_menu,"mnu_dplmc_deny_terms"),
        (try_end),
      ]),
      ("dplmc_demand_8000",[(gt, "$g_player_chamberlain", 0),],"Demand 8000 scillingas",
       [
         (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "fac_player_supporters_faction", -1),
         (assign, ":goodwill", reg0),
         (val_mul, ":goodwill", 2),
				 (store_random_in_range, ":random", 0, 10),

         (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
				 (try_begin),
				   (le, ":random", ":goodwill"),
           (call_script, "script_dplmc_pay_into_treasury", 8000),
           (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_notification_menu_var1", "fac_player_supporters_faction", 1),
           (change_screen_return),
         (else_try),
             (jump_to_menu,"mnu_dplmc_deny_terms"),
         (try_end),
       ]),
      ("dplmc_demand_castle",[
        (assign, ":distance", 100),
        (assign, "$demanded_castle", -1),
        (try_for_range, ":castle", castles_begin, castles_end),
          (store_faction_of_party, ":castle_faction", ":castle"),
          (eq, ":castle_faction", "$g_notification_menu_var1"),
          (try_for_range, ":center", centers_begin, centers_end),
            (store_faction_of_party, ":center_faction", ":center"),
            (eq, ":center_faction", "fac_player_supporters_faction"),
            (store_distance_to_party_from_party, ":tmp_distance", ":center", ":castle"),

            (lt, ":tmp_distance", ":distance"),
            (assign, ":distance", ":tmp_distance"),
            (assign, "$demanded_castle", ":castle"),
            (str_store_party_name, s2, ":castle"),
          (try_end),
        (try_end),
        (is_between, "$demanded_castle", castles_begin,castles_end),
      ],"Demand {s2}.",
       [
        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", "fac_player_supporters_faction", -1),
        (assign, ":goodwill", reg0),
        (val_mul, ":goodwill", 2),
        (store_random_in_range, ":random", 0, 12),

        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -6),
        (try_begin),
          (le, ":random", ":goodwill"),
			 ##diplomacy start+ chief
			 #Chance of veto based on ownership and difficulty setting.
			 (assign, ":did_veto", 0),
			 (try_begin),
					 (party_get_slot, ":castle_lord", "$demanded_castle", slot_town_lord),
					 (ge, ":castle_lord", 1),
					 (neg|troop_slot_ge, ":castle_lord", slot_troop_prisoner_of_party, 0),
					 (try_begin),
								(troop_get_slot, ":castle_lord_original_faction", ":castle_lord", slot_troop_original_faction),
								(party_slot_eq, "$demanded_castle", slot_center_original_faction, ":castle_lord_original_faction"),
								(store_random_in_range, ":random", 0, 12),
								(assign, ":did_veto", 1),
								(le, ":random", ":goodwill"),
								(assign, ":did_veto", 0),
					 (try_end),
			 (try_end),
			 (eq, ":did_veto", 0),
		  (assign, ":player_kingdom", "fac_player_supporters_faction"),
		  (call_script, "script_give_center_to_faction", "$demanded_castle", ":player_kingdom"),
          (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_notification_menu_var1", ":player_kingdom", 1),
		  ##diplomacy end+
          (change_screen_return),
        (else_try),
          (jump_to_menu,"mnu_dplmc_deny_terms"),
        (try_end),        ]
       ),
	  ("dplmc_go_back",[],"Go back",
       [
	     (jump_to_menu,"mnu_question_peace_offer"),
       ]),
    ]
  ),

  ("dplmc_deny_terms",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The {s1} refuses your terms and is breaking off of negotiations.",
    "none",
    [(set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),],
    [
	  ("dplmc_continue",[],"Continue",
       [
       (change_screen_return),
       ]),
    ]
  ),

  (
    "dplmc_village_riot_result",mnf_scale_picture,
    "{s9}",
    "none",
    [(try_begin),
       (eq, "$g_battle_result", 1),
       (jump_to_menu, "mnu_dplmc_village_riot_removed"),
     (else_try),
       (set_background_mesh, "mesh_pic_villageriot"),
       (str_store_string, s9, "@Try as you might, you could not defeat the rebelling village."),
     (try_end),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [(call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
        (jump_to_menu, "mnu_village"),]),
    ],
  ),

  (
    "dplmc_village_riot_removed",mnf_disable_all_keys,
    "In bloody battle you and your men slaughter the rebels and regain control over the village. But there is not much left you can control.",
    "none",
    [
     (set_background_mesh, "mesh_pic_looted_village1"),
     (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
     (call_script, "script_village_set_state",  "$current_town", svs_looted),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (jump_to_menu, "mnu_village"),
       ]),
    ],
  ),

  (
    "dplmc_town_riot_removed",mnf_disable_all_keys,
    "In bloody battle you and your men slaughter the rebels and regain control over the town.",
    "none",
    [],
    [
      ("dplmc_continue",[],"Continue...",
       [
        (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
        (assign, "$new_encounter", 1),
        (try_begin),
          (party_get_slot, ":town_lord","$g_encountered_party", slot_town_lord),
          (troop_get_slot, ":cur_banner", ":town_lord", slot_troop_banner_scene_prop),
          (gt, ":cur_banner", 0),
          (val_sub, ":cur_banner", banner_scene_props_begin),
          (val_add, ":cur_banner", banner_map_icons_begin),
          (party_set_banner_icon, "$g_encountered_party", ":cur_banner"),
        (try_end),
        (jump_to_menu, "mnu_castle_outside"),
       ]),
    ],
  ),

  (
    "dplmc_riot_negotiate",mnf_disable_all_keys,
    "You approach the angry crowd and begin negotiations. The leader of the riot demands {reg0} scillingas. He agrees to lay down arms if you are willing to pay.",
    "none",
    [
      (party_get_slot, ":center_relation", "$g_encountered_party", slot_center_player_relation),
      (val_min, ":center_relation", 0),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
        (val_sub, ":center_relation", 75),
        (set_background_mesh, "mesh_pic_townriot"),
      (else_try),
        (val_sub, ":center_relation", 50),
        (set_background_mesh, "mesh_pic_villageriot"),
      (try_end),

      (store_skill_level, ":persuasion_level", "skl_persuasion", "trp_player"),
      (val_add, ":center_relation", ":persuasion_level"),
      (val_mul, ":center_relation", ":center_relation"),
      (assign, reg0, ":center_relation"),
    ],
    [
      ("dplmc_pay_riot_treasury",
      [
        (gt, "$g_player_chamberlain", 0),
        (store_troop_gold, ":gold", "trp_household_possessions"),
        (ge, ":gold", reg0),
      ],"Induce your chamberlain to pay the money from the treasury.",
       [
        (call_script, "script_dplmc_withdraw_from_treasury", reg0),
        (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (jump_to_menu, "mnu_castle_outside"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),

       ]),
       ("dplmc_pay_riot_cash",
      [
        (store_troop_gold, ":gold", "trp_player"),
        (ge, ":gold", reg0),
      ],"Pay cash.",
       [
        (troop_remove_gold, "trp_player", reg0),
        (party_set_slot, "$g_encountered_party", slot_village_infested_by_bandits, 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (jump_to_menu, "mnu_castle_outside"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),

       ]),

      ("dplmc_back",[],"Back...",
       [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", slot_party_type, spt_town),
          (jump_to_menu, "mnu_castle_outside"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),
       ]),
    ],
  ),

  (
    "dplmc_notification_riot",0,
    "The peasants of {s1} launched a riot against you! In a surprise attack, men loyal to you have been slain. The remainder joined the angry crowd.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (try_begin),
        (party_slot_eq, "$g_notification_menu_var1", slot_party_type, spt_town),
        (set_background_mesh, "mesh_pic_townriot"),
      (else_try),
        (set_background_mesh, "mesh_pic_villageriot"),
      (try_end),
      ],
    [
      ("dplmc_continue",[],"Continue...",
       [(change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_appoint_chamberlain",0,
    "As a lord of a fief you can now appoint a chamberlain who resides at you court for a weekly salary of 15 scillingas. He will handle all financial affairs like collecting and determining taxes, paying wages and managing your estate. In addition he supervises money transfers between kingdoms giving you more diplomatic options.",
    "none",
    [],
    [

      ("dplmc_appoint_default",[],"Appoint a prominent nobleman from the area.",
       [
        (call_script, "script_dplmc_appoint_chamberlain"),
        (jump_to_menu, "mnu_dplmc_chamberlain_confirm"),
        ]),
      ("dplmc_continue",[],"Proceed without chamberlain.",
       [
         (assign, "$g_player_chamberlain", -1), #denied
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_chamberlain_confirm",0,
    "Your chamberlain can be found at your court. You should consult him if you want to give him any financial advice or you need greater amounts of money. You should always make sure that there is enough money in the treasury to pay for political affairs.",
    "none",
    [],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_notification_appoint_constable",0,
    "As a lord of a fief you can now appoint a constable who resides at you court for a weekly salary of 15 scillingas. He will recruit new troops and provide information about your army.",
    "none",
    [],
    [

      ("dplmc_appoint_default",[],"Appoint a prominent nobleman from the area.",
       [
        (call_script, "script_dplmc_appoint_constable"),
        (jump_to_menu, "mnu_dplmc_constable_confirm"),
        ]),
      ("dplmc_continue",[],"Proceed without constable.",
       [
         (assign, "$g_player_constable", -1), #denied
         (assign, "$g_constable_training_center", -1),
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_constable_confirm",0,
    "Your constable can be found at your court. You should consult him if you want to recruit new troops or get detailed information about your standing  army.",
    "none",
    [],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),



  (
    "dplmc_notification_appoint_chancellor",0,
    "As a lord of a fief you can now appoint a chancellor who resides at you court for a weekly salary of 20 scillingas. He will be the keeper of your seal and conduct the correspondence between you and other important persons.",
    "none",
    [],
    [

      ("dplmc_appoint_default",[],"Appoint a prominent nobleman from the area.",
       [
        (call_script, "script_dplmc_appoint_chancellor"),
        (jump_to_menu, "mnu_dplmc_chancellor_confirm"),
        ]),
      ("dplmc_continue",[],"Proceed without chancellor.",
       [
         (assign, "$g_player_chancellor", -1), #denied
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_chancellor_confirm",0,
    "Your chancellor can be found at your court. You should consult him if you want to send messages or gifts.",
    "none",
    [],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),


  (
    "dplmc_deserters",0,
    "Some of your men don't believe that you will pay their wages and desert. Overall you lose: {s11} men.",
    "none",
    [
      (set_background_mesh, "mesh_pic_deserters1"),
      (store_random_in_range, ":random", 1,  "$g_notification_menu_var1"),
      (call_script, "script_dplmc_player_troops_leave", ":random"),
      (str_store_string, s11, "@{reg0}"),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_negotiate_besieger",0,
    "You appear with a white flag at the top of the wall. After a while a negotiator of {s11} approaches you. He demands {s6} and all associated villages as well as {reg0} scillingas for safe conduct.",
    "none",
    [
      (party_get_slot, ":besieger", "$current_town", slot_center_is_besieged_by),
      (party_stack_get_troop_id, ":enemy_party_leader", ":besieger", 0),
      (str_store_troop_name, s11, ":enemy_party_leader"),
      (store_faction_of_troop, ":besieger_faction", ":enemy_party_leader"),

      (assign, ":besieger_size", 0),
      (try_for_range, ":lord", active_npcs_begin, active_npcs_end),
        (store_faction_of_troop, ":lord_faction", ":lord"),
        (eq, ":lord_faction", ":besieger_faction"),
        (troop_get_slot, ":led_party", ":lord", slot_troop_leaded_party),
        (party_is_active, ":led_party"),

        (party_slot_eq, ":led_party", slot_party_ai_state, spai_accompanying_army),
        (party_slot_eq, ":led_party", slot_party_ai_object, ":besieger"),

        (party_is_active, ":besieger"),
        (store_distance_to_party_from_party, ":distance_to_marshal", ":led_party", ":besieger"),
        (lt, ":distance_to_marshal", 25),
        (party_get_num_companions, ":party_size", ":led_party"),
        (val_add, ":besieger_size", ":party_size"),
      (try_end),

      (assign, ":garrison_size", 0),
      (party_get_num_companion_stacks, ":num_stacks", "$current_town"),
      (try_for_range, ":i_stack", 0, ":num_stacks"),
        (party_stack_get_size, ":stack_size", "$current_town", ":i_stack"),
        (val_add, ":garrison_size", ":stack_size"),
      (try_end),
      (val_sub, ":besieger_size", ":garrison_size"),

      (store_skill_level, ":player_persuasion_skill", "skl_persuasion", "trp_player"),
      (val_mul, ":player_persuasion_skill", 10),
      (store_sub, "$diplomacy_var", ":besieger_size", ":player_persuasion_skill"),
      (val_mul, "$diplomacy_var", 4),
      ##diplomacy start+ : include ransom cost in calculation chief
      (call_script, "script_calculate_ransom_amount_for_troop", "trp_player"),
      (val_add, "$diplomacy_var", reg0),
      ##diplomacy end+
      (val_max,"$diplomacy_var",500),
      (val_div, "$diplomacy_var", 100),
      (val_mul, "$diplomacy_var", 100),
      (assign, reg0, "$diplomacy_var"),

      (str_store_party_name, s6, "$current_town"),

    ],
      [
      ("dplmc_comply_treasury",
      [
        (store_troop_gold, ":gold", "trp_household_possessions"),
        (ge, ":gold", "$diplomacy_var"),
      ],"Comply and induce your chamberlain to pay the money from the treasury.",
      [
        (call_script, "script_dplmc_withdraw_from_treasury", "$diplomacy_var"),
		##diplomacy start+ when the player pays, give the gold to the lord chief
		(party_get_slot, ":besieger", "$current_town", slot_center_is_besieged_by),
		(party_stack_get_troop_id, ":enemy_party_leader", ":besieger", 0),
		(troop_add_gold, ":enemy_party_leader", "$diplomacy_var"),
		##diplomacy end+
        (call_script, "script_dplmc_player_center_surrender", "$current_town"),
        (change_screen_return),
      ]),

      ("dplmc_comply",
      [
        (store_troop_gold, ":gold", "trp_player"),
        (ge, ":gold", "$diplomacy_var"),
      ],"Comply and pay the money cash.",
      [
        (troop_remove_gold, "trp_player", "$diplomacy_var"),
 		##diplomacy start+ when the player pays, give the gold to the lord chief
		(party_get_slot, ":besieger", "$current_town", slot_center_is_besieged_by),
		(party_stack_get_troop_id, ":enemy_party_leader", ":besieger", 0),
		(troop_add_gold, ":enemy_party_leader", "$diplomacy_var"),
		##diplomacy end+
       (call_script, "script_dplmc_player_center_surrender", "$current_town"),
        (change_screen_return),
      ]),

      ("dplmc_break_off",[],"Break off negotiations.",
       [
          (jump_to_menu, "mnu_town"),
        ]),
     ]
  ),


  (
    "dplmc_messenger",0,
    "Sire, I found {s10} and delivered your message. His answer was {s11}.",
    "none",
    [
        (set_background_mesh, "mesh_pic_messenger1"),
        (str_store_troop_name, s10, "$g_notification_menu_var1"),
        (try_begin),
          (eq, "$g_notification_menu_var2", 1),
          (str_store_string, s11, "@positive"),
        (else_try),
          (str_store_string, s11, "@negative"),
        (try_end),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_scout",0,
    "Your spy returned from {s10}^^{s11}{s12}",
    "none",
    [
    (set_background_mesh, "mesh_pic_messenger1"),
    (str_store_party_name, s10, "$g_notification_menu_var1"),

    (call_script, "script_game_get_center_note", "$g_notification_menu_var1", 0),
    (str_store_string, s11, "@{!}{s0}"),
    (try_begin),
      (this_or_next|is_between, "$g_notification_menu_var1", towns_begin, towns_end),
      (is_between, "$g_notification_menu_var1", castles_begin, castles_end),
      (party_get_slot, ":center_food_store", "$g_notification_menu_var1", slot_party_food_store),
      (call_script, "script_center_get_food_consumption", "$g_notification_menu_var1"),
      (assign, ":food_consumption", reg0),
      (store_div, reg6, ":center_food_store", ":food_consumption"),
      (store_party_size, reg5, "$g_notification_menu_var1"),
      (str_store_string, s11, "@{s11}^^ The current garrison consists of {reg5} men.^The food stock lasts for {reg6} days."),
    (try_end),

    (str_clear, s12),
    (party_get_num_attached_parties, ":num_attached_parties", "$g_notification_menu_var1"),
    (try_begin),
      (gt, ":num_attached_parties", 0),
      (str_store_string, s12, "@^^Additional the following parties are currently inside:^"),
    (try_for_range, ":attached_party_rank", 0, ":num_attached_parties"),
      (party_get_attached_party_with_rank, ":attached_party", "$g_notification_menu_var1", ":attached_party_rank"),
      (str_store_party_name, s3, ":attached_party"),
      (store_party_size, reg1, ":attached_party"),
      (str_store_string, s12, "@{s12} {s3} with {reg1} troops.^"),
    (try_end),

	##diplomacy start+
	#Add missing try-end for (gt, ":num_attached_parties", 0),
	(try_end),
	##diplomacy end+
    (call_script, "script_update_center_recon_notes", "$g_notification_menu_var1"),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "dplmc_domestic_policy",0,
    "You can now shape the domestic policy of your kingdom. Do you want to change your policy now?",
    "none",
    [
      (try_begin),
          (eq, "$g_players_policy_set", 1),
          (change_screen_return),
      (try_end),

      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
    ],
    [
      ("dplmc_yes",[],"Yes, I want to change the domestic policy.",
       [
         (start_presentation, "prsnt_dplmc_policy_management"),
        ]),
      ("dplmc_no",[],"No, I don't want to change the domestic policy.",
       [
         (change_screen_return),

        ]),
     ]
  ),

  (
    "dplmc_affiliate_end",0,
    "{!}{s11}",
    "none",
    [
      (set_background_mesh, "mesh_pic_messenger1"),

      (str_store_troop_name, s9, "$g_notification_menu_var1"),
      (try_begin),
        (eq, "$g_player_affiliated_troop", "$g_notification_menu_var1"),
        (str_store_string, s11, "@{playername}, ^^I always knew you were a bad egg, since the day you have pledged allegiance to my clan. ^Did you really think you could set my family against me? You've dropped your mask, you snake! You are an infliction, and I will not bear it anymore. ^Hereby, I disown and ban you from my house. I have urged my family to fight you, and I will warn Britannia and Hibernia lords about your infamy. ^Tremble with fear, you have a deadly enemy! ^^{s9}."),
      (else_try), #chief cambia para quitar calradia
        (is_between, "$g_player_affiliated_troop", lords_begin, kingdom_ladies_end),
        (str_store_troop_name, s10, "$g_player_affiliated_troop"),
        (str_store_string, s11, "@{playername},^^ I've received a letter from {s9}, telling me about your disgracefull jiggery-pokery. In the present circumstances, {s9} could not provide evidence. But unlike you, {he/she} is a distinguished member of my family; and since all these years, I never had any reason to distrust {him/her}. I take {his/her} charges for granted. ^Hopefully, you failed to breakup my family unit. Hereby I reject your pledge : you are no longer related to my house. Each membership will retaliate against you in all conscience... ^I would be ashamed to confess how you maliciously fooled me, so I will not challenge you, to not be accountable for your death to my King. However I'm not used to report him every rat I crush while in wilderness, someday I may find you there ! ^^{s10}"),
      (try_end),
    ],
    [
      ("dplmc_continue",[],"Continue...",
       [
         (change_screen_return),
        ]),
     ]
  ),

  (
    "torneo_opciones",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Preferences",
    "none",
    [
              (set_background_mesh, "mesh_pic_messenger1"),
    ],
    [
      ("disable_avdificultad",[ (eq, "$g_avdificultad", 1),],"Click to Disable Level of Difficulty: Expert.",
       [
           (assign, "$g_avdificultad", 0),
           (jump_to_menu, "mnu_torneo_opciones"),
        ]),
      ("enable_avdificultad",[ (eq, "$g_avdificultad", 0),],"Click to Enable Level of Difficulty: Expert.",
       [
           (assign, "$g_avdificultad", 1),
           (jump_to_menu, "mnu_torneo_opciones"),
        ]),
      ("tonero_back",[],"Back...",
       [
           (jump_to_menu, "mnu_town_tournament"),
        ]),
     ]
  ),

  (
    "dplmc_preferences",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Preferences",
    "none",
    [
              (set_background_mesh, "mesh_pic_messenger1"),
    ],
    [
      ("formation_mod_option",[],"Formations mod options.", [(start_presentation, "prsnt_formation_mod_option")]),
      ("disable_realism_upgrade",[ (eq, "$g_realism_upgrade", 0),],"Click to Disable Realism Upgrade (x2 Xp need for Troops upgrade).",
       [
           (assign, "$g_realism_upgrade", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_realism_upgrade",[ (eq, "$g_realism_upgrade", 1),],"Click to Enable Realism Upgrade (x2 Xp need for Troops upgrade).",
       [
           (assign, "$g_realism_upgrade", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("dplmc_disable_battle_continuation",[ (eq, "$g_dplmc_battle_continuation", 0),],"Click to Disable battle continuation.",
       [
           (assign, "$g_dplmc_battle_continuation", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("dplmc_enable_battle_continuation",[ (eq, "$g_dplmc_battle_continuation", 1),],"Click to Enable battle continuation and death camera.",
       [
           (assign, "$g_dplmc_battle_continuation", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("disable_siege_realism",[ (eq, "$g_siege_realism", 1),],"Click to Disable Siege Warfare Realism (Native mode).",
       [
           (assign, "$g_siege_realism", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_siege_realism",[ (eq, "$g_siege_realism", 0),],"Click to Enable Siege Warfare Realism.",
       [
           (assign, "$g_siege_realism", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
###combate avanzado
##      ("action_tactics_on2",[(eq, "$g_realistic_casualties", 0)],"Click to Disable Advance Warfare (Realistic Casualties+ Weapon Breaking+ shield bash+ Armor Penalty).",
##       [
##           (assign, "$g_realistic_casualties",1),
##           (assign, "$g_weapon_breaking", 1),
##           (assign, "$sp_shield_bash", 0),
##           (assign, "$g_armor_penalties", 1),
##           (jump_to_menu,"mnu_dplmc_preferences"),
##        ]
##       ),
##      ("action_tactics_off2",[(eq, "$g_realistic_casualties", 1)],"Click to Enable Advance Warfare (Realistic Casualties+ Weapon Breaking+ shield bash+ Armor Penalty).",
##       [
##           (assign, "$g_realistic_casualties",0),
##           (assign, "$g_weapon_breaking", 0),
##           (assign, "$sp_shield_bash", 1),
##           (assign, "$g_armor_penalties", 0),
##        (display_message, "@ Shield bash enabled. Key: Right Click + Left Click. Remember: Shield bash consumes energy and you can not make two consecutive bashes."),
##           (jump_to_menu,"mnu_dplmc_preferences"),
##        ]
##       ),
##
###combate realista
##      ("action_tactics_on3",[(eq, "$g_realistic_casualties", 0)],"Click to Disable Realistic Warfare (Advance+ AI shield bash+ Walk Backwards Fall+ Battle Wounds+ Special Hits and Bleeding).",
##       [
##           (assign, "$g_realistic_casualties",1),
##           (assign, "$g_weapon_breaking", 1),
##           (assign, "$sp_shield_bash", 0),
##           (assign, "$g_armor_penalties", 1),
##           (assign, "$sp_shield_bash_ai", 0),
##           (assign, "$sp_caer_andar", 0),
##           (assign, "$g_heridas_chel", 0),
##           (assign, "$sp_criticos", 0),
##           (jump_to_menu,"mnu_dplmc_preferences"),
##        ]
##       ),
##      ("action_tactics_off3",[(eq, "$g_realistic_casualties", 1)],"Click to Enable Realistic Warfare (Advance+ AI shield bash+ Walk Backwards Fall+ Battle Wounds+ Special Hits and Bleeding).",
##       [
##           (assign, "$g_realistic_casualties",0),
##           (assign, "$g_weapon_breaking", 0),
##           (assign, "$sp_shield_bash", 1),
##           (assign, "$g_armor_penalties", 0),
##        (display_message, "@ Shield bash enabled. Key: Right Click + Left Click. Remember: Shield bash consumes energy and you can not make two consecutive bashes."),
##           (assign, "$sp_shield_bash_ai", 1),
##           (assign, "$sp_caer_andar", 1),
##           (assign, "$g_heridas_chel", 1),
##           (assign, "$sp_criticos", 1),
##           (jump_to_menu,"mnu_dplmc_preferences"),
##        ]
##       ),

      ("enable_alturas",[ (eq, "$sp_alturas", 0),],"Click to Enable different heights for the troops in battle (You remember that is change physics when Ragdolls on).",
       [
           (assign, "$sp_alturas", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("alturas_disable",[(eq, "$sp_alturas", 1),],"Click to Disable different heights for the troops in battle.",
       [
           (assign, "$sp_alturas", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
##      ("action_tactics_on",[(eq, "$g_realistic_casualties", 0)],"Click to Disable Realistic Casualties.",
##       [
##           (assign, "$g_realistic_casualties",1),(jump_to_menu,"mnu_dplmc_preferences"),
##        ]
##       ),
##      ("action_tactics_off",[(eq, "$g_realistic_casualties", 1)],"Click to Enable Realistic Casualties.",
##       [
##           (assign, "$g_realistic_casualties",0),(jump_to_menu,"mnu_dplmc_preferences"),
##        ]
##       ),
      ("weapon_breaking_disable",[(eq, "$g_weapon_breaking", 0),],"Click to Disable Weapon Breaking.",
       [
           (assign, "$g_weapon_breaking", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_weapon_breaking",[ (eq, "$g_weapon_breaking", 1),],"Click to Enable Weapon Breaking.",
       [
           (assign, "$g_weapon_breaking", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_shield_bash",[ (eq, "$sp_shield_bash", 0),],"Click to Enable Shield Bash.",
       [
           (assign, "$sp_shield_bash_ai", 1),
           (assign, "$sp_shield_bash", 1),
        (display_message, "@ Shield bash enabled. Key: Right Click + Left Click. Remember: Shield bash consumes energy and you can not make two consecutive bashes."),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("shield_bash_disable",[(eq, "$sp_shield_bash", 1),],"Click to Disable Shield Bash.",
       [
           (assign, "$sp_shield_bash", 0),
           (assign, "$sp_shield_bash_ai", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
##      ("enable_shield_ai_bash",[ (eq, "$sp_shield_bash_ai", 0),],"Click to Enable Shield Bash AI.",
##       [
##           (assign, "$sp_shield_bash_ai", 1),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
##      ("shield_bash_ai_disable",[(eq, "$sp_shield_bash_ai", 1),],"Click to Disable Shield Bash AI.",
##       [
##           (assign, "$sp_shield_bash_ai", 0),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
      ("armor_penalties_on",[ (eq, "$g_armor_penalties", 0),],"Click to Disable armor penalty.",
       [
           (assign, "$g_armor_penalties", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("armor_penalties_disable",[ (eq, "$g_armor_penalties", 1),],"Click to Enable armor penalty.",
       [
           (assign, "$g_armor_penalties", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("diseble_moral_rest",[(eq, "$g_moral_rest", 0),],"Click to Disable realism morale impact of resting/not resting.",
       [
           (assign, "$g_moral_rest", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_moral_rest",[ (eq, "$g_moral_rest", 1),],"Click to Enable realism morale impact of resting/not resting.",
       [
           (assign, "$g_moral_rest", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_decapitation",[ (eq, "$sp_decapitation", 0),],"Click to Enable Gore.",
       [
           (assign, "$sp_decapitation", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("decapitation_disable",[(eq, "$sp_decapitation", 1),],"Click to Disable Gore.",
       [
           (assign, "$sp_decapitation", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_fatigas",[ (eq, "$sp_fatigas", 0),],"Click to Enable Fatigue/stamine system.",
       [
           (assign, "$sp_fatigas", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("fatigas_disable",[(eq, "$sp_fatigas", 1),],"Click to Disable Fatigue/stamine system.",
       [
           (assign, "$sp_fatigas", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
##      ("enable_heridas",[ (eq, "$g_heridas_chel", 0),],"Click to Enable Battle Wounds.",
##       [
##           (assign, "$g_heridas_chel", 1),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
##      ("disable_heridas",[(eq, "$g_heridas_chel", 1),],"Click to Disable Battle Wounds.",
##       [
##           (assign, "$g_heridas_chel", 0),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
      ("enable_caeratras",[ (eq, "$sp_caer_andar", 0),],"Click to Enable Walk Backwards Fall.",
       [
           (assign, "$sp_caer_andar", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("disable_caeratras",[(eq, "$sp_caer_andar", 1),],"Click to Disable Walk Backwards Fall.",
       [
           (assign, "$sp_caer_andar", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("enable_sp_criticos",[ (eq, "$sp_criticos", 0),],"Click to Enable Battle Wounds, Special Hits and Bleeding.",
       [
           (assign, "$g_heridas_chel", 1),
           (assign, "$sp_criticos", 1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
      ("disable_sp_criticos",[(eq, "$sp_criticos", 1),],"Click to Disable Battle Wounds, Special Hits and Bleeding.",
       [
           (assign, "$sp_criticos", 0),
           (assign, "$g_heridas_chel", 0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]),
#TEMPERED chief CHANGES BEGIN, TOGGLE OPTIONS
      ("action_drowning",[(eq, "$drowning", 0)],"Click to Enable drowning in missions.",
       [
			(assign,"$drowning",1),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]
       ),

      ("action_no_drowning",[(eq, "$drowning", 1)],"Click to Disable drowning in missions.",
       [
			(assign,"$drowning",0),
           (jump_to_menu, "mnu_dplmc_preferences"),
        ]
       ),

##			("jump_to_scene",[(eq,"$cheat_mode",1)],"debug: test scene menu",
##				[
##					(jump_to_menu,"mnu_test_scene"),
##				]),
##
##			("toggle_cheat_on",[(eq, "$cheat_mode", 0)],"_Toggle cheat menu on.",
##				[
##					(assign,"$cheat_mode",1),
##					(jump_to_menu,"mnu_dplmc_preferences"),
##				]),
##
##			("toggle_cheat_off",[(eq, "$cheat_mode",1)],"_Toggle cheat menu off.",
##				[
##					(assign,"$cheat_mode",0),
##					(jump_to_menu,"mnu_dplmc_preferences"),
##				]),
##
##			("toggle_companion_complaint_off",[(eq, "$disable_npc_complaints", 0)],"_Toggle companion complaints off.",
##				[
##					(assign, "$disable_npc_complaints", 1),
##					(jump_to_menu,"mnu_dplmc_preferences"),
##				]),
##
##			("toggle_companion_complaint_on",[(eq, "$disable_npc_complaints", 1)],"_Toggle companion complaints on.",
##				[
##					(assign, "$disable_npc_complaints", 0),
##					(jump_to_menu,"mnu_dplmc_preferences"),
##				]),
##
##			("camp_cheat",[(ge, "$cheat_mode", 1)], "CHEAT MENU!",
##				[
##					(jump_to_menu, "mnu_camp_cheat"),
##				]),
##
##			("continue",[],"Back to camp menu",
##				[
##					(jump_to_menu,"mnu_camp"),
##				]),
#TEMPERED chief CHANGES END

##            ("disable_esconder_defensores",[ (eq, "$g_esconder_defensores", 0),],"Disable Hide Defenders.",
##       [
##           (assign, "$g_esconder_defensores", 1),
##	 (try_for_range,":cur_center",centers_begin,centers_end),
##		(party_set_flags,":cur_center",pf_hide_defenders,1),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
##      ("enable_esconder_defensores",[ (eq, "$g_esconder_defensores", 1),],"Enable Hide Defenders.",
##       [
##           (assign, "$g_esconder_defensores", 0),
##	 (try_for_range,":cur_center",centers_begin,centers_end),
##		(party_set_flags,":cur_center",pf_hide_defenders,0),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
##      ("shield_bash_enable",[ (eq, "$g_shield_bash", 1),],"Enable Shield Bash (Alpha version).",
##       [
##           (assign, "$g_shield_bash", 0),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
##      ("shield_bash_disable",[(eq, "$g_shield_bash", 0),],"Disable Shield Bash.",
##       [
##           (assign, "$g_shield_bash", 1),
##           (jump_to_menu, "mnu_dplmc_preferences"),
##        ]),
      ("dplmc_back",[],"Back...",
       [
           (jump_to_menu, "mnu_camp"),
        ]),
     ]
  ),

  ##diplomacy chief end
  #Random Events chief Sot
    (
    "event_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A bard composed a song about your noble deeds.",
    "none",
    [

	],
    [
      ("choice_01_1",[],"Excellent!",
       [
		  (call_script, "script_change_troop_renown", "trp_player", 5),
          (change_screen_return),
        ]
       ),
      ("choice_01_2",[],"Reward him with 200 denars. Let his song be played across the land.",
       [
	   (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(call_script, "script_change_troop_renown", "trp_player", 20),
		(troop_remove_gold, "trp_player", 200),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_01_3",[],"Noble deeds? A song? Bring me this fool's head!",
       [
	   (call_script, "script_change_player_honor", -10),
	   (change_screen_return),
        ]
       ),
      ]
  ),


  (
    "event_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Tales of your honor spread around the country. Everywhere you go, your procession is surrounded by beggars.",
    "none",
    [

	],
    [
      ("choice_02_1",[],"Allocate 200 denars for an alms fund.",
       [
          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(call_script, "script_change_player_honor", 5),
		(call_script, "script_change_troop_renown", "trp_player", 10),
		(troop_remove_gold, "trp_player", 200),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_02_2",[],"Ignore them.",
       [
	   (call_script, "script_change_troop_renown", "trp_player", -5),
	   (call_script, "script_change_player_honor", -5),
		(change_screen_return),
        ]
       ),
      ("choice_02_3",[],"Beggars huh? Release the hounds!",
       [
	   (call_script, "script_change_player_honor", -15),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_03",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A young noble spreads rumors about your mother. Accusations of working in the world's oldest profession are the most delicate ones.",
    "none",
    [

	],
    [
      ("choice_03_1",[],"I challenge him to a duel!",
       [
	   (call_script, "script_change_player_honor", 5),
		(display_message, "@The young noble preferred to flee rather than duel with you!"),
	   (change_screen_return),
        ]
       ),
      ("choice_03_2",[],"It's none of my business.",
       [
	   (call_script, "script_change_player_honor", -25),
		(change_screen_return),
        ]
       ),
      ("choice_03_3",[],"Make sure he accidentaly encounters a loose falling brick.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -15),
	   (call_script, "script_change_player_honor", -5),
	   (change_screen_return),
        ]
       ),
      ]
  ),


  (
    "event_04",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You encounter one of your soldiers wives. She begs you to release her husband from his contract. The harvest was poor this year and his wages can't feed the whole family. If he could come back and work on the field they might survive.",
    "none",
    [

	],
    [
      ("choice_04_1",[],"This can't be! Here take 200 scillingas.",
       [
		          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(call_script, "script_change_player_honor", 5),
		(troop_remove_gold, "trp_player", 200),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_04_2",[],"Pacta sunt servanda!",
       [
		(change_screen_return),
        ]
       ),
      ("choice_04_3",[],"Why starve when my army could use the services of such a pretty young girl?",
       [
	   (call_script, "script_change_player_honor", -15),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_05",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A local naysayer is spreading false rumors about you. While most of the stories are just pure nonsense, sooner or later people will believe those stories.",
    "none",
    [

	],
    [
      ("choice_05_1",[],"Let him speak what he wants. Every man has his rights.",
       [
		          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
          (change_screen_return),
        ]
       ),
      ("choice_05_2",[],"Tell royal scribe to spread opposite rumors to counter his lies. (300 scillingas).",
       [
	    (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(call_script, "script_change_player_honor", 2),
		(call_script, "script_change_troop_renown", "trp_player", 5),
		(troop_remove_gold, "trp_player", 300),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -7),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_05_3",[],"Ask him to stop. 100 scillingas might help him to forget what he said.",
       [
	    (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -7),
		(try_end),
	   (change_screen_return),
        ]
       ),
	   ("choice_05_4",[],"Throw him into the dungeon. Insulting to me is a crime.",
       [
	   (call_script, "script_change_player_honor", -15),
	   (change_screen_return),
        ]
       ),
	   ("choice_05_5",[],"Silence him permanently and seize his house and properties.",
       [
	   (call_script, "script_change_player_honor", -60),
	   (troop_add_gold, "trp_player", 1000),
	   (change_screen_return),
        ]
       ),
      ]
  ),


   (
    "event_06",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A mob of angry {s1} dwellers are complaining about corrupt tax collectors. They demand justice. The situation is getting worse by the minute. It looks like a riot is about to begin unless you do something.",
    "none",
    [
	(assign, ":stop", 0),
	(try_for_range, ":unused", 0, 9999),
	(eq, ":stop", 0),
	(store_random_party_in_range, "$temp", centers_begin, centers_end),
	(neg|party_slot_eq, "$temp", slot_party_type, spt_castle),
	(party_slot_eq, "$temp", slot_town_lord, "trp_player"),
	(assign, ":stop", 1),
	(str_store_party_name, s1, "$temp"),
	(try_end),
	],
    [
      ("choice_06_1",[],"Begin an investigation and compensate the peasants for their loss.",
       [
	 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", 2),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(troop_remove_gold, "trp_player", 300),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_sub, ":cur_relation", 5),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_06_2",[],"Rush the town guards to control the mob from spreading and turning into a riot.",
       [
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_sub, ":cur_relation", 5),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(change_screen_return),
        ]
       ),
      ("choice_06_3",[],"Put the peasants back to their place and collect their overdue taxes.",
       [
	   (call_script, "script_change_player_honor", -5),
	   (party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_sub, ":cur_relation", 10),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(troop_add_gold, "trp_player", 100),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_07",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A single rider, looking poor and unarmed, approaches your party. Intercepted by your men he presents himself as a troubadour from {s1} and requests your permission to compose an ode about your magnificency and generosity. Your men exchange glances and then look at you waiting for an answer. You...",
    "none",
    [
	(assign, ":stop", 0),
	(try_for_range, ":unused", 0, 9999),
	(eq, ":stop", 0),
	(store_random_party_in_range, "$temp", centers_begin, centers_end),
	(neg|party_slot_eq, "$temp", slot_party_type, spt_castle),
	(party_slot_eq, "$temp", slot_town_lord, "trp_player"),
	(assign, ":stop", 1),
	(str_store_party_name, s1, "$temp"),
	(try_end),
	],
    [
      ("choice_07_1",[],"Grant such permission to the troubadour and cover the man with gold -300 scillingas-.",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(store_random_in_range, ":rand_no", 3, 10),
		(call_script, "script_change_troop_renown", "trp_player", ":rand_no"),
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", 5),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(troop_remove_gold, "trp_player", 300),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -2),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_07_2",[],"Grant permission and hand a purse with 100 scillingas to the man.",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", 2),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(troop_remove_gold, "trp_player", 100),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -2),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_07_3",[],"Allow the troubadour to compose the ode but offer him no payment.",
       [
		(store_random_in_range, ":rand_no", -2, 2),
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", ":rand_no"),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
	   (change_screen_return),
        ]
       ),
	   ("choice_07_4",[],"Order your men to take the beggar out of your way.",
       [
	   (call_script, "script_change_player_honor", -2),
	   (change_screen_return),
        ]
       ),
      ]
  ),

(
    "event_08",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You spot a single man riding hard towards your party. With a gesture of your hand, your men run to meet him. Intercepted by your men he presents himself as an emissary from {s1} and without delay informs you that an influential man has died {s2} and that his family requests that you agree to declare an official day of mourning in {s1} in his honor. You...",
    "none",
    [
	(assign, ":stop", 0),
	(try_for_range, ":unused", 0, 9999),
	(eq, ":stop", 0),
	(store_random_party_in_range, "$temp", centers_begin, centers_end),
	(neg|party_slot_eq, "$temp", slot_party_type, spt_castle),
#	(party_slot_eq, "$temp", slot_town_lord, "trp_player"),
	(assign, ":stop", 1),
	(str_store_party_name, s1, "$temp"),
	(try_end),
	(store_random_in_range, ":rand_no", 1, 10),
		(try_begin),
		(ge, ":rand_no", 8),
		(str_store_string , s2, "@of a fulminatng disease"),
		(else_try),
		(ge, ":rand_no", 5),
		(str_store_string , s2, "@in a hunting accident"),
		(else_try),
		(ge, ":rand_no", 3),
		(str_store_string , s2, "@assasinated"),
		(else_try),
		(ge, ":rand_no", 0),
		(str_store_string , s2, "@of an indigestion"),
		(try_end),
	],
    [
      ("choice_08_1",[],"Agree to such request.",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", 2),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(troop_remove_gold, "trp_player", 100),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -1),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_08_2",[],"Refuse to such request.",
       [
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", -2),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
		(change_screen_return),
        ]
       ),
      ]
  ),
#fine
    (
    "event_09",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are travelling through the forest and you suddenly spot a wild hare, trapped in the snare. What do you do?",
    "none",
    [

	],
    [
      ("choice_09_1",[],"Free the animal.",
       [

                  (change_screen_return),
        ]
       ),
      ("choice_09_2",[],"Clench snare and kill the animal!",
       [
            (troop_add_item, "trp_player","itm_dried_meat",0),
	    (change_screen_return),
        ]
       ),
      ("choice_09_3",[],"Pass by the animal and ignore it.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_10",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are travelling through the forest and you spot a peasant tied up a tree, probably by a bandit. What do you do?",
    "none",
    [

	],
    [
      ("choice_10_1",[],"Free the peasant.",
       [
		  (call_script, "script_change_player_honor", 1),
                  (party_add_members, "p_main_party", "trp_farmer", 1),
                  (change_screen_return),
        ]
       ),
      ("choice_10_2",[],"Pass by the peasant.",
       [
	    (change_screen_return),
        ]
       ),
      ("choice_10_3",[],"Kill the peasant",
       [
	   (call_script, "script_change_player_honor", -1),
	   (change_screen_return),
        ]
       ),
      ]
  ),


#tropas que se unen
        (
    "event_101",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are a famous leader, and you received news that a group of young nobles wishes to join you. But They want more pay than the rest of your troops for their condition.",
    "none",
    [

	],
    [
      ("choice_101_1",[],"They are welcome.",
       [
                  (party_add_members, "p_main_party", "trp_mercenary_cavalry", 3),
                  (change_screen_return),
        ]
       ),
      ("choice_101_2",[],"I do not need more troops.",
       [
	    (change_screen_return),
        ]
       ),
      ("choice_101_3",[],"Kill them. Sure they give good loot.",
       [
	   (call_script, "script_change_player_honor", -20),
	   (troop_add_gold, "trp_player", 10000),
		(call_script, "script_change_troop_renown", "trp_player", -100),
	   (change_screen_return),
        ]
       ),
      ]
  ),

        (
    "event_102",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are a famous leader, and you received news that a group of women expresses interest in becoming camp followers.",
    "none",
    [

	],
    [
      ("choice_102_1",[],"They are welcome.",
       [
                  (party_add_members, "p_main_party", "trp_follower_woman", 6),
                  (change_screen_return),
        ]
       ),
      ("choice_102_2",[],"I do not need more troops.",
       [
	    (change_screen_return),
        ]
       ),
      ]
  ),

        (
    "event_103",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are a famous leader, and you received news that a group of street musicians wishes to join you, and make the path more merry.",
    "none",
    [

	],
    [
      ("choice_103_1",[],"They are welcome.",
       [
                  (party_add_members, "p_main_party", "trp_briton_portaestandarte", 1),
                  (party_add_members, "p_main_party", "trp_todos_cuerno", 2),
                  (change_screen_return),
        ]
       ),
      ("choice_103_2",[],"I do not need more troops.",
       [
	    (change_screen_return),
        ]
       ),
      ]
  ),

#tropas acaba

        (
    "event_11",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The kin of a Geoguth (a regular freeman) slain in one of your battles brings a suit against you requesting wergild (compensation) of 200 scillingas. What do you do?",
    "none",
    [

	],
    [
      ("choice_11_1",[],"Pay the Wergild",
       [   (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(troop_remove_gold, "trp_player", 200),
                (display_message, "@Wergild was paid."),
           	(call_script, "script_change_player_honor", 2),
                (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", 1),
                (call_script, "script_change_troop_renown", "trp_player", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -10),
                (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", -3),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_11_2",[],"Refuse to pay",
       [
	   (call_script, "script_change_player_honor", -12),
            (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", -9),
	    (change_screen_return),
        ]
       ),
      ("choice_11_3",[],"Refuse to answer the case at all",
       [
	   (call_script, "script_change_player_honor", -8),
           (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", -5),
	   (change_screen_return),
        ]
       ),
      ]
  ),

          (
    "event_12",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The kin of the Mierce pagan priest slain by your men in the fight brings a suit against you requesting wergild (compensation) of 500 scillingas. What do you do?",
    "none",
    [

	],
    [
      ("choice_12_1",[],"Pay the Wergild",
       [   (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@Wergild was paid."),
           	(call_script, "script_change_player_honor", 3),
                (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2),
                (call_script, "script_change_troop_renown", "trp_player", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
                (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -4),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_12_2",[],"Refuse to pay",
       [
           	(call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -10),
	    (change_screen_return),
        ]
       ),
      ("choice_12_3",[],"Refuse to answer the case at all",
       [
	   (call_script, "script_change_player_honor", -10),
           (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -5),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_13",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You see a crane circling above your party.",
    "none",
    [

	],
    [
      ("choice_13_1",[],"Tell to your men that the crane symbolizes the gods of war, and the next battle you fight shall leave you victorious!",
       [
		  (call_script, "script_change_player_party_morale", 5),
  (display_message, "@It is common knowledge that the crane is a Celtic symbol of war. Your men are impressed by your worldy knowledge, and grateful that the gods are with them."),
          (change_screen_return),
        ]
       ),
      ("choice_13_2",[],"Ignore it.",
       [
	(change_screen_return),
  (display_message, "@Your men pass by the bird without noticing it."),
        ]
       ),
      ("choice_13_3",[],"Tell them that although the cranes warn of a bad fortunes, you have faith in their sword arms!",
       [
	   (call_script, "script_change_player_party_morale", -5),
	   (display_message, "@The crane is a Celtic symbol of war - everyone knows that! Your lack of knowledge troubles your men, and they begin to doubt your certainty of character."),

	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_14",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A country farmer stands before you on the road, a weeping girl behind him. He points his finger accusingly at one of your men, saying that he raped his daughter and demands justice.",
    "none",
    [

	],
    [
      ("choice_14_1",[],"You will not tolerate indecency amongst your men! Brand the man and cast him out of your party.",
       [
		  (call_script, "script_change_player_honor", 5),
          (change_screen_return),
        ]
       ),
      ("choice_14_2",[],"Give the accused man a lashing and consider the matter settled.",
       [
	(change_screen_return),
        ]
       ),
      ("choice_14_3",[],"It is a hard world, and a man will take what he can. Tell the farmer that he is lucky that is all the man did!",
       [
	   (call_script, "script_change_player_honor", -5),
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_15",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are travelling through the forest and you suddenly spot a lot of mushrooms called 'the porcini'. What do you do?",
    "none",
    [

	],
    [
      ("choice_15_1",[],"Pick them up and eat.",
       [

                  (change_screen_return),
                  (display_message, "@The mushrooms were really tasty!"),
        ]
       ),
      ("choice_15_2",[],"Pick them up and give to your men.",
       [
            (call_script, "script_change_player_party_morale", 1),
  (display_message, "@Your men are eating mushrooms while resting at camp. They seem to be happy."),

	    (change_screen_return),
        ]
       ),
      ("choice_15_3",[],"Pass by them.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

        (
    "event_16",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are travelling through the forest and you suddenly spot a lot of mushrooms called 'the beautiful clavaria'. What do you do?",
    "none",
    [

	],
    [
      ("choice_16_1",[],"Pick them up and eat.",
       [
		   (display_message, "@The mushrooms were really tasteless. You have diarrhoea and feel very bad. Strength and agility attributes were decreased by 1."),
                (troop_raise_attribute, "trp_player",ca_strength,-1),
                   (troop_raise_attribute, "trp_player",ca_agility,-1),
                  (change_screen_return),

        ]
       ),
      ("choice_16_2",[],"Pick them up and give to your men.",
       [
            (call_script, "script_change_player_party_morale", -5),
  (display_message, "@Your men are eating mushrooms while resting at camp. Some of them have diarrhoea and feel very bad. They are angry!"),

	    (change_screen_return),
        ]
       ),
      ("choice_16_3",[],"Pass by them.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

     (
    "event_17",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You are travelling through the forest and you suddenly spot a lot of mushrooms called 'the destroying angel'. What do you do?",
    "none",
    [

	],
    [
      ("choice_17_1",[],"Pick them up and eat.",
       [
		   (display_message, "@The mushrooms were really tasteless. You have diarrhoea and feel very bad. Strength and agility attributes were decreased by 3."),
                (troop_raise_attribute, "trp_player",ca_strength,-2),
                   (troop_raise_attribute, "trp_player",ca_agility,-2),
                  (change_screen_return),

        ]
       ),
      ("choice_17_2",[],"Pick them up and give to your men.",
       [
            (call_script, "script_change_player_party_morale", -10),
  (display_message, "@Your men are eating mushrooms while resting at camp. Some of them have diarrhoea and feel very bad. They are really angry!"),

	    (change_screen_return),
        ]
       ),
      ("choice_17_3",[],"Pass by them.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_18",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "In one of the rest of the day near a village, the priest's wife wants to see you (alone) while her husband is away.",
    "none",
    [

	],
    [
      ("choice_18_1",[],"You agree.",
       [
		  (call_script, "script_change_player_honor", -15),
  (display_message, "@You spend a good time with the priest's wife, and when her husband returns, you away for the stable without being seen!"),
          (change_screen_return),
        ]
       ),
      ("choice_18_2",[],"You send one of your men in your place.",
       [
            (call_script, "script_change_player_party_morale", 2),
		  (call_script, "script_change_player_honor", -10),
	(change_screen_return),
        ]
       ),
      ("choice_18_3",[],"You refuse.",
       [
	   (call_script, "script_change_player_honor", 2),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_19",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You stumble over a group of christian priests that are being attacked by a group of bandits.",
    "none",
    [

	],
    [
      ("choice_19_1",[],"Rush to the aid of the priests to teach those bloody pagan bandits not to disturb the business of the holy church.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -2), #la q designemos
    (call_script, "script_change_player_honor", 3),
  (display_message, "@Bandits run away when you are near!"),
          (change_screen_return),
        ]
       ),
      ("choice_19_2",[],"Aid the bandits to slaughter those sheeplike christians and bathe in their blood.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 1), #la q designemos
    (call_script, "script_change_player_honor", -5),
  (display_message, "@You kill the priest while claiming the name of Woden!"),
	(change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_20",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You happen to find a purse filled with coins.",
    "none",
    [

	],
    [
      ("choice_20_1",[],"You gift the purse to a hospice for abandoned children.",
       [
    (call_script, "script_change_player_honor", 5),
          (change_screen_return),
        ]
       ),
      ("choice_20_2",[],"You keep the purse for yourself.",
       [
    (call_script, "script_troop_add_gold", "trp_player", 100),
	(change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_21",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You come across some runaway slaves.",
    "none",
    [

	],
    [
      ("choice_21_1",[],"Help them on their way.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -2),
          (change_screen_return),
        ]
       ),
      ("choice_21_2",[],"Return them to their master.",
       [
		(call_script, "script_change_troop_renown", "trp_player", 1),
    (call_script, "script_troop_add_gold", "trp_player", 30),
	(change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_22",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You come upon Bandits Ambushing some Merchants.",
    "none",
    [

	],
    [
      ("choice_22_1",[],"Chase the Bandits away.",
       [
    (call_script, "script_troop_add_gold", "trp_player", 40),
    (call_script, "script_change_player_honor", 1),
  (display_message, "@Merchants give you some money!"),
          (change_screen_return),
        ]
       ),
      ("choice_22_2",[],"Aid the Bandits.",
       [
    (call_script, "script_change_player_honor", -3),
    (call_script, "script_troop_add_gold", "trp_player", 70),
	(change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_23",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your fame and popularity has attracted young noblemen to your cause.",
    "none",
    [

	],
    [
      ("choice_23_1",[],"Accept them.",
       [
                  (party_add_members, "p_main_party", "trp_mercenary_horseman", 4),
	    (change_screen_return),
        ]
       ),
      ("choice_23_2",[],"I don't need more men.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_24",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You spot a poor man on the road, he looks tired. You send one of your men to ask him why he is in the wilderness alone. He says that men robbed him and of he doesnt get some money soon to buy food, he will starve. He says he served in the army once, and will make a loyal warrior.",
    "none",
    [

	],
    [
      ("choice_24_1",[],"Lifes not fair, give him nothing.",
       [
    (call_script, "script_change_player_honor", 6),
  (display_message, "@ The man's eyes sadly watch you while you follow your path."),
	    (change_screen_return),
        ]
       ),
      ("choice_24_2",[],"Give him money only to eat a very small meal, at least he will live.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_24_3",[],"Give him a ton! Every one deserves to eat.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 400),
		(troop_remove_gold, "trp_player", 400),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -8),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_24_4",[],"Give him money and a horse, to ride home.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 600),
		(troop_remove_gold, "trp_player", 600),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 10),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_24_5",[],"Pay him and suggest he join your army, he looks able after all.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 800),
		(troop_remove_gold, "trp_player", 800),
                (display_message, "@ When you give him armor and food, he draws a distinction in the size of a mighty warrior."),
                  (party_add_members, "p_main_party", "trp_mountain_bandit_hero", 1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -8),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_25",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You encounter a small child dressed in rags and looking very hungry. He walks up to you and begs for some food; his family's crops produced no yields and they have no money.",
    "none",
    [

	],
    [
      ("choice_25_1",[],"Lifes not fair, give him nothing.",
       [
    (call_script, "script_change_player_honor", 6),
  (display_message, "@ The child's eyes sadly watch you while you follow your path."),
	    (change_screen_return),
        ]
       ),
      ("choice_25_2",[],"Give the boy a handful of gold.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_25_3",[],"Give the boy a sack of gold.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 400),
		(troop_remove_gold, "trp_player", 400),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -8),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_26",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A group of bandits approaches your camp. As your men reach for their arms, the bandits put down their weapons and say they come in peace. The leader of the bandits approaches you and asks if they may join you.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_guerreros"),
	],
    [
      ("choice_26_1",[],"Of course! My party always welcomes bloodthirsty men!.",
       [
            (call_script, "script_change_player_party_morale", -5),
		  (call_script, "script_change_player_honor", -10),
                  (party_add_members, "p_main_party", "trp_mountain_bandit", 8),
                (display_message, "@ New troops join your party."),
	    (change_screen_return),
        ]
       ),
      ("choice_26_2",[],"I'm sorry, we have no room for your kind!.",
       [
                (display_message, "@ Bandits flee away."),
	   (change_screen_return),
        ]
       ),
      ("choice_26_3",[],"Prove yourselves worthy by raiding a village and bringing me the chiefs head!",
       [
    (call_script, "script_troop_add_gold", "trp_player", 200),
    (call_script, "script_change_player_honor", -30),
		(call_script, "script_change_troop_renown", "trp_player", -8),
                  (party_add_members, "p_main_party", "trp_mountain_bandit", 8),
                (display_message, "@ After tow hours the bandits return with some loot and the chiefs head..."),
	   (change_screen_return),
        ]
       ),
      ("choice_26_4",[],"Kill them all!",
       [
    (call_script, "script_troop_add_gold", "trp_player", 50),
    (call_script, "script_change_player_honor", 1),
                (display_message, "@ Your men kill all the bandits."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

            (
    "event_27",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A religous fanatic (christianity cult) follow your army. While he gains some converts he also creates some unrest.",
    "none",
    [

	],
    [
      ("choice_27_1",[],"Thank to God. Let him be!.",
       [
       (display_message, "@ You are now a christian."),
        (assign, "$g_sod_faith", 4),
           (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -5), #la q designemos
	    (change_screen_return),
        ]
       ),
      ("choice_27_2",[],"Offer him a place in your troops!.",
       [
                (display_message, "@ He join you."),
                  (party_add_members, "p_main_party", "trp_picto_sacerdote", 1),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -5), #la q designemos
	   (change_screen_return),
        ]
       ),
      ("choice_27_3",[],"Rat! Suppress him!",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -10), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 10), #la q designemos
    (call_script, "script_change_player_honor", -10),
            (call_script, "script_change_player_party_morale", -2),
                (display_message, "@ The man insists too much, and then you leave his body by the roadside."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_28",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A religous fanatic (pagan cult) follow your army. While he gains some converts he also creates some unrest.",
    "none",
    [

	],
    [
      ("choice_28_1",[],"Thank to Woden. Let him be!.",
       [
       (display_message, "@ You are now a pagan (germanic gods)."),
       (assign, "$g_sod_faith", 3),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 5), #la q designemos
	    (change_screen_return),
        ]
       ),
      ("choice_28_2",[],"Offer him a place in your troops!.",
       [
                (display_message, "@ He join you."),
                  (party_add_members, "p_main_party", "trp_anglo_pagano", 1),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 5), #la q designemos
	   (change_screen_return),
        ]
       ),
      ("choice_28_3",[],"Rat! Suppress him!",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 10), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -10), #la q designemos
    (call_script, "script_change_player_honor", -10),
            (call_script, "script_change_player_party_morale", -2),
                (display_message, "@ The man insists too much, and then you leave his body by the roadside."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_29",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You come upon a Pagan Temple. The priest are busy working or praying, none of them is armed. You see gold treasures and silver tributes glistening inside...",
    "none",
    [

	],
    [
      ("choice_29_1",[],"Pass by the temple!.",
       [
    (call_script, "script_change_player_honor", -2),
	    (change_screen_return),
        ]
       ),
      ("choice_29_2",[],"Go inside, pray and pay a tribute. (200 schillingas).",
       [
                (display_message, "@ The priest bless you and you continue your way ."),
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(troop_remove_gold, "trp_player", 200),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_29_3",[],"Loot the temple, slaughter all priests and burn the place!",
       [
           	(call_script, "script_change_player_honor", -30),
		(call_script, "script_change_troop_renown", "trp_player", 15),
            (call_script, "script_change_player_party_morale", -5),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -10), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -10), #la q designemos
    (call_script, "script_troop_add_gold", "trp_player", 500),
                (display_message, "@ Blood and death everywhere. The priest do not resist and you take possession of their gold."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_30",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You come upon a Christian Monastery. The monks are busy working or praying, none of them is armed. You see gold treasures and silver tributes glistening inside...",
    "none",
    [

	],
    [
      ("choice_30_1",[],"Pass by the monastery!.",
       [
    (call_script, "script_change_player_honor", -2),
	    (change_screen_return),
        ]
       ),
      ("choice_30_2",[],"Go inside, pray and pay a tribute. (200 schillingas).",
       [
                (display_message, "@ The monks bless you and you continue your way ."),
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(troop_remove_gold, "trp_player", 200),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 5),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -2), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_30_3",[],"Loot the church, slaughter all priests and burn the place!",
       [
           	(call_script, "script_change_player_honor", -30),
		(call_script, "script_change_troop_renown", "trp_player", 15),
            (call_script, "script_change_player_party_morale", -5),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -7), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -7), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 3), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -7), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 5), #la q designemos
    (call_script, "script_troop_add_gold", "trp_player", 500),
                (display_message, "@ With unusual fury, your pagan warriors plundered the monastery and kill all the monks. Blood covers the ground, and greed shining in the eyes of the fiercest men."),
                (display_message, "@ Blood and death everywhere. The monks do not resist and you take possession of their gold. Your Christian followers do not seem very happy."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_31",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Some of your enemies have taken refuge in a nearby church after being defeated in battle and the rural priest have given them SANCTUARY.",
    "none",
    [

	],
    [
      ("choice_31_1",[],"Bah! They can go to the devil for all you care! You have enough prisoners and loot to satisfy yourself!.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -2),
	    (change_screen_return),
        ]
       ),
      ("choice_31_2",[],"Offer a pledge of safety to your enemies. Assure them you will treat them well. Offer a donation to the church fathers.",
       [
                (display_message, "@ The priest bless you and you continue your way ."),

            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 2),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_31_3",[],"What? Go inside and slaughter them and kill any priest who interferes. You cannot allow these dogs to escape your justice!",
       [
           	(call_script, "script_change_player_honor", -20),
		(call_script, "script_change_troop_renown", "trp_player", 10),
            (call_script, "script_change_player_party_morale", -3),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 5), #la q designemos
    (call_script, "script_troop_add_gold", "trp_player", 200),
                (display_message, "@ With unusual fury, your pagan warriors plundered the church and kill all the priest and your enemies. Blood covers the ground, and greed shining in the eyes of the fiercest men."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_32",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You come across the grave of an old forgotten warlord.",
    "none",
    [

	],
    [
      ("choice_32_1",[],"Loot and pillage!.",
       [
           	(call_script, "script_change_player_honor", -50),
		(call_script, "script_change_troop_renown", "trp_player", -50),
            (call_script, "script_change_player_party_morale", -20),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -5), #la q designemos
    (call_script, "script_troop_add_gold", "trp_player", 100),
            (troop_add_item, "trp_player","itm_arming_sword",0),
            (troop_add_item, "trp_player","itm_lorika",0),
                (display_message, "@ Among the remains of the corpse are the sword and armor of a king. Magnificent weapons to take away the iron oxide to discover a high quality. Now they are yours if you do not mind the bad luck that belonged to a dead."),
	    (change_screen_return),
        ]
       ),
      ("choice_32_2",[],"Pay for a new gravemarker",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 10),
                (display_message, "@ Someday, perhaps, you might have the honor of being buried like a king."),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_32_3",[],"Tend to the grave and pay your respects",
       [
           	(call_script, "script_change_player_honor", 3),
                (display_message, "@ Someday, perhaps, you might have the honor of being buried like a king."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_33",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "In the local tavern you come across a young monk who claims his master is chronicling the great and notable events of this land.\
He offers for a small fee to to convince his master to overlook your notoriety for incessant raping pillaging and general debauchery and instead depict you as a something closer to a virtuous saint  or a crusader for the poor and oppressed or a heroic champion - whichever you prefer.",
    "none",
    [

	],
    [
      ("choice_33_1",[],"You decide to ignore him muttering that you are content to let history be the judge.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -5),
	    (change_screen_return),
        ]
       ),
      ("choice_33_2",[],"You pay the young monk what he asks for and mention that you will be back in due course to inspect the manuscript.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(troop_remove_gold, "trp_player", 300),
                (display_message, "@ Fame is important."),
		(call_script, "script_change_troop_renown", "trp_player", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -2),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_33_3",[],"You gladly pay the monk his fee and then a little more for his troubles.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@ Fame is important."),
		(call_script, "script_change_troop_renown", "trp_player", 8),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -3),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_33_4",[],"After listening impatiently to the monk, you scold the monk remarking that you have never heard of a more pathetic scam in your life.",
       [
           	(call_script, "script_change_player_honor", -3),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_34",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You pass through a local town which appears down on its luck.\
To give the town a boost you announce that you will sponsor a sewing and embroidery contest for the gentle ladyfolk of the town and will reward handsomely the one who can produce the brightest, most fashionable yet suitably manly new tunic.",
    "none",
    [

	],
    [
      ("choice_34_1",[],"Reward the town well for their efforts and declare the prettiest girl in town to be the winner instructing her where is your tent.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@ Tunic isn't important, girl yes."),
		(call_script, "script_change_troop_renown", "trp_player", 5),
            (troop_add_item, "trp_player","itm_bl_tunicsr02",0),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_34_2",[],"You cast your eyes disappointingly, scold the village elder for not treating the matter seriously declaring that these rags are not fit for dishcloths , you storm out of the town.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -5),
	   (change_screen_return),
        ]
       ),
      ("choice_34_3",[],"You collect various coloured tunics brought to you and amusingly think to yourself these would be good to cloth your hounds in winter or for some type of hound race derby, you compliment the village elder.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@ Fame is important."),
		(call_script, "script_change_troop_renown", "trp_player", 5),
            (troop_add_item, "trp_player","itm_redtunic",0),
            (troop_add_item, "trp_player","itm_romantunic_purple",0),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -3),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),
#problema de espacio
 (
    "event_35",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "While reviewing the latest reconnaissance reports with your lieutenants, you whimsically remark that passing through the beautiful countryside makes you wish you could one day cast aside your sword settle down on your own land with some local buxom wench and spend the rest of your days making babies and growing stuff...\
To which one of the more smart alec lieutenants retorts that this was hardly likely as your body odour was legendary forcing them to pay double to each lady of the night you took a fancy to and it well known that you thought that food  was made by shops and grew in boxes and urns.",
    "none",
    [

	],
    [
      ("choice_35_1",[],"Laugh heartily with his witty comment, while secretly making a mental note that you must send him deep into enemy territory on an 'important mission'.",
       [
           	(call_script, "script_change_player_honor", -5),
            (call_script, "script_change_player_party_morale", 5),
	    (change_screen_return),
        ]
       ),
      ("choice_35_2",[],"You glare at your young lieutenant and your mood suddenly turns for the worse but later on reflection you realise that he was probably right.",
       [
            (call_script, "script_change_player_party_morale", 5),
	   (change_screen_return),
        ]
       ),
      ("choice_35_3",[],"You manage to force a smile while your comrades laughter surrounds you and when no one was looking, you give the secret wink to your bodyguard. This means that the young comedian's head will be impaled.",
       [
           	(call_script, "script_change_player_honor", -5),
            (call_script, "script_change_player_party_morale", -2),
		(call_script, "script_change_troop_renown", "trp_player", 5),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_36",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You come across what are evidently stray cattle from a Nearby village",
    "none",
    [

	],
    [
      ("choice_36_1",[],"Return the animals to the village and ask for no reward.",
       [
           	(call_script, "script_change_player_honor", 5),
 		(call_script, "script_change_troop_renown", "trp_player", 10),
                (display_message, "@ Animals really valuable to village survival."),
	    (change_screen_return),
        ]
       ),
      ("choice_36_2",[],"Return the Animals. . . for a price.",
       [
 		(call_script, "script_change_troop_renown", "trp_player", 10),
                (call_script, "script_troop_add_gold", "trp_player", 250),
                (display_message, "@ You did return the animals after all."),
	   (change_screen_return),
        ]
       ),
      ("choice_36_3",[],"Dinner!! Round up and slaughter the animals.",
       [
           	(call_script, "script_change_player_honor", -3),
            (call_script, "script_change_player_party_morale", 10),
                (display_message, "@ Anymore was devoured on the spot."),
            (troop_add_item, "trp_player","itm_cattle_meat",0),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_37",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A traveler tells you where to find a band of ANGLE settlers recently arrived in Britannia.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_barco"),
	],
    [
      ("choice_37_1",[],"You attack the small caravan, easily slaughtering the hapless immigrants from an ambush, leaving few survivors.",
       [
           	(call_script, "script_change_player_honor", -15),
 		(call_script, "script_change_troop_renown", "trp_player", 2),
            (call_script, "script_change_player_party_morale", 5),
                (call_script, "script_troop_add_gold", "trp_player", 450),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", -8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -8), #la q designemos
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_14", -8), #la q designemos
                (display_message, "@ With the blood of the sword falling to the elbow, you will welcome the easy victory."),
	    (change_screen_return),
        ]
       ),
      ("choice_37_2",[],"Demand tribute for crossing YOUR land, they pay and go on their way poorer than before.",
       [
           	(call_script, "script_change_player_honor", -2),
                (call_script, "script_troop_add_gold", "trp_player", 100),
	   (change_screen_return),
        ]
       ),
      ("choice_37_3",[],"Disperse the band and claim all their possessions as your own, leaving them only their lives.",
       [
           	(call_script, "script_change_player_honor", -8),
            (call_script, "script_change_player_party_morale", 2),
                (call_script, "script_troop_add_gold", "trp_player", 250),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -4), #la q designemos
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_14", -4), #la q designemos
                (display_message, "@ Your soldiers get a kick out of harassing helpless peasants."),
            (troop_add_item, "trp_player","itm_pork",0),
	   (change_screen_return),
        ]
       ),
      ("choice_37_4",[],"Help them on their way, giving them food and gold. They depart praising your name.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(troop_remove_gold, "trp_player", 200),
                (display_message, "@ Honour and fame are important."),
		(call_script, "script_change_troop_renown", "trp_player", 3),
           	(call_script, "script_change_player_honor", 3),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_4", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 1), #la q designemos
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_14", 1), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -6),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_37_5",[],"Ignore them, and they go on their way ignorant of the danger that could have befallen them.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_38",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A traveler tells you where to find a band of SAXON settlers recently arrived in Britannia.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_barco"),
	],
    [
      ("choice_38_1",[],"You attack the small caravan, easily slaughtering the hapless immigrants from an ambush, leaving few survivors.",
       [
           	(call_script, "script_change_player_honor", -15),
 		(call_script, "script_change_troop_renown", "trp_player", 2),
            (call_script, "script_change_player_party_morale", 5),
                (call_script, "script_troop_add_gold", "trp_player", 450),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_2", -8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_3", -8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_5", -8), #la q designemos
                (display_message, "@ With the blood of the sword falling to the elbow, you will welcome the easy victory."),
	    (change_screen_return),
        ]
       ),
      ("choice_38_2",[],"Demand tribute for crossing YOUR land, they pay and go on their way poorer than before.",
       [
           	(call_script, "script_change_player_honor", -2),
                (call_script, "script_troop_add_gold", "trp_player", 100),
	   (change_screen_return),
        ]
       ),
      ("choice_38_3",[],"Disperse the band and claim all their possessions as your own, leaving them only their lives.",
       [
           	(call_script, "script_change_player_honor", -8),
            (call_script, "script_change_player_party_morale", 2),
                (call_script, "script_troop_add_gold", "trp_player", 250),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_2", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_3", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_5", -4), #la q designemos
                (display_message, "@ Your soldiers get a kick out of harassing helpless peasants."),
            (troop_add_item, "trp_player","itm_pork",0),
	   (change_screen_return),
        ]
       ),
      ("choice_38_4",[],"Help them on their way, giving them food and gold. They depart praising your name.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(troop_remove_gold, "trp_player", 200),
                (display_message, "@ Honour and fame are important."),
		(call_script, "script_change_troop_renown", "trp_player", 3),
           	(call_script, "script_change_player_honor", 3),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_2", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_3", 1), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_5", 1), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -6),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_38_5",[],"Ignore them, and they go on their way ignorant of the danger that could have befallen them.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_39",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A traveler tells you where to find a band of JUTE settlers recently arrived in Britannia.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_barco"),
	],
    [
      ("choice_39_1",[],"You attack the small caravan, easily slaughtering the hapless immigrants from an ambush, leaving few survivors.",
       [
           	(call_script, "script_change_player_honor", -15),
 		(call_script, "script_change_troop_renown", "trp_player", 2),
            (call_script, "script_change_player_party_morale", 5),
                (call_script, "script_troop_add_gold", "trp_player", 450),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -20), #la q designemos
                (display_message, "@ With the blood of the sword falling to the elbow, you will welcome the easy victory."),
	    (change_screen_return),
        ]
       ),
      ("choice_39_2",[],"Demand tribute for crossing YOUR land, they pay and go on their way poorer than before.",
       [
           	(call_script, "script_change_player_honor", -2),
                (call_script, "script_troop_add_gold", "trp_player", 100),
	   (change_screen_return),
        ]
       ),
      ("choice_39_3",[],"Disperse the band and claim all their possessions as your own, leaving them only their lives.",
       [
           	(call_script, "script_change_player_honor", -8),
            (call_script, "script_change_player_party_morale", 2),
                (call_script, "script_troop_add_gold", "trp_player", 250),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -13), #la q designemos
                (display_message, "@ Your soldiers get a kick out of harassing helpless peasants."),
            (troop_add_item, "trp_player","itm_pork",0),
	   (change_screen_return),
        ]
       ),
      ("choice_39_4",[],"Help them on their way, giving them food and gold. They depart praising your name.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 200),
		(troop_remove_gold, "trp_player", 200),
                (display_message, "@ Honour and fame are important."),
		(call_script, "script_change_troop_renown", "trp_player", 3),
           	(call_script, "script_change_player_honor", 3),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 5), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -6),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_39_5",[],"Ignore them, and they go on their way ignorant of the danger that could have befallen them.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_40",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your soldiers rapes the daughter of a local elder.",
    "none",
    [

	],
    [
      ("choice_40_1",[],"Ignore the situation.",
       [
           	(call_script, "script_change_player_honor", -15),
	    (change_screen_return),
        ]
       ),
      ("choice_40_2",[],"Punish the soldier.",
       [
           	(call_script, "script_change_player_honor", 3),
		(call_script, "script_change_troop_renown", "trp_player", 3),
            (call_script, "script_change_player_party_morale", -5),
	   (change_screen_return),
        ]
       ),
      ("choice_40_3",[],"Execute the soldier and apologize for the incident.",
       [
           	(call_script, "script_change_player_honor", 6),
            (call_script, "script_change_player_party_morale", -10),
       (call_script, "script_change_player_relation_with_faction", "fac_innocents", 5), #la q designemos
       (call_script, "script_change_player_relation_with_faction", "fac_commoners", 5), #la q designemos
       (call_script, "script_change_player_relation_with_faction", "fac_merchants", 5), #la q designemos
	   (change_screen_return),
        ]
       ),
      ("choice_40_4",[],"Pay wergild (compensation) to local elder.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 250),
		(troop_remove_gold, "trp_player", 250),
                (display_message, "@ The girl is pregnant and the elder asks for a high compensation. To avoid rumors and problems, you pay."),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -10),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_41",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your soldiers succumbs to his wounds from a previous battle.",
    "none",
    [

	],
    [
      ("choice_41_1",[],"Take his kit and his gold, he was afterall just a soldier, a mere pawn, and all he owns belongs to you.",
       [
            (call_script, "script_change_player_party_morale", -5),
           	(call_script, "script_change_player_honor", -10),
                (call_script, "script_troop_add_gold", "trp_player", 150),
                (display_message, "@ you get their meager belongings."),
            (troop_add_item, "trp_player","itm_spear_1",0),
	    (change_screen_return),
        ]
       ),
      ("choice_41_2",[],"Give the soldier's belongings to his family.",
       [
           	(call_script, "script_change_player_honor", 4),
            (call_script, "script_change_player_party_morale", 4),
	   (change_screen_return),
        ]
       ),
      ("choice_41_3",[],"Give the soldier's belongings to his family and hold a funeral in his name.",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 250),
		(troop_remove_gold, "trp_player", 250),
                (display_message, "@ Celebrating a funeral at your expense."),
           	(call_script, "script_change_player_honor", 8),
            (call_script, "script_change_player_party_morale", 8),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -10),
            (call_script, "script_change_player_party_morale", -10),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_42",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your new recruits dies from an illness. He carries both Woden's simbol and a cross. No one knows what he preferred most.",
    "none",
    [

	],
    [
      ("choice_42_1",[],"Do you put his sword in his hand and burn him? (PAGAN)",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 50),
		(troop_remove_gold, "trp_player", 50),
                (display_message, "@ Celebrating a funeral at your expense."),
           	(call_script, "script_change_player_honor", 1),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 5), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_party_morale", -15),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_42_2",[],"Bury him and pray to God he reaches heaven?, (CHRISTIAN)",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 50),
		(troop_remove_gold, "trp_player", 50),
                (display_message, "@ Celebrating a funeral at your expense."),
           	(call_script, "script_change_player_honor", 1),
       (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", -5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 5), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -5), #la q designemos
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_party_morale", -15),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_42_3",[],"Just leave him lying there in fear of doing it wrong?.",
       [
           	(call_script, "script_change_player_honor", -15),
            (call_script, "script_change_player_party_morale", -15),
	   (change_screen_return),
        ]
       ),
      ]
  ),

## (
##    "event_43",menu_text_color(0xFF000000)|mnf_disable_all_keys,
##    "Your Wife desires to reconcile with her estranged Father.",
##    "none",
##    [
##
##	],
##    [
##      ("choice_43_1",[],"Accede to her wishes and beg forgiveness of her father. (She need money for travel)",
##       [
##            (store_troop_gold, ":gold", "trp_player"),
##	   (try_begin),
##		(ge, ":gold", 100),
##		(troop_remove_gold, "trp_player", 100),
##                (display_message, "@ Your wife seem happy."),
##           	(call_script, "script_change_player_honor", 1),
##		(else_try),
##		(display_message, "@You don't have enough gold. How embarassing!"),
##           	(call_script, "script_change_player_honor", -5),
##		(try_end),
##	   (change_screen_return),
##        ]
##       ),
##      ("choice_43_2",[],"Ignore her wish and forbid her to speak of it again",
##       [
##           	(call_script, "script_change_player_honor", -1),
##	   (change_screen_return),
##        ]
##       ),
##      ("choice_43_3",[],"Decide to go along with her whim, dragging your feet and conceding very little (He didn't like ME after all!).",
##       [
##            (store_troop_gold, ":gold", "trp_player"),
##	   (try_begin),
##		(ge, ":gold", 200),
##		(troop_remove_gold, "trp_player", 200),
##                (display_message, "@ Your wife seem happy."),
##           	(call_script, "script_change_player_honor", 3),
##		(else_try),
##		(display_message, "@You don't have enough gold. How embarassing!"),
##           	(call_script, "script_change_player_honor", -5),
##		(try_end),
##	   (change_screen_return),
##        ]
##       ),
##      ]
##  ),
## (
##    "event_44",menu_text_color(0xFF000000)|mnf_disable_all_keys,
##    "A sworn man of your spouse's father comes up to you and demands that you return his daughter or face the consequences.",
##    "none",
##    [
##
##	],
##    [
##      ("choice_44_1",[],"You propose to settle the threats man to man, to the death.",
##       [
##           	(call_script, "script_change_player_honor", 5),
##		(call_script, "script_change_troop_renown", "trp_player", 3),
##                (display_message, "@ The man nearly begs for forgiveness. Which you give to him."),
##	   (change_screen_return),
##        ]
##       ),
##      ("choice_44_2",[],"You ask what the consequences will be, and the sworn man, sensing your fear, arrogantly states 'Face Me in mortal combat or pay milord 500 gold and be known throughout the land as a weakling,' You give in to his demands and pay him the money.",
##       [
##           	(call_script, "script_change_player_honor", -1),
##	   (change_screen_return),
##        ]
##       ),
##      ("choice_44_3",[],"Decide to go along with her whim, dragging your feet and conceding very little (He didn't like ME after all!).",
##       [
##            (store_troop_gold, ":gold", "trp_player"),
##	   (try_begin),
##		(ge, ":gold", 200),
##		(troop_remove_gold, "trp_player", 200),
##                (display_message, "@ Your wife seem happy."),
##           	(call_script, "script_change_player_honor", 3),
##		(else_try),
##		(display_message, "@You don't have enough gold. How embarassing!"),
##           	(call_script, "script_change_player_honor", -5),
##		(try_end),
##	   (change_screen_return),
##        ]
##       ),
##      ]
##  ),

#random events chief Sot acaba
####siege warfare random event chief

#si no tiene hecho letrinas y saneamiento
    (
    "event_siege_01",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your advisers tells you that he has found rats in the provisions that your men are eating.",
    "none",
    [

	],
    [
      ("choice_01_1a",[],"That is terrible! Destroy contaminated supplies.",
       [
    (try_begin),
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
      (try_end),
      (try_begin),
        (ge, ":number_of_foods_player_has", 6),
        (unlock_achievement, ACHIEVEMENT_ABUNDANT_FEAST),
      (try_end),
    (try_end),
    (assign, ":consumption_amount", 10),
    (assign, ":no_food_displayed", 0),
    (try_for_range, ":unused", 0, ":consumption_amount"),
      (assign, ":available_food", 0),
      (try_for_range, ":cur_food", food_begin, food_end),
        (item_set_slot, ":cur_food", slot_item_is_checked, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_food", imod_rotten),
        (val_add, ":available_food", 1),
      (try_end),
      (try_begin),
        (gt, ":available_food", 0),
        (store_random_in_range, ":selected_food", 0, ":available_food"),
        (call_script, "script_consume_food", ":selected_food"),
	   (call_script, "script_change_player_party_morale", -2),
	   (display_message, "@Part of your food was destroyed.", 0xFF0000),
      (else_try),
        (eq, ":no_food_displayed", 0),
        (display_message, "@Your men have nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -8),
        (assign, ":no_food_displayed", 1),
        (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
#NPC companion changes end
      (try_end),
    (try_end),
          (change_screen_return),
        ]
       ),
      ("choice_01_2a",[],"I can not leave my men without food. Kill as many rats as you can.",
       [
       (jump_to_menu,"mnu_ratas_siege"),
        ]
       ),
      ]
  ),

###matar ratas submenu
      ("ratas_siege",0,
    "Before all the rats are exterminated, many of your men are sick and dying. ^^Your casualties:{s8}",
    "none", [

          (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
              ],

        [("back_to_siegea",[],"Done.",
       [
        (call_script, "script_change_player_party_morale", -6),
          (change_screen_return),
        ]),
   ],
  ),
#matar ratas acaba
#bajas enfermedad
        ("enfermedad_siege",0,
    "You don't have enough gold. How embarrassing! Death governs your camp. Many of your men are sick and dying. ^^Your casualties:{s8}",
    "none", [

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 10),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
              ],

        [("back_to_siegeb",[],"Done.",
       [
        (call_script, "script_change_player_party_morale", -6),
		(call_script, "script_change_troop_renown", "trp_player", -15),
          (change_screen_return),
        ]),
   ],
  ),
        ("enfermedad2_siege",0,
    "Death governs your camp. Many of your men are sick and dying. ^^Your casualties:{s8}",
    "none", [

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 10),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
              ],

        [("back_to_siegec",[],"Done.",
       [
        (call_script, "script_change_player_party_morale", -6),
		(call_script, "script_change_troop_renown", "trp_player", -15),
          (change_screen_return),
        ]),
   ],
  ),
        ("enfermedad3_siege",0,
    "Death governs your camp. Many of your men are sick and dying. But perhaps your god has saved some lives. ^^Your casualties:{s8}",
    "none", [

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
              ],

        [("back_to_sieged",[],"Done.",
       [
        (call_script, "script_change_player_party_morale", -6),
		(call_script, "script_change_troop_renown", "trp_player", -15),
          (change_screen_return),
        ]),
   ],
  ),
        ("enfermedad4_siege",0,
    "Thanks to the healing abilities you manage to save many men. But some die^^Your casualties:{s8}",
    "none", [

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
              ],

        [("back_to_siegee",[],"Done.",
       [
        (call_script, "script_change_player_party_morale", -3),
          (change_screen_return),
        ]),
   ],
  ),
###bajas enfermedad acaba
  (
    "event_siege_02",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Poor hygiene in your camp causes dysentery. The men start dying all around you.",
    "none",
    [

	],
    [
      ("choice_02_1b",[],"Pay the high price of a physician to try to help your people from contracting disease (1000 scillingas).",
       [
          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 1000),
		(call_script, "script_change_player_honor", 1),
		(call_script, "script_change_troop_renown", "trp_player", 1),
		(troop_remove_gold, "trp_player", 1000),
		(change_screen_return),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
       (jump_to_menu,"mnu_enfermedad_siege"),
		(try_end),
        ]
       ),
      ("choice_02_2b",[],"There is nothing I can do.",
       [
       (jump_to_menu,"mnu_enfermedad2_siege"),
        ]
       ),
      ("choice_02_3b",[],"Pray to your god.",
       [
       (jump_to_menu,"mnu_enfermedad3_siege"),
        ]
       ),
      ("choice_02_4b",[
		(party_get_skill_level, ":heal", "p_main_party", skl_wound_treatment),
		(ge, ":heal", 5),
          ],"I or my companions can cure them.",
       [
       (jump_to_menu,"mnu_enfermedad4_siege"),
        ]
       ),
      ]
  ),

   (
    "event_siege_03",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The plague has spread across your camp because of rats. Men die before your eyes (1000 scillingas).",
    "none",
    [

	],
    [
      ("choice_03_1c",[],"Pay the high price of a physician to try to help your people from contracting disease.",
       [
          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 1000),
		(call_script, "script_change_player_honor", 1),
		(call_script, "script_change_troop_renown", "trp_player", 1),
		(troop_remove_gold, "trp_player", 1000),
		(change_screen_return),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
       (jump_to_menu,"mnu_enfermedad_siege"),
		(try_end),
        ]
       ),
      ("choice_03_2c",[],"Oh. I can do nothing.",
       [
       (jump_to_menu,"mnu_enfermedad2_siege"),
        ]
       ),
      ("choice_03_3c",[],"Pray to your god.",
       [
       (jump_to_menu,"mnu_enfermedad3_siege"),
        ]
       ),
      ("choice_03_4c",[
		(party_get_skill_level, ":heal", "p_main_party", skl_wound_treatment),
		(ge, ":heal", 5),
          ],"I or my companions can cure them.",
       [
       (jump_to_menu,"mnu_enfermedad4_siege"),
        ]
       ),
      ]
  ),

###acaba enfermedades chief

#eventos incursion, infiltracion y emboscadas
  (
    "event_siege_04",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Some enemies have managed to infiltrate at night and burn some of your supplies. Part of your food was destroyed.",
    "none",
    [
    (try_begin),
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
      (try_end),
      (try_begin),
        (ge, ":number_of_foods_player_has", 6),
        (unlock_achievement, ACHIEVEMENT_ABUNDANT_FEAST),
      (try_end),
    (try_end),
    (assign, ":consumption_amount", 10),
    (assign, ":no_food_displayed", 0),
    (try_for_range, ":unused", 0, ":consumption_amount"),
      (assign, ":available_food", 0),
      (try_for_range, ":cur_food", food_begin, food_end),
        (item_set_slot, ":cur_food", slot_item_is_checked, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_food", imod_rotten),
        (val_add, ":available_food", 1),
      (try_end),
      (try_begin),
        (gt, ":available_food", 0),
        (store_random_in_range, ":selected_food", 0, ":available_food"),
        (call_script, "script_consume_food", ":selected_food"),
	   (call_script, "script_change_player_party_morale", -2),
	   (display_message, "@Part of your food was destroyed.", 0xFF0000),
      (else_try),
        (eq, ":no_food_displayed", 0),
        (display_message, "@Your men have nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -8),
        (assign, ":no_food_displayed", 1),
        (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
      (try_end),
    (try_end),
	],
    [
      ("choice_04_1d",[],"To set an example punish the men who were on duty that night.",
       [
        (call_script, "script_change_player_party_morale", -4),
                                (assign, "$g_enemigo_quema_comida", 1),
          (change_screen_return),
        ]
       ),
      ("choice_04_2d",[],"No do nothing!",
       [
		(change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_05",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "During the night, your men captured and executed a group of enemies who tried to infiltrate and burn supplies.",
    "none",
    [

	],
    [
      ("choice_05_1e",[],"Congratulate them for doing their job well.",
       [
          (change_screen_return),
        ]
       ),
      ("choice_05_2e",[],"Reward each one of them with a warrior bracelet (cost 300 scillingas).",
       [
	    (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(call_script, "script_change_troop_renown", "trp_player", 3),
                (call_script, "script_change_player_party_morale", 1),
		(troop_remove_gold, "trp_player", 300),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -3),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_05_3e",[],"Reward them with a night off and money to spend at the nearest brothel. 200 scillingas might help.",
       [
	    (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 200),
                (call_script, "script_change_player_party_morale", 2),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_player_honor", -3),
		(call_script, "script_change_troop_renown", "trp_player", -4),
		(try_end),
	   (change_screen_return),
        ]
       ),
	   ("choice_05_4e",[],"Do nothing. You are a firm leader, and will not show weakness.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -1),
	   (change_screen_return),
        ]
       ),
      ]
  ),


   (
    "event_siege_06",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Sir, our food supply routes may be in danger. Our scouts have discovered enemy raiders behind our lines.",
    "none",
    [
	],
    [
      ("choice_06_1f",[],"Send men to protect the routes and pursue the enemies (Note: you will lose troops from your main army).",
       [
       (jump_to_menu,"mnu_encuentro_avituallamiento"),
        ]
       ),
      ("choice_06_2f",[],"Send a messenger to pay the enemy raiders not to attack your supply routes for a few days (500 scillingas).",
       [
	 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
    (try_begin),
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
      (try_end),
      (try_begin),
        (ge, ":number_of_foods_player_has", 6),
        (unlock_achievement, ACHIEVEMENT_ABUNDANT_FEAST),
      (try_end),
    (try_end),
    (assign, ":consumption_amount", 10),
    (assign, ":no_food_displayed", 0),
    (try_for_range, ":unused", 0, ":consumption_amount"),
      (assign, ":available_food", 0),
      (try_for_range, ":cur_food", food_begin, food_end),
        (item_set_slot, ":cur_food", slot_item_is_checked, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_food", imod_rotten),
        (val_add, ":available_food", 1),
      (try_end),
      (try_begin),
        (gt, ":available_food", 0),
        (store_random_in_range, ":selected_food", 0, ":available_food"),
        (call_script, "script_consume_food", ":selected_food"),
	   (call_script, "script_change_player_party_morale", -2),
	   (display_message, "@Part of your food was destroyed.", 0xFF0000),
      (else_try),
        (eq, ":no_food_displayed", 0),
        (display_message, "@Your men have nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -8),
        (assign, ":no_food_displayed", 1),
        (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
      (try_end),
    (try_end),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_06_3f",[],"Do nothing (lose part of your food).",
       [
	   (call_script, "script_change_player_honor", -5),
    (try_begin),
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
      (try_end),
      (try_begin),
        (ge, ":number_of_foods_player_has", 6),
        (unlock_achievement, ACHIEVEMENT_ABUNDANT_FEAST),
      (try_end),
    (try_end),
    (assign, ":consumption_amount", 10),
    (assign, ":no_food_displayed", 0),
    (try_for_range, ":unused", 0, ":consumption_amount"),
      (assign, ":available_food", 0),
      (try_for_range, ":cur_food", food_begin, food_end),
        (item_set_slot, ":cur_food", slot_item_is_checked, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_food", imod_rotten),
        (val_add, ":available_food", 1),
      (try_end),
      (try_begin),
        (gt, ":available_food", 0),
        (store_random_in_range, ":selected_food", 0, ":available_food"),
        (call_script, "script_consume_food", ":selected_food"),
	   (call_script, "script_change_player_party_morale", -2),
	   (display_message, "@Part of your food was destroyed.", 0xFF0000),
      (else_try),
        (eq, ":no_food_displayed", 0),
        (display_message, "@Your men have nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -8),
        (assign, ":no_food_displayed", 1),
        (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
      (try_end),
    (try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

#submenu encuentro avituallamiento
        ("encuentro_avituallamiento",0,
    "Dispatch a group of men to protect and pursue the enemies that plague your supply routes. Your men attempt to corner the enemy to force him to fight until death. There are some losses, but your men manage to impose themselves and secure the supply routes. ^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none", [

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 40),
      (else_try),
        (assign, ":division_constant2", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 20),
      (else_try),
        (assign, ":division_constant", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
     #   (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),


              ],

        [("back_to_siegeg",[],"Well done.",
       [
          (change_screen_return),
        ]),
   ],
  ),
####encuentro avituallamiento acaba


   (
    "event_siege_07",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Our scouts have found that the defenders have poisoned the water with dead animals.",
    "none",
    [
	],
    [
      ("choice_07_1g",[],"Order: Buy water from the merchants. They can bring water through our supply route and we can promise protection (cost 600 scillingas).",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 600),
		(troop_remove_gold, "trp_player", 600),
          (change_screen_return),
		(else_try),
		(display_message, "@You don't have enough gold. You order water to be rationed and dig wells."),
		(call_script, "script_change_troop_renown", "trp_player", -10),
       (jump_to_menu,"mnu_sed_siege"),
		(try_end),
        ]
       ),
      ("choice_07_2g",[],"Ration water, order the digging of wells, and send out a scouting party to rivers in the area (you may lose some men before the well is ready).",
       [
       (jump_to_menu,"mnu_sed_siege"),
        ]
       ),
      ("choice_07_3g",[],"Without water the siege can not continue. Abandon the siege.",
       [
         (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
         (assign,"$g_player_besiege_town", -1),
		 (party_set_slot,"p_main_party",slot_party_siege_camp,0),  #Tempered chief added for siege camp
         #siege warfare chief
         (assign, "$g_empieza_asedio", 0),
         (assign, "$g_siege_circunvalation", 0),
         (assign, "$g_siege_saneamiento", 0),
         (assign, "$g_close_port", 0),
         (assign, "$g_traicion_interna", 0),
         (assign, "$g_infiltracion_interna", 0),
         (assign, "$g_campos_cercanos", 0),
         (assign, "$g_listos_para_asalto", 0),
         (assign, "$g_mantlets_1", 0),
         (assign, "$g_enemigo_quema_comida", 0),
         (assign, "$g_cabezas_dentro", 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado, 0),
       (party_set_slot,"$g_encountered_party",centro_bloqueado_puerto, 0),
         #siege warfare acaba
	   (change_screen_return),
        ]
       ),
      ]
  ),

###perdidas por sed mientras cavan pozos
        ("sed_siege",0,
    "Water is running out, and your men are weakened. Driven by the madness of thirst, some of them drink poisoned water and die. Finally, a well is completed and you get water for the time being. You can continue the siege.^^Your casualties by poisoned water:{s8}",
    "none", [

        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
              ],

        [("back_to_siegeh",[],"Done.",
       [
        (call_script, "script_change_player_party_morale", -5),
		(call_script, "script_change_troop_renown", "trp_player", -10),
          (change_screen_return),
        ]),
   ],
  ),
####sed acaba

(
    "event_siege_08",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Sir, bad news: One of our men has deserted to the enemy. It may be because of his low morale or because they have offered him money. Whatever it is, the enemy will know our plans.",
    "none",
    [
	],
    [
      ("choice_08_1h",[],"Scit! Offer 400 scillingas to the army to raise morale. I don't want more deserters.",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 400),
                (call_script, "script_change_player_party_morale", 4),
		(troop_remove_gold, "trp_player", 400),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
        (call_script, "script_change_player_party_morale", -3),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_08_2h",[],"Do not worry. I can always change plans.",
       [
		(change_screen_return),
        ]
       ),
      ]
  ),
    (
    "event_siege_09",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Lord, a deserter from the enemy has joined our ranks. He has informed us that {s2}.",
    "none",
    [
	(store_random_in_range, ":rand_no", 1, 10),
		(try_begin),
		(ge, ":rand_no", 8),
		(str_store_string , s2, "@ the enemy thinks reinforcements will soon arrive."),
		(else_try),
		(ge, ":rand_no", 5),
		(str_store_string , s2, "@ fear and discontent is spreading inside."),
		(else_try),
		(ge, ":rand_no", 3),
		(str_store_string , s2, "@ he likes the wife of his former master and he will fight by your side if you give her to him after the conquest."),
		(else_try),
		(ge, ":rand_no", 0),
		(str_store_string , s2, "@ the enemy's morale is low and we should attack."),
		(try_end),
	],
    [
      ("choice_09_1i",[],"He is welcome to our ranks.",
       [
                  (party_add_members, "p_main_party", "trp_watchman", 1),
        (call_script, "script_change_player_party_morale", -1),
                  (change_screen_return),
        ]
       ),
      ("choice_09_2i",[],"I do not want deserters among my men. Kill him.",
       [
           	(call_script, "script_change_player_honor", -2),
	    (change_screen_return),
        ]
       ),
      ("choice_09_3i",[],"I'm sure he's a spy. Return him to the enemy.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_siege_10",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Sir, our men and the enemy do not insult each other as much anymore, and sometimes talk to each other. This can affect their fighting spirit when we attack. What shall we do?",
    "none",
    [

	],
    [
      ("choice_10_1j",[],"Allow it. The enemy's fighting spirit is also affected.",
       [
		  (call_script, "script_change_player_honor", 1),
        (call_script, "script_change_player_party_morale", -5),
                  (change_screen_return),
        ]
       ),
      ("choice_10_2j",[],"What? Forbid it and punish the offenders.",
       [
		  (call_script, "script_change_player_honor", -1),
        (call_script, "script_change_troop_renown", "trp_player", -8),
	    (change_screen_return),
        ]
       ),
      ]
  ),
###frio invierno bajas
        (
    "event_siege_11",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The cold winter always takes its toll when it comes. Some men have died of cold, flu and other minor illnesses.  ^^Your casualties:{s8}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 60),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 60),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
	],
    [
      ("choice_11_1j",[],"Requiescat in pace.",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),

          (
    "event_siege_12",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A farmer comes to you and says that one of your men have raped his daughter, who lives in a village near your siege camp. The farmer wishes payment wergild (compensation) of 50 scillingas. What do you do?",
    "none",
    [

	],
    [
      ("choice_12_1j",[],"Pay the Wergild.",
       [   (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 50),
		(troop_remove_gold, "trp_player", 50),
                (display_message, "@Wergild was paid."),
           	(call_script, "script_change_player_honor", 1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_12_2j",[],"Refuse to pay. You're in enemy territory, your men are entitled to do whatever they want.",
       [
           	(call_script, "script_change_player_honor", -5),
	    (change_screen_return),
        ]
       ),
      ("choice_12_3j",[],"Kill the farmer and his daughter. They are slaves of your enemy.",
       [
	   (call_script, "script_change_player_honor", -10),
	   (change_screen_return),
        ]
       ),
      ]
  ),

#escaramuza pequena
   (
    "event_siege_13",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A group of enemies attacked our men by surprise, and then quickly withdrew.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 40),
      (else_try),
        (assign, ":division_constant2", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 20),
      (else_try),
        (assign, ":division_constant", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_13_1b",[],"This is common. Be cautious. (If you build circunvallation the problem will stop immediately).",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_14",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "While foraging a group of enemy riders by surprise encountered a group of our men.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 40),
      (else_try),
        (assign, ":division_constant2", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 20),
      (else_try),
        (assign, ":division_constant", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_14_1b",[],"This is common. Be cautious. (If you build circunvallation the problem will stop immediately).",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_15",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "We have been attacked by an enemy force while raiding neighboring villages. The villagers have joined the enemy causing us many casualties.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 30),
      (else_try),
        (assign, ":division_constant2", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 18),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 18),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 16),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 16),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 14),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 14),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 12),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 12),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 10),
      (else_try),
        (assign, ":division_constant", 10),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_15_1b",[],"This is common. Be cautious. (If you build circunvallation the problem will stop immediately).",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_16",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The enemy and our men came upon each other near a river, and the struggle for water caused numerous casualties on both sides.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 30),
      (else_try),
        (assign, ":division_constant2", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 20),
      (else_try),
        (assign, ":division_constant", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_16_1b",[],"This is common. Be cautious. (If you build circunvallation the problem will stop immediately).",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_17",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The enemy has made a secret passage, attacking us swiftly before retreating back to the protection of their walls.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 30),
      (else_try),
        (assign, ":division_constant2", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 30),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 20),
      (else_try),
        (assign, ":division_constant", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_17_1b",[],"This is common. Be cautious. (If you build circunvallation the problem will stop immediately).",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_18",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Some of your men have abducted women from the surrounding villages, and brought them to the siege camp for fun.",
    "none",
    [

	],
    [
      ("choice_18_1b",[],"You accept it, and you ask the most beautiful woman.",
       [
		  (call_script, "script_change_player_honor", -10),
            (call_script, "script_change_player_party_morale", 2),
                  (party_add_members, "p_main_party", "trp_refugee", 6),
          (change_screen_return),
        ]
       ),
      ("choice_18_2b",[],"Order your men to release the women and punish them.",
       [
            (call_script, "script_change_player_party_morale", -6),
		  (call_script, "script_change_player_honor", 10),
	(change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_siege_19",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The enemy is trying to break our circunvallation, and our men try to contain them.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 20),
      (else_try),
        (assign, ":division_constant2", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 30),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 30),
      (else_try),
        (assign, ":division_constant", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 40),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_19_1b",[],"Quickly, I want to send a detachment of men to reinforce the wall, while I make a threat of assault, forcing them to withdraw.",
       [
          (store_random_in_range, ":rand", 0, 7),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_no_defendiendo"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_no_defendiendo"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
                                          (else_try),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
          (try_end),
        ]
       ),
      ("choice_19_2b",[],"Fast. Send all men to protect that part of the circunvallation.",
       [
          (store_random_in_range, ":rand", 0, 7),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_defendiendo_mal"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_defendiendo_mal"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_defendiendo_mal"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_defendiendo_mal"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
                                          (else_try),
       (jump_to_menu,"mnu_defendiendo_circunvallation"),
          (try_end),
        ]
       ),
      ("choice_19_3b",[],"Do not worry, our wall is strong.",
       [
       (jump_to_menu,"mnu_no_defendiendo"),
        ]
       ),
      ]
  ),

###ataque a circunvallation por defensores
     (
    "no_defendiendo",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The enemy has overcome our defenses and they burn the circunvallation.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 20),
      (else_try),
        (assign, ":division_constant2", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 30),
      (else_try),
        (assign, ":division_constant", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1b",[],"We must begin to build another circunvallation.",
       [
         (assign, "$g_siege_circunvalation", 0),
          (change_screen_return),
        ]
       ),
      ]
  ),
     (
    "defendiendo_circunvallation",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "We have managed to repel the enemy who has returned to the protection of their walls...^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 20),
      (else_try),
        (assign, ":division_constant2", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 50),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 50),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 48),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 48),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 46),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 46),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 44),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 44),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 42),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 42),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 40),
      (else_try),
        (assign, ":division_constant", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1",[],"Well done.",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),
     (
    "defendiendo_mal",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Another wave of enemies took advantage of the concentration of our troops here, and set fire to another part of our circunvallation.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 20),
      (else_try),
        (assign, ":division_constant2", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 30),
      (else_try),
        (assign, ":division_constant", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1",[],"Scit!",
       [
         (assign, "$g_siege_circunvalation", 0),
          (change_screen_return),
        ]
       ),
      ]
  ),
#####ataque a circunvallation acaba

 ###ataque a maquinas de asedio
   (
    "event_siege_20",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The enemy is trying to burn down our assault equipment.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 60),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 60),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 58),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 58),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 56),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 56),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 54),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 54),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 52),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 52),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 50),
      (else_try),
        (assign, ":division_constant2", 50),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 50),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 30),
      (else_try),
        (assign, ":division_constant", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("choice_20_1b",[],"Make hast. I want to send a detachment of men to reinforce the equipment zone, and meanwhile making a threat of assault, forcing them to withdraw.",
       [
          (store_random_in_range, ":rand", 0, 7),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_defendiendo_mal_equip"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_no_defendiendo_equip"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_defendiendo_equip"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_defendiendo_equip"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_defendiendo_equip"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_defendiendo_equip"),
                                          (else_try),
       (jump_to_menu,"mnu_defendiendo_equip"),
          (try_end),
        ]
       ),
      ("choice_20_2b",[],"Fast. Send all men to protect the equipment.",
       [
          (store_random_in_range, ":rand", 0, 7),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_defendiendo_mal_equip"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_defendiendo_mal_equip"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_no_defendiendo_equip"),
                                          (else_try),
                                            (eq, ":rand", 3),
       (jump_to_menu,"mnu_defendiendo_mal"),
                                          (else_try),
                                            (eq, ":rand", 4),
       (jump_to_menu,"mnu_defendiendo_equip"),
                                          (else_try),
                                            (eq, ":rand", 5),
       (jump_to_menu,"mnu_defendiendo_equip"),
                                          (else_try),
       (jump_to_menu,"mnu_defendiendo_equip"),
          (try_end),
        ]
       ),
      ("choice_20_3b",[],"Do not worry, our men will guard it.",
       [
       (jump_to_menu,"mnu_no_defendiendo_equip"),
        ]
       ),
      ]
  ),
###ataque a equipamiento de asedio
     (
    "no_defendiendo_equip",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The enemy has overcome our defenses and burned our equipment.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 30),
      (else_try),
        (assign, ":division_constant2", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 50),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 30),
      (else_try),
        (assign, ":division_constant", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1b",[],"We must begin construction of a new one.",
       [
         (assign, "$g_siege_method", 0),
          (change_screen_return),
        ]
       ),
      ]
  ),
     (
    "defendiendo_equip",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "We have managed to repel the enemy who has returned to the protection of their walls.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 38),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 36),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 34),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 32),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 30),
      (else_try),
        (assign, ":division_constant2", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 30),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 38),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 36),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 34),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 32),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 30),
      (else_try),
        (assign, ":division_constant", 30),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 30),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1h",[],"Well done.",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),
     (
    "defendiendo_mal_equip",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Another wave of enemies have surrounded our positions and burned our siege equipment from the other side.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
          (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 48),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 46),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 44),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 42),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 40),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 40),
      (else_try),
        (assign, ":division_constant2", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 30),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 28),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 26),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 24),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 22),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 20),
      (else_try),
        (assign, ":division_constant", 20),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 20),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1v",[],"Scit!",
       [
         (assign, "$g_siege_method", 0),
          (change_screen_return),
        ]
       ),
      ]
  ),
#####ataque a equipamiento acaba


#continuamos aqui
   (
    "event_siege_21",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your guards discovered several men trying to sneak out at night to escape your circunvallation.",
    "none",
    [

	],
    [
      ("choice_21_1b",[],"Allow them to escape.",
       [
    (call_script, "script_change_player_honor", 2),
            (call_script, "script_change_player_party_morale", -2),
          (change_screen_return),
        ]
       ),
      ("choice_21_2b",[],"Kill them.",
       [
    (call_script, "script_change_player_honor", -2),
            (call_script, "script_change_player_party_morale", 1),
	(change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_siege_22",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "At night, your guards let you know that they have seen a group of enemies dressed in sheep's clothing. Right now enemies are filling bottles along the river to bring water to the settlement.",
    "none",
    [

	],
    [
      ("choice_22_1b",[],"Ambush the enemy in sheep's clothing.",
       [
          (store_random_in_range, ":rand", 0, 3),
                                          (try_begin),
                                            (eq, ":rand", 0),
       (jump_to_menu,"mnu_victoria_ovejas"),
                                          (else_try),
                                            (eq, ":rand", 1),
       (jump_to_menu,"mnu_derrota_ovejas"),
                                          (else_try),
                                            (eq, ":rand", 2),
       (jump_to_menu,"mnu_tablas_ovejas"),
                                          (else_try),
       (jump_to_menu,"mnu_tablas_ovejas"),
          (try_end),
        ]
       ),
      ("choice_22_2b",[],"Do nothing.",
       [
	(change_screen_return),
        ]
       ),
      ]
  ),

#####atacar ovejas chief
       (
    "victoria_ovejas",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your soldiers surround the enemy in sheep's clothing and fall upon them by surprise, spreading death.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 30),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 28),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 26),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 24),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 22),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 20),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 20),
      (else_try),
        (assign, ":division_constant2", 2),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 20),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 50),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 50),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 48),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 48),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 46),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 46),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 44),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 44),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 42),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 42),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 40),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 40),
      (else_try),
        (assign, ":division_constant", 40),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
		(party_get_skill_level, ":tactics", "p_main_party", skl_tactics),
               (val_add, ":division_constant", ":tactics"),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 40),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1l",[],"Perfect!",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),
     (
    "derrota_ovejas",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "It's a trap! Sir, the men dressed in sheep were a decoy to bring out our men and they were ambushed. Many were killing before returning to the protecting of our circunvallation.^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power2", ":player_party_strength"),
      (try_begin),
        (le, ":minimum_power2", 25),
        (assign, ":division_constant2", 60),
      (else_try),
        (le, ":minimum_power2", 50),
        (assign, ":division_constant2", 60),
      (else_try),
        (le, ":minimum_power2", 75),
        (assign, ":division_constant2", 58),
      (else_try),
        (le, ":minimum_power2", 125),
        (assign, ":division_constant2", 58),
      (else_try),
        (le, ":minimum_power2", 200),
        (assign, ":division_constant2", 56),
      (else_try),
        (le, ":minimum_power2", 400),
        (assign, ":division_constant2", 56),
      (else_try),
        (le, ":minimum_power2", 800),
        (assign, ":division_constant2", 54),
      (else_try),
        (le, ":minimum_power2", 1600),
        (assign, ":division_constant2", 54),
      (else_try),
        (le, ":minimum_power2", 3200),
        (assign, ":division_constant2", 52),
      (else_try),
        (le, ":minimum_power2", 6400),
        (assign, ":division_constant2", 52),
      (else_try),
        (le, ":minimum_power2", 12800),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 25600),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 51200),
        (assign, ":division_constant2", 50),
      (else_try),
        (le, ":minimum_power2", 102400),
        (assign, ":division_constant2", 50),
      (else_try),
        (assign, ":division_constant2", 50),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":player_party_strength", ":division_constant2"),
      (val_max, ":player_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":player_party_strength", 50),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
#chief calcula dano aplicado
        (assign, ":minimum_power", ":enemy_party_strength"),
      (try_begin),
        (le, ":minimum_power", 25),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 50),
        (assign, ":division_constant", 20),
      (else_try),
        (le, ":minimum_power", 75),
        (assign, ":division_constant", 18),
      (else_try),
        (le, ":minimum_power", 125),
        (assign, ":division_constant", 18),
      (else_try),
        (le, ":minimum_power", 200),
        (assign, ":division_constant", 16),
      (else_try),
        (le, ":minimum_power", 400),
        (assign, ":division_constant", 16),
      (else_try),
        (le, ":minimum_power", 800),
        (assign, ":division_constant", 14),
      (else_try),
        (le, ":minimum_power", 1600),
        (assign, ":division_constant", 14),
      (else_try),
        (le, ":minimum_power", 3200),
        (assign, ":division_constant", 12),
      (else_try),
        (le, ":minimum_power", 6400),
        (assign, ":division_constant", 12),
      (else_try),
        (le, ":minimum_power", 12800),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 25600),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 51200),
        (assign, ":division_constant", 10),
      (else_try),
        (le, ":minimum_power", 102400),
        (assign, ":division_constant", 10),
      (else_try),
        (assign, ":division_constant", 10),
      (try_end),
##      (val_div, ":player_party_strength", ":division_constant"),
##      (val_max, ":player_party_strength", 1),
      (val_div, ":enemy_party_strength", ":division_constant"),
      (val_max, ":enemy_party_strength", 1),
#chief dano aplicado acaba
#        (val_div, ":enemy_party_strength", 10),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),

        (inflict_casualties_to_party_group, "$g_encountered_party", ":player_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s9, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
	],
    [
      ("defendiendo_1p",[],"It is terrible.",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),
     (
    "tablas_ovejas",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your soldiers were deployed to surround the enemy, but they were too slow and noisy, and men in sheep's clothing find what you offer and return to the settlement quickly.",
    "none",
    [
	],
    [
      ("defendiendo_1o",[],"Scit.",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),
###atacar ovejas acaba

      (
    "event_siege_23",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Today a mercenary who wants to join our ranks has come to our circunvallation. He says he is an exile from the settlement that we are besieging and he wants revenge.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_guerreroelite"),
	],
    [
      ("choice_23_1b",[],"Accept him.",
       [
                  (party_add_members, "p_main_party", "trp_mercenary_horseman", 1),
	    (change_screen_return),
        ]
       ),
      ("choice_23_2b",[],"I don't need more men.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_siege_24",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Sir, we have accumulated heads of enemies and dead peasants. Do you want to use it to undermine the morale of the enemy and cause disease by throwing them over the walls?",
    "none",
    [

	],
    [
      ("choice_24_1b",[],"What? You're a crazy maniac. Do not do that!",
       [
    (call_script, "script_change_player_honor", 1),
	    (change_screen_return),
        ]
       ),
      ("choice_24_2b",[],"Sure, it will be useful when negotiating their surrender.",
       [
           	(call_script, "script_change_player_honor", -15),
       (jump_to_menu,"mnu_cabezas_moral"),
        ]
       ),
      ]
  ),


###cabezas
       (
    "cabezas_moral",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The heads are thrown into the settlement. From the outside you hear cries and tears of citizens when they recognize a loved one. War is merciless, and you're willing to prove you're the most terrible of foes.",
    "none",
    [
	],
    [
      ("defendiendo_1q",[],"This will help them give up ... or die...",
       [
(assign, "$g_cabezas_dentro", 1),
          (change_screen_return),
        ]
       ),
      ]
  ),
###cabezas acaba

      (
    "event_siege_25",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A merchant offers a group of dancers to entertain your men during the night.",
    "none",
    [

	],
    [
      ("choice_25_1b",[],"I need my men ready for action, not distracted or tired.",
       [
            (call_script, "script_change_player_party_morale", -5),
	    (change_screen_return),
        ]
       ),
      ("choice_25_2b",[],"Hire dancers to yourself (100 scillingas).",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
                (display_message, "@ You feel happy."),
            (call_script, "script_change_player_party_morale", -5),
              (add_xp_as_reward, 20),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_25_3b",[],"Your men deserve it. Hire dancers for them (500 scillingas).",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@ You feel good for helping."),
            (call_script, "script_change_player_party_morale", 3),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -8),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_siege_26",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A group of bandits approaches your camp. As your men reach for their arms, the bandits put down their weapons and say they come in peace. The leader of the bandits steps forward and asks if they may join you.",
    "none",
    [
   (set_background_mesh, "mesh_pic_extra_guerreros"),
	],
    [
      ("choice_26_1b",[],"Of course! My warband always welcomes bloodthirsty men!",
       [
            (call_script, "script_change_player_party_morale", -5),
		  (call_script, "script_change_player_honor", -10),
                  (party_add_members, "p_main_party", "trp_mountain_bandit", 8),
                (display_message, "@ New troops join your party."),
	    (change_screen_return),
        ]
       ),
      ("choice_26_2b",[],"I'm sorry, we have no room for your kind!.",
       [
                (display_message, "@ Bandits flee away."),
	   (change_screen_return),
        ]
       ),
      ("choice_26_3b",[],"Prove yourselves worthy by raiding a village and bringing me the chiefs head!",
       [
    (call_script, "script_troop_add_gold", "trp_player", 200),
    (call_script, "script_change_player_honor", -30),
		(call_script, "script_change_troop_renown", "trp_player", -8),
                  (party_add_members, "p_main_party", "trp_mountain_bandit", 8),
                (display_message, "@ After tow hours the bandits return with some loot and the chiefs head..."),
	   (change_screen_return),
        ]
       ),
      ("choice_26_4b",[],"Kill them all!",
       [
    (call_script, "script_troop_add_gold", "trp_player", 50),
    (call_script, "script_change_player_honor", 1),
                (display_message, "@ Your men kill all the bandits."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

            (
    "event_siege_27",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Several merchants approach you wanting to sell their goods in the camp that has formed close to yours with the wives of the soldiers, prostitutes, refugees, children and other followers of the army.",
    "none",
    [

	],
    [
      ("choice_27_1b",[],"They (and their money) are welcome.",
       [
    (call_script, "script_troop_add_gold", "trp_player", 400),
	    (change_screen_return),
        ]
       ),
      ("choice_27_2b",[],"There are enough merchants already.",
       [
	   (change_screen_return),
        ]
       ),
      ("choice_27_3b",[],"Kill them and steal their money.",
       [
    (call_script, "script_change_player_honor", -50),
            (call_script, "script_change_player_party_morale", -12),
    (call_script, "script_troop_add_gold", "trp_player", 1600),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_siege_28",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "To make the food last longer, the defenders threw away their wives, children and the elderly. You can see them moving towards your circunvallation begging for food.",
    "none",
    [

	],
    [
      ("choice_28_1b",[],"Send a party of soldiers, killing children and the elderly, and taking the women to your men.",
       [
    (call_script, "script_change_player_honor", -20),
            (call_script, "script_change_player_party_morale", 2),
		(call_script, "script_change_troop_renown", "trp_player", -15),
	    (change_screen_return),
        ]
       ),
      ("choice_28_2b",[],"Buy food and give it to citizens. (400 schillingas).",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 400),
		(troop_remove_gold, "trp_player", 400),
                (display_message, "@ You feel good for helping."),
           	(call_script, "script_change_player_honor", 5),
            (call_script, "script_change_player_party_morale", -2),
		(else_try),
		(display_message, "@You don't have enough gold, and know that in the coming days hundreds of children, women and elderly will die before your eyes, languished from hunger."),
           	(call_script, "script_change_player_honor", -20),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_28_3b",[],"Do not give them anything. Allow them to die of starvation!",
       [
           	(call_script, "script_change_player_honor", -20),
		(call_script, "script_change_troop_renown", "trp_player", -5),
                (display_message, "@ You know that in the coming days hundreds of children, women and elderly will die before your eyes, languished from hunge."),
	   (change_screen_return),
        ]
       ),
      ]
  ),

 (
    "event_siege_29",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your soldiers, angered by the long siege, rapes the wife of one of your officers.",
    "none",
    [

	],
    [
      ("choice_29_1b",[],"Ignore the situation.",
       [
           	(call_script, "script_change_player_honor", -5),
       (jump_to_menu,"mnu_cabezas_moral"),
	    (change_screen_return),
        ]
       ),
      ("choice_29_b",[],"Punish the soldier.",
       [
           	(call_script, "script_change_player_honor", 2),
       (jump_to_menu,"mnu_cabezas_moral"),
        ]
       ),
      ("choice_29_3b",[],"Execute the soldier.",
       [
           	(call_script, "script_change_player_honor", 6),
            (call_script, "script_change_player_party_morale", -9),
	   (change_screen_return),
        ]
       ),
      ("choice_29_4b",[],"Pay wergild (compensation) to officer (500 scillingas).",
       [
            (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
                (display_message, "@ The wife is pregnant and the officer asks for a high compensation. To avoid rumors and problems, you pay."),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
           	(call_script, "script_change_player_honor", -10),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

###soldado problematico
       (
    "lucha_oficial",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your officer kills the soldier and there is a brawl between some friends of the soldier and those loyal to your official.^^Casualties:{s8}",
    "none",
    [
        (call_script, "script_party_calculate_strength", "p_main_party", 1), #skip player
        (assign, ":player_party_strength", reg0),
        (val_div, ":player_party_strength", 40),

        (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
        (assign, ":enemy_party_strength", reg0),
        (val_div, ":enemy_party_strength", 50),

        (inflict_casualties_to_party_group, "p_main_party", ":enemy_party_strength", "p_temp_casualties"),
        (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
        (str_store_string_reg, s8, s0),
   (set_background_mesh, "mesh_pic_extra_encuentro"),
        ],
    [
      ("defendiendo_1z",[],"That is terrible.",
       [
          (change_screen_return),
        ]
       ),
      ]
  ),


####siege warfare acaba chief random event

####random event juicios cuando eres rey chief
    (
    "event_01_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Two farmers, one very tall and lanky, the other low and stocky, were presented to you to discuss the ownership of a calf. Apparently their fields were bordering and the tall farmer had a bull that impregnated a cow belonging to the other farmer.\
The stocky farmer said the calf was his because it was his cow giving birth. The tall farmer claimed the calf to be his, being the offspring of his best bull, or at least financial compensation.",
    "none",
    [

	],
    [
      ("choice_01_1n",[],"The owner of the cow's right. The calf is yours, just like the cow is.",
       [
		  (call_script, "script_change_troop_renown", "trp_player", -1),
          (change_screen_return),
        ]
       ),
      ("choice_01_2n",[],"The owner of the bull's right. The bull is his and the calf too.",
       [
		  (call_script, "script_change_troop_renown", "trp_player", -1),
		(change_screen_return),
        ]
       ),
      ("choice_01_3n",[],"The owner of the cow keeps the calf and pays compensation of 30 scillingas to the owner of the bull.",
       [
	   (change_screen_return),
        ]
       ),
      ("choice_01_4n",[],"Neither is right. I'll stick with the calf and beef!",
       [
            (troop_add_item, "trp_player","itm_dried_meat",0),
		  (call_script, "script_change_troop_renown", "trp_player", -2),
	   (change_screen_return),
        ]
       ),
      ("choice_01_5n",[],"Neither is right. kill the calf and distribute its meat to the two farmers!",
       [
		  (call_script, "script_change_troop_renown", "trp_player", 2),
	   (change_screen_return),
        ]
       ),
      ]
  ),


  (
    "event_02_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "My lord, we captured the attacker! This is the men who attacked one of your messengers, who is lying seriously injured in bed. This doesn't show us in good light, the messenger was under your protection. But the attacker has an interesting story, and his wish was to tell it to you before his execution.^^\
Prisioner talk: My lord I would have never thought of attacking your messenger but... That man wished to sleep with my young daughter for the night, of course this offer was refused, we are not barbarians! However he never accepted the answer, entered my house with his three friends, and robbed my dear daughter, laughing that my king will never believe a commoner's word. I tried what I could think of, and I regret that I seriously injured him while he was under your personal protection, but a father must protect his only child! Please be reasonable to your humble servant!",
    "none",
    [

	],
    [
      ("choice_02_1n",[],"The messenger was under my protection. You and your family will be executed at dawn, all your belongings confiscated!",
       [
	   (troop_add_gold, "trp_player", 500),
		(call_script, "script_change_troop_renown", "trp_player", -5),
	   (call_script, "script_change_player_honor", -5),
		(change_screen_return),
        ]
       ),
      ("choice_02_2n",[],"The messenger is important, but I will be reasonable with you: Your family will not be punished, it is only you who will hang.",
       [
	   (call_script, "script_change_troop_renown", "trp_player", -2),
		(change_screen_return),
        ]
       ),
      ("choice_02_3n",[],"While the messenger is important, I would have done the same. You can go, the king has spoken!",
       [
	   (call_script, "script_change_player_honor", 1),
            (call_script, "script_change_player_party_morale", -2),
	   (change_screen_return),
        ]
       ),
      ("choice_02_4n",[],"What? Out with that bastard messenger from my city, how can he abuse my loyal followers?!",
       [
	   (call_script, "script_change_player_honor", 1),
		(call_script, "script_change_troop_renown", "trp_player", 2),
            (call_script, "script_change_player_party_morale", -4),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_03_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You summon two men to decide a dispute between two men. One is a lord, while the other is a man sworn to the lord. It seems what happened is that the Lord didn't have enough tribute to pay his man, so the oath-man took his Lord's daughter to his own bed and had his way with her.",
    "none",
    [

	],
    [
      ("choice_03_1n",[],"Punish the oath-man, he violated his Lord's honor.",
       [
            (call_script, "script_change_player_party_morale", -5),
		(call_script, "script_change_troop_renown", "trp_player", 3),
	   (change_screen_return),
        ]
       ),
      ("choice_03_2n",[],"Punish the Lord, he failed in his duty as Lord.",
       [
            (call_script, "script_change_player_party_morale", 3),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(change_screen_return),
        ]
       ),
      ("choice_03_3n",[],"Ask to see the daughter, and when she is brought forth, you decide it was punishment enough that the oath-man had to sleep with her. Hire the oath-man for your own warband.",
       [
                  (party_add_members, "p_main_party", "trp_farmer", 1),
	   (call_script, "script_change_player_honor", -5),
	   (change_screen_return),
        ]
       ),
      ("choice_03_4n",[],"Compensate the Lord yourself for this crime, and pay the oath-man for the Lord's dereliction of duty.",
       [
		          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(call_script, "script_change_player_honor", 1),
		(troop_remove_gold, "trp_player", 500),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),


  (
    "event_04_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your sworn men approachs you. He states his fears that among the men, there is much dissatiafaction. Pertaining that you are too placid and that there is too little gold and honour to be won under your service.",
    "none",
    [

	],
    [
      ("choice_04_1n",[],"Pay the men and give rings to them.",
       [
		          (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 1000),
		(troop_remove_gold, "trp_player", 1000),
            (call_script, "script_change_player_party_morale", 4),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
            (call_script, "script_change_player_party_morale", -4),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_04_2n",[],"Tell the men that they are released from their oaths if they are so stupid and savage to question the wisdom of your leadership.",
       [
            (call_script, "script_change_player_party_morale", -24),
		(change_screen_return),
        ]
       ),
      ("choice_04_3n",[],"Kill the man who approached you in front of your men and state there shall be no more talk of sedition.",
       [
	   (call_script, "script_change_player_honor", -30),
            (call_script, "script_change_player_party_morale", -14),
	   (change_screen_return),
        ]
       ),
      ("choice_04_4n",[],"Promise to change your leadership style, and say the next big plunder is just round the corner.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_05_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Gluttony. One of the 7 deadly sins your majesty. After having feasted your lords repeatedly for the last 4 months, it appears your tunic no longer slips over your head. You have begun wearing open chest tunics and generally snacking on delicious fruits from the east. Dinner is of course a spiced pig roasted to perfection. Your wife abhors you but she is barren anyway and you have no lack of ladies/men willing to satisfy your flesh. Your physician however feels you have reached some sort of tipping point, and has suggested fresh air and a general course of exercise and a limited diet.",
    "none",
    [

	],
    [
      ("choice_05_1n",[],"Eat more food and change your physician.",
       [
            (troop_add_item, "trp_player","itm_dried_meat",0),
             (troop_raise_attribute, "trp_player",ca_strength,-2),
             (change_screen_return),
        ]
       ),
      ("choice_05_2n",[],"Go on a pilgrimage to Bath, to enjoy the roman water baths there whilst exercising regularly.",
       [
	    (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(troop_remove_gold, "trp_player", 300),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -7),
		(try_end),
		(change_screen_return),
        ]
       ),
      ("choice_05_3n",[],"Exist entirely on bowls of beans and lentils, you develop a foul temper and often execute men who comment on your weight.",
       [
            (call_script, "script_change_player_party_morale", -7),
	   (change_screen_return),
        ]
       ),
      ]
  ),


   (
    "event_06_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your wife tarries with a youth of soft skin and curls that have an almost grecian style to them. Indeed your wife even calls him a young apollo it is rumoured. Whilst it is ok for you to practise your sword craft among the populance, for your wife to taint your marriage in such a manner is...",
    "none",
    [
	],
    [
      ("choice_06_1n",[],"Leave your wife be, she is happy and you see no need to ruin such splendour (perhaps the heir to the throne is not your child 75%).",
       [
		(call_script, "script_change_troop_renown", "trp_player", -105),
          (change_screen_return),
        ]
       ),
      ("choice_06_2n",[],"No man cuckolds the King, have the youth seized castrated and killed.",
       [
	   (call_script, "script_change_player_honor", -15),
		(change_screen_return),
        ]
       ),
      ("choice_06_3n",[],"Move in your mother to keep an eye on the queen (perhaps the heir to the throne is not your child 50%).",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_07_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The crop this year has whithered miserably under the sun. As the first snow has fallen, there are many who fear the long months of winter as starvation looms. What should we do, my Lord?",
    "none",
    [
	],
    [
      ("choice_07_1n",[],"I cannot spare any grain as I have to feed my household... besides... there are feasts to be had.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -15),
	   (call_script, "script_change_player_honor", -10),
            (call_script, "script_change_player_party_morale", 4),
          (change_screen_return),
        ]
       ),
      ("choice_07_2n",[],"Distribute some wagons of grain to my people, it is the most I can spare..",
       [
    (try_begin),
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
      (try_end),
      (try_begin),
        (ge, ":number_of_foods_player_has", 6),
        (unlock_achievement, ACHIEVEMENT_ABUNDANT_FEAST),
      (try_end),
    (try_end),
    (assign, ":consumption_amount", 10),
    (assign, ":no_food_displayed", 0),
    (try_for_range, ":unused", 0, ":consumption_amount"),
      (assign, ":available_food", 0),
      (try_for_range, ":cur_food", food_begin, food_end),
        (item_set_slot, ":cur_food", slot_item_is_checked, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_food", imod_rotten),
        (val_add, ":available_food", 1),
      (try_end),
      (try_begin),
        (gt, ":available_food", 0),
        (store_random_in_range, ":selected_food", 0, ":available_food"),
        (call_script, "script_consume_food", ":selected_food"),
	   (call_script, "script_change_player_honor", 10),
	   (call_script, "script_change_player_party_morale", -2),
	   (display_message, "@Part of your food was distribute.", 0xFF0000),
      (else_try),
        (eq, ":no_food_displayed", 0),
        (display_message, "@Your men have nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -18),
        (assign, ":no_food_displayed", 1),
        (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
      (try_end),
    (try_end),
		(change_screen_return),
        ]
       ),
      ("choice_07_3n",[],"Import grain from Frankia, let there be enough for all my people (expensive).",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 1000),
		(troop_remove_gold, "trp_player", 1000),
         	   (call_script, "script_change_player_honor", 15),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -50),
		(try_end),
	   (change_screen_return),
        ]
       ),
	   ("choice_07_4n",[],"Let them rot! Serves them right for not tending to their crops carefully enough!",
       [
	   (call_script, "script_change_player_honor", -20),
	   (change_screen_return),
        ]
       ),
      ]
  ),

(
    "event_08_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One of your lords approaches you stating, he has an illegitimate son(who he favours) who wishes to join your bodyguard, you agree to meet the boy as it would be unseemly to flat out reject a noble. When you meet the boy, however it is clear that he is rather homely and certainly not a man of war. Faced with this plump, smiling young man do you.",
    "none",
    [
	],
    [
      ("choice_08_1n",[],"Allow him to join your bodyguard thus appalling your bodyguard.",
       [
                  (party_add_members, "p_main_party", "trp_farmer", 1),
        (call_script, "script_change_player_party_morale", -10),
          (change_screen_return),
        ]
       ),
      ("choice_08_2n",[],"Ask for payment to grease the deal.",
       [
                  (party_add_members, "p_main_party", "trp_farmer", 1),
	   (troop_add_gold, "trp_player", 500),
        (call_script, "script_change_player_party_morale", -18),
		(change_screen_return),
        ]
       ),
      ("choice_08_3n",[],"Refuse outright, no money or morale boost.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(change_screen_return),
        ]
       ),
      ]
  ),
#fine
    (
    "event_09_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Two proposals come before you one day. One is a scholarly young lisping monk called Brother Gilrchrist who proposes the building of more monastries and a fund to be set aside to buy and maintain books of knowledge, although his case is eloquent, the delivery is less so.\
Another man comes forward. A hulking great bearded warrior of a man who makes gilchrist visibly wince in his shadow, he suggests the funds be better allocated in purchasing weapons, horses and shields, things that can be used today and are not merely fantasies.",
    "none",
    [

	],
    [
      ("choice_09_1n",[],"Choose Gilchrist stating that a wise king has need of books far more than the sword.",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 600),
		(troop_remove_gold, "trp_player", 600),
                  (troop_raise_attribute, "trp_player",ca_intelligence,1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
                  (change_screen_return),
        ]
       ),
      ("choice_09_2n",[],"Choose the warrior, stating that books have no place in this age of war.",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 600),
		(troop_remove_gold, "trp_player", 600),
                  (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,15),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
	    (change_screen_return),
        ]
       ),
      ("choice_09_3n",[],"State a kingdom needs both men of knowledge and men of war (expensive).",
       [
		(store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 2000),
		(troop_remove_gold, "trp_player", 2000),
                  (troop_raise_attribute, "trp_player",ca_intelligence,1),
                  (troop_raise_proficiency, "trp_player",wpt_one_handed_weapon,15),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -20),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_9_4n",[],"I'm not interested.",
       [
                  (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_10_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A searing flash is seen across the night sky. There is much talk of omens the next day, among the people of {s1} there is a general consensus that some act of sacrifice must be committed or some wrath shall befall the kingdom. The practise of the wickerman suddenely gains impetus as it is near harvest time. You find an angelic girl and she is treated with as a living goddess until just before harvest.",
    "none",
    [
	(assign, ":stop", 0),
	(try_for_range, ":unused", 0, 9999),
	(eq, ":stop", 0),
	(store_random_party_in_range, "$temp", centers_begin, centers_end),
	(neg|party_slot_eq, "$temp", slot_party_type, spt_castle),
	(party_slot_eq, "$temp", slot_town_lord, "trp_player"),
	(assign, ":stop", 1),
	(str_store_party_name, s1, "$temp"),
	(try_end),
	],
    [
      ("choice_10_1n",[],"She is then burned alive inside a wickeman of straw.",
       [
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", 10),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
                  (change_screen_return),
        ]
       ),
      ("choice_10_2n",[],"You refuse to enact such a barbaric practise and you send the girl away from the town to safety.",
       [
		(party_get_slot, ":cur_relation", "$temp", slot_center_player_relation),
		(val_add, ":cur_relation", -20),
		(party_set_slot, "$temp", slot_center_player_relation, ":cur_relation"),
                  (party_add_members, "p_main_party", "trp_refugee", 1),
	    (change_screen_return),
        ]
       ),
      ("choice_10_3n",[],"This is no affair of yours.",
       [
	   (call_script, "script_change_player_honor", -10),
	   (change_screen_return),
        ]
       ),
      ]
  ),

        (
    "event_11_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The sound of a galloping horse pierces the cold morning, and you run outside to find a scout. He tells you a strange ship carrying men who speak a strange language has been shipwrecked near your coast. What do you do?",
    "none",
    [

	],
    [
      ("choice_11_1n",[],"Immediately send a warband to investigate and search for valuables; if there are any survivors, kill them.",
       [
           	(call_script, "script_change_player_honor", -8),
	   (troop_add_gold, "trp_player", 500),
          (change_screen_return),
        ]
       ),
      ("choice_11_2n",[],"Immediately send a warband to investigate and search for valuables; if there are any survivors, recruit them.",
       [
	   (call_script, "script_change_player_honor", 2),
        (call_script, "script_change_player_party_morale", -8),
                  (party_add_members, "p_main_party", "trp_black_khergit_horseman", 4),
	    (change_screen_return),
        ]
       ),
      ("choice_11_3n",[],"Do nothing.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

          (
    "event_12_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The runner arrives at the courtroom, and after you allow, starts to tell dire news: My lord, a village is in great danger! The populace has some kind of strange sickness, they can hardly move, sweat and vomit, and the local wise-woman has no cure for it. The lord of the village doesn't let anyone out for the moment, and is expecting your orders!",
    "none",
    [

	],
    [
      ("choice_12_1n",[],"Dire news indeed! The quarantine should stay, but I will send in my best galeno to help!",
       [   (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(troop_remove_gold, "trp_player", 300),
           	(call_script, "script_change_player_honor", 3),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_12_2n",[],"Dire news indeed! We cannot risk our best galeno. The quarantine should stay, and we will examinethe survivors when the epicemic is over!",
       [
           	(call_script, "script_change_player_honor", -15),
	    (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_13_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "The nuns approach you: My lord, the childbirth is not going well! We tried everything we could, but it seems that the young lady is simply not suited for pregnancy. All what is left is to pray for our dear Virgin Mary to help!.",
    "none",
    [

	],
    [
      ("choice_13_1n",[],"Everybody, kneel down and start praying!",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -2), #la q designemos
          (change_screen_return),
        ]
       ),
      ("choice_13_2n",[],"Hah! You christians are good for nothing! Guards: Bring me the wise-woman from the village, NOW!.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -2), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
	(change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_14_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One day, a loyal noble warrior comes to you with a strange request. 'My lord, I am in a very bad situation. I spent all my money on proper equipment and troops, so that I can serve you well. However, my first daughter is about to marry, and I cannot give a proper present with her to the husband'.",
    "none",
    [

	],
    [
      ("choice_14_1n",[],"Take this small amount of gold for your faithful service (expensive).",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 800),
		(troop_remove_gold, "trp_player", 800),
           	(call_script, "script_change_player_honor", 10),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
 (change_screen_return),
        ]
       ),
      ("choice_14_2n",[],"Everyone should plan ahead, you should have known it is time to marry off your daughter. I will help you now, this is the last time.",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 400),
		(troop_remove_gold, "trp_player", 400),
        (call_script, "script_change_player_party_morale", -2),
           	(call_script, "script_change_player_honor", 2),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
	(change_screen_return),
        ]
       ),
      ("choice_14_3n",[],"No, you should have saved up the money up front!",
       [
        (call_script, "script_change_player_party_morale", -12),
	   (call_script, "script_change_player_honor", -15),
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_15_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "One day, your chaplain arrives at your doorstep, he seems very enthusiastic! My lord, I have splendid news! There is a marchant from Jerusalem in the city now, and he is willing to sell us a piece of the Holy Cross! I cannot believe that our kingdom has the opportunity to have such a famous relic!",
    "none",
    [

	],
    [
      ("choice_15_1n",[],"I have seen so many parts of the Holy Cross, that it must have been at least a size of a castle! We don't pay for fake relics!",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -20), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -8),
      (try_end),
                  (change_screen_return),
        ]
       ),
      ("choice_15_2n",[],"This is a very good offer indeed, but sadly we don't have that much in the coffers.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -20), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -8),
      (try_end),
	    (change_screen_return),
        ]
       ),
      ("choice_15_3n",[],"We cannot let this opportunity slip! BUY (expensive).",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 5000),
		(troop_remove_gold, "trp_player", 5000),
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 10), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -10), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", 4),
      (try_end),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -55),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

        (
    "event_16_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "You were having a feast with your companions when a messenger of the guild masters court came to your attention, 'My great King, there is a situation in the town and needs your council.' You stepped outside, but taking your mighty sword with you.^^\
There is a gread deal of rumble among the crowd, but when you appear, silence beffals the audience. A ancient bows to you and ask permission to speak, which you give, and says: My lord here a case worthy of a kings wisdom. There are two women who claim to be the mother of this child, neither desist.^\
You say to the crowd 'Let their faces be know and let this forgo'. Two women show up, one in plain clothes and another in rags. You say 'If neither agree, the children will be in the dead sea' You direct your guards to cut the children in half and give each half to the two women.\
Then the woman in rags scream and says 'No please my great king, let the other women have the child then. You stare at her and say: 'Your are the rightfull mother and this child belongs to you', and the other woman:",
    "none",
    [

	],
    [
      ("choice_16_1n",[],"Imprison her for lying, for it is the greatest sin.",
       [
	   (call_script, "script_change_player_honor", 5),
		(call_script, "script_change_troop_renown", "trp_player", -5),
                  (change_screen_return),

        ]
       ),
      ("choice_16_2n",[],"Cut her down with your mighty sword, to show that is no mercy for liars.",
       [
	   (call_script, "script_change_player_honor", -5),
		(call_script, "script_change_troop_renown", "trp_player", 5),
	    (change_screen_return),
        ]
       ),
      ("choice_16_3n",[],"Give her and the crowd a speech about honesty and honor and let her live.",
       [
	   (change_screen_return),
        ]
       ),
      ]
  ),

     (
    "event_17_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your advisor, streaked with dirt and sunburned, arrives after inspecting the harvest. 'My Lord, the harvest is poor this year. If you do not reduce taxes there will be starvation this winter.'",
    "none",
    [

	],
    [
      ("choice_17_1n",[],"And if I reduce taxes I will have to release men from their oaths, and our enemies would overrun us. Better a empty gut than a cut throat.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -25),
                  (change_screen_return),

        ]
       ),
      ("choice_17_2n",[],"Then reduce the tax (I will compensate it for my treasure).",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 2000),
		(troop_remove_gold, "trp_player", 2000),
		(call_script, "script_change_troop_renown", "trp_player", 15),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -35),
		(try_end),
	    (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_18_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A peasant from a nearby village comes to you as a supplicant. He breathlessly reports that armed men from a nearby kingdom have raided your holdings, carrying off women, cattle and grain. He is spattered with blood and stinks of burned thatch.",
    "none",
    [

	],
    [
      ("choice_18_1n",[],"Gather my men! We'll avenge this insult in their blood! (Raid is expensive).",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 300),
		(troop_remove_gold, "trp_player", 300),
		(call_script, "script_change_troop_renown", "trp_player", 5),
		  (call_script, "script_change_player_honor", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -15),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_18_2n",[],"There is nothing to be done here. Away with you, mongrel!",
       [
            (call_script, "script_change_player_party_morale", -2),
		  (call_script, "script_change_player_honor", -10),
	(change_screen_return),
        ]
       ),
      ("choice_18_3n",[],"There will be war. You have done well to report this to me. Take this money and rebuild your village.",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 150),
		(troop_remove_gold, "trp_player", 150),
		(call_script, "script_change_troop_renown", "trp_player", 1),
		  (call_script, "script_change_player_honor", 1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_18_4n",[],"How can I be sure it wasn't a band of outlaws or pirates? There is little I can do for you. Take this to compensate some of your losses.",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 100),
		(troop_remove_gold, "trp_player", 100),
		  (call_script, "script_change_player_honor", 1),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -5),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_19_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A quastuosa is accused of witchcraft, after several oathmen sworn to your vassal report pain while relieving themselves. Your vassal backs their claim, and you suspect they have the same complaint but know better than to air it publicly.",
    "none",
    [

	],
    [
      ("choice_19_1n",[],"Banish the quasosta, exiling her to your enemy's lands.",
       [
    (call_script, "script_change_player_honor", -1),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2), #la q designemos
          (change_screen_return),
        ]
       ),
      ("choice_19_2n",[],"Pay a retainer to the witch and have her cooperate with your pagan priests to counteract the spread of Christianity.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -10), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 2), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -4),
      (try_end),
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_1", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_13", -4), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_kingdom_9", 2), #la q designemos
	(change_screen_return),
        ]
       ),
      ("choice_19_3n",[],"Witches! Where there's one there's many! Kill the witch and ensure the sanctity of your God-given holdings by killing anyone else reported for witchcraft.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -10), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", 1),
      (try_end),
	(change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_20_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "An abbot comes upon you and tells you that most inhabitants of one of your villages where he was introducing God grace has taken arms and kicked him and his followers when they wanted to slaughter a tree which they worshiped as pagan fools.",
    "none",
    [

	],
    [
      ("choice_20_1n",[],"This abbot is right : cut this heretic tree in pikes and show on them those pagan heads.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", 8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", -10), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", 1),
      (try_end),
          (change_screen_return),
        ]
       ),
      ("choice_20_2n",[],"This abbot is wrong : make him and his followers burn for the old Gods.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -18), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 8), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -2),
      (try_end),
	(change_screen_return),
        ]
       ),
      ("choice_20_3",[],"This abbot is wrong : make those christans leave this village and let the village in peace.",
       [
          (call_script, "script_change_player_relation_with_faction", "fac_christians", -8), #la q designemos
          (call_script, "script_change_player_relation_with_faction", "fac_pagans", 4), #la q designemos
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (neg|party_slot_ge, ":center", center_religion_pagana, 1),
  (call_script, "script_change_player_relation_with_center", ":center", -1),
      (try_end),
	(change_screen_return),
        ]
       ),
      ("choice_20_4n",[],"Do nothing.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -10),
          (change_screen_return),
        ]
       ),
      ]
  ),

   (
    "event_21_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your people live divided up into familial clans. One day a young clan leader comes to you with a request for justice. His clan has long suffered in the cattle raiding that exists between all clans to a stronger clan, stronger he says purely by numbers and chance. In an attempt to stem the flow of loss, this eminity between the two clans haveing existed for at least a hundred years, the young clan chief suggested a marraige to one of the daughters of the other clan.\
The other clan chief a wily old man however had a suprise for the young man. Having picked his bride, all seemed to be set. It was to the young man's horror that he was presented with the younger sister of his chosen bride, the young man being a romantic at heart and as stubborn as one who believes in true love is refused outright. He then with his chosen men and brothers carried off his chosen bride in the night. The other clan chief then annexed his lands on claims of rape and theft. The young clan chief requests the return of his land and to live with his bride there.",
    "none",
    [

	],
    [
      ("choice_21_1n",[],"Grant the man's request.",
       [
    (call_script, "script_change_player_honor", 2),
        (troop_add_gold, "trp_player", 100),
          (change_screen_return),
        ]
       ),
      ("choice_21_2n",[],"Imprison the man and declare his clan forfeit and the lands given over to the bigger clan.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -5),
    (call_script, "script_change_player_honor", -5),
        (troop_add_gold, "trp_player", 500),
	(change_screen_return),
        ]
       ),
      ("choice_21_3n",[],"Seize the lands for yourself and imprison or exile the youth.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -10),
    (call_script, "script_change_player_honor", -10),
        (troop_add_gold, "trp_player", 1000),
	(change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_22_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A woman from a nearby village comes to you claiming that one of your men who has died recently was her husband, she asks for assistance to take care of her deceased husband.",
    "none",
    [

	],
    [
      ("choice_22_1n",[],"Give her Monetary assistance and send for a priest.",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
		  (call_script, "script_change_player_honor", 5),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
          (change_screen_return),
        ]
       ),
      ("choice_22_2n",[],"Do Nothing.",
       [
    (call_script, "script_change_player_honor", -8),
	(change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_23_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Your wife and queen approaches you with a request, 'My lord, would it not show your great mercy and honor by providing for those who have suffered while serving under you? We have dozens of maimed, lamed and aged soldiers begging for coin in the streets, and many families who have lost fathers and husbands in your battles. We need to reward and protect your loyal supporters or else men might be hesitant in the future to be in your shieldwall.",
    "none",
    [

	],
    [
      ("choice_23_1n",[],"Bah! Let the orphans and my warriors who were unskilled enough to defend themselves properly rot.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -15),
    (call_script, "script_change_player_honor", -15),
	    (change_screen_return),
        ]
       ),
      ("choice_23_2n",[],"Send those outcasts my regards, but I regret there is nothing I can do for them.",
       [
		(call_script, "script_change_troop_renown", "trp_player", -15),
	   (change_screen_return),
        ]
       ),
      ("choice_23_3n",[],"I agree, we should support our veterans and their families, just this once as I am feeling generous.",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 500),
		(troop_remove_gold, "trp_player", 500),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -10),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_23_4n",[],"This is a tragedy! Immediately open my coffers and make it kingdom policy that all families shall receive support from their King.",
       [
 (store_troop_gold, ":gold", "trp_player"),
	   (try_begin),
		(ge, ":gold", 2000),
		(troop_remove_gold, "trp_player", 2000),
		(call_script, "script_change_troop_renown", "trp_player", 15),
    (call_script, "script_change_player_honor", 15),
		(else_try),
		(display_message, "@You don't have enough gold. How embarassing!"),
		(call_script, "script_change_troop_renown", "trp_player", -30),
		(try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

      (
    "event_24_juicio",menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "A seemingly straightforward case is brought before you: Yesterday, the accused man broke into the victim's house and removed large amounts of wealth. Many people saw him and the missing items were discovered in his house. But the victim was a influential supporter of the previous lord, had actually served as a councillor and was known to be of doubtful loyalties, while the accused was one of your most vocal supporters and had donated much money to your cause.",
    "none",
    [

	],
    [
      ("choice_24_1n",[],"Ignoring the evidence, You settle in your man's favor, actually saying that he was acting on your orders.",
       [
    (call_script, "script_change_player_honor", -6),
            (call_script, "script_change_player_party_morale", 5),
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (call_script, "script_change_player_relation_with_center", ":center", -1),
      (try_end),
	    (change_screen_return),
        ]
       ),
      ("choice_24_2n",[],"The evidence is clear, the jury agrees, and the accused is found guilty and has his hands cut off for theft!",
       [
            (call_script, "script_change_player_party_morale", -15),
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (call_script, "script_change_player_relation_with_center", ":center", 1),
      (try_end),
	   (change_screen_return),
        ]
       ),
      ("choice_24_3n",[],"You claim both parties are in the wrong, exiling them and confiscating all material pertaining to the case.",
       [
        (troop_add_gold, "trp_player", 1000),
            (call_script, "script_change_player_party_morale", -10),
  #reduce relacion con cada centro chief
      (try_for_range, ":center", centers_begin, centers_end),
  (call_script, "script_change_player_relation_with_center", ":center", -1),
      (try_end),
	   (change_screen_return),
        ]
       ),
      ]
  ),

####juicios chief acaba

  #construir torre de vigia
  #x############################################
  #Tempered chief entrenchment remastered menus begin
#Tempered entrenched camp menu not currently used
	("entrenched_camp",mnf_scale_picture,
	"  Your fortifications are complete.    ",
	"none",
		[
			(set_background_mesh, "mesh_pic_camp"),
		],
		[
      ("camp_wait_here",[],"Wait here for some time.",
       [
           (assign, "$g_infinite_camping", 0),
           (try_begin),
             (party_is_active, "p_main_party"),
             (party_get_current_terrain, ":cur_terrain", "p_main_party"),
             (try_begin),
               (eq, ":cur_terrain", rt_desert),
               (unlock_achievement, ACHIEVEMENT_SARRANIDIAN_NIGHTS),
             (try_end),
           (try_end),
           (rest_for_hours_interactive, 24 * 365, 5, 1), #rest while attackable
           (change_screen_map),
        ]
       ),

      ("camp_inspect",[
          (party_get_current_terrain,":terrain","p_main_party"),
         (neq,":terrain",0),
          (neq,":terrain",7),
          (neq,":terrain",8),
          ],"Inspect your camp.",
       [
			(call_script,"script_visit_camp"),
        ]
       ),

      ("resume_travelling",[],"Resume travelling.",
       [   (assign, "$g_player_icon_state", pis_normal),
		   #(party_set_slot,"p_main_party",slot_party_entrenched,0), #TEMPERED ADDED LINE FOR NO ENTRENCHMENT
		   #(assign,"$current_camp_party",-1), #TEMPERED ADDED LINE FOR NO ENTRENCHMENT
		   (assign, "$g_camp_mode", 0),
           (change_screen_map),
        ]
       ),

		]
	),

##################grueso chief acaba


 ]
